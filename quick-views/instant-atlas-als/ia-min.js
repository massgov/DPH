(function($,h,c){var a=$([]),e=$.resize=$.extend($.resize,{}),i,k="setTimeout",j="resize",d=j+"-special-event",b="delay",f="throttleWindow";e[b]=250;e[f]=true;$.event.special[j]={setup:function(){if(!e[f]&&this[k])return false;var l=$(this);a=a.add(l);$.data(this,d,{w:l.width(),h:l.height()});if(a.length===1)g()},teardown:function(){if(!e[f]&&this[k])return false;var l=$(this);a=a.not(l);l.removeData(d);if(!a.length)clearTimeout(i)},add:function(l){if(!e[f]&&this[k])return false;var n;function m(s,
o,p){var q=$(this),r=$.data(this,d);r.w=o!==c?o:q.width();r.h=p!==c?p:q.height();n.apply(this,arguments)}if($.isFunction(l)){n=l;return m}else{n=l.handler;l.handler=m}}};function g(){i=h[k](function(){a.each(function(){var n=$(this),m=n.width(),l=n.height(),o=$.data(this,d);if(m!==o.w||l!==o.h)n.trigger(j,[o.w=m,o.h=l])});g()},e[b])}})(jQuery,this);(function(){var m,k=function(){this.form=this.digits=0;this.lostDigits=!1;this.roundingMode=0;var a=this.DEFAULT_FORM,b=this.DEFAULT_LOSTDIGITS,c=this.DEFAULT_ROUNDINGMODE;if(4==k.arguments.length)a=k.arguments[1],b=k.arguments[2],c=k.arguments[3];else if(3==k.arguments.length)a=k.arguments[1],b=k.arguments[2];else if(2==k.arguments.length)a=k.arguments[1];else if(1!=k.arguments.length)throw"MathContext(): "+k.arguments.length+" arguments given; expected 1 to 4";var d=k.arguments[0];if(d!=this.DEFAULT_DIGITS){if(d<
this.MIN_DIGITS)throw"MathContext(): Digits too small: "+d;if(d>this.MAX_DIGITS)throw"MathContext(): Digits too large: "+d;}if(a!=this.SCIENTIFIC&&a!=this.ENGINEERING&&a!=this.PLAIN)throw"MathContext() Bad form value: "+a;if(!this.isValidRound(c))throw"MathContext(): Bad roundingMode value: "+c;this.digits=d;this.form=a;this.lostDigits=b;this.roundingMode=c};k.prototype.getDigits=function(){return this.digits};k.prototype.getForm=function(){return this.form};k.prototype.getLostDigits=function(){return this.lostDigits};
k.prototype.getRoundingMode=function(){return this.roundingMode};k.prototype.toString=function(){var a=null,b=0,c=null,a=this.form==this.SCIENTIFIC?"SCIENTIFIC":this.form==this.ENGINEERING?"ENGINEERING":"PLAIN",d=this.ROUNDS.length,b=0;a:for(;0<d;d--,b++)if(this.roundingMode==this.ROUNDS[b]){c=this.ROUNDWORDS[b];break a}return"digits="+this.digits+" form="+a+" lostDigits="+(this.lostDigits?"1":"0")+" roundingMode="+c};k.prototype.isValidRound=function(a){var b=0,c=this.ROUNDS.length,b=0;for(;0<c;c--,
b++)if(a==this.ROUNDS[b])return!0;return!1};k.PLAIN=k.prototype.PLAIN=0;k.SCIENTIFIC=k.prototype.SCIENTIFIC=1;k.ENGINEERING=k.prototype.ENGINEERING=2;k.ROUND_CEILING=k.prototype.ROUND_CEILING=2;k.ROUND_DOWN=k.prototype.ROUND_DOWN=1;k.ROUND_FLOOR=k.prototype.ROUND_FLOOR=3;k.ROUND_HALF_DOWN=k.prototype.ROUND_HALF_DOWN=5;k.ROUND_HALF_EVEN=k.prototype.ROUND_HALF_EVEN=6;k.ROUND_HALF_UP=k.prototype.ROUND_HALF_UP=4;k.ROUND_UNNECESSARY=k.prototype.ROUND_UNNECESSARY=7;k.ROUND_UP=k.prototype.ROUND_UP=0;k.prototype.DEFAULT_FORM=
k.prototype.SCIENTIFIC;k.prototype.DEFAULT_DIGITS=9;k.prototype.DEFAULT_LOSTDIGITS=!1;k.prototype.DEFAULT_ROUNDINGMODE=k.prototype.ROUND_HALF_UP;k.prototype.MIN_DIGITS=0;k.prototype.MAX_DIGITS=999999999;k.prototype.ROUNDS=[k.prototype.ROUND_HALF_UP,k.prototype.ROUND_UNNECESSARY,k.prototype.ROUND_CEILING,k.prototype.ROUND_DOWN,k.prototype.ROUND_FLOOR,k.prototype.ROUND_HALF_DOWN,k.prototype.ROUND_HALF_EVEN,k.prototype.ROUND_UP];k.prototype.ROUNDWORDS="ROUND_HALF_UP ROUND_UNNECESSARY ROUND_CEILING ROUND_DOWN ROUND_FLOOR ROUND_HALF_DOWN ROUND_HALF_EVEN ROUND_UP".split(" ");
k.prototype.DEFAULT=new k(k.prototype.DEFAULT_DIGITS,k.prototype.DEFAULT_FORM,k.prototype.DEFAULT_LOSTDIGITS,k.prototype.DEFAULT_ROUNDINGMODE);m=k;var v,G=function(a,b){return(a-a%b)/b},K=function(a){var b=Array(a),c;for(c=0;c<a;++c)b[c]=0;return b},h=function(){this.ind=0;this.form=m.prototype.PLAIN;this.mant=null;this.exp=0;if(0!=h.arguments.length){var a,b,c;1==h.arguments.length?(a=h.arguments[0],b=0,c=a.length):(a=h.arguments[0],b=h.arguments[1],c=h.arguments[2]);"string"==typeof a&&(a=a.split(""));
var d,e,i,f,g,j=0,l=0;e=!1;var k=l=l=j=0,q=0;f=0;0>=c&&this.bad("BigDecimal(): ",a);this.ind=this.ispos;"-"==a[0]?(c--,0==c&&this.bad("BigDecimal(): ",a),this.ind=this.isneg,b++):"+"==a[0]&&(c--,0==c&&this.bad("BigDecimal(): ",a),b++);e=d=!1;i=0;g=f=-1;k=c;j=b;a:for(;0<k;k--,j++){l=a[j];if("0"<=l&&"9">=l){g=j;i++;continue a}if("."==l){0<=f&&this.bad("BigDecimal(): ",a);f=j-b;continue a}if("e"!=l&&"E"!=l){("0">l||"9"<l)&&this.bad("BigDecimal(): ",a);d=!0;g=j;i++;continue a}j-b>c-2&&this.bad("BigDecimal(): ",
a);e=!1;"-"==a[j+1]?(e=!0,j+=2):j="+"==a[j+1]?j+2:j+1;l=c-(j-b);(0==l||9<l)&&this.bad("BigDecimal(): ",a);c=l;l=j;for(;0<c;c--,l++)k=a[l],"0">k&&this.bad("BigDecimal(): ",a),"9"<k?this.bad("BigDecimal(): ",a):q=k-0,this.exp=10*this.exp+q;e&&(this.exp=-this.exp);e=!0;break a}0==i&&this.bad("BigDecimal(): ",a);0<=f&&(this.exp=this.exp+f-i);q=g-1;j=b;a:for(;j<=q;j++)if(l=a[j],"0"==l)b++,f--,i--;else if("."==l)b++,f--;else break a;this.mant=Array(i);l=b;if(d){b=i;j=0;for(;0<b;b--,j++)j==f&&l++,k=a[l],
"9">=k?this.mant[j]=k-0:this.bad("BigDecimal(): ",a),l++}else{b=i;j=0;for(;0<b;b--,j++)j==f&&l++,this.mant[j]=a[l]-0,l++}0==this.mant[0]?(this.ind=this.iszero,0<this.exp&&(this.exp=0),e&&(this.mant=this.ZERO.mant,this.exp=0)):e&&(this.form=m.prototype.SCIENTIFIC,f=this.exp+this.mant.length-1,(f<this.MinExp||f>this.MaxExp)&&this.bad("BigDecimal(): ",a))}},H=function(){var a;if(1==H.arguments.length)a=H.arguments[0];else if(0==H.arguments.length)a=this.plainMC;else throw"abs(): "+H.arguments.length+
" arguments given; expected 0 or 1";return this.ind==this.isneg?this.negate(a):this.plus(a)},w=function(){var a;if(2==w.arguments.length)a=w.arguments[1];else if(1==w.arguments.length)a=this.plainMC;else throw"add(): "+w.arguments.length+" arguments given; expected 1 or 2";var b=w.arguments[0],c,d,e,i,f,g,j,l=0;d=l=0;var l=null,k=l=0,q=0,t=0,s=0,n=0;a.lostDigits&&this.checkdigits(b,a.digits);c=this;if(0==c.ind&&a.form!=m.prototype.PLAIN)return b.plus(a);if(0==b.ind&&a.form!=m.prototype.PLAIN)return c.plus(a);
d=a.digits;0<d&&(c.mant.length>d&&(c=this.clone(c).round(a)),b.mant.length>d&&(b=this.clone(b).round(a)));e=new h;i=c.mant;f=c.mant.length;g=b.mant;j=b.mant.length;if(c.exp==b.exp)e.exp=c.exp;else if(c.exp>b.exp){l=f+c.exp-b.exp;if(l>=j+d+1&&0<d)return e.mant=i,e.exp=c.exp,e.ind=c.ind,f<d&&(e.mant=this.extend(c.mant,d),e.exp-=d-f),e.finish(a,!1);e.exp=b.exp;l>d+1&&0<d&&(l=l-d-1,j-=l,e.exp+=l,l=d+1);l>f&&(f=l)}else{l=j+b.exp-c.exp;if(l>=f+d+1&&0<d)return e.mant=g,e.exp=b.exp,e.ind=b.ind,j<d&&(e.mant=
this.extend(b.mant,d),e.exp-=d-j),e.finish(a,!1);e.exp=c.exp;l>d+1&&0<d&&(l=l-d-1,f-=l,e.exp+=l,l=d+1);l>j&&(j=l)}e.ind=c.ind==this.iszero?this.ispos:c.ind;if((c.ind==this.isneg?1:0)==(b.ind==this.isneg?1:0))d=1;else{do{d=-1;do if(b.ind!=this.iszero)if(f<j||c.ind==this.iszero)l=i,i=g,g=l,l=f,f=j,j=l,e.ind=-e.ind;else if(!(f>j)){k=l=0;q=i.length-1;t=g.length-1;c:for(;;){if(l<=q)s=i[l];else{if(k>t){if(a.form!=m.prototype.PLAIN)return this.ZERO;break c}s=0}n=k<=t?g[k]:0;if(s!=n){s<n&&(l=i,i=g,g=l,l=
f,f=j,j=l,e.ind=-e.ind);break c}l++;k++}}while(0)}while(0)}e.mant=this.byteaddsub(i,f,g,j,d,!1);return e.finish(a,!1)},x=function(){var a;if(2==x.arguments.length)a=x.arguments[1];else if(1==x.arguments.length)a=this.plainMC;else throw"compareTo(): "+x.arguments.length+" arguments given; expected 1 or 2";var b=x.arguments[0],c=0,c=0;a.lostDigits&&this.checkdigits(b,a.digits);if(this.ind==b.ind&&this.exp==b.exp){c=this.mant.length;if(c<b.mant.length)return-this.ind;if(c>b.mant.length)return this.ind;
if(c<=a.digits||0==a.digits){a=c;c=0;for(;0<a;a--,c++){if(this.mant[c]<b.mant[c])return-this.ind;if(this.mant[c]>b.mant[c])return this.ind}return 0}}else{if(this.ind<b.ind)return-1;if(this.ind>b.ind)return 1}b=this.clone(b);b.ind=-b.ind;return this.add(b,a).ind},p=function(){var a,b=-1;if(2==p.arguments.length)a="number"==typeof p.arguments[1]?new m(0,m.prototype.PLAIN,!1,p.arguments[1]):p.arguments[1];else if(3==p.arguments.length){b=p.arguments[1];if(0>b)throw"divide(): Negative scale: "+b;a=new m(0,
m.prototype.PLAIN,!1,p.arguments[2])}else if(1==p.arguments.length)a=this.plainMC;else throw"divide(): "+p.arguments.length+" arguments given; expected between 1 and 3";return this.dodivide("D",p.arguments[0],a,b)},y=function(){var a;if(2==y.arguments.length)a=y.arguments[1];else if(1==y.arguments.length)a=this.plainMC;else throw"divideInteger(): "+y.arguments.length+" arguments given; expected 1 or 2";return this.dodivide("I",y.arguments[0],a,0)},z=function(){var a;if(2==z.arguments.length)a=z.arguments[1];
else if(1==z.arguments.length)a=this.plainMC;else throw"max(): "+z.arguments.length+" arguments given; expected 1 or 2";var b=z.arguments[0];return 0<=this.compareTo(b,a)?this.plus(a):b.plus(a)},A=function(){var a;if(2==A.arguments.length)a=A.arguments[1];else if(1==A.arguments.length)a=this.plainMC;else throw"min(): "+A.arguments.length+" arguments given; expected 1 or 2";var b=A.arguments[0];return 0>=this.compareTo(b,a)?this.plus(a):b.plus(a)},B=function(){var a;if(2==B.arguments.length)a=B.arguments[1];
else if(1==B.arguments.length)a=this.plainMC;else throw"multiply(): "+B.arguments.length+" arguments given; expected 1 or 2";var b=B.arguments[0],c,d,e,i=e=null,f,g=0,j,l=0,k=0;a.lostDigits&&this.checkdigits(b,a.digits);c=this;d=0;e=a.digits;0<e?(c.mant.length>e&&(c=this.clone(c).round(a)),b.mant.length>e&&(b=this.clone(b).round(a))):(0<c.exp&&(d+=c.exp),0<b.exp&&(d+=b.exp));c.mant.length<b.mant.length?(e=c.mant,i=b.mant):(e=b.mant,i=c.mant);f=e.length+i.length-1;g=9<e[0]*i[0]?f+1:f;j=new h;var g=
this.createArrayWithZeros(g),m=e.length,l=0;for(;0<m;m--,l++)k=e[l],0!=k&&(g=this.byteaddsub(g,g.length,i,f,k,!0)),f--;j.ind=c.ind*b.ind;j.exp=c.exp+b.exp-d;j.mant=0==d?g:this.extend(g,g.length+d);return j.finish(a,!1)},I=function(){var a;if(1==I.arguments.length)a=I.arguments[0];else if(0==I.arguments.length)a=this.plainMC;else throw"negate(): "+I.arguments.length+" arguments given; expected 0 or 1";var b;a.lostDigits&&this.checkdigits(null,a.digits);b=this.clone(this);b.ind=-b.ind;return b.finish(a,
!1)},J=function(){var a;if(1==J.arguments.length)a=J.arguments[0];else if(0==J.arguments.length)a=this.plainMC;else throw"plus(): "+J.arguments.length+" arguments given; expected 0 or 1";a.lostDigits&&this.checkdigits(null,a.digits);return a.form==m.prototype.PLAIN&&this.form==m.prototype.PLAIN&&(this.mant.length<=a.digits||0==a.digits)?this:this.clone(this).finish(a,!1)},C=function(){var a;if(2==C.arguments.length)a=C.arguments[1];else if(1==C.arguments.length)a=this.plainMC;else throw"pow(): "+
C.arguments.length+" arguments given; expected 1 or 2";var b=C.arguments[0],c,d,e,i=e=0,f,g=0;a.lostDigits&&this.checkdigits(b,a.digits);c=b.intcheck(this.MinArg,this.MaxArg);d=this;e=a.digits;if(0==e){if(b.ind==this.isneg)throw"pow(): Negative power: "+b.toString();e=0}else{if(b.mant.length+b.exp>e)throw"pow(): Too many digits: "+b.toString();d.mant.length>e&&(d=this.clone(d).round(a));i=b.mant.length+b.exp;e=e+i+1}e=new m(e,a.form,!1,a.roundingMode);i=this.ONE;if(0==c)return i;0>c&&(c=-c);f=!1;
g=1;a:for(;;g++){c<<=1;0>c&&(f=!0,i=i.multiply(d,e));if(31==g)break a;if(!f)continue a;i=i.multiply(i,e)}0>b.ind&&(i=this.ONE.divide(i,e));return i.finish(a,!0)},D=function(){var a;if(2==D.arguments.length)a=D.arguments[1];else if(1==D.arguments.length)a=this.plainMC;else throw"remainder(): "+D.arguments.length+" arguments given; expected 1 or 2";return this.dodivide("R",D.arguments[0],a,-1)},E=function(){var a;if(2==E.arguments.length)a=E.arguments[1];else if(1==E.arguments.length)a=this.plainMC;
else throw"subtract(): "+E.arguments.length+" arguments given; expected 1 or 2";var b=E.arguments[0];a.lostDigits&&this.checkdigits(b,a.digits);b=this.clone(b);b.ind=-b.ind;return this.add(b,a)},r=function(){var a,b,c,d;if(6==r.arguments.length)a=r.arguments[2],b=r.arguments[3],c=r.arguments[4],d=r.arguments[5];else if(2==r.arguments.length)b=a=-1,c=m.prototype.SCIENTIFIC,d=this.ROUND_HALF_UP;else throw"format(): "+r.arguments.length+" arguments given; expected 2 or 6";var e=r.arguments[0],i=r.arguments[1],
f,g=0,g=g=0,j=null,l=j=g=0;f=0;g=null;l=j=0;(-1>e||0==e)&&this.badarg("format",1,e);-1>i&&this.badarg("format",2,i);(-1>a||0==a)&&this.badarg("format",3,a);-1>b&&this.badarg("format",4,b);c!=m.prototype.SCIENTIFIC&&c!=m.prototype.ENGINEERING&&(-1==c?c=m.prototype.SCIENTIFIC:this.badarg("format",5,c));if(d!=this.ROUND_HALF_UP)try{-1==d?d=this.ROUND_HALF_UP:new m(9,m.prototype.SCIENTIFIC,!1,d)}catch(h){this.badarg("format",6,d)}f=this.clone(this);-1==b?f.form=m.prototype.PLAIN:f.ind==this.iszero?f.form=
m.prototype.PLAIN:(g=f.exp+f.mant.length,f.form=g>b?c:-5>g?c:m.prototype.PLAIN);if(0<=i)a:for(;;){f.form==m.prototype.PLAIN?g=-f.exp:f.form==m.prototype.SCIENTIFIC?g=f.mant.length-1:(g=(f.exp+f.mant.length-1)%3,0>g&&(g=3+g),g++,g=g>=f.mant.length?0:f.mant.length-g);if(g==i)break a;if(g<i){j=this.extend(f.mant,f.mant.length+i-g);f.mant=j;f.exp-=i-g;if(f.exp<this.MinExp)throw"format(): Exponent Overflow: "+f.exp;break a}g-=i;if(g>f.mant.length){f.mant=this.ZERO.mant;f.ind=this.iszero;f.exp=0;continue a}j=
f.mant.length-g;l=f.exp;f.round(j,d);if(f.exp-l==g)break a}b=f.layout();if(0<e){c=b.length;f=0;a:for(;0<c;c--,f++){if("."==b[f])break a;if("E"==b[f])break a}f>e&&this.badarg("format",1,e);if(f<e){g=Array(b.length+e-f);e-=f;j=0;for(;0<e;e--,j++)g[j]=" ";this.arraycopy(b,0,g,j,b.length);b=g}}if(0<a){e=b.length-1;f=b.length-1;a:for(;0<e;e--,f--)if("E"==b[f])break a;if(0==f){g=Array(b.length+a+2);this.arraycopy(b,0,g,0,b.length);a+=2;j=b.length;for(;0<a;a--,j++)g[j]=" ";b=g}else if(l=b.length-f-2,l>a&&
this.badarg("format",3,a),l<a){g=Array(b.length+a-l);this.arraycopy(b,0,g,0,f+2);a-=l;j=f+2;for(;0<a;a--,j++)g[j]="0";this.arraycopy(b,f+2,g,j,l);b=g}}return b.join("")},F=function(){var a;if(2==F.arguments.length)a=F.arguments[1];else if(1==F.arguments.length)a=this.ROUND_UNNECESSARY;else throw"setScale(): "+F.arguments.length+" given; expected 1 or 2";var b=F.arguments[0],c,d;c=c=0;c=this.scale();if(c==b&&this.form==m.prototype.PLAIN)return this;d=this.clone(this);if(c<=b)c=0==c?d.exp+b:b-c,d.mant=
this.extend(d.mant,d.mant.length+c),d.exp=-b;else{if(0>b)throw"setScale(): Negative scale: "+b;c=d.mant.length-(c-b);d=d.round(c,a);d.exp!=-b&&(d.mant=this.extend(d.mant,d.mant.length+1),d.exp-=1)}d.form=m.prototype.PLAIN;return d};v=function(){var a,b=0,c=0;a=Array(190);b=0;a:for(;189>=b;b++){c=b-90;if(0<=c){a[b]=c%10;h.prototype.bytecar[b]=G(c,10);continue a}c+=100;a[b]=c%10;h.prototype.bytecar[b]=G(c,10)-10}return a};var u=function(){var a,b;if(2==u.arguments.length)a=u.arguments[0],b=u.arguments[1];
else if(1==u.arguments.length)b=u.arguments[0],a=b.digits,b=b.roundingMode;else throw"round(): "+u.arguments.length+" arguments given; expected 1 or 2";var c,d,e=!1,i=0,f;c=null;c=this.mant.length-a;if(0>=c)return this;this.exp+=c;c=this.ind;d=this.mant;0<a?(this.mant=Array(a),this.arraycopy(d,0,this.mant,0,a),e=!0,i=d[a]):(this.mant=this.ZERO.mant,this.ind=this.iszero,e=!1,i=0==a?d[0]:0);f=0;if(b==this.ROUND_HALF_UP)5<=i&&(f=c);else if(b==this.ROUND_UNNECESSARY){if(!this.allzero(d,a))throw"round(): Rounding necessary";
}else if(b==this.ROUND_HALF_DOWN)5<i?f=c:5==i&&(this.allzero(d,a+1)||(f=c));else if(b==this.ROUND_HALF_EVEN)5<i?f=c:5==i&&(this.allzero(d,a+1)?1==this.mant[this.mant.length-1]%2&&(f=c):f=c);else if(b!=this.ROUND_DOWN)if(b==this.ROUND_UP)this.allzero(d,a)||(f=c);else if(b==this.ROUND_CEILING)0<c&&(this.allzero(d,a)||(f=c));else if(b==this.ROUND_FLOOR)0>c&&(this.allzero(d,a)||(f=c));else throw"round(): Bad round value: "+b;0!=f&&(this.ind==this.iszero?(this.mant=this.ONE.mant,this.ind=f):(this.ind==
this.isneg&&(f=-f),c=this.byteaddsub(this.mant,this.mant.length,this.ONE.mant,1,f,e),c.length>this.mant.length?(this.exp++,this.arraycopy(c,0,this.mant,0,this.mant.length)):this.mant=c));if(this.exp>this.MaxExp)throw"round(): Exponent Overflow: "+this.exp;return this};h.prototype.div=G;h.prototype.arraycopy=function(a,b,c,d,e){var i;if(d>b)for(i=e-1;0<=i;--i)c[i+d]=a[i+b];else for(i=0;i<e;++i)c[i+d]=a[i+b]};h.prototype.createArrayWithZeros=K;h.prototype.abs=H;h.prototype.add=w;h.prototype.compareTo=
x;h.prototype.divide=p;h.prototype.divideInteger=y;h.prototype.max=z;h.prototype.min=A;h.prototype.multiply=B;h.prototype.negate=I;h.prototype.plus=J;h.prototype.pow=C;h.prototype.remainder=D;h.prototype.subtract=E;h.prototype.equals=function(a){var b=0,c=null,d=null;if(null==a||!(a instanceof h)||this.ind!=a.ind)return!1;if(this.mant.length==a.mant.length&&this.exp==a.exp&&this.form==a.form){c=this.mant.length;b=0;for(;0<c;c--,b++)if(this.mant[b]!=a.mant[b])return!1}else{c=this.layout();d=a.layout();
if(c.length!=d.length)return!1;a=c.length;b=0;for(;0<a;a--,b++)if(c[b]!=d[b])return!1}return!0};h.prototype.format=r;h.prototype.intValueExact=function(){var a,b=0,c,d=0;a=0;if(this.ind==this.iszero)return 0;a=this.mant.length-1;if(0>this.exp){a+=this.exp;if(!this.allzero(this.mant,a+1))throw"intValueExact(): Decimal part non-zero: "+this.toString();if(0>a)return 0;b=0}else{if(9<this.exp+a)throw"intValueExact(): Conversion overflow: "+this.toString();b=this.exp}c=0;var e=a+b,d=0;for(;d<=e;d++)c*=
10,d<=a&&(c+=this.mant[d]);if(9==a+b&&(a=G(c,1E9),a!=this.mant[0])){if(-2147483648==c&&this.ind==this.isneg&&2==this.mant[0])return c;throw"intValueExact(): Conversion overflow: "+this.toString();}return this.ind==this.ispos?c:-c};h.prototype.movePointLeft=function(a){var b;b=this.clone(this);b.exp-=a;return b.finish(this.plainMC,!1)};h.prototype.movePointRight=function(a){var b;b=this.clone(this);b.exp+=a;return b.finish(this.plainMC,!1)};h.prototype.scale=function(){return 0<=this.exp?0:-this.exp};
h.prototype.setScale=F;h.prototype.signum=function(){return this.ind};h.prototype.toString=function(){return this.layout().join("")};h.prototype.layout=function(){var a,b=0,b=null,c=0,d=0;a=0;var d=null,e,b=0;a=Array(this.mant.length);c=this.mant.length;b=0;for(;0<c;c--,b++)a[b]=this.mant[b]+"";if(this.form!=m.prototype.PLAIN){b="";this.ind==this.isneg&&(b+="-");c=this.exp+a.length-1;if(this.form==m.prototype.SCIENTIFIC)b+=a[0],1<a.length&&(b+="."),b+=a.slice(1).join("");else if(d=c%3,0>d&&(d=3+d),
c-=d,d++,d>=a.length){b+=a.join("");for(a=d-a.length;0<a;a--)b+="0"}else b+=a.slice(0,d).join(""),b=b+"."+a.slice(d).join("");0!=c&&(0>c?(a="-",c=-c):a="+",b+="E",b+=a,b+=c);return b.split("")}if(0==this.exp){if(0<=this.ind)return a;d=Array(a.length+1);d[0]="-";this.arraycopy(a,0,d,1,a.length);return d}c=this.ind==this.isneg?1:0;e=this.exp+a.length;if(1>e){b=c+2-this.exp;d=Array(b);0!=c&&(d[0]="-");d[c]="0";d[c+1]=".";var i=-e,b=c+2;for(;0<i;i--,b++)d[b]="0";this.arraycopy(a,0,d,c+2-e,a.length);return d}if(e>
a.length){d=Array(c+e);0!=c&&(d[0]="-");this.arraycopy(a,0,d,c,a.length);e-=a.length;b=c+a.length;for(;0<e;e--,b++)d[b]="0";return d}b=c+1+a.length;d=Array(b);0!=c&&(d[0]="-");this.arraycopy(a,0,d,c,e);d[c+e]=".";this.arraycopy(a,e,d,c+e+1,a.length-e);return d};h.prototype.intcheck=function(a,b){var c;c=this.intValueExact();if(c<a||c>b)throw"intcheck(): Conversion overflow: "+c;return c};h.prototype.dodivide=function(a,b,c,d){var e,i,f,g,j,l,k,q,t,s=0,n=0,p=0;i=i=n=n=n=0;e=null;e=e=0;e=null;c.lostDigits&&
this.checkdigits(b,c.digits);e=this;if(0==b.ind)throw"dodivide(): Divide by 0";if(0==e.ind)return c.form!=m.prototype.PLAIN?this.ZERO:-1==d?e:e.setScale(d);i=c.digits;0<i?(e.mant.length>i&&(e=this.clone(e).round(c)),b.mant.length>i&&(b=this.clone(b).round(c))):(-1==d&&(d=e.scale()),i=e.mant.length,d!=-e.exp&&(i=i+d+e.exp),i=i-(b.mant.length-1)-b.exp,i<e.mant.length&&(i=e.mant.length),i<b.mant.length&&(i=b.mant.length));f=e.exp-b.exp+e.mant.length-b.mant.length;if(0>f&&"D"!=a)return"I"==a?this.ZERO:
this.clone(e).finish(c,!1);g=new h;g.ind=e.ind*b.ind;g.exp=f;g.mant=this.createArrayWithZeros(i+1);j=i+i+1;f=this.extend(e.mant,j);l=j;k=b.mant;q=j;t=10*k[0]+1;1<k.length&&(t+=k[1]);j=0;a:for(;;){s=0;b:for(;;){if(l<q)break b;if(l==q){c:do{var r=l,n=0;for(;0<r;r--,n++){p=n<k.length?k[n]:0;if(f[n]<p)break b;if(f[n]>p)break c}s++;g.mant[j]=s;j++;f[0]=0;break a}while(0);n=f[0]}else n=10*f[0],1<l&&(n+=f[1]);n=G(10*n,t);0==n&&(n=1);s+=n;f=this.byteaddsub(f,l,k,q,-n,!0);if(0!=f[0])continue b;p=l-2;n=0;c:for(;n<=
p;n++){if(0!=f[n])break c;l--}if(0==n)continue b;this.arraycopy(f,n,f,0,l)}if(0!=j||0!=s){g.mant[j]=s;j++;if(j==i+1)break a;if(0==f[0])break a}if(0<=d&&-g.exp>d)break a;if("D"!=a&&0>=g.exp)break a;g.exp-=1;q--}0==j&&(j=1);if("I"==a||"R"==a){if(j+g.exp>i)throw"dodivide(): Integer overflow";if("R"==a){do{if(0==g.mant[0])return this.clone(e).finish(c,!1);if(0==f[0])return this.ZERO;g.ind=e.ind;i=i+i+1-e.mant.length;g.exp=g.exp-i+e.exp;i=l;n=i-1;b:for(;1<=n&&g.exp<e.exp&&g.exp<b.exp;n--){if(0!=f[n])break b;
i--;g.exp+=1}i<f.length&&(e=Array(i),this.arraycopy(f,0,e,0,i),f=e);g.mant=f;return g.finish(c,!1)}while(0)}}else 0!=f[0]&&(e=g.mant[j-1],0==e%5&&(g.mant[j-1]=e+1));if(0<=d)return j!=g.mant.length&&(g.exp-=g.mant.length-j),e=g.mant.length-(-g.exp-d),g.round(e,c.roundingMode),g.exp!=-d&&(g.mant=this.extend(g.mant,g.mant.length+1),g.exp-=1),g.finish(c,!0);if(j==g.mant.length)g.round(c);else{if(0==g.mant[0])return this.ZERO;e=Array(j);this.arraycopy(g.mant,0,e,0,j);g.mant=e}return g.finish(c,!0)};h.prototype.bad=
function(a,b){throw a+"Not a number: "+b;};h.prototype.badarg=function(a,b,c){throw"Bad argument "+b+" to "+a+": "+c;};h.prototype.extend=function(a,b){var c;if(a.length==b)return a;c=K(b);this.arraycopy(a,0,c,0,a.length);return c};h.prototype.byteaddsub=function(a,b,c,d,e,i){var f,g,j,h,k,m,p=0;f=m=0;f=a.length;g=c.length;b-=1;h=j=d-1;h<b&&(h=b);d=null;i&&h+1==f&&(d=a);null==d&&(d=this.createArrayWithZeros(h+1));k=!1;1==e?k=!0:-1==e&&(k=!0);m=0;p=h;a:for(;0<=p;p--){0<=b&&(b<f&&(m+=a[b]),b--);0<=
j&&(j<g&&(m=k?0<e?m+c[j]:m-c[j]:m+c[j]*e),j--);if(10>m&&0<=m){do{d[p]=m;m=0;continue a}while(0)}m+=90;d[p]=this.bytedig[m];m=this.bytecar[m]}if(0==m)return d;c=null;i&&h+2==a.length&&(c=a);null==c&&(c=Array(h+2));c[0]=m;a=h+1;f=0;for(;0<a;a--,f++)c[f+1]=d[f];return c};h.prototype.diginit=v;h.prototype.clone=function(a){var b;b=new h;b.ind=a.ind;b.exp=a.exp;b.form=a.form;b.mant=a.mant;return b};h.prototype.checkdigits=function(a,b){if(0!=b){if(this.mant.length>b&&!this.allzero(this.mant,b))throw"Too many digits: "+
this.toString();if(null!=a&&a.mant.length>b&&!this.allzero(a.mant,b))throw"Too many digits: "+a.toString();}};h.prototype.round=u;h.prototype.allzero=function(a,b){var c=0;0>b&&(b=0);var d=a.length-1,c=b;for(;c<=d;c++)if(0!=a[c])return!1;return!0};h.prototype.finish=function(a,b){var c=0,d=0,e=null,c=d=0;0!=a.digits&&this.mant.length>a.digits&&this.round(a);if(b&&a.form!=m.prototype.PLAIN){c=this.mant.length;d=c-1;a:for(;1<=d;d--){if(0!=this.mant[d])break a;c--;this.exp++}c<this.mant.length&&(e=Array(c),
this.arraycopy(this.mant,0,e,0,c),this.mant=e)}this.form=m.prototype.PLAIN;c=this.mant.length;d=0;for(;0<c;c--,d++)if(0!=this.mant[d]){0<d&&(e=Array(this.mant.length-d),this.arraycopy(this.mant,d,e,0,this.mant.length-d),this.mant=e);d=this.exp+this.mant.length;if(0<d){if(d>a.digits&&0!=a.digits&&(this.form=a.form),d-1<=this.MaxExp)return this}else-5>d&&(this.form=a.form);d--;if(d<this.MinExp||d>this.MaxExp){b:do{if(this.form==m.prototype.ENGINEERING&&(c=d%3,0>c&&(c=3+c),d-=c,d>=this.MinExp&&d<=this.MaxExp))break b;
throw"finish(): Exponent Overflow: "+d;}while(0)}return this}this.ind=this.iszero;if(a.form!=m.prototype.PLAIN)this.exp=0;else if(0<this.exp)this.exp=0;else if(this.exp<this.MinExp)throw"finish(): Exponent Overflow: "+this.exp;this.mant=this.ZERO.mant;return this};h.prototype.isGreaterThan=function(a){return 0<this.compareTo(a)};h.prototype.isLessThan=function(a){return 0>this.compareTo(a)};h.prototype.isGreaterThanOrEqualTo=function(a){return 0<=this.compareTo(a)};h.prototype.isLessThanOrEqualTo=
function(a){return 0>=this.compareTo(a)};h.prototype.isPositive=function(){return 0<this.compareTo(h.prototype.ZERO)};h.prototype.isNegative=function(){return 0>this.compareTo(h.prototype.ZERO)};h.prototype.isZero=function(){return this.equals(h.prototype.ZERO)};h.ROUND_CEILING=h.prototype.ROUND_CEILING=m.prototype.ROUND_CEILING;h.ROUND_DOWN=h.prototype.ROUND_DOWN=m.prototype.ROUND_DOWN;h.ROUND_FLOOR=h.prototype.ROUND_FLOOR=m.prototype.ROUND_FLOOR;h.ROUND_HALF_DOWN=h.prototype.ROUND_HALF_DOWN=m.prototype.ROUND_HALF_DOWN;
h.ROUND_HALF_EVEN=h.prototype.ROUND_HALF_EVEN=m.prototype.ROUND_HALF_EVEN;h.ROUND_HALF_UP=h.prototype.ROUND_HALF_UP=m.prototype.ROUND_HALF_UP;h.ROUND_UNNECESSARY=h.prototype.ROUND_UNNECESSARY=m.prototype.ROUND_UNNECESSARY;h.ROUND_UP=h.prototype.ROUND_UP=m.prototype.ROUND_UP;h.prototype.ispos=1;h.prototype.iszero=0;h.prototype.isneg=-1;h.prototype.MinExp=-999999999;h.prototype.MaxExp=999999999;h.prototype.MinArg=-999999999;h.prototype.MaxArg=999999999;h.prototype.plainMC=new m(0,m.prototype.PLAIN);
h.prototype.bytecar=Array(190);h.prototype.bytedig=v();h.ZERO=h.prototype.ZERO=new h("0");h.ONE=h.prototype.ONE=new h("1");h.TEN=h.prototype.TEN=new h("10");v=h;"function"===typeof define&&null!=define.amd?define({BigDecimal:v,MathContext:m}):"object"===typeof this&&(this.BigDecimal=v,this.MathContext=m)}).call(this);(function(){var a=Math,b=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",c="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,d="ontouchstart"in window,e=b+"Transform"in document.documentElement.style,f=/android/gi.test(navigator.appVersion),g=/iphone|ipad/gi.test(navigator.appVersion),h=/playbook/gi.test(navigator.appVersion),k=g||h,i=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),l=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,j="onorientationchange"in window?"orientationchange":"resize",m=d?"touchstart":"mousedown",n=d?"touchmove":"mousemove",o=d?"touchend":"mouseup",p=d?"touchcancel":"mouseup",q=b=="Moz"?"DOMMouseScroll":
"mousewheel",r="translate"+(c?"3d(":"("),t=c?",0)":")",h=function(a,h){var i=this,l;i.wrapper=typeof a=="object"?a:document.getElementById(a);i.wrapper.style.overflow="hidden";i.scroller=i.wrapper.children[0];i.options={hScroll:!0,vScroll:!0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,roundPosition:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:f,hideScrollbar:g,fadeScrollbar:g&&c,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,
doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(l in h)i.options[l]=h[l];i.options.useTransform=e?i.options.useTransform:!1;i.options.hScrollbar=i.options.hScroll&&i.options.hScrollbar;i.options.vScrollbar=i.options.vScroll&&i.options.vScrollbar;
i.options.zoom=i.options.useTransform&&i.options.zoom;i.options.useTransition=k&&i.options.useTransition;i.scroller.style[b+"TransitionProperty"]=i.options.useTransform?"-"+b.toLowerCase()+"-transform":"top left";i.scroller.style[b+"TransitionDuration"]="0";i.scroller.style[b+"TransformOrigin"]="0 0";i.options.useTransition&&(i.scroller.style[b+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)");i.options.useTransform?i.scroller.style[b+"Transform"]=r+"0,0"+t:i.scroller.style.cssText+=";position:absolute;top:0;left:0";
if(i.options.useTransition)i.options.fixedScrollbar=!0;i.refresh();i._bind(j,window);i._bind(m);d||(i._bind("mouseout",i.wrapper),i._bind(q));if(i.options.checkDOMChanges)i.checkDOMTime=setInterval(function(){i._checkDOMChanges()},500)};h.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case m:if(!d&&a.button!==0)break;this._start(a);break;case n:this._move(a);break;case o:case p:this._end(a);
break;case j:this._resize();break;case q:this._wheel(a);break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(c){var d=document,f;if(this[c+"Scrollbar"]){if(!this[c+"ScrollbarWrapper"]){f=d.createElement("div");this.options.scrollbarClass?
f.className=this.options.scrollbarClass+c.toUpperCase():f.style.cssText="position:absolute;z-index:100;"+(c=="h"?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");f.style.cssText+=";pointer-events:none;-"+b+"-transition-property:opacity;-"+b+"-transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(f);this[c+"ScrollbarWrapper"]=
f;f=d.createElement("div");if(!this.options.scrollbarClass)f.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+b+"-background-clip:padding-box;-"+b+"-box-sizing:border-box;"+(c=="h"?"height:100%":"width:100%")+";-"+b+"-border-radius:3px;border-radius:3px";f.style.cssText+=";pointer-events:none;-"+b+"-transition-property:-"+b+"-transform;-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+b+"-transition-duration:0;-"+b+
"-transform:"+r+"0,0"+t;this.options.useTransition&&(f.style.cssText+=";-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[c+"ScrollbarWrapper"].appendChild(f);this[c+"ScrollbarIndicator"]=f}c=="h"?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=a.max(a.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,
this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=a.max(a.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(c,!0)}else this[c+"ScrollbarWrapper"]&&(e&&(this[c+"ScrollbarIndicator"].style[b+
"Transform"]=""),this[c+"ScrollbarWrapper"].parentNode.removeChild(this[c+"ScrollbarWrapper"]),this[c+"ScrollbarWrapper"]=null,this[c+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},f?200:0)},_pos:function(c,d){c=this.hScroll?c:0;d=this.vScroll?d:0;if(this.options.roundPosition||!this.options.useTransform)c=a.round(c),d=a.round(d);this.options.useTransform?this.scroller.style[b+"Transform"]=r+c+"px,"+d+"px"+t+" scale("+this.scale+")":(this.scroller.style.left=
c+"px",this.scroller.style.top=d+"px");this.x=c;this.y=d;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(c,d){var e=c=="h"?this.x:this.y;if(this[c+"Scrollbar"])e*=this[c+"ScrollbarProp"],e<0?(this.options.fixedScrollbar||(e=this[c+"ScrollbarIndicatorSize"]+a.round(e*3),e<8&&(e=8),this[c+"ScrollbarIndicator"].style[c=="h"?"width":"height"]=e+"px"),e=0):e>this[c+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?e=this[c+"ScrollbarMaxScroll"]:(e=this[c+"ScrollbarIndicatorSize"]-
a.round((e-this[c+"ScrollbarMaxScroll"])*3),e<8&&(e=8),this[c+"ScrollbarIndicator"].style[c=="h"?"width":"height"]=e+"px",e=this[c+"ScrollbarMaxScroll"]+(this[c+"ScrollbarIndicatorSize"]-e))),this[c+"ScrollbarWrapper"].style[b+"TransitionDelay"]="0",this[c+"ScrollbarWrapper"].style.opacity=d&&this.options.hideScrollbar?"0":"1",this[c+"ScrollbarIndicator"].style[b+"Transform"]=r+(c=="h"?e+"px,0":"0,"+e+"px")+t},_start:function(c){var e=d?c.touches[0]:c,f,g;if(this.enabled){this.options.onBeforeScrollStart&&
this.options.onBeforeScrollStart.call(this,c);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&d&&c.touches.length>1)g=a.abs(c.touches[0].pageX-c.touches[1].pageX),f=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDistStart=a.sqrt(g*g+f*f),this.originX=a.abs(c.touches[0].pageX+c.touches[1].pageX-this.wrapperOffsetLeft*2)/2-this.x,this.originY=
a.abs(c.touches[0].pageY+c.touches[1].pageY-this.wrapperOffsetTop*2)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,c);if(this.options.momentum&&(this.options.useTransform?(f=getComputedStyle(this.scroller,null)[b+"Transform"].replace(/[^0-9-.,]/g,"").split(","),g=f[4]*1,f=f[5]*1):(g=getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,"")*1,f=getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")*1),g!=this.x||f!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):
l(this.aniTime),this.steps=[],this._pos(g,f);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=e.pageX;this.pointY=e.pageY;this.startTime=c.timeStamp||(new Date).getTime();this.options.onScrollStart&&this.options.onScrollStart.call(this,c);this._bind(n);this._bind(o);this._bind(p)}},_move:function(c){var e=d?c.touches[0]:c,f=e.pageX-this.pointX,g=e.pageY-this.pointY,h=this.x+f,j=this.y+g,i=c.timeStamp||(new Date).getTime();this.options.onBeforeScrollMove&&
this.options.onBeforeScrollMove.call(this,c);if(this.options.zoom&&d&&c.touches.length>1)h=a.abs(c.touches[0].pageX-c.touches[1].pageX),j=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDist=a.sqrt(h*h+j*j),this.zoomed=!0,e=1/this.touchesDistStart*this.touchesDist*this.scale,e<this.options.zoomMin?e=0.5*this.options.zoomMin*Math.pow(2,e/this.options.zoomMin):e>this.options.zoomMax&&(e=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/e)),this.lastScale=e/this.scale,h=this.originX-
this.originX*this.lastScale+this.x,j=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[b+"Transform"]=r+h+"px,"+j+"px"+t+" scale("+e+")",this.options.onZoom&&this.options.onZoom.call(this,c);else{this.pointX=e.pageX;this.pointY=e.pageY;if(h>0||h<this.maxScrollX)h=this.options.bounce?this.x+f/2:h>=0||this.maxScrollX>=0?0:this.maxScrollX;if(j>this.minScrollY||j<this.maxScrollY)j=this.options.bounce?this.y+g/2:j>=this.minScrollY||this.maxScrollY>=0?this.minScrollY:this.maxScrollY;if(this.absDistX<
6&&this.absDistY<6)this.distX+=f,this.distY+=g,this.absDistX=a.abs(this.distX),this.absDistY=a.abs(this.distY);else{if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)j=this.y,g=0;else if(this.absDistY>this.absDistX+5)h=this.x,f=0;this.moved=!0;this._pos(h,j);this.dirX=f>0?-1:f<0?1:0;this.dirY=g>0?-1:g<0?1:0;if(i-this.startTime>300)this.startTime=i,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,c)}}},_end:function(c){if(!(d&&c.touches.length!=
0)){var e=this,f=d?c.changedTouches[0]:c,g,h,j={dist:0,time:0},i={dist:0,time:0},k=(c.timeStamp||(new Date).getTime())-e.startTime,l=e.x,m=e.y;e._unbind(n);e._unbind(o);e._unbind(p);e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,c);if(e.zoomed)l=e.scale*e.lastScale,l=Math.max(e.options.zoomMin,l),l=Math.min(e.options.zoomMax,l),e.lastScale=l/e.scale,e.scale=l,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[b+"TransitionDuration"]="200ms",
e.scroller.style[b+"Transform"]=r+e.x+"px,"+e.y+"px"+t+" scale("+e.scale+")",e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,c);else{if(e.moved){if(k<300&&e.options.momentum){j=l?e._momentum(l-e.startX,k,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?e.wrapperW:0):j;i=m?e._momentum(m-e.startY,k,-e.y,e.maxScrollY<0?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):i;l=e.x+j.dist;m=e.y+i.dist;if(e.x>0&&l>0||e.x<e.maxScrollX&&l<e.maxScrollX)j={dist:0,
time:0};if(e.y>e.minScrollY&&m>e.minScrollY||e.y<e.maxScrollY&&m<e.maxScrollY)i={dist:0,time:0}}if(j.dist||i.dist){j=a.max(a.max(j.time,i.time),10);if(e.options.snap)i=l-e.absStartX,k=m-e.absStartY,a.abs(i)<e.options.snapThreshold&&a.abs(k)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(i=e._snap(l,m),l=i.x,m=i.y,j=a.max(i.time,j));e.scrollTo(l,m,j)}else e.options.snap?(i=l-e.absStartX,k=m-e.absStartY,a.abs(i)<e.options.snapThreshold&&a.abs(k)<e.options.snapThreshold?e.scrollTo(e.absStartX,
e.absStartY,200):(i=e._snap(e.x,e.y),(i.x!=e.x||i.y!=e.y)&&e.scrollTo(i.x,i.y,i.time))):e._resetPos(200)}else{if(d)e.doubleTapTimer&&e.options.zoom?(clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,c),e.zoom(e.pointX,e.pointY,e.scale==1?e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,c)},200)):e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null;for(g=f.target;g.nodeType!=1;)g=g.parentNode;
if(g.tagName!="SELECT"&&g.tagName!="INPUT"&&g.tagName!="TEXTAREA")h=document.createEvent("MouseEvents"),h.initMouseEvent("click",!0,!0,c.view,1,f.screenX,f.screenY,f.clientX,f.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),h._fake=!0,g.dispatchEvent(h)},e.options.zoom?250:0);e._resetPos(200)}e.options.onTouchEnd&&e.options.onTouchEnd.call(e,c)}}},_resetPos:function(a){var c=this.x>=0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||this.maxScrollY>0?this.minScrollY:
this.y<this.maxScrollY?this.maxScrollY:this.y;if(c==this.x&&d==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.hScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.vScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(c,
d,a||0)},_wheel:function(a){var b=this,c,d;"wheelDeltaX"in a?(c=a.wheelDeltaX/12,d=a.wheelDeltaY/12):c="detail"in a?d=-a.detail*3:d=-a.wheelDelta;if(b.options.wheelAction=="zoom"){d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0));if(d<b.options.zoomMin)d=b.options.zoomMin;if(d>b.options.zoomMax)d=b.options.zoomMax;d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&
b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{c=b.x+c;d=b.y+d;if(c>0)c=0;else if(c<b.maxScrollX)c=b.maxScrollX;if(d>b.minScrollY)d=b.minScrollY;else if(d<b.maxScrollY)d=b.maxScrollY;b.scrollTo(c,d,0)}},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var b=this,c=b.x,d=b.y,e=(new Date).getTime(),
f,g;if(!b.animating)if(b.steps.length){f=b.steps.shift();if(f.x==c&&f.y==d)f.time=0;b.animating=!0;b.moved=!0;b.options.useTransition?(b._transitionTime(f.time),b._pos(f.x,f.y),b.animating=!1,f.time?b._bind("webkitTransitionEnd"):b._resetPos(0)):function B(){var h=(new Date).getTime();if(h>=e+f.time)b._pos(f.x,f.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();else if(h=(h-e)/f.time-1,g=a.sqrt(1-h*h),h=(f.x-c)*g+c,b._pos(h,(f.y-d)*g+d),b.animating)b.aniTime=
i(B)}()}else b._resetPos(400)},_transitionTime:function(a){a+="ms";this.scroller.style[b+"TransitionDuration"]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[b+"TransitionDuration"]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[b+"TransitionDuration"]=a)},_momentum:function(b,c,d,e,f){var c=a.abs(b)/c,g=c*c/0.0012,h=0,h=0;b>0&&g>d?(d+=f/(6/(g/c*6.0E-4)),c=c*d/g,g=d):b<0&&g>e&&(e+=f/(6/(g/c*6.0E-4)),c=c*e/g,g=e);g*=b<0?-1:1;return{dist:g,time:a.round(c/6.0E-4)}},_offset:function(a){for(var b=
-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(b,c){var d,e,f;f=this.pagesX.length-1;d=0;for(e=this.pagesX.length;d<e;d++)if(b>=this.pagesX[d]){f=d;break}f==this.currPageX&&f>0&&this.dirX<0&&f--;b=this.pagesX[f];e=(e=a.abs(b-this.pagesX[this.currPageX]))?a.abs(this.x-b)/e*500:0;this.currPageX=f;f=this.pagesY.length-1;for(d=0;d<f;d++)if(c>=this.pagesY[d]){f=d;break}f==this.currPageY&&
f>0&&this.dirY<0&&f--;c=this.pagesY[f];d=(d=a.abs(c-this.pagesY[this.currPageY]))?a.abs(this.y-c)/d*500:0;this.currPageY=f;f=a.round(a.max(e,d))||200;return{x:b,y:c,time:f}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){this.scroller.style[b+"Transform"]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(j,window);this._unbind(m);this._unbind(n);
this._unbind(o);this._unbind(p);this.options.hasTouch&&(this._unbind("mouseout",this.wrapper),this._unbind(q));this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var c,d,e,f=0;d=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=
-this.options.topOffset||0;this.scrollerW=a.round(this.scroller.offsetWidth*this.scale);this.scrollerH=a.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&this.maxScrollX<0;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);
this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;c=this._offset(this.wrapper);this.wrapperOffsetLeft=-c.left;this.wrapperOffsetTop=-c.top;if(typeof this.options.snap=="string"){this.pagesX=[];this.pagesY=[];e=this.scroller.querySelectorAll(this.options.snap);c=0;for(d=e.length;c<d;c++)f=this._offset(e[c]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[c]=f.left<this.maxScrollX?this.maxScrollX:
f.left*this.scale,this.pagesY[c]=f.top<this.maxScrollY?this.maxScrollY:f.top*this.scale}else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[d]=f,f-=this.wrapperW,d++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);d=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[d]=f,f-=this.wrapperH,d++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-
this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[b+"TransitionDuration"]="0",this._resetPos(200))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);a=0;for(b=e.length;a<b;a++){if(e[a].relative)e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y;this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0})}this._startAni()},scrollToElement:function(b,c){var d;if(b=b.nodeType?b:this.scroller.querySelector(b))d=
this._offset(b),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=d.left>0?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:d.top,c=c===void 0?a.max(a.abs(d.left)*2,a.abs(d.top)*2):c,this.scrollTo(d.left,d.top,c)},scrollToPage:function(a,b,c){if(this.options.snap)a=a=="next"?this.currPageX+1:a=="prev"?this.currPageX-1:a,b=b=="next"?this.currPageY+1:b=="prev"?this.currPageY-1:b,a=a<0?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=b<0?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c||400)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(n);this._unbind(o);this._unbind(p)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):
l(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,c,d,e){var f=d/this.scale;if(this.options.useTransform)this.zoomed=!0,e=e===void 0?200:e,a=a-this.wrapperOffsetLeft-this.x,c=c-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=c-c*f+this.y,this.scale=d,this.refresh(),this.x=this.x>0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[b+"TransitionDuration"]=e+
"ms",this.scroller.style[b+"Transform"]=r+this.x+"px,"+this.y+"px"+t+" scale("+d+")",this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};typeof exports!=="undefined"?exports.iScroll=h:window.iScroll=h})();
var ia=ia||{log:function(a){window.console&&window.console.log&&window.console.log(a);ia.isTouchDevice()&&$j("#ia-debug-container").append("<span style='color:green'><br/>&gt; "+a+"</span>")},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},parseInt:function(a,b){return parseInt(a,b||10)},extend:function(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.baseConstructor=a;b.superClass=a.prototype},Quicksort:function(a,b,c,d){var e,f,g,h;if(d-c==
1)a[c][b]>a[d][b]&&(h=a[c],a[c]=a[d],a[d]=h);else{e=a[ia.parseInt((c+d)/2)];a[ia.parseInt((c+d)/2)]=a[c];a[c]=e;f=c+1;g=d;do{for(;f<=g&&a[f][b]<=e[b];)f++;for(;a[g][b]>e[b];)g--;f<g&&(h=a[f],a[f]=a[g],a[g]=h)}while(f<g);a[c]=a[g];a[g]=e;c<g-1&&ia.Quicksort(a,b,c,g-1);g+1<d&&ia.Quicksort(a,b,g+1,d)}},proxyMapStem:"../",proxyMaps:void 0,useProxy:!1,accessToken:"",addProxy:function(a,b){if(ia.proxyMaps==void 0)ia.proxyMaps={};ia.proxyMaps[a]=b},getDomainSafeUrl:function(a){var b=a;if(ia.useProxy){var c=
a.indexOf("://")+3,c=a.substring(0,a.indexOf("/",c)+1);ia.proxyMaps&&ia.proxyMaps[c]&&(b=a.replace(c,ia.proxyMapStem+ia.proxyMaps[c]))}return b},regAppId:"83wV2txRMBrDpKjq",redirectToArcGisOnlineAuth:function(){var a="https://www.arcgis.com/sharing/oauth2/authorize?client_id="+ia.regAppId+"&response_type=token&redirect_uri="+encodeURI(window.location.href);window.location.href=a},getNiceNum:function(a,b){var c=Math.floor(ia.log10(a)),d=a/Math.pow(10,c);return(b?d<1.5?1:d<3?2:d<7?5:10:d<=1?1:d<=2?
2:d<=5?5:10)*Math.pow(10,c)},log10:function(a){return Math.log(a)/Math.LN10},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},disableTextSelection:function(a){a=a.get(0);typeof a.onselectstart!="undefined"?a.onselectstart=function(){return!1}:typeof a.style.MozUserSelect!="undefined"?a.style.MozUserSelect="none":a.onmousedown=function(){return!1}},enableTextSelection:function(a){a=a.get(0);typeof a.onselectstart!="undefined"?a.onselectstart=function(){return!0}:typeof a.style.MozUserSelect!=
"undefined"?a.style.MozUserSelect="text":a.onmousedown=function(){return!0}},loadCssfile:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";c.appendChild(d);ia.File.load({url:a,type:"text",onSuccess:function(a){d.appendChild(document.createTextNode(a));b!=void 0&&b.call(null)}})},appendCss:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";c.appendChild(d);d.appendChild(document.createTextNode(a));
b!=void 0&&b.call(null)},getPrecision:function(a){for(var b=0,c=a.length-1,d=0;d<c;d++){var e,f=a[d],g=a[d+1];e=Math.abs(g-f);f!=Infinity&&f!=-Infinity&&g!=Infinity&&g!=-Infinity&&(f=new BigDecimal(""+f),g=new BigDecimal(""+g),e=Math.abs(g.subtract(f)));e>0&&e<1?(f=String(e).indexOf("e"),f!=-1?(e=new BigDecimal(""+e),e=Math.abs(e.exp)):(e=String(e).split(".")[1],f=e.indexOf("e"),f!=-1?(f=e.indexOf("+")!=-1?f+2:f+1,e=e.substr(f)):(f=String(ia.parseInt(e)),e=e.length-f.length+1)),e>b&&(b=e)):String(f).indexOf(".")>
-1&&(e=1,e>b&&(b=e))}return b},callFunction:function(a,b,c){var d="none";a.indexOf("script")==0||a.indexOf("javascript")==0?(d=a.split(":")[0],a=a.substring(a.indexOf(":")+1).split(";")):a=a.split(";");for(var e=0;e<a.length;e++)a[e]&&ia.processFunction(a[e],d,b,c)},processFunction:function(a,b,c,d){var e=[];if(b=="script"||b=="javascript"){if(a.indexOf("(")!=-1){if(b=jQuery.trim(a.substring(0,a.indexOf("("))),a=a.substring(a.indexOf("(")+1,a.indexOf(")")),a!=""){e=a.split(",");for(a=0;a<e.length;a++)c=
jQuery.trim(e[a]),c.indexOf("'")==0&&c.lastIndexOf("'")==c.length-1?c=c.substr(1,c.length-2):c.indexOf('"')==0&&c.lastIndexOf('"')==c.length-1&&(c=c.substr(1,c.length-2)),ia.isNumber(c)&&(c=parseFloat(c)),e[a]=c}}else b=jQuery.trim(a);d&&(e[e.length]=d);window[b].apply(null,e)}else c==void 0&&(c="_blank"),window.open(a,c)},supportsCanvas:function(){return!!document.createElement("canvas").getContext},isTouchDevice:function(){return"ontouchstart"in window},disableDefaultTouch:function(){if(ia.isTouchDevice())document.body.addEventListener("touchstart touchend touchmove",
function(a){a.preventDefault()},!1),document.ontouchmove=function(a){a.preventDefault()}},showWaitCursor:function(){$j("body").css("cursor","wait")},showDefaultCursor:function(){document.onselectstart=function(){return ia.useTextSelection};$j("body").css("cursor","default")},showCursor:function(a){document.onselectstart=function(){return!1};$j("body").css("cursor",a)},showMoveCursor:function(){document.onselectstart=function(){return!1};$j("body").css("cursor","move")},showPointerCursor:function(){$j("body").css("cursor",
"pointer")},useTextSelection:document.onselectstart,IAS_PATH:"",CLICK_TYPE:"click",MOUSE_DOWN_TYPE:"mousedown",IS_TOUCH_DEVICE:!1,IS_IE_TEN:!1,SINGLE_MAP_REPORT:"timeseries_advanced_sm::flash::html",PYRAMID_REPORT:"timeseries_advanced_sm::flash::pyramid::html",SPINE_REPORT:"areaprofiler::flash::html",ELECTION_REPORT:"areaprofiler::flash::election::html",DOUBLE_GEOG_REPORT:"double_timeseries_advanced_dm::flash::html",DOUBLE_BASELAYER_REPORT:"double_timeseries_advanced_dm::flash::double_base::html",
DOUBLE_BASELAYER_REPORT_NEW:"double_timeseries_advanced_dm::flash::double_base_new::html",DOUBLE_PLOT_REPORT:"timeseries_advanced_dm::flash::html",BUBBLE_PLOT_REPORT:"bubbleplot::flash::html",BUBBLE_PLOT_REPORT_SINGLE:"bubbleplot::flash::html::single"};
iaAddGlobalFunctions=function(a){iaToggle=function(b){a.closePopups(b);var c=a.getWidget(b);c!=void 0?c.toggle():(c=a.getWidget(b),c!=void 0&&c.toggle())};iaTogglePopup=function(b){b.indexOf("http")==-1&&(b=ia.IAS_PATH+b);ia.IS_TOUCH_DEVICE?window.open(b,"_blank"):(iaToggle("popup"),a.getComponent("popup").setHtml(b))};iaToggleCallout=function(a,c){ia.toggleCallout(a,c)};iaToggleLegendEditor=function(a){iaToggleCallout("legend-callout",a)};iaToggleHelp=function(){iaTogglePopup("./help.htm")};iaToggleShare=
function(a){var c=ia.getUrl();$j("#ia-share-callout").val(c);$j("#ia-embed-callout").val("<iframe src='"+c+"' style='width:800px;height:600px;border-width:0px'></iframe>");iaToggleCallout("shareCallout",a)};iaToggleProfileTree=function(){a.getComponent("spineChart").toggleTree()};iaOpenPrintPreview=function(){var a=ia.getUrl();a+="&printmode=true";window.open(a,"_blank")};iacPopMetadata=function(a,c){alert(a+" "+c)}};
(function(){function a(){l();i();var a=new ia.Panel("popup");a.setDimensions(15,15,70,70);a.closeable(!0);a.popup(!0);a.resizeable(!0);a.zIndex(300);j.addPanel(a);var b=new ia.HTMLContainer("popup");a.append(b.container);j.addComponent("popup",b);iaAddGlobalFunctions(j);j.url.params.select!=void 0&&(a=j.url.params.select.toString().split(","),j.getComponent("interactionGroup")&&j.getComponent("interactionGroup").setSelection(a));j.url.params.select2!=void 0&&(a=j.url.params.select2.toString().split(","),
j.getComponent("interactionGroup2")&&j.getComponent("interactionGroup2").setSelection(a));j.url.params.comparisonSelect!=void 0&&(a=j.url.params.comparisonSelect.toString().split(","),j.getComponent("comparisonInteractionGroup")&&j.getComponent("comparisonInteractionGroup").setSelection(a));j.url.params.comparisonSelect2!=void 0&&(a=j.url.params.comparisonSelect2.toString().split(","),j.getComponent("comparisonInteractionGroup2")&&j.getComponent("comparisonInteractionGroup2").setSelection(a));if(j.url.params.filter!=
void 0||j.url.params.filteredFeatures!=void 0)(a=j.getComponent("activeMap"))&&a.zoomToFeatures(o[0].getFilteredFeatures(),[p[0].baseLayer]);if(j.url.params.filter2!=void 0||j.url.params.filteredFeatures2!=void 0)(a=j.getComponent("activeMap2"))&&a.zoomToFeatures(o[1].getFilteredFeatures(),[p[1].baseLayer]);j.url.params.custom&&(m=onIAReportComplete);m&&m.call(null,j);j.endProgress("init")}function b(a,b){if(a.onSuccess)m=a.onSuccess;if(a.onFail)ia.File.errorHandler=a.onFail;h(a.params);if(a.data){var c=
a.data.config;if(c)if(c.source)q=c.source;else if(c.xml)r=c.xml;if(c=a.data.attribute)if(c.source)t=c.source;else if(c.json)s=c.json;if(c=a.data.model)j.data.model=c;if(c=a.data.map)if(c.source)u=c.source;else if(c.json)v=c.json;if(c=a.data.style)if(c.source)w=c.source;else if(c.text)x=c.text}j.url.params.dataPath!=void 0&&(t!=void 0&&(t=j.url.params.dataPath+t),u!=void 0&&(u=j.url.params.dataPath+u));j.url.params.config!=void 0&&(q=j.url.params.config+".xml");j.url.params.data!=void 0&&(t=j.url.params.dataPath+
j.url.params.data+".js");j.url.params.map!=void 0&&(u=j.url.params.dataPath+j.url.params.map+".js");ia.log("-----------------------------------");ia.log("CONFIG SOURCE : "+q);ia.log("  DATA SOURCE : "+t);ia.log("   MAP SOURCE : "+u);ia.log("-----------------------------------");ia.log("   CONFIG XML : "+r);ia.log("    DATA JSON : "+s);ia.log("    MAP JSON  : "+v);ia.log("-----------------------------------");w?ia.loadCssfile(w,function(){b.call(null)}):x?ia.appendCss(x,function(){b.call(null)}):b.call(null)}
function c(a){s?j.data.parseData(s,a):t?j.data.loadSource(t,a):a.call(null)}function d(a,b){v?a.parseData(v,b):u?a.loadSource(u,b):b.call(null)}function e(a){function b(){if(j.config.getComponent("featureCard")!=void 0||j.config.getComponent("pyramidChart")!=void 0||j.config.getComponent("spineChart")!=void 0)j.url.params.loadAllData=!0;j.locale=new ia.Locale(j.config.getProperty("locale"));j.locale.formatter.noDataValue=j.config.getProperty("noDataValue");j.data.formatter=j.locale.formatter;var c=
j.config.getProperty("ndecimal");j.data.precision=c>-1?c:void 0;j.data.setProperty(j.config.getProperty("customBreaksKey"),j.config.getProperty("legendBreaks"));j.data.setProperty(j.config.getProperty("customLabelsKey"),j.config.getProperty("legendLabels"));j.data.setProperty(j.config.getProperty("customBreaksKey2"),j.config.getProperty("legendBreaks2"));j.data.setProperty(j.config.getProperty("customLabelsKey2"),j.config.getProperty("legendLabels2"));a.call(null)}r?j.config.parseXML(r,b):q?j.config.loadSource(q,
b):a.call(null)}function f(a){o=[];p=[];var b=j.config.getProperty("selectionMode"),c,e=new ia.MapData;p[p.length]=e;var f=j.config.getComponent("map");if(f!=void 0)e.tilePath=f.getProperty("backgroundMappingPath");d(e,function(){var f=new ia.InteractionGroup;if(b)f.selectionMode=b;var g=new ia.InteractionGroup,h=new ia.DataGroup(j,"");h.mapData=e;o[o.length]=h;j.addComponent("dataGroup",h);j.template=e.template;j.version=e.version;j.evaluation=e.baseLayers[0].eval;j.uid=e.baseLayers[0].uid;h.build(function(){if(j.config.template==
ia.SINGLE_MAP_REPORT||j.config.template==ia.PYRAMID_REPORT||j.config.template==ia.SPINE_REPORT||j.config.template==ia.ELECTION_REPORT){var i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g}];c=new ia.ComponentFactory(j.config,j,i);j.addComponent("factory",c);c.buildComponents(function(){a!=void 0&&a.call(null)})}else if(j.config.template==ia.BUBBLE_PLOT_REPORT_SINGLE)i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},
{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(j.config,j,i),j.addComponent("factory",c),c.buildComponents(function(){a!=void 0&&a.call(null)});else{var l=new ia.MapData;p[p.length]=l;i=j.config.getComponent("map2");if(i!=void 0)l.tilePath=i.getProperty("backgroundMappingPath");d(l,function(){var d=new ia.DataGroup(j,"2");d.mapData=l;o[o.length]=d;j.addComponent("dataGroup2",d);d.build(function(){if(j.config.template==
ia.DOUBLE_GEOG_REPORT){var i=new ia.InteractionGroup;if(b)i.selectionMode=b;var l=new ia.InteractionGroup,m=j.config.getComponent("dataExplorer2");m==void 0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){d.setData(d.geography.id,h.indicator.id,h.indicator.date)});m=j.config.getComponent("filterExplorer2");m==void 0&&h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){a.filterId!=""?d.setFilter(a.filterId,a.filterValue):d.clearFilter()});i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},
{dataGroup:d,interactionGroup:i,comparisonInteractionGroup:l}];c=new ia.ComponentFactory(j.config,j,i);j.addComponent("factory",c);c.buildComponents(function(){var b=j.config.getComponent("map");b&&b.getProperty("syncMaps")&&k();a!=void 0&&a.call(null)})}else if(j.config.template==ia.DOUBLE_PLOT_REPORT)h.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){d.setData(a.geography.id,d.indicator.id,d.indicator.date)}),h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){d.setFilteredFeatures(a.filterFeatures)}),
(i=j.config.getComponent("dataExplorer"))&&i.getProperty("syncDates")==!0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(a){d.setData(a.geography.id,d.indicator.id,h.indicator.date)}),i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:d,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(j.config,j,i),j.addComponent("factory",c),c.buildComponents(function(){var b=j.config.getComponent("map");b&&b.getProperty("syncMaps")&&k();a!=void 0&&
a.call(null)});else if(j.config.template==ia.BUBBLE_PLOT_REPORT){var n=new ia.DataGroup(j,"3");n.mapData=e;o[o.length]=n;j.addComponent("dataGroup3",n);n.build(function(){var b=new ia.DataGroup(j,"4");b.mapData=e;o[o.length]=b;j.addComponent("dataGroup4",b);b.build(function(){h.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){d.setData(a.geography.id,d.indicator.id,d.indicator.date);n.setData(a.geography.id,n.indicator.id,n.indicator.date);b.setData(a.geography.id,b.indicator.id,b.indicator.date)});
h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){d.setFilteredFeatures(a.filterFeatures);n.setFilteredFeatures(a.filterFeatures);b.setFilteredFeatures(a.filterFeatures)});var e=j.config.getComponent("dataExplorer");e&&e.getProperty("syncDates")==!0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(a){d.setData(a.geography.id,d.indicator.id,h.indicator.date);n.setData(a.geography.id,n.indicator.id,h.indicator.date);b.setData(a.geography.id,b.indicator.id,h.indicator.date)});c=
new ia.ComponentFactory(j.config,j,[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:d,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:n,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:b,interactionGroup:f,comparisonInteractionGroup:g}]);j.addComponent("factory",c);c.buildComponents(function(){a!=void 0&&a.call(null)})})})}else if(j.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){d.setData(d.geography.id,
h.indicator.id,h.indicator.date)}),d.addEventListener(ia.Event.THEMATIC_CHANGED,function(){var a=j.getComponent("map");a&&a.render()}),h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){d.setFilteredFeatures(a.filterFeatures)}),i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:d,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(j.config,j,i),j.addComponent("factory",c),c.buildComponents(function(){var b=j.getComponent("map");b&&b.render();
a!=void 0&&a.call(null)});else if(j.config.template==ia.DOUBLE_BASELAYER_REPORT){i=new ia.InteractionGroup;if(b)i.selectionMode=b;l=new ia.InteractionGroup;d.addEventListener(ia.Event.THEMATIC_CHANGED,function(){var a=j.getComponent("map");a&&a.render()});m=j.config.getComponent("dataExplorer2");m==void 0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){d.setData(d.geography.id,h.indicator.id,h.indicator.date)});i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:d,
interactionGroup:i,comparisonInteractionGroup:l}];c=new ia.ComponentFactory(j.config,j,i);j.addComponent("factory",c);c.buildComponents(function(){var b=j.getComponent("map");b&&b.render();a!=void 0&&a.call(null)})}})})}})})}function g(a){function b(){if(c==o.length)a!=void 0&&a.call(null);else{var d=o[c];c++;d.update(b)}}var c=0;b()}function h(a){j.url=new ia.UrlParams(window.location.href);if(a){for(var b in a)!j.url.params[b]&&b!="errorHandler"&&b!="style"&&b!="printmode"&&(j.url.params[b]=a[b]);
if(j.url.params.config)ia.IAS_PATH=ia.File.getFileDirectory(j.url.params.config)}j.url.params.dataPath=j.url.params.dataPath||"";j.url.params.style&&ia.loadCssfile(j.url.params.style+".css");j.url.params.custom=j.url.params.custom||"";if(j.url.params.custom)a=document.createElement("script"),a.type="text/javascript",a.src=j.url.params.custom+".js",document.body.appendChild(a);j.url.params.printmode&&(j.container.addClass("ia-report-printmode"),a=new ia.PrintBar(j),a.render(),$j("body").prepend(a.container))}
function k(){var a=j.getComponent("gMap"),b=j.getComponent("gMap2");if(a&&b){var c=!1,d=!1;google.maps.event.addListener(a.gMap,"bounds_changed",function(){d==!1&&(c=!0,b.gMap.setZoom(a.gMap.getZoom()),b.gMap.setCenter(a.gMap.getCenter()))});google.maps.event.addListener(a.gMap,"idle",function(){c=!1});google.maps.event.addListener(b.gMap,"bounds_changed",function(){c==!1&&(d=!0,a.gMap.setZoom(b.gMap.getZoom()),a.gMap.setCenter(b.gMap.getCenter()))});google.maps.event.addListener(b.gMap,"idle",function(){d=
!1})}else if(a=j.getComponent("map"),b=j.getComponent("map2"),a&&b){var e=!1,f=function(a){e==!1&&(e=!0,b.controller.zoomToBBox(a.bBox),e=!1)};a.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,f);a.addEventListener(ia.BBoxEvent.BBOX_SCALE,f);f=function(b){e==!1&&(e=!0,a.controller.zoomToBBox(b.bBox),e=!1)};b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,f);b.addEventListener(ia.BBoxEvent.BBOX_SCALE,f)}}function i(){var a=new ia.CalloutBox("shareCallout","top-bottom");a.popup(!0);j.addCallout(a);var b=
$j("<div></div>");a.container.append(b);a=$j("<div></div>").html(j.config.getProperty("emailReportText"));b.append(a);a=$j('<input id="ia-share-callout" type="text" style="width:100%" class="ia-input" value="'+document.URL+'"/>');b.append(a);a.bind(ia.CLICK_TYPE,function(){this.select()});a=$j("<br/><br/>");b.append(a);a=$j("<div></div>").html(j.config.getProperty("embedReportText"));b.append(a);a=$j('<input id="ia-embed-callout" type="text" style="width:100%" class="ia-input" value="'+("<iframe src='"+
document.URL+"' style='width:800px;height:600px;border-width:0px'></iframe>")+'"/>');b.append(a);a.bind(ia.CLICK_TYPE,function(){this.select()})}function l(){$j("body").keydown(function(a){a.which==73&&a.ctrlKey==!0&&(a="About This InstantAtlas Report",a+="\n___________________________________________________________\n",a+="\nTemplate",a+="\n",a+="\nName: "+j.template,a+="\nVersion: "+j.version,a+="\nEvaluation: "+j.evaluation,a+="\nUID: "+j.uid,a+="\n___________________________________________________________\n",
a+="\nConfig",a+="\n",a+="\nName: "+j.config.name,a+="\nVersion: "+j.config.version,a+="\nId: "+j.config.template,alert(a))})}var j,m,n,o=[],p=[],q,r,t,s,u,v,w,x;ia.init=function(d,g,h){if(g!=void 0&&(d={container:d,onSuccess:g,data:{config:{source:"./config.xml"},attribute:{source:"./data.js"},map:{source:"./map.js"}}},h!=void 0))d.params=h;j=new ia.Report($j("#"+d.container));j.startProgress("init",function(){j.data=new ia.ReportData;n=new ia.TextSubstitution;if(BrowserDetect.browser=="Explorer"&&
BrowserDetect.version=="10")ia.IS_IE_TEN=!0;if(ia.isTouchDevice())ia.IS_TOUCH_DEVICE=!0,ia.CLICK_TYPE="touchend",ia.MOUSE_DOWN_TYPE="touchstart";$j.support.cors=!0;b(d,function(){e(function(){for(var b in j.url.params){if(b.indexOf("prop_")==0){var e=b.split("_")[1],g=j.url.params[b];j.config.setProperty(e,g,!0)}if(b.indexOf("comp_")==0){var h=b.split("_")[1],e=b.split("_")[2],g=j.url.params[b],h=j.config.getComponent(h);h!=void 0&&(h.setProperty(e,g,!0),h[e]=g)}b.indexOf("pal_")==0&&(h=j.config.getMapPalette(),
e=b.split("_")[1],g=j.url.params[b],h[e]=g)}d.data.attribute==void 0?j.build(function(){a()}):c(function(){j.build(function(){f(function(){a()})})})})})})};ia.loadStyle=function(a,b){j.startProgress("loadStyle",function(){j.url.params.style=a.substring(0,a.lastIndexOf("."));ia.loadCssfile(a,function(){j.endProgress("loadStyle");b!=void 0&&b.call(null)})})};ia.loadConfig=function(a,b){j.startProgress("loadConfig",function(){j.url.params.config=a.substring(0,a.lastIndexOf("."));q=a;r=void 0;e(function(){j.data.refresh(function(){j.build(function(){f(function(){j.endProgress("loadConfig");
b!=void 0&&b.call(null)})})})})})};ia.parseConfig=function(a,b){j.startProgress("parseConfig",function(){q=void 0;r=a;e(function(){j.data.refresh(function(){j.build(function(){f(function(){j.endProgress("parseConfig");b!=void 0&&b.call(null)})})})})})};ia.loadData=function(a,b){j.startProgress("loadData",function(){j.url.params.data=a.substring(0,a.lastIndexOf("."));t=a;s=void 0;c(function(){g(function(){j.endProgress("loadData");b!=void 0&&b.call(null)})})})};ia.parseData=function(a,b){j.startProgress("parseData",
function(){t=void 0;s=a;c(function(){g(function(){j.endProgress("parseData");b!=void 0&&b.call(null)})})})};ia.loadMap=function(a,b){j.startProgress("loadMap",function(){function c(){if(e==p.length)g(function(){j.endProgress("loadMap");b!=void 0&&b.call(null)});else{var a=p[e];e++;d(a,c)}}j.url.params.map=a.substring(0,a.lastIndexOf("."));u=a;v=void 0;var e=0;c()})};ia.parseMap=function(a,b){j.startProgress("parseMap",function(){function c(){if(e==p.length)g(function(){j.endProgress("parseMap");b!=
void 0&&b.call(null)});else{var a=p[e];e++;d(a,c)}}u=void 0;v=a;var e=0;c()})};ia.update=function(a,d){j.startProgress("update",function(){b(a,function(){e(function(){c(function(){j.build(function(){f(function(){j.endProgress("update");d!=void 0&&d.call(null)})})})})})})};ia.load=function(a,b,c){j.startProgress("load",function(){j.url.params.data=a.substring(0,a.lastIndexOf("."));j.data.loadSource(a,function(){ia.loadMap(b,function(){j.endProgress("load");c!=void 0&&c.call(null)})})})};ia.parse=function(a,
b,c){j.startProgress("parse",function(){j.data.parseData(a,function(){ia.parseMap(b,function(){j.endProgress("parse");c!=void 0&&c.call(null)})})})};ia.tipFunction=function(a,b,c){n.clearVariables();var d=j.config.getComponent(b).getProperty("tip");c&&(d=j.config.getComponent(b).getProperty("tip"+c));for(var b=a.name,c="",e=0;e<o.length;e++){var f=o[e],g=f.indicator;e!=0&&(c=e+1);n.setVariable("featureName"+c,b);if(f=f.geography.getFeature(a.id)){n.setVariable("feature-id",f.id);n.setVariable("feature-name",
f.name);n.setVariable("feature-href",f.href);var f=f.getProperties(),h;for(h in f)n.setVariable(h+c,f[h]),n.setVariable(h+"-value",f[h])}f=g.getFormattedValue(a.id);n.setVariable("indicatorValue"+c,f);n.setVariable("indicator-id"+c,g.id);n.setVariable("indicator-name"+c,g.name);n.setVariable("indicator-type"+c,g.type);n.setVariable("indicator-href"+c,g.href);n.setVariable("indicator-value"+c,f);n.setVariable("indicator-formatted-value"+c,g.formattedValue);n.setVariable("indicator-date"+c,g.date);
f=g.getProperties();for(h in f)n.setVariable(h+c,f[h]),n.setVariable(h+"-value"+c,f[h]);for(var f=g.getAssociates(),i=f.length,k=0;k<i;k++){var l=f[k];n.setVariable(l.name+""+c,l.getFormattedValue(a.id));n.setVariable(l.name+"-value"+c,l.getValue(a.id));n.setVariable(l.name+"-formatted-value"+c,l.getFormattedValue(a.id));n.setVariable(l.name+"-type"+c,l.type)}f=g.getLowerLimits();g=g.getUpperLimits();f&&g?(n.setVariable("lowerLimit"+c,f.getFormattedValue(a.id)),n.setVariable("upperLimit"+c,g.getFormattedValue(a.id))):
(n.setVariable("lowerLimit"+c,""),n.setVariable("upperLimit"+c,""))}return n.formatMessage(d)};ia.initGoogleMaps=function(){ia.googleMapsLoaded=!0;p[0].loadVisibleLayers()};ia.googleMapsLoaded=!1;ia.getUrl=function(){return j.url.getReportUrl()};ia.toggleCallout=function(a,b){var c=j.getCallout(a);if(c!=void 0){if(ia.IS_TOUCH_DEVICE){var d=b.originalEvent.changedTouches[0];c.position(d.pageX,d.pageY)}else c.position(b.pageX,b.pageY);c.toggle()}}})();
ia.EventDispatcher=function(){this._objs=[];this._eventListeners=[];this._eventTypes=[]};ia.EventDispatcher.prototype.addEventListener=function(a,b,c){this._objs.push(c);this._eventTypes.push(a);this._eventListeners.push(b)};ia.EventDispatcher.prototype.removeListener=function(a){for(var b=this._objs.length;b--;)this._objs[b]==a&&(this._objs.splice(b,1),this._eventTypes.splice(b,1),this._eventListeners.splice(b,1))};
ia.EventDispatcher.prototype.dispatchEvent=function(a){for(var b=this._eventListeners.concat(),c=this._eventTypes.concat(),d=0;d<b.length;d++)c[d]==a.type&&b[d].call(null,a)};ia.Event=function(a,b){this.type=a;this.object=b};ia.Event.MAP_READY="mapReady";ia.Event.MAP_RESIZE="mapResize";ia.Event.LAYER_READY="layerReady";ia.Event.LAYER_VISIBLE_CHANGED="layerVisibleChanged";ia.Event.THEME_CHANGED="themeChanged";ia.Event.THEMATIC_CHANGED="thematicChanged";ia.Event.CLEAR_SELECTION="clearSelection";
ia.MouseEvent=function(a,b,c,d,e){ia.MouseEvent.baseConstructor.call(this,b,e);this.x=c;this.y=d;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey;a=window.event||a;this.delta=a.detail?a.detail*-120:a.wheelDelta};ia.extend(ia.Event,ia.MouseEvent);
ia.Report=function(a){ia.Report.baseConstructor.call(this);this._widgetArray=[];this._widgetHash={};this._panelArray=[];this._panelHash={};this._buttonArray=[];this._buttonHash={};this._textArray=[];this._textHash={};this._imageArray=[];this._imageHash={};this._calloutArray=[];this._calloutHash={};this._componentArray=[];this._componentHash={};this.selectionColor="#ff0000";this.highlightColor="#00ff00";this.highlightOpacity=this.selectionOpacity=0.3;this.uid="";this.evaluation=!0;this.config=new ia.ReportConfig;
this.textSubstitution=new ia.TextSubstitution;this.container=$j('<div id="ia-report" class="ia-report">');a.append(this.container);this.$busyContainer=$j('<div class="ia-report-busy">');this.$busyContainer.bind(ia.CLICK_TYPE,function(){event.stopPropagation()});this.$busyContainer.bind("touchstart touchmove touchend mousemove mouseup mouseenter mouseleave mousedown click",function(a){a.stopPropagation()});a.append(this.$busyContainer);$j("#ia-report-progress").length?this.$progressContainer=$j("#ia-report-progress"):
(this.$progressContainer=$j('<div class="ia-report-loading">'),a.append(this.$progressContainer));this.$progressContainer.bind(ia.CLICK_TYPE,function(){event.stopPropagation()});this.$progressContainer.bind("touchstart touchmove touchend mousemove mouseup mouseenter mouseleave mousedown click",function(a){a.stopPropagation()})};ia.extend(ia.EventDispatcher,ia.Report);this.evaluation=!0;
ia.Report.prototype.addComponent=function(a,b){this._componentHash[a]=b;this._componentArray[this._componentArray.length]=b};ia.Report.prototype.getComponents=function(){return this._componentArray};ia.Report.prototype.getComponent=function(a){return this._componentHash[a]};ia.Report.prototype.addCallout=function(a){this._calloutArray[this._calloutArray.length]=a;this._calloutHash[a.id]=a;this.container.append(a.container)};ia.Report.prototype.getCallouts=function(){return this._calloutArray};
ia.Report.prototype.getCallout=function(a){return this._calloutHash[a]};ia.Report.prototype.addWidget=function(a,b){this._widgetArray[this._widgetArray.length]=a;this._widgetHash[a.id]=a;this.container.append(a.container);b!=void 0&&(b.id.indexOf("filterButton")!=-1||b.id.indexOf("geographyButton")!=-1?a.container.css("visibility","hidden"):a.visible(b.visible),a.update(b))};ia.Report.prototype.getWidgets=function(){return this._widgetArray};
ia.Report.prototype.getWidget=function(a){a=a.replace("-panel","");return this._widgetHash[a]};
ia.Report.prototype.removeWidgets=function(){for(var a=0;a<this._widgetArray.length;a++)this._widgetArray[a].container.remove();this._panelArray=[];this._panelHash={};this._textArray=[];this._textHash={};this._imageArray=[];this._imageHash={};this._buttonArray=[];this._buttonHash={};this._widgetArray=[];this._widgetHash={};this._calloutArray=[];this._calloutHash={};this._componentArray=[];this._componentHash={}};
ia.Report.prototype.addPanel=function(a,b){this._panelArray[this._panelArray.length]=a;this._panelHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getPanels=function(){return this._panelArray};ia.Report.prototype.getPanel=function(a){a=a.replace("-panel","");return this._panelHash[a]};ia.Report.prototype.addButton=function(a,b){this._buttonArray[this._buttonArray.length]=a;this._buttonHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getButtons=function(){return this._buttonArray};
ia.Report.prototype.getButton=function(a){return this._buttonHash[a]};ia.Report.prototype.addText=function(a,b){this._textArray[this._textArray.length]=a;this._textHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getTexts=function(){return this._textArray};ia.Report.prototype.getText=function(a){return this._textHash[a]};ia.Report.prototype.addImage=function(a,b){this._imageArray[this._imageArray.length]=a;this._imageHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getImages=function(){return this._imageArray};
ia.Report.prototype.getImage=function(a){return this._imageHash[a]};
ia.Report.prototype.build=function(a){this.removeWidgets();var b=$j('<div class="ia-highlight-color ia-map-highlight-opacity">');this.container.append(b);var c=$j('<div class="ia-selection-color ia-map-selection-opacity">');this.container.append(c);this.highlightColor=ia.Color.toHex(b.css("color"));this.selectionColor=ia.Color.toHex(c.css("color"));this.highlightOpacity=b.css("opacity");this.selectionOpacity=c.css("opacity");b.remove();c.remove();b=this.config.getWidgets();c=$j('<div class="ia-panel">');
this.container.append(c);for(var d=0;d<b.length;d++){var e=b[d],f;if(e.type=="component"||e.type=="table")f=new ia.Panel(e.id),this.addPanel(f,e);else if(e.type=="button")f=new ia.Button(e.id),this.addButton(f,e);else if(e.type=="text")f=new ia.Text(e.id),this.addText(f,e);else if(e.type=="image"||e.type=="img")f=new ia.Image(e.id,e.src),this.addImage(f,e)}c.remove();a!=null&&a.call(null,this)};
ia.Report.prototype.updateDynamicText=function(a){for(var b=this.config.getComponents(),c=0;c<b.length;c++){var d=b[c],e=a.formatMessage(d.getProperty("title"));this.getWidget(d.id).title(e)}b=this.config.getTexts().concat(this.config.getButtons());for(c=0;c<b.length;c++)d=b[c],e=a.formatMessage(d.text),this.getWidget(d.id).text(e)};ia.Report.prototype._progressIds=[];
ia.Report.prototype.startProgress=function(a,b){this._progressIds[this._progressIds]=a;this.$progressContainer.css("display","inline");ia.showWaitCursor();setTimeout(function(){b.call(null)},100)};ia.Report.prototype.endProgress=function(a){a=this._progressIds.indexOf(a);a!=-1&&this._progressIds.splice(a,1);this._progressIds.length==0&&(this.$progressContainer.css("display","none"),ia.showDefaultCursor())};ia.Report.prototype._blockIds=[];
ia.Report.prototype.blockInteraction=function(a,b,c){this._blockIds[this._blockIds]=a;this.$busyContainer.css("display","inline");b&&ia.showWaitCursor();setTimeout(function(){c.call(null)},100)};ia.Report.prototype.allowInteraction=function(a){a=this._blockIds.indexOf(a);a!=-1&&this._blockIds.splice(a,1);this._blockIds.length==0&&(this.$busyContainer.css("display","none"),ia.showDefaultCursor())};
ia.Report.prototype.displayEvaluationMessage=function(a){var b="This report was prepared using an InstantAtlas&#153 evaluation license. It is not licensed for distribution or publication of any kind. For more information contact <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a>, or visit <a href='http://www.instantatlas.com/' target='_blank'>http://www.instantatlas.com/</a>.",c="Evaluation";this.locale&&(this.locale.getLanguage()=="de"?b="Dieser Bericht wurde mit einer InstantAtlas&#153 Testlizenz erstellt. Er ist nicht zur Verbreitung oder Ver\u00f6ffentlichung jeglicher Art lizensiert. F\u00fcr weitere Informationen kontaktieren Sie bitte <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> oder besuchen Sie <a href='http://www.instantatlas.com/de/' target='_blank'>http://www.instantatlas.com/</a>.":
this.locale.getLanguage()=="fr"?b="Ce rapport a \u00e9t\u00e9 cr\u00e9e avec une licence d\u2019\u00e9valuation. Cette licence ne permet pas la distribution ou la publication du rapport. Pour plus de renseignements veuillez contacter <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> ou consulter <a href='http://www.instantatlas.com/fr/' target='_blank'>http://www.instantatlas.com</a>.":this.locale.getLanguage()=="es"&&(b="Este informe ha sido generado con una licencia de evaluaci\u00f3n. La distribuci\u00f3n o publicaci\u00f3n del informe est\u00e1 prohibida. Para m\u00e1s informaci\u00f3n mande un email a <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> o consulte <a href='http://www.instantatlas.com/es/' target='_blank'>http://www.instantatlas.com</a>.",
c="Evaluaci\u00f3n"));var d=$j("<div>");d.css({position:"absolute",left:"5px",bottom:"5px","border-color":"#DCDCDC","border-width":"1px","border-style":"solid","background-color":"#f9f9f9","border-radius":"4px",padding:"5px","text-align":"right"});c=$j("<div>").text(c);c.css({"font-family":"Arial Black","font-size":"30px",color:"#bbbbbb"});var e=$j("<a href='http://www.instantatlas.com/' target='_blank'>").text("http://www.instantatlas.com");this.locale&&(this.locale.getLanguage()=="de"?e=$j("<a href='http://www.instantatlas.com/de/' target='_blank'>").text("http://www.instantatlas.com"):
this.locale.getLanguage()=="fr"?e=$j("<a href='http://www.instantatlas.com/fr/' target='_blank'>").text("http://www.instantatlas.com"):this.locale.getLanguage()=="es"&&(e=$j("<a href='http://www.instantatlas.com/es/' target='_blank'>").text("http://www.instantatlas.com")));e.css({"font-family":"Verdana","font-size":"11px",color:"#888888"});var f=$j("<div>").html(b);f.css({position:"absolute",left:"30%",top:"40%",width:"40%","border-color":"#DCDCDC","border-width":"1px","border-style":"solid","background-color":"#f9f9f9",
"border-radius":"5px",padding:"10px","z-index":999999});$j("body").bind(ia.CLICK_TYPE,function(){f.hide()});a.append(d);d.append(c);d.append(e);this.container.append(f)};ia.Report.prototype.closePopups=function(a){for(var b=this.getPanels(),c=0;c<b.length;c++){var d=b[c];d.popup()&&d.id!=a&&d.hide()}b=this.getCallouts();for(c=0;c<b.length;c++)d=b[c],d.id!=a&&d.hide()};ia.InteractionEvent=function(a,b,c){ia.InteractionEvent.baseConstructor.call(this,a,b);this.ids=c||[]};ia.extend(ia.Event,ia.InteractionEvent);
ia.InteractionEvent.SELECTION_CHANGED="selectionChanged";ia.InteractionEvent.HIGHLIGHT_CHANGED="highlightChanged";ia.InteractionGroup=function(){ia.InteractionGroup.baseConstructor.call(this);this._selection=[];this._highlight="";this._components=[];this._legendComponents=[];this.selectionMode="multiple"};ia.extend(ia.EventDispatcher,ia.InteractionGroup);ia.InteractionGroup.prototype.getComponents=function(){return this._components.concat(this._legendComponents)};
ia.InteractionGroup.prototype.addComponent=function(a){function b(a){this.dispatchEvent(a)}a.isLegendComponent?this._legendComponents.push(a):this._components.push(a);a.addEventListener(ia.ItemEvent.ITEM_MOUSE_OVER,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_OUT,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_UP,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_CLICK,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.NONE_ITEM_CLICK,
this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_DOWN,b.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_MOVE,b.bind(this))};ia.InteractionGroup.prototype.removeComponent=function(a){var b=this._components.indexOf(a);b!=-1&&this._components.splice(b,1);b=this._legendComponents.indexOf(a);b!=-1&&this._legendComponents.splice(b,1)};ia.InteractionGroup.prototype.getHighlight=function(){return this._highlight};
ia.InteractionGroup.prototype.clearHighlight=function(){this._highlight="";for(var a=0;a<this._components.length;a++){var b=this._components[a];b.clearHighlight()}for(a=0;a<this._legendComponents.length;a++)b=this._legendComponents[a],b.clearHighlight();this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))};
ia.InteractionGroup.prototype.setHighlight=function(a){if(a!=""){this._highlight=a;for(var b=0;b<this._components.length;b++)this._components[b].clearHighlight(),this._components[b].highlight(a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))}else this.clearHighlight()};ia.InteractionGroup.prototype.getSelection=function(){return this._selection};
ia.InteractionGroup.prototype.setSelection=function(a){if(a.length>0){this._selection=a.concat();for(a=0;a<this._components.length;a++)for(var b=0;b<this._selection.length;++b)this._components[a].select(this._selection[b]);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}else this.clearSelection()};
ia.InteractionGroup.prototype.clearSelection=function(){for(var a=0;a<this._components.length;a++){var b=this._components[a];b.clearSelection()}for(a=0;a<this._legendComponents.length;a++)b=this._legendComponents[a],b.clearSelection();this._selection=[];this.dispatchEvent(new ia.Event(ia.Event.CLEAR_SELECTION,{}));this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))};
ia.InteractionGroup.prototype.select=function(a){if(this._selection.indexOf(a)==-1){this._selection.push(a);for(var b=0;b<this._components.length;b++)this._components[b].select(a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}};
ia.InteractionGroup.prototype.unselect=function(a){var b=this._selection.indexOf(a);if(b!=-1){this._selection.splice(b,1);for(b=0;b<this._components.length;b++)this._components[b].unselect(a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}};
ia.InteractionGroup.prototype._itemEventHandler=function(a){var b=a.item;a.type==ia.ItemEvent.NONE_ITEM_CLICK?a.item.parent instanceof ia.FeatureLayer&&this.clearSelection():b.parent.isLegendComponent?a.type==ia.ItemEvent.ITEM_CLICK&&this.selectionMode=="single"?b.parent.unselect(b.id):this._onLegendClassEvent(a,b):(this._updateComponents(a,b),this._updateLegendClassComponents(a,b));this._dispatchInteractionEvent(a.type)};
ia.InteractionGroup.prototype._dispatchInteractionEvent=function(a){a==ia.ItemEvent.NONE_ITEM_CLICK||a==ia.ItemEvent.ITEM_CLICK?this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection)):(a==ia.ItemEvent.ITEM_MOUSE_OUT||a==ia.ItemEvent.ITEM_MOUSE_UP||a==ia.ItemEvent.ITEM_MOUSE_OVER)&&this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))};
ia.InteractionGroup.prototype._onLegendClassEvent=function(a,b){for(var c=b.id,d=b.parent,e=b.state,f=0;f<this._legendComponents.length;f++){var g=this._legendComponents[f];g!=d&&d.thematic==g.thematic&&(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP?g.clearHighlight():a.type==ia.ItemEvent.ITEM_MOUSE_OVER?(g.clearHighlight(),g.highlight(c)):a.type==ia.ItemEvent.ITEM_CLICK&&(e==ia.ItemLayer.UNSELECTED?g.unselect(c):g.select(c)))}if(a.type==ia.ItemEvent.ITEM_CLICK){c=b.legendClass.items;
d=c.length;for(f=0;f<d;f++)this._updateComponents(a,c[f])}};ia.InteractionGroup.prototype._updateLegendClassComponents=function(a,b){for(var c=0;c<this._legendComponents.length;c++){var d=this._legendComponents[c];if(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP)d.clearHighlight();else if(a.type==ia.ItemEvent.ITEM_MOUSE_OVER){d.clearHighlight();var e=d.thematic.getData();e&&(e=e[b.id])&&e.legendClass&&d.highlight(e.legendClass.index)}}};
ia.InteractionGroup.prototype._updateComponents=function(a,b){var c=b.id,d=b.parent,e=a.item.state;a.type==ia.ItemEvent.ITEM_CLICK&&this.selectionMode=="single"&&this.clearSelection();if(a.type==ia.ItemEvent.ITEM_CLICK)if(e==ia.ItemLayer.UNSELECTED){var f=this._selection.indexOf(c);f!=-1&&this._selection.splice(f,1)}else this._selection.push(c);else if(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP)this._highlight="";else if(a.type==ia.ItemEvent.ITEM_MOUSE_OVER)this._highlight=
c;for(f=0;f<this._components.length;f++){var g=this._components[f];if(g!=d||this.selectionMode=="single")a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP?g.clearHighlight():a.type==ia.ItemEvent.ITEM_MOUSE_OVER&&(g.clearHighlight(),g.highlight(c)),a.type==ia.ItemEvent.ITEM_CLICK&&(e==ia.ItemLayer.UNSELECTED?g.unselect(c):g.select(c))}this.dispatchEvent(a)};
ia.DataGroup=function(a,b){function c(){l=!0;var c,e=a.data.getGeographies();a.url.params["geog"+b]&&(c=e[a.url.params["geog"+b]]);c==void 0&&(c=(a.config.template==ia.DOUBLE_GEOG_REPORT||a.config.template==ia.DOUBLE_BASELAYER_REPORT||a.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)&&b!=""?e.length>=b?e[b-1]:e[0]:e[0]);var f=a.getButton("geographyButton"+b);f&&(e.length>1?f.show():f.hide());e=!0;if(f=a.config.getComponent("dataExplorer"+b))e=f.getProperty("reverseDates"),e==void 0&&(e=!0);var g;
a.url.params["indicator"+b]&&(g=a.url.params["date"+b]?c.getIndicator(a.url.params["indicator"+b],a.url.params["date"+b]):c.getIndicator(a.url.params["indicator"+b],void 0,e));g==void 0&&(g=c.getFirstIndicator(e),a.url.params["date"+b]&&(g=c.getIndicator(g.id,a.url.params["date"+b])));d(c.id,g.id,g.date)}function d(b,c,d){a.blockInteraction("onDataChangeProgress",!0,function(){var g=a.data.getGeography(b);g.loadIndicator(c,d,function(b){l||b.geography.id!=i.indicator.geography.id?f(g,function(){a.url.params.loadAllData?
g.loadData(function(){e(b)}):e(b)}):e(b)})})}function e(a){n=!0;i.indicator=a;if(l||i.theme.id!=a.theme.id)m=!0;i.theme=a.theme;i.geography=a.geography;g();h(i.thematic,i.indicator);i.thematic.commitChanges()}function f(c,d){j=!0;if(l)if(a.url.params["filteredFeatures"+b])r.features=a.url.params["filteredFeatures"+b].split(","),o=!0;else{if(a.url.params["filter"+b]){var e=a.url.params["filter"+b].split(","),f=e[0],e=e[1];o=!0;r.id=f;r.name=c.getFilter(f).name;r.value=e;r.features=c.getFilteredFeatures(r.id,
r.value);a.textSubstitution.setVariable("filterName"+b,r.name);a.textSubstitution.setVariable("filterValue"+b,r.value)}}else r.features=[],a.textSubstitution.setVariable("filterName"+b,""),a.textSubstitution.setVariable("filterValue"+b,"");(f=a.getButton("filterButton"+b))&&(c.getFilters().length>0?f.show():f.hide());if(i.mapData){var g=i.mapData.baseLayer.getVisible();i.mapData.baseLayer.setVisible(!1);i.mapData.baseLayer=i.mapData.baseLayers[c.index];if(i.mapData.baseLayer==void 0)i.mapData.baseLayer=
i.mapData.baseLayers[0];var h=function(){g&&i.mapData.baseLayer.setVisible(!0);var c,e=i.thematic.numericClassifier.sizePalette;if(a.config.template==ia.BUBBLE_PLOT_REPORT&&b=="2"){var f=a.config.getComponent("scatterPlot");if(f)c="circle",i.thematic.setDataField(f.getProperty("sizeData")),i.legendSettings.legendType="continuous",e.minSize=f.getProperty("minBubbleSize"),e.maxSize=f.getProperty("maxBubbleSize"),i.thematic.categoricClassifier.symbolSize=8}else i.mapData.baseLayer.geometry=="point"?
(c=a.config.getProperty("symbolShape"+b),e.minSize=a.config.getProperty("minSymbolSize"+b),e.maxSize=a.config.getProperty("maxSymbolSize"+b),i.thematic.categoricClassifier.symbolSize=i.mapData.baseLayer.symbolSize):i.mapData.baseLayer.geometry=="line"?(c=ia.Shape.LINE,e.minSize=a.config.getProperty("minLineSize"+b),e.maxSize=a.config.getProperty("maxLineSize"+b),i.thematic.categoricClassifier.symbolSize=i.mapData.baseLayer.style.lineWidth):(c=ia.Shape.SQUARE,e.minSize=i.mapData.baseLayer.symbolSize,
e.maxSize=i.mapData.baseLayer.symbolSize,i.thematic.categoricClassifier.symbolSize=i.mapData.baseLayer.symbolSize);i.mapData.baseLayer.symbol=c;i.thematic.symbol=c;d.call(null)};i.mapData.baseLayer.isLoaded?h():(i.mapData.baseLayer.addEventListener(ia.Event.LAYER_READY,function(){h()}),i.mapData.baseLayer.loadSource())}else d.call(null)}function g(){r.features.length>0?(i.indicatorData=i.indicator.getData(r.features),i.themeData=i.theme.getData(i.indicator.id,r.features)):(i.indicatorData=i.indicator.getData(),
i.themeData=i.theme.getData(i.indicator.id));i.comparisonData=i.indicator.getComparisonData();i.comparisonThemeData=i.theme.getComparisonData(i.indicator.id);i.comparisonThematic.setData(i.comparisonData);var c=i.indicator.getDataType(i.thematic.getDataField());i.thematic.setDataType(c);i.thematic.setData(i.indicatorData);a.textSubstitution.setVariable("geogName"+b,i.geography.name);a.textSubstitution.setVariable("themeName"+b,i.theme.getParentThemes());a.textSubstitution.setVariable("indicatorName"+
b,i.indicator.name);a.textSubstitution.setVariable("date"+b,i.indicator.date);var c=i.indicator.getProperties(),d;for(d in c)a.textSubstitution.setVariable(d+""+b,c[d]);a.updateDynamicText(a.textSubstitution)}function h(c,d){var e=a.config.getMapPalette(),f=d.getProperty(a.config.getProperty("customClassifierKey"+b)),g=d.getProperty(a.config.getProperty("customColoursKey"+b)),h=d.getProperty(a.config.getProperty("customPaletteKey"+b)),j=d.getProperty(a.config.getProperty("customBreaksKey"+b)),k=d.getProperty(a.config.getProperty("customLabelsKey"+
b)),l=d.getProperty("customNoClasses"),m=i.thematic.categoricClassifier;m.breaks=[];m.labels=[];m.colorPalette=e.getColorScheme(i.legendSettings.schemeId);var n=i.thematic.numericClassifier;n.labels=[];n.classificationName=i.legendSettings.legendType;n.colorPalette=i.mapData.baseLayer.themeColors!=void 0?new ia.ColorPalette(i.mapData.baseLayer.themeColors):e.getColorPalette(i.legendSettings.paletteId);if(d.type==ia.Thematic.CATEGORIC){a.textSubstitution.setVariable("legendType"+b,"");a.updateDynamicText(a.textSubstitution);
if(j)m.breaks=j.split(";");if(k)m.labels=k.split(";");if(h)m.colorPalette=e.getColorScheme(h);if(g)e=g.split(";"),m.colorPalette=new ia.ColorPalette(e)}else{if(f)n.classificationName=f;a.textSubstitution.setVariable("legendType"+b,n.classificationName);a.updateDynamicText(a.textSubstitution);if(j){var o=j.split(";"),m=function(){return o};f=="continuous"?(n.getCalculator().addFunction("continuous",m),n.classificationName="continuous"):(n.getCalculator().addFunction("customClassifier",m),n.classificationName=
"customClassifier")}if(l)n.noClasses=l;if(k)n.labels=k.split(";");if(h)n.colorPalette=e.getColorPalette(h);if(g)e=g.split(";"),n.colorPalette=new ia.ColorPalette(e)}}function k(){if(i.indicator.getDataType(i.thematic.getDataField())==ia.Thematic.CATEGORIC)a.textSubstitution.setVariable("mean"+b,""),a.textSubstitution.setVariable("median"+b,""),a.textSubstitution.setVariable("sum"+b,""),a.textSubstitution.setVariable("minValue"+b,""),a.textSubstitution.setVariable("maxValue"+b,""),a.textSubstitution.setVariable("range"+
b,""),a.textSubstitution.setVariable("lowerQuartile"+b,""),a.textSubstitution.setVariable("upperQuartile"+b,""),a.textSubstitution.setVariable("interquartileRange"+b,""),a.textSubstitution.setVariable("variance"+b,""),a.textSubstitution.setVariable("standardDeviation"+b,"");else{var c=i.indicator.precision||2;c==void 0&&(c=2);var d=a.locale.formatter,e=i.thematic.numericClassifier.getCalculator().getStats();a.textSubstitution.setVariable("sum"+b,d.format(e.sum,c));a.textSubstitution.setVariable("mean"+
b,d.format(e.mean,c));a.textSubstitution.setVariable("median"+b,d.format(e.median,c));a.textSubstitution.setVariable("minValue"+b,d.format(e.minValue,c));a.textSubstitution.setVariable("maxValue"+b,d.format(e.maxValue,c));a.textSubstitution.setVariable("range"+b,d.format(e.range,c));a.textSubstitution.setVariable("lowerQuartile"+b,d.format(e.lowerQuartile,c));a.textSubstitution.setVariable("upperQuartile"+b,d.format(e.upperQuartile,c));a.textSubstitution.setVariable("interquartileRange"+b,d.format(e.interquartileRange,
c));a.textSubstitution.setVariable("variance"+b,d.format(e.variance,c));a.textSubstitution.setVariable("standardDeviation"+b,d.format(e.standardDeviation,c))}a.updateDynamicText(a.textSubstitution)}ia.DataGroup.baseConstructor.call(this);var i=this,l=!0,j=!1,m=!1,n=!1,o=!1,p=!1,q,r={id:"",name:"",value:"",features:[]};this.suffix=b||"";this.legendSettings={};this.setData=function(b,c,e){var f=a.data.getGeography(b),c=f.getIndicator(c,e);c==void 0&&(c=f.getFirstIndicator(!0));d(b,c.id,c.date)};this.setFilter=
function(c,d){o=!0;r.id=c;r.name=i.geography.getFilter(c).name;r.value=d;r.features=i.geography.getFilteredFeatures(r.id,r.value);a.textSubstitution.setVariable("filterName"+b,r.name);a.textSubstitution.setVariable("filterValue"+b,r.value);g();i.thematic.commitChanges()};this.setFilteredFeatures=function(c){o=!0;r.id="";r.name="";r.value="";r.features=c.concat();a.textSubstitution.setVariable("filterName"+b,"");a.textSubstitution.setVariable("filterValue"+b,"");g();i.thematic.commitChanges()};this.getFilteredFeatures=
function(){return r.features};this.clearFilter=function(){o=!0;r.id="";r.name="";r.value="";r.features=[];a.textSubstitution.setVariable("filterName"+b,"");a.textSubstitution.setVariable("filterValue"+b,"");g();i.thematic.commitChanges()};this.update=function(a){q=a;c()};this.build=function(d){q=d;a.textSubstitution.setVariable("geogName"+b," ");a.textSubstitution.setVariable("themeName"+b," ");a.textSubstitution.setVariable("indicatorName"+b," ");a.textSubstitution.setVariable("date"+b," ");a.textSubstitution.setVariable("filterName"+
b,"");a.textSubstitution.setVariable("filterValue"+b,"");a.textSubstitution.setVariable("legendType"+b,"");a.updateDynamicText(a.textSubstitution);i.thematic=new ia.Thematic;i.thematic.noDataValue=a.locale.formatter.noDataValue;i.thematic.setDataField(a.config.getProperty("data"+b));i.thematic.addEventListener(ia.Event.THEME_CHANGED,function(){i.comparisonThematic.commitChanges();p=!0;k();a.blockInteraction("onThemeChangeProgress",!1,function(){j&&i.dispatchEvent(new ia.DataEvent(ia.DataEvent.GEOG_CHANGED,
i,i.geography,i.theme,i.indicator));o&&(a.url.params["filteredFeatures"+b]=r.features.length>0?r.features.join(","):"",i.dispatchEvent(new ia.FilterEvent(ia.FilterEvent.FILTER_CHANGED,i,r.id,r.name,r.value,r.features)));m&&i.dispatchEvent(new ia.DataEvent(ia.DataEvent.THEME_CHANGED,i,i.geography,i.theme,i.indicator));if(n)a.url.params["geog"+b]=i.geography.index,a.url.params["indicator"+b]=i.indicator.id,a.url.params["date"+b]=i.indicator.date?i.indicator.date:"",i.dispatchEvent(new ia.DataEvent(ia.DataEvent.INDICATOR_CHANGED,
i,i.geography,i.theme,i.indicator));(n||o)&&i.dispatchEvent(new ia.DataEvent(ia.DataEvent.DATA_CHANGED,i,i.geography,i.theme,i.indicator));if(p){a.url.params["prop_legendClassifier"+b]=i.thematic.numericClassifier.classificationName;if(b=="")a.url.params.pal_defaultPaletteId=i.legendSettings.paletteId,a.url.params.pal_defaultSchemeId=i.legendSettings.schemeId,a.url.params.pal_noClasses=i.thematic.numericClassifier.noClasses;if(b=="2")a.url.params.prop_mapPalette2=i.legendSettings.paletteId;var c=
i.thematic.numericClassifier.sizePalette;if(a.config.template==ia.BUBBLE_PLOT_REPORT&&b=="2"){if(a.config.getComponent("scatterPlot"))a.url.params["prop_minBubbleSize"+b]=c.minSize,a.url.params["prop_maxBubbleSize"+b]=c.maxSize}else if(i.mapData.baseLayer.geometry=="point")a.url.params["prop_minSymbolSize"+b]=c.minSize,a.url.params["prop_maxSymbolSize"+b]=c.maxSize;else if(i.mapData.baseLayer.geometry=="line")a.url.params["prop_minLineSize"+b]=c.minSize,a.url.params["prop_maxLineSize"+b]=c.maxSize;
i.dispatchEvent(new ia.Event(ia.Event.THEMATIC_CHANGED,i))}a.allowInteraction("onThemeChangeProgress");a.allowInteraction("onDataChangeProgress");l&&q&&(l=!1,q.call(null));p=m=n=o=j=!1})});var d=a.config.getMapPalette(),e=i.thematic.categoricClassifier;e.formatter=a.locale.formatter;e.colorPalette=d.getColorScheme(d.defaultSchemeId);i.legendSettings.schemeId=d.defaultSchemeId;i.legendSettings.paletteId=b!=""?a.config.getProperty("mapPalette"+b)||d.defaultPaletteId:d.defaultPaletteId;i.legendSettings.legendType=
a.config.getProperty("legendClassifier"+b)||"quantile";e=i.thematic.numericClassifier;e.noClasses=d.noClasses;e.formatter=a.locale.formatter;e.classificationName=i.legendSettings.legendType;e.colorPalette=d.getColorPalette(i.legendSettings.paletteId);e.sdLabels=[a.config.getProperty("sd1"),a.config.getProperty("sd2"),a.config.getProperty("sd3"),a.config.getProperty("sd4"),a.config.getProperty("sd5"),a.config.getProperty("sd6")];if(a.config.getProperty("sdSize"))e.getCalculator().sdSize=a.config.getProperty("sdSize");
d=a.config.getProperty("legendPrecision");if(d!=void 0&&d>-1)e.precision=d;i.comparisonThematic=new ia.Thematic;i.comparisonThematic.setDataType(ia.Thematic.CATEGORIC);i.comparisonThematic.setDataField("id");c()}};ia.extend(ia.EventDispatcher,ia.DataGroup);ia.Color=function(){};
ia.Color.r=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[0]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(0,2),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[0]));return b};ia.Color.g=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[1]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(2,4),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[1]));return b};
ia.Color.b=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[2]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(4,6),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[2]));return b};ia.Color.a=function(a){var b;ia.Color.isHSV(a)?b=parseFloat(a[3]):ia.Color.isHex(a)?b=parseFloat(ia.Color.cutHex(a).substring(6,8),16):ia.Color.isRGB(a)&&(b=parseFloat(ia.Color.cutRgb(a)[3]));return b};ia.Color.h=function(a){return ia.Color.toHSVA(a)[0]};
ia.Color.s=function(a){return ia.Color.toHSVA(a)[1]};ia.Color.v=function(a){return ia.Color.toHSVA(a)[2]};ia.Color.toRGBA=function(a,b){var c=b;c==void 0&&(c=1);var d=ia.Color.r(a),e=ia.Color.g(a),f=ia.Color.b(a);return ia.Color.rgba(d,e,f,c)};ia.Color.toHex=function(a){var b=ia.Color.r(a),c=ia.Color.g(a),a=ia.Color.b(a);return"#"+ia.Color.intToHex(b)+ia.Color.intToHex(c)+ia.Color.intToHex(a)};
ia.Color.toHSVA=function(a,b){var c=ia.Color.r(a),d=ia.Color.g(a),e=ia.Color.b(a),f,g=Math.max(c,d,e),h=Math.min(c,d,e);g==h?f=0:g==c?f=(60*(d-e)/(g-h)+360)%360:g==d?f=60*(e-c)/(g-h)+120:g==e&&(f=60*(c-d)/(g-h)+240);return[f,g==0?0:(1-h/g)*100,g/255*100,b]};
ia.Color.HSVtoRGB=function(a){var b=a[0],c=a[1]/100,d=a[2]/100*255,a=a[3];b<0&&(b+=360);var e=b/60-Math.floor(b/60),f=d*(1-c),g=d*(1-e*c),c=d*(1-(1-e)*c),h,k,i;switch(Math.floor(b/60)%6){case 0:h=d;k=c;i=f;break;case 1:h=g;k=d;i=f;break;case 2:h=f;k=d;i=c;break;case 3:h=f;k=g;i=d;break;case 4:h=c;k=f;i=d;break;case 5:h=d,k=f,i=g}return ia.Color.rgba(h,k,i,a)};
ia.Color.validHex=function(a){a=a.replace(/[^#a-fA-F0-9]/g,"");a=a.toLowerCase();a.match(/#/g)&&a.match(/#/g).length>1&&(a=a.replace(/#/g,""));a.indexOf("#")==-1&&(a="#"+a);a.length>7&&(a=a.substr(0,7));return a};ia.Color.intToHex=function(a){if(a==null)return"00";a=ia.parseInt(a);if(a==0||isNaN(a))return"00";a=Math.max(0,a);a=Math.min(a,255);a=Math.round(a);return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};
ia.Color.cutHex=function(a){return a.charAt(0)=="#"?a.substring(1,7):a};ia.Color.cutRgb=function(a){return a.substring(a.indexOf("(")+1,a.indexOf(")")).split(",")};ia.Color.isHex=function(a){return a.indexOf("#")==0};ia.Color.isRGB=function(a){return a.indexOf("rgb")!=-1};ia.Color.isHSV=function(a){return Object.prototype.toString.call(a)=="[object Array]"};ia.Color.rgba=function(a,b,c,d){d==void 0&&(d=1);return"rgba("+Math.floor(a)+","+Math.floor(b)+","+Math.floor(c)+","+d+")"};
ia.Color.getInterpolatedColor=function(a,b,c){var d;return ia.Color.rgba((d=ia.Color.r(a))+c*(ia.Color.r(b)-d),(d=ia.Color.g(a))+c*(ia.Color.g(b)-d),(d=ia.Color.b(a))+c*(ia.Color.b(b)-d))};ia.Color.getRandomColor=function(){return ia.Color.rgba(Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255))};ia.Color.lighten=function(a,b){var c=ia.Color.toHSVA(a),d=c[2];d+=d*b;d>100&&(d=100);d<0&&(d=0);c[2]=d;return ia.Color.toHex(c)};
ia.Color.darken=function(a,b){return ia.Color.lighten(a,b*-1)};ia.Color.adjustSV=function(a,b,c){a=ia.Color.toHSVA(a);a[1]=b;a[2]=c;return ia.Color.toHex(a)};ia.Color.saturate=function(a,b){var c=ia.Color.toHSVA(a),d=c[1];d+=d*b;d>100&&(d=100);d<0&&(d=0);c[1]=d;return ia.Color.toHex(c)};ia.Color.desaturate=function(a,b){return ia.Color.saturate(a,b*-1)};ia.Color.hueShift=function(a,b){for(a+=b;a>=360;)a-=360;for(;a<0;)a+=360;return a};
ia.Color.complement=function(a){a=ia.Color.toHSVA(a);a[0]=ia.Color.hueShift(a[0],180);return ia.Color.toHex(a)};ia.Color.triad=function(a){var b=ia.Color.toHSVA(a),c=b[0],a=[ia.Color.hueShift(c,156),b[1],b[2]],b=[ia.Color.hueShift(c,204),b[1],b[2]];return[ia.Color.toHex(a),ia.Color.toHex(b)]};ia.Color.analogic=function(a){var b=ia.Color.toHSVA(a),c=b[0],a=[ia.Color.hueShift(c,-24),b[1],b[2]],b=[ia.Color.hueShift(c,24),b[1],b[2]];return[ia.Color.toHex(a),ia.Color.toHex(b)]};ia.Shape=function(){};
ia.Shape.CIRCLE="circle";ia.Shape.SQUARE="square";ia.Shape.LINE="line";ia.Shape.VERTICAL_LINE="vertical line";ia.Shape.HORIZONTAL_LINE="horizontal line";ia.Shape.MINUS="minus";ia.Shape.PLUS="plus";ia.Shape.X="x";ia.Shape.DIAMOND="diamond";ia.Shape.STAR="star";ia.Shape.TRIANGLE_UP="triangle up";ia.Shape.TRIANGLE_DOWN="triangle down";ia.Shape.TRIANGLE_RIGHT="triangle right";ia.Shape.TRIANGLE_LEFT="triangle left";ia.Shape.ARROW_UP="arrow up";ia.Shape.ARROW_DOWN="arrow down";ia.Shape.ARROW_RIGHT="arrow right";
ia.Shape.ARROW_LEFT="arrow left";
ia.Shape.draw=function(a,b,c,d,e){switch(a){case ia.Shape.SQUARE:this.drawSquare(b,c,d,e);break;case ia.Shape.LINE:this.drawLine(b,c,d,e);break;case ia.Shape.VERTICAL_LINE:this.drawVerticalLine(b,c,d,e);break;case ia.Shape.HORIZONTAL_LINE:this.drawHorizontalLine(b,c,d,e);break;case ia.Shape.MINUS:this.drawMinus(b,c,d,e);break;case ia.Shape.PLUS:this.drawPlus(b,c,d,e);break;case ia.Shape.X:this.drawX(b,c,d,e);break;case ia.Shape.CIRCLE:this.drawCircle(b,c,d,e);break;case ia.Shape.DIAMOND:this.drawDiamond(b,
c,d,e);break;case ia.Shape.TRIANGLE_UP:this.drawTriangleUp(b,c,d,e);break;case ia.Shape.TRIANGLE_DOWN:this.drawTriangleDown(b,c,d,e);break;case ia.Shape.TRIANGLE_RIGHT:this.drawTriangleRight(b,c,d,e);break;case ia.Shape.TRIANGLE_LEFT:this.drawTriangleLeft(b,c,d,e);break;case ia.Shape.ARROW_UP:this.drawArrowUp(b,c,d,e);break;case ia.Shape.ARROW_DOWN:this.drawArrowDown(b,c,d,e);break;case ia.Shape.ARROW_RIGHT:this.drawArrowRight(b,c,d,e);break;case ia.Shape.ARROW_LEFT:this.drawArrowLeft(b,c,d,e);break;
case ia.Shape.STAR:this.drawStar(b,c,d,e)}};ia.Shape.drawSquare=function(a,b,c,d){var e=d/2;a.rect(b-e,c-e,d,d)};ia.Shape.drawLine=function(a,b,c,d){d/=2;a.moveTo(b-d,c);a.lineTo(b+d,c)};ia.Shape.drawVerticalLine=function(a,b,c,d){a.rect(b-1,c-d/2,2,d)};ia.Shape.drawHorizontalLine=function(a,b,c,d){a.rect(b-d/2,c-1,d,2)};ia.Shape.drawMinus=function(a,b,c,d){var e=d*0.3;a.rect(b-d/2,c-e/2,d,e)};
ia.Shape.drawPlus=function(a,b,c,d){var e=d/2,d=d*0.3/2;a.moveTo(b-d,c-e);a.lineTo(b+d,c-e);a.lineTo(b+d,c-d);a.lineTo(b+e,c-d);a.lineTo(b+e,c+d);a.lineTo(b+d,c+d);a.lineTo(b+d,c+e);a.lineTo(b-d,c+e);a.lineTo(b-d,c+d);a.lineTo(b-e,c+d);a.lineTo(b-e,c-d);a.lineTo(b-d,c-d);a.lineTo(b-d,c-e)};
ia.Shape.drawX=function(a,b,c,d){var e=d/2,d=d*0.3/2,f=b-d-b,g=c-e-c,h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180),f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.moveTo(h+b,f+c);f=b+d-b;g=c-e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+e-b;g=
c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+e-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c+e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=
f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c+e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-e-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+
b,f+c);f=b-e-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c-e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c)};
ia.Shape.drawCircle=function(a,b,c,d){d/=2;d>0&&a.arc(b,c,d,0,2*Math.PI,!1)};ia.Shape.drawDiamond=function(a,b,c,d){d/=2;a.moveTo(b,c-d);a.lineTo(b+d,c);a.lineTo(b,c+d);a.lineTo(b-d,c);a.lineTo(b,c-d)};ia.Shape.drawTriangleUp=function(a,b,c,d){d/=2;a.moveTo(b,c-d);a.lineTo(b+d,c+d);a.lineTo(b-d,c+d);a.lineTo(b,c-d)};ia.Shape.drawTriangleDown=function(a,b,c,d){d/=2;a.moveTo(b-d,c-d);a.lineTo(b+d,c-d);a.lineTo(b,c+d);a.lineTo(b-d,c-d)};
ia.Shape.drawTriangleRight=function(a,b,c,d){d/=2;a.moveTo(b-d,c-d);a.lineTo(b+d,c);a.lineTo(b-d,c+d);a.lineTo(b-d,c-d)};ia.Shape.drawTriangleLeft=function(a,b,c,d){d/=2;a.moveTo(b+d,c-d);a.lineTo(b+d,c+d);a.lineTo(b-d,c);a.lineTo(b+d,c-d)};ia.Shape.drawArrowUp=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b,c-e);a.lineTo(b+g/2,c-e+d);a.lineTo(b+f/2,c-e+d);a.lineTo(b+f/2,c+e);a.lineTo(b-f/2,c+e);a.lineTo(b-f/2,c-e+d);a.lineTo(b-g/2,c-e+d);a.lineTo(b,c-e)};
ia.Shape.drawArrowDown=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b,c+e);a.lineTo(b+g/2,c+e-d);a.lineTo(b+f/2,c+e-d);a.lineTo(b+f/2,c-e);a.lineTo(b-f/2,c-e);a.lineTo(b-f/2,c+e-d);a.lineTo(b-g/2,c+e-d);a.lineTo(b,c+e)};ia.Shape.drawArrowRight=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b+e,c);a.lineTo(b+e-d,c+g/2);a.lineTo(b+e-d,c+f/2);a.lineTo(b-e,c+f/2);a.lineTo(b-e,c-f/2);a.lineTo(b+e-d,c-f/2);a.lineTo(b+e-d,c-g/2);a.lineTo(b+e,c)};
ia.Shape.drawArrowLeft=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b-e,c);a.lineTo(b-e+d,c+g/2);a.lineTo(b-e+d,c+f/2);a.lineTo(b+e,c+f/2);a.lineTo(b+e,c-f/2);a.lineTo(b-e+d,c-f/2);a.lineTo(b-e+d,c-g/2);a.lineTo(b-e,c)};
ia.Shape.drawStar=function(a,b,c,d){var e=0.25*d;d*=0.5;var f,g,h,k,i;f=Math.PI*2/5;g=f/2;h=0.5*Math.PI;a.moveTo(b+Math.cos(h)*d,c-Math.sin(h)*d);for(var l=1;l<=5;l++)k=b+Math.cos(h+f*l-g)*e,i=c-Math.sin(h+f*l-g)*e,a.lineTo(k,i),k=b+Math.cos(h+f*l)*d,i=c-Math.sin(h+f*l)*d,a.lineTo(k,i)};
ia.Shape.drawGradient=function(a,b,c){c==null&&(c="bottomToTop");var d=a.getContext("2d"),e;c=="leftToRight"?e=d.createLinearGradient(0,0,a.width,0):c=="rightToLeft"?e=d.createLinearGradient(a.width,0,0,0):c=="topToBottom"?e=d.createLinearGradient(0,0,0,a.height):c=="bottomToTop"&&(e=d.createLinearGradient(0,a.height,0,0));for(var c=b.length,f=0;f<c;f++)e.addColorStop(f/(c-1),b[f]);d.rect(0,0,a.width,a.height);d.fillStyle=e};
ia.Formatter=function(){this.language="en";this.noDataValue="No Data";this.decimalSeparatorTo=".";this.thousandsSeparatorTo=","};ia.Formatter.prototype.language=void 0;ia.Formatter.prototype.noDataValue=void 0;ia.Formatter.prototype.precision=void 0;ia.Formatter.prototype.decimalSeparatorTo=void 0;ia.Formatter.prototype.thousandsSeparatorTo=void 0;ia.Formatter.prototype.format=function(a,b){b=b==void 0?this.precision:b;return ia.isNumber(a)?this.formatNumber(a,b):this.formatText(a)};
ia.Formatter.prototype.unformat=function(a){return parseFloat(a.split(this.thousandsSeparatorTo).join("").split(this.decimalSeparatorTo).join("."))};
ia.Formatter.prototype.formatNumber=function(a,b){var c=a<0?"-":"",d,e;if(b==void 0){var f=String(a).split(".");d=Math.abs(f[0])+"";e=d.length>3?d.length%3:0;return c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+this.thousandsSeparatorTo)+(f.length==2?this.decimalSeparatorTo+f[1]:"")}else return b==0?(d=Math.abs(parseInt(Math.abs(a||0).toFixed(b),10))+"",e=d.length>3?d.length%3:0,c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,
"$1"+this.thousandsSeparatorTo)):(d=Math.abs(parseInt(Math.abs(a||0).toFixed(b),10))+"",e=d.length>3?d.length%3:0,c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+this.thousandsSeparatorTo)+(b?this.decimalSeparatorTo+Math.abs(a).toFixed(b).split(".")[1]:""))};ia.Formatter.prototype.formatText=function(a){return a=="null"||a==null||a=="NaN"||a==""||a=="No Data"||a==void 0?this.noDataValue:String(a)};
ia.Locale=function(a){this._propertyHash={};this.formatter=new ia.Formatter;this.setLanguage(a||"en")};ia.Locale.prototype.getLanguage=function(){return this._language};
ia.Locale.prototype.setLanguage=function(a){this._language=a;this._language=="be"?(this._displayLanguage="\u0431\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0456",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="bg"?(this._displayLanguage="\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="ca"?(this._displayLanguage="catal\u00e0",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="."):this._language=="cs"?(this._displayLanguage="\u010de\u0161tina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="da"?(this._displayLanguage="dansk",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="de"?(this._displayLanguage="Deutsch",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="el"?(this._displayLanguage=
"\u03b5\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="en"?(this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=","):this._language=="es"?(this._displayLanguage="espa\u00f1ol",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="et"?(this._displayLanguage="Eesti",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo=
"\u00a0"):this._language=="fi"?(this._displayLanguage="suomi",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="fr"?(this._displayLanguage="fran\u00e7ais",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="hr"?(this._displayLanguage="hrvatski",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="hu"?(this._displayLanguage="magyar",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="is"?(this._displayLanguage="\u00edslenska",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="it"?(this._displayLanguage="italiano",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="lt"?(this._displayLanguage="Lietuvi\u0173",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="lv"?(this._displayLanguage=
"Latvie\u0161u",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="mk"?(this._displayLanguage="\u043c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="nl"?(this._displayLanguage="Nederlands",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="no"?(this._displayLanguage="norsk",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="pl"?(this._displayLanguage="polski",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="pt"?(this._displayLanguage="portugu\u00eas",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="ro"?(this._displayLanguage="rom\u00e2n\u0103",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="ru"?(this._displayLanguage=
"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="sk"?(this._displayLanguage="Sloven\u010dina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="sl"?(this._displayLanguage="Sloven\u0161\u010dina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="sq"?(this._displayLanguage="shqipe",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="."):this._language=="sr"?(this._displayLanguage="\u0421\u0440\u043f\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="sv"?(this._displayLanguage="svenska",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="tr"?(this._displayLanguage="T\u00fcrk\u00e7e",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language==
"uk"?(this._displayLanguage="\u0443\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language.toLowerCase()=="none"?(this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=""):(this._language="en",this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=",");this.formatter.language=this._language};
ia.Statistics=function(a){a!=void 0&&this.setData(a)};ia.Statistics.prototype.getData=function(){return this._data};ia.Statistics.prototype.setData=function(a){this._data=a;this._invalidateData()};ia.Statistics.prototype.getPercentile=function(a,b){if(a<0||a>1)return NaN;var c=a*(b.length+1),d=Math.floor(c);c-=d;var e=b[d-1],d=b[d];return parseFloat(e)+c*(d-e)};
ia.Statistics.prototype.toString=function(){return"-----Data-----\n Data: "+this.getData()+"\n Sorted data: "+this.sorted+"\n Unique data: "+this.unique+"\n\n -----Central tendency-----\n Mean: "+this.mean+"\n Median: "+this.median+"\n Mode: "+this.mode+"\n Mode Count: "+this.modeCount+"\n\n -----Variability-----\n Min: "+this.minValue+"\n Max: "+this.maxValue+"\n Range: "+this.range+"\n Lower quartile: "+this.lowerQuartile+"\n Upper quartile: "+this.upperQuartile+"\n Interquartile range: "+this.interquartileRange+
"\n Population Variance: "+this.variance+"\n Population Standard deviation: "+this.standardDeviation};
ia.Statistics.prototype.statsToString=function(){return"-----Central tendency-----\n Mean: "+this.mean+"\n Median: "+this.median+"\n Mode: "+this.mode+"\n Mode Count: "+this.modeCount+"\n\n -----Variability-----\n Min: "+this.minValue+"\n Max: "+this.maxValue+"\n Range: "+this.range+"\n Lower quartile: "+this.lowerQuartile+"\n Upper quartile: "+this.upperQuartile+"\n Interquartile range: "+this.interquartileRange+"\n Population Variance: "+this.variance+"\n Population Standard deviation: "+this.standardDeviation};
ia.Statistics.prototype._invalidateData=function(){this.sorted=[];for(var a=this._data.length,b=0;b<a;b++){var c=this._data[b];ia.isNumber(c)&&(this.sorted[this.sorted.length]=c)}this.sorted.sort(function(a,b){return a-b});this.unique=[];var d,c=this.sum=0,e;this.mode=[];this.modeCount=0;for(var f=1,a=this.sorted.length,b=0;b<a;b++){e=this.sorted[b];if(e!=d){this.unique.push(e);if(f>this.modeCount)this.mode=[];if(f==this.modeCount)this.mode.push(d),this.modeCount=f;f=1}else f++;d=e;this.sum+=parseFloat(e);
e*=e;c+=e}this.mean=this.sum/a;this.lowerQuartile=this.getPercentile(0.25,this.sorted);this.median=this.getPercentile(0.5,this.sorted);this.upperQuartile=this.getPercentile(0.75,this.sorted);this.interquartileRange=this.upperQuartile-this.lowerQuartile;for(b=d=0;b<a;b++)e=this.sorted[b],c=e-this.mean,d+=c*c;this.variance=d/(a-1);this.standardDeviation=Math.sqrt(Math.abs(this.variance));this.minValue=this.sorted[0];this.maxValue=this.sorted[a-1];this.range=this.maxValue-this.minValue};
ia.TextSubstitution=function(){this._TAB=9;this._LINEFEED=10;this._CARRIAGE=13;this._SPACE=32;this._substitutionVariables={}};ia.TextSubstitution.prototype.setVariable=function(a,b){this._substitutionVariables[a]=b};ia.TextSubstitution.prototype.clearVariables=function(){this._substitutionVariables={}};
ia.TextSubstitution.prototype.formatMessage=function(a){for(a+="";a.indexOf("${")>=0;){var b=a.indexOf("${"),c=a.indexOf("}",b),b=a.substring(b,c+1);if((b.indexOf("&&")!=-1||b.indexOf("||")!=-1)&&b.indexOf("==")!=-1){for(var d=b.split("=="),c=this._trim(d[1]),c=c.substring(c.indexOf("(")+1,c.indexOf(")")),d=this._trim(d[0]),e=d.split(/&&|\|\|/),f=0;f<e.length;f++){var g=e[f],h;h=f==0?this._processVariable(this._trim(g)+"}"):this._processVariable("${"+this._trim(g)+"}");d=this._replace(d,g,h)}h=this._processVariable("${andOrTest('"+
d+"',"+c+")}")}else h=this._processVariable(b);a=this._replace(a,b,h)}return a};
ia.TextSubstitution.prototype._processVariable=function(a){var b=a.substring(a.indexOf("{")+1,a.indexOf("("));if(b.indexOf("themeName")!=-1){var b=this._substitutionVariables[b],c="";if(b!=void 0)if(b.length==1)c=b[0];else for(var a=a.substring(a.indexOf("'")+1,a.lastIndexOf("'")),d=0,e=0;e<b.length;e++){var f=b[e],c=d==0?f:c+a+f;d++}return c}if(b=="${")return this._formatValue(a.substring(2,a.length-1));a=this._trim(a.substring(a.indexOf("(")+1,a.lastIndexOf(")}")));c=a.split(",");b=b.toLowerCase();
if(b=="andortest"){a=this._formatValue(c[0]);d=this._formatValue(c[1]);e=this._formatValue(c[2]);try{if(b=eval(a),b==!0)return d;else if(b==!1)return e}catch(g){}}else if(b=="empty")if(a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a==void 0||a.toString()=="")return d;else{if(e!=void 0)return e}else if(b=="notempty")if(a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a!=void 0&&a.toString()!=
"")return d;else{if(e!=void 0)return e}else if(b=="equals")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a==b)return d;else{if(e!=void 0)return e}else if(b=="notequals")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a!=b)return d;else{if(e!=void 0)return e}else if(b=="greaterthan")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),
d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a>b)return d;else{if(e!=void 0)return e}else if(b=="greaterthanorequalto")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a>=b)return d;else{if(e!=void 0)return e}else if(b=="lessthan")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a<b)return d;else{if(e!=void 0)return e}else if(b==
"lessthanorequalto")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a<=b)return d;else{if(e!=void 0)return e}else if(b=="even")return a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a%2==0?d:e;else if(b=="odd")return a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a%2==0?e:d;else if(b=="multiply")return a=this._formatValue(c[0]),
b=this._formatValue(c[1]),a*b;else if(b=="divide")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a/b;else if(b=="add")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a+b;else if(b=="subtract")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a-b;else if(b=="min")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),Math.min(a,b);else if(b=="max")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),Math.max(a,b);else if(b=="pow")return a=this._formatValue(c[0]),
b=this._formatValue(c[1]),Math.pow(a,b);else if(b=="sqrt")return a=this._formatValue(c[0]),Math.sqrt(a);else if(b=="exp")return a=this._formatValue(c[0]),Math.exp(a);else if(b=="log")return a=this._formatValue(c[0]),Math.log(a);else if(b=="abs")return a=this._formatValue(c[0]),Math.abs(a);return""};
ia.TextSubstitution.prototype._formatValue=function(a){if(a!=void 0){var b=this._trim(a),a="";if(b.indexOf("[")!=-1&&b.indexOf("]")!=-1){var c=b.substring(0,b.indexOf("[")),b=b.substring(b.indexOf("[")+1,b.indexOf("]")),c=this._substitutionVariables[c];c.indexOf(";")!=-1?a=c.split(";")[b]:c.indexOf(",")!=-1&&(a=c.split(",")[b])}else a=ia.isNumber(b)?parseFloat(b):b.charAt(0)=='"'||b.charAt(0)=="'"?b.substring(1,b.length-1):this._substitutionVariables[b];if(a!=void 0)return a}return""};
ia.TextSubstitution.prototype._trim=function(a){return this._leftTrim(this._rightTrim(a))};ia.TextSubstitution.prototype._rightTrim=function(a){for(var b=a.length-1;a.charCodeAt(b)==this._SPACE||a.charCodeAt(b)==this._CARRIAGE||a.charCodeAt(b)==this._LINEFEED||a.charCodeAt(b)==this._TAB;)b--;return a.substring(0,b+1)};
ia.TextSubstitution.prototype._leftTrim=function(a){for(var b=0;a.charCodeAt(b)==this._SPACE||a.charCodeAt(b)==this._CARRIAGE||a.charCodeAt(b)==this._LINEFEED||a.charCodeAt(b)==this._TAB;)b++;return a.substring(b,a.length)};ia.TextSubstitution.prototype._replace=function(a,b,c){return a.split(b).join(c)};
ia.UrlParams=function(a){this.href=a;this.path=ia.File.getFileDirectory(decodeURIComponent(a));this.filename=ia.File.getFileName(decodeURIComponent(a));if(location.href.indexOf("#")!=-1)this.href=this.href.split("#")[0],a=a.split("#")[0];this.params={};if(a.indexOf("?")!=-1)for(var a=a.slice(a.indexOf("?")+1).split("&"),b=0;b<a.length;b++){var c=a[b].split("="),d=decodeURIComponent(c[0]),c=decodeURIComponent(c[1]);c=="false"&&(c=!1);c=="true"&&(c=!0);ia.isNumber(c)&&d!="select"&&d!="select2"&&(c=
parseFloat(c));this.params[d]=c}};ia.UrlParams.prototype.getReportUrl=function(){var a=this.path+this.filename+"?",b=!1,c;for(c in this.params){var d=this.params[c];d!=""&&d!=void 0&&(b==!0&&(a+="&"),a=a+c+"="+this.params[c],b=!0)}return a};
var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].substring)!=-1)return a[b].identity}else if(d)return a[b].identity}},
searchVersion:function(a){var b=a.indexOf(this.versionSearchString);return b==-1?void 0:parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,substring:"Chrome",identity:"Chrome"},{string:navigator.userAgent,substring:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,substring:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,substring:"iCab",
identity:"iCab"},{string:navigator.vendor,substring:"KDE",identity:"Konqueror"},{string:navigator.userAgent,substring:"Firefox",identity:"Firefox"},{string:navigator.vendor,substring:"Camino",identity:"Camino"},{string:navigator.userAgent,substring:"Netscape",identity:"Netscape"},{string:navigator.userAgent,substring:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,substring:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,substring:"Mozilla",
identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,substring:"Win",identity:"Windows"},{string:navigator.platform,substring:"Mac",identity:"Mac"},{string:navigator.userAgent,substring:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,substring:"Linux",identity:"Linux"}]};BrowserDetect.init();ia.File=function(){};ia.File.errorHandler=void 0;
ia.File.load=function(a){var b={};b.type=a.type||"GET";b.url=ia.getDomainSafeUrl(a.url);b.dataType=a.dataType||"text";if(a.contentType)b.contentType=a.contentType;if(a.data)b.data=a.data;if(a.onSuccess)b.success=a.onSuccess;b.error=function(c,d,e){if(a.onFail)a.onFail(c,d,e);ia.File.errorHandler&&ia.File.errorHandler(b.url,c,d,e,a)};$j.ajax(b)};
ia.File.getFileDirectory=function(a){var b=a;a.indexOf("?")>0&&(b=a.substring(0,a.lastIndexOf("?")));return b.indexOf("/")<0?b.substring(0,b.lastIndexOf("\\")+1):b.substring(0,b.lastIndexOf("/")+1)};ia.File.getFileName=function(a){var b=a;a.indexOf("?")>0&&(b=a.substring(0,a.lastIndexOf("?")));return b.indexOf("/")<0?b.substring(b.lastIndexOf("\\")+1):b.substring(b.lastIndexOf("/")+1)};ia.FeatureServiceReader=function(){};
ia.FeatureServiceReader.buildQuery=function(a,b,c){a.indexOf("/query?")==-1&&(a+="/query?where=1+%3D+1");c!=void 0&&(a+="&objectIds="+c.join());b!=void 0&&(a+="&outFields="+b.join());return a};ia.FeatureServiceReader.getFeatureServiceUrl=function(a){a.indexOf("/query?")!=-1?a=a.split("/query?")[0]:a.indexOf("?")!=-1&&(a=a.split("?")[0]);return a};
ia.FeatureServiceReader.getParam=function(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);return c==null?"":decodeURIComponent(c[1].replace(/\+/g," "))};
ia.FeatureServiceReader.sendQuery=function(a,b,c){var d=ia.FeatureServiceReader.getParam(a,"outFields"),d=d!=""?d.split(/[\s,]+/):void 0,e=ia.FeatureServiceReader.getParam(a,"objectIds"),e=e!=""?e.split(/[\s,]+/):void 0,f=ia.FeatureServiceReader.getParam(a,"where");e==""&&(f=void 0);a.indexOf("f=json")==-1&&(a+=a.indexOf("?")>0?"&f=json":"?f=json");ia.FeatureServiceReader.getInfo(a,b,function(b,h){var k=Infinity;b.maxRecordCount!=void 0&&(k=ia.parseInt(b.maxRecordCount));e!=void 0?ia.FeatureServiceReader.sendFeatureRequests(a,
h,e,d,k,function(a){c.call(null,a)}):ia.FeatureServiceReader.getObjectIds(a,h,f,function(b){b!=void 0?ia.FeatureServiceReader.sendFeatureRequests(a,h,b,d,k,function(a){c.call(null,a)}):c.call(null,[])})})};
ia.FeatureServiceReader.sendFeatureRequests=function(a,b,c,d,e,f){a=ia.FeatureServiceReader.getFeatureServiceUrl(a);if(c.length>0){for(var e=Math.min(c.length,e),g=[];c.length>0;)g[g.length]=c.splice(0,e);var h=[],k=g.length,i=0,l=function(c){h=h.concat(c);i++;i==k?f.call(null,h):ia.FeatureServiceReader.getFeatureAttributes(a,b,g[i],d,l)};ia.FeatureServiceReader.getFeatureAttributes(a,b,g[i],d,l)}else f.call(null,[])};
ia.FeatureServiceReader.getInfo=function(a,b,c){var a=ia.FeatureServiceReader.getFeatureServiceUrl(a),d=a+"?f=json";b!=void 0&&(d+="&token="+b);ia.File.load({url:d,dataType:"json",onSuccess:function(d){if(d.error&&d.error.code==498)return ia.FeatureServiceReader.getInfo(a,void 0,c);else d.error&&d.error.code==499?ia.redirectToArcGisOnlineAuth():c.call(null,d,b)}})};
ia.FeatureServiceReader.getObjectIds=function(a,b,c,d){var a=ia.FeatureServiceReader.getFeatureServiceUrl(a),e="f=json&returnGeometry=false&returnIdsOnly=true&returnCountOnly=false";e+=c!=void 0?"&where="+c:"&where=1+%3D+1";b!=void 0&&(e+="&token="+b);ia.File.load({url:a+"/query",type:"POST",dataType:"json",data:e,onSuccess:function(a){d.call(null,a.objectIds)}})};
ia.FeatureServiceReader.getFeatureAttributes=function(a,b,c,d,e){var a=ia.FeatureServiceReader.getFeatureServiceUrl(a),f="where=1+%3D+1&f=json&returnGeometry=false&returnIdsOnly=false&returnCountOnly=false";c!=void 0&&(f+="&objectIds="+c);d!=void 0&&(f+="&outFields="+d);b!=void 0&&(f+="&token="+b);ia.File.load({url:a+"/query",type:"POST",dataType:"json",data:f,onSuccess:function(a){e.call(null,a.features)}})};
ia.FeatureServiceReader.getFeatureGeometry=function(a,b,c,d,e,f,g){var a=ia.FeatureServiceReader.getFeatureServiceUrl(a),h="where=1+%3D+1&f=json&returnGeometry=true&returnIdsOnly=false&returnCountOnly=false";c!=void 0&&(h+="&objectIds="+c);d!=void 0&&(h+="&outFields="+d);e!=void 0&&(h+="&outSR="+e);f!=void 0&&(h+="&maxAllowableOffset="+f);b!=void 0&&(h+="&token="+b);ia.File.load({url:a+"/query",type:"POST",dataType:"json",data:h,onSuccess:function(a){g.call(null,a.features)}})};ia.ReportConfig=function(){};
ia.ReportConfig.prototype.loadSource=function(a,b){var c=this;ia.File.load({url:a,dataType:"xml",onSuccess:function(a){c.parseXML(a,b)}})};
ia.ReportConfig.prototype.parseXML=function(a,b){var c=this;c.xml=a;var d=$j(a),e=d.find("AtlasInterface").get(0);$j.each(e.attributes,function(a,b){c[b.name]=b.value});e=c.template.indexOf("::arcgisonline");if(e!=-1)c.template=c.template.substring(0,e);c._componentArray=[];c._componentHash={};e=d.find("Component");$j.each(e,function(a,b){if($j(b).attr("visible")=="true"){var d=new ia.ComponentConfig(b);c._componentArray[c._componentArray.length]=d;c._componentHash[d.id]=d}});e=d.find("Table");$j.each(e,
function(a,b){if($j(b).attr("visible")=="true"){var d=new ia.TableConfig(b);c._componentArray[c._componentArray.length]=d;c._componentHash[d.id]=d}});c.properties={};e=d.find("PropertyGroup");$j.each(e,function(a,b){var d=$j(b).find("Property");$j.each(d,function(a,b){var d=new ia.PropertyConfig(b,c);c.properties[d.id]=d})});c._buttonArray=[];c._buttonHash={};e=d.find("Button");$j.each(e,function(a,b){var d=new ia.ButtonConfig(b);c._buttonArray[c._buttonArray.length]=d;c._buttonHash[d.id]=d});c._textArray=
[];c._textHash={};e=d.find("Text");$j.each(e,function(a,b){var d=new ia.TextConfig(b);c._textArray[c._textArray.length]=d;c._textHash[d.id]=d});c._imageArray=[];c._imageHash={};e=d.find("Image");$j.each(e,function(a,b){var d=new ia.ImageConfig(b);c._imageArray[c._imageArray.length]=d;c._imageHash[d.id]=d});c._palette=new ia.PaletteConfig(d.find("MapPalettes"),c.getProperty("noDataColor"),c.getProperty("noDataValue"));b.call(null,c)};ia.ReportConfig.prototype.getWidgets=function(){return this._componentArray.concat(this._buttonArray).concat(this._textArray).concat(this._imageArray)};
ia.ReportConfig.prototype.getWidget=function(a){if(this.getComponent(a))return this.getComponent(a);else if(this.getButton(a))return this.getButton(a);else if(this.getText(a))return this.getText(a);else if(this.getImage(a))return this.getImage(a)};ia.ReportConfig.prototype.addComponent=function(a){a=new ia.ComponentConfig(a);this._componentArray[this._componentArray.length]=a;return this._componentHash[a.id]=a};
ia.ReportConfig.prototype.addTable=function(a){a=new ia.TableConfig(a);this._componentArray[this._componentArray.length]=a;return this._componentHash[a.id]=a};ia.ReportConfig.prototype.addButton=function(a){a=new ia.ButtonConfig(a);this._buttonArray[this._buttonArray.length]=a;return this._buttonHash[a.id]=a};ia.ReportConfig.prototype.addText=function(a){a=new ia.TextConfig(a);this._textArray[this._textArray.length]=a;return this._textHash[a.id]=a};
ia.ReportConfig.prototype.addImage=function(a){a=new ia.ImageConfig(a);this._imageArray[this._imageArray.length]=a;return this._imageHash[a.id]=a};ia.ReportConfig.prototype.getComponents=function(){return this._componentArray};ia.ReportConfig.prototype.getComponent=function(a){return this._componentHash[a]};ia.ReportConfig.prototype.getButtons=function(){return this._buttonArray};ia.ReportConfig.prototype.getButton=function(a){return this._buttonHash[a]};ia.ReportConfig.prototype.getTexts=function(){return this._textArray};
ia.ReportConfig.prototype.getText=function(a){return this._textHash[a]};ia.ReportConfig.prototype.getImages=function(){return this._imageArray};ia.ReportConfig.prototype.getImage=function(a){return this._imageHash[a]};ia.ReportConfig.prototype.getMapPalette=function(){return this._palette};ia.ReportConfig.prototype.getProperties=function(){return this.properties};ia.ReportConfig.prototype.getProperty=function(a){if(a=this.properties[a])return a.value};
ia.ReportConfig.prototype.setProperty=function(a,b,c){if(a=this.properties[a])a.value=c?a.castValue(b):b};ia.WidgetConfig=function(a){this.xml=a;this._parseWidgetXML(a)};ia.WidgetConfig.prototype.parseXML=function(a){this._parseWidgetXML(a)};
ia.WidgetConfig.prototype._parseWidgetXML=function(a){var b=this;b.xml=a;this.anchor="left";this.visible=!0;$j.each(a.attributes,function(a,c){b[c.name]=c.value});b.properties={};var c=$j(a).find("Property");$j.each(c,function(a,c){var f=new ia.PropertyConfig(c,b);b.properties[f.id]=f;if(f.id=="zIndex")b.zIndex=f.value;if(f.id=="visible")b.visible=f.value});if(this.x!=void 0)this.x=parseFloat(this.x)/800*100,this.x=Math.round(this.x*10)/10;if(this.y!=void 0)this.y=parseFloat(this.y)/600*100,this.y=
Math.round(this.y*10)/10;if(this.rescale=="false")this.width=parseFloat(this.width),this.height=parseFloat(this.height);else{if(this.width!=void 0)this.width=parseFloat(this.width)/800*100,this.width=Math.round(this.width*10)/10;if(this.height!=void 0)this.height=parseFloat(this.height)/600*100,this.height=Math.round(this.height*10)/10}this.type=a.nodeName.toLowerCase()};ia.WidgetConfig.prototype.getProperties=function(){return this.properties};
ia.WidgetConfig.prototype.getProperty=function(a){if(a=this.properties[a])return a.value};ia.WidgetConfig.prototype.setProperty=function(a,b,c){if(a=this.properties[a])a.value=c?a.castValue(b):b};ia.ComponentConfig=function(a){ia.ComponentConfig.baseConstructor.call(this,a);this._parseComponentXML(a)};ia.extend(ia.WidgetConfig,ia.ComponentConfig);ia.ComponentConfig.prototype.parseXML=function(a){this._parseWidgetXML(a)};ia.ComponentConfig.prototype._parseComponentXML=function(){};
ia.PropertyConfig=function(a,b){var c=this;this.parent=b;this.xml=a;$j.each(a.attributes,function(a,b){c[b.name]=b.value});c.value=c.castValue(c.value);if(c.choices)c.choices=c.choices.split(";")};
ia.PropertyConfig.prototype.castValue=function(a){if(this.type=="float"){if(a!="")return parseFloat(a)}else if(this.type=="integer"){if(a!="")return ia.parseInt(a)}else if(this.type=="boolean")return a==!0||a==!1?a:a=="true";else if(this.type=="string-array"||this.type=="colour-array"){if(a!=""){for(var b=a.split(","),a=0;a<b.length;a++)b[a].substring(0,1)=="'"&&(b[a]=b[a].substring(1)),b[a].substring(b[a].length-1)=="'"&&(b[a]=b[a].substring(0,b[a].length-1));return b}}else if(this.type=="float-array"){if(a!=
""){for(var b=a.split(","),c=Array(b.length),a=0;a<b.length;a++)c[a]=parseFloat(b[a]);return c}}else if(this.type=="integer-array"){if(a!=""){b=a.split(",");c=Array(b.length);for(a=0;a<b.length;a++)c[a]=ia.parseInt(b[a]);return c}}else if(this.type=="boolean-array"){b=a.split(",");c=Array(b.length);for(a=0;a<b.length;a++)c[a]=b[a]=="true";return c}else if(a!="")return a};ia.TableConfig=function(a){ia.TableConfig.baseConstructor.call(this,a);this._parseTableXML(a)};ia.extend(ia.WidgetConfig,ia.TableConfig);
ia.TableConfig.prototype.parseXML=function(a){this._parseTableXML(a)};
ia.TableConfig.prototype._parseTableXML=function(a){this._parseWidgetXML(a);var b=this,a=$j(a);b.customColumns=[];b._columnArray=[];b._columnHash={};var c=0,a=a.find("Column");$j.each(a,function(a,d){var g={},h=$j(d).attr("name");h!="name"&&(h+="_formatted");g.id=$j(d).attr("name");g.formattedId=h;g.label=$j(d).attr("alias");g.width=parseFloat($j(d).attr("width"));b._columnArray[a]=g;b._columnHash[g.id]=g;c+=g.width});a=1-c;if(a!=0){a/=b._columnArray.length;for(var d=0;d<b._columnArray.length;d++)b._columnArray[d].width+=
a}};ia.TableConfig.prototype.getColumn=function(){return this._columnHash[id]};ia.TableConfig.prototype.getColumns=function(){return this._columnArray};
ia.TableConfig.prototype.getColumnsForIndicator=function(a,b){for(var c=[],c=this.customColumns.length>0?this.customColumns.concat():this._columnArray.concat(),d=[],e=0;e<c.length;e++){var f=c[e],g={};g.id=f.id;g.formattedId=f.formattedId;g.label=b.formatMessage(f.label);g.width=f.width;g.type="categoric";if(g.id=="name")g.type="categoric";else if(g.id=="value")g.type=a.type;else if(f=a.getAssociate(g.id),f!=null)g.type=f.type;d.push(g)}return d};
ia.TableConfig.prototype.getColumnsForIndicators=function(a,b){for(var c=a[0],d=[],d=this.customColumns.length>0?this.customColumns.concat():this._columnArray.concat(),e=[],f=0;f<d.length;f++){var g=d[f],h={};h.id=g.id;h.formattedId=g.formattedId;h.label=b.formatMessage(g.label);h.width=g.width;h.type="categoric";if(h.id=="name")h.type="categoric";else if(h.id=="value")h.type=c.type;else if(h.id.indexOf("~")!=-1){var g=h.id.split("~")[0],k=h.id.split("~")[1],k=a[k-2];if(k!=void 0)if(g=="value")h.type=
k.type;else if(g=k.getAssociate(g),g!=null)h.type=g.type}else if(g=c.getAssociate(h.id),g!=null)h.type=g.type;e.push(h)}return e};ia.ButtonConfig=function(a){ia.ButtonConfig.baseConstructor.call(this,a);this._parseButtonXML(a)};ia.extend(ia.WidgetConfig,ia.ButtonConfig);ia.ButtonConfig.prototype.parseXML=function(a){this._parseButtonXML(a)};
ia.ButtonConfig.prototype._parseButtonXML=function(a){this._parseWidgetXML(a);this["css-class"]="";this.text=this.text||"";this.target=this.target||"_blank";this.tooltip=this.tooltip||"";this.href=this.href||"";if(this.href!=""&&this.href.indexOf("http")==-1&&this.href.indexOf("javascript")==-1)this.href=ia.IAS_PATH+this.href};ia.TextConfig=function(a){ia.TextConfig.baseConstructor.call(this,a);this._parseTextXML(a)};ia.extend(ia.ButtonConfig,ia.TextConfig);ia.TextConfig.prototype.parseXML=function(a){this._parseTextXML(a)};
ia.TextConfig.prototype._parseTextXML=function(a){this._parseButtonXML(a);this.cssProps={};if(this["wrap-width"]!="-1")this.width=parseFloat(this["wrap-width"])/800*100,this.width=Math.round(this.width*10)/10;this.fill!=void 0&&(this.cssProps.color=this.fill);this["font-family"]!=void 0&&(this.cssProps["font-family"]=this["font-family"]);this["font-size"]!=void 0&&(this.cssProps["font-size"]=this["font-size"]+"px");this["font-style"]!=void 0&&(this.cssProps["font-style"]=this["font-style"]);this["font-weight"]!=
void 0&&(this.cssProps["font-weight"]=this["font-weight"]);this.text=$j(a).text()};ia.ImageConfig=function(a){ia.ImageConfig.baseConstructor.call(this,a);this._parseImageXML(a)};ia.extend(ia.ButtonConfig,ia.ImageConfig);ia.ImageConfig.prototype.parseXML=function(a){this._parseImageXML(a)};ia.ImageConfig.prototype._parseImageXML=function(a){this._parseButtonXML(a);this.src=this.src||"";if(this.src!=""&&this.src.indexOf("http")==-1&&this.src.indexOf("javascript")==-1)this.src=ia.IAS_PATH+this.src};
ia.PaletteConfig=function(a,b,c){var d=this,a=$j(a);this.defaultSchemeId=this.defaultPaletteId="";this.noClasses=5;this.minNoClasses=2;this.maxNoClasses=10;this.noDataValue=c;if(a.attr("default")!=void 0)this.defaultPaletteId=a.attr("default");if(a.attr("classes")!=void 0)this.noClasses=ia.parseInt(a.attr("classes"));if(a.attr("maxclasses")!=void 0)this.maxNoClasses=ia.parseInt(a.attr("maxclasses"));d._paletteArray=[];d._paletteHash={};var e=a.find("ColourRange");$j.each(e,function(a,b){var c=$j(b).find("Colour"),
e=[];$j.each(c,function(a,b){e.push($j(b).text())});c=new ia.ColorPalette(e);c.id=$j(b).attr("id");d._paletteHash[c.id]=c;d._paletteArray.push(c)});var f=b==void 0?"#f9f9f9":b,g=["null",null,"NaN","","No Data",void 0];g[g.length]=c;d._schemeArray=[];d._schemeHash={};e=a.find("ColourScheme");$j.each(e,function(a,b){var c=[],e=new ia.ColorPalette,j=$j(b).find("ColourMatch");$j.each(j,function(a,b){var d=$j(b).attr("for"),f=$j(b).text();c.push(f);e.matchColorsToValues[d]=f});for(a=0;a<g.length;a++)e.matchColorsToValues[g[a]]=
f;e.setColorList(c);e.id=$j(b).attr("id");d._schemeHash[e.id]=e;d._schemeArray.push(e)});this.defaultSchemeId=d._schemeArray[0].id};ia.PaletteConfig.prototype.noDataValue="";ia.PaletteConfig.prototype.getColorPalettes=function(){return this._paletteArray};ia.PaletteConfig.prototype.getColorPalette=function(a){return this._paletteHash[a]};ia.PaletteConfig.prototype.getColorSchemes=function(){return this._schemeArray};ia.PaletteConfig.prototype.getColorScheme=function(a){return this._schemeHash[a]};
ia.BaseData=function(a,b){this.data=a;this.parent=b;this._properties={};this.hasData=!0;this.type="categoric";if(this.parent!=void 0){this.type=this.parent.type;this.precision=this.parent.precision;var c=this.parent.getProperties();if(c!=void 0){var d=c.length,e;for(e in c)this._properties[e]=c[e]}}this.id=this.data.themeId||this.data.id;this.name=this.data.themeName||this.data.name;this.href=this.data.href;this.fileName=this.data.fileName;if(this.data.fileName!=void 0)this.hasData=!1;if(this.data.type!=
void 0)this.type=this.data.type;if(this.data.precision!=void 0)this.precision=ia.parseInt(this.data.precision);c=this.data.properties;if(c!=void 0){d=c.length;for(e=0;e<d;e++){var f=c[e];this._properties[f.name]=f.value}}this.customColumns=[];for(var g in this._properties)if(g.indexOf("column_")!=-1){c={};c.id=g.substring(g.indexOf("_")+1,g.length);if(c.id=="indicator")c.id="value";c.formattedId=c.id!="name"?c.id+"_formatted":c.id;c.label=this._properties[g];this.customColumns.push(c)}};
ia.BaseData.prototype.getProperty=function(a){return this._properties[a]};ia.BaseData.prototype.getProperties=function(){return this._properties};ia.BaseData.prototype.getChildren=function(){};
ia.BaseData.prototype.getDataTree=function(a,b,c,d){var c=c==void 0?{}:c,e={};e.id=this.geography?this.geography.id+"~"+this.id:this.id;e.label=this.name;if(this.href!=void 0)e.href=this.href;if(d!=void 0)e.parent=d;var f=this.getChildren(),d=[];if(f!=null){e.type="branch";for(var g=f.length,h,k=0;k<g;k++){var i=f[k];i.id!=h&&(this.geography?d.push(this.geography.id+"~"+i.id):d.push(this.id+"~"+i.id),i.getDataTree(a,b,c,e.id));h=i.id}if(d.length>0)e.children=d}else if(a!=!1&&this.date!=void 0){e.type=
"branch";a=this.theme.getIndicators(this.id);g=a.length;if(b)for(k=g-1;k>=0;k--){b=a[k];h={};h.id=this.geography.id+"~"+b.id+"~"+b.date;h.label=b.date;h.type="leaf";h.parent=e.id;if(b.href!=void 0)h.href=b.href;d.push(h.id);c[h.id]=h}else for(k=0;k<g;k++){b=a[k];h={};h.id=this.geography.id+"~"+b.id+"~"+b.date;h.label=b.date;h.type="leaf";h.parent=e.id;if(b.href!=void 0)h.href=b.href;d.push(h.id);c[h.id]=h}if(d.length>0)e.children=d}else e.type="leaf";c[e.id]=e;return c};
ia.ReportData=function(){ia.ReportData.baseConstructor.call(this);this._propertyHash={};this.path=this.url="";this.formatter=new ia.Formatter};ia.extend(ia.EventDispatcher,ia.ReportData);ia.ReportData.prototype.getGeographies=function(){return this._geogArray};ia.ReportData.prototype.getProperty=function(a){return this._propertyHash[a]};ia.ReportData.prototype.setProperty=function(a,b){this._propertyHash[a]=b};ia.ReportData.prototype.getProperties=function(){return this._propertyHash};
ia.ReportData.prototype.getGeography=function(a){return this._geogHash[a]};ia.ReportData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(a);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseData(a,b)}})};
ia.ReportData.prototype.parseData=function(a,b){this.data=a;this._geogArray=[];this._geogHash={};var c=a.geographies;if(c!=void 0)for(var d=c.length,e=0;e<d;e++){var f=new ia.Geography(this,c[e]);f.index=e;this._geogArray[e]=f;this._geogHash[f.id]=f}b.call(null,this)};ia.ReportData.prototype.refresh=function(a){var b=this;b.parseData(b.data,function(){a.call(null,b)})};
ia.ReportData.prototype.getDataTree=function(a,b){var c={},d={id:"topLevel",label:"topLevel",type:"branch"};c[d.id]=d;var e=[],f;for(f in this._geogHash)e.push(f),this._geogHash[f].getDataTree(a,b,c,d.id);d.children=e;return c};ia.ReportData.prototype.getGeographyTree=function(){var a={},b={id:"topLevel",label:"topLevel",type:"branch"};a[b.id]=b;for(var c=[],d=0;d<this._geogArray.length;d++){var e=this._geogArray[d],f={};f.id=e.id;f.label=e.name;f.type="leaf";a[f.id]=f;c.push(e.id)}b.children=c;return a};
ia.Geography=function(a,b){this.reportData=a;this.parseData(b)};ia.extend(ia.BaseData,ia.Geography);
ia.Geography.prototype.parseData=function(a){ia.Geography.baseConstructor.call(this,a,this.reportData);this._featureArray=[];this._featureHash={};var b=this.data.features;if(b!=void 0)for(var a=b.length,c=0;c<a;c++){var d=new ia.Feature(b[c]);this._featureArray[c]=d;this._featureHash[d.id]=d}this._comparisonArray=[];this._comparisonHash={};b=this.data.comparisonFeatures;if(b!=void 0){a=b.length;for(c=0;c<a;c++)d=new ia.Feature(b[c]),this._comparisonArray[c]=d,this._comparisonHash[d.id]=d}this._filterArray=
[];this._filterHash={};b=this.data.filters;if(b!=void 0){a=b.length;for(c=0;c<a;c++)d=new ia.Filter(b[c]),this._filterArray[c]=d,this._filterHash[d.id]=d}this._themeArray=[];this._themeHash={};d=this.data.themes;if(d!=void 0){a=d.length;for(c=0;c<a;c++)b=new ia.Theme(this,void 0,d[c]),this._themeArray[c]=b,this._themeHash[b.id]=b}};ia.Geography.prototype.getThemes=function(){return this._themeArray};ia.Geography.prototype.getTheme=function(a){return this._themeHash[a]};
ia.Geography.prototype.getFeatures=function(){return this._featureArray};ia.Geography.prototype.getFeature=function(a){return this._featureHash[a]!=void 0?this._featureHash[a]:this.getComparisonFeature(a)};ia.Geography.prototype.getComparisonFeatures=function(){return this._comparisonArray};ia.Geography.prototype.getComparisonFeature=function(a){return this._comparisonHash[a]};ia.Geography.prototype.getFilters=function(){return this._filterArray};ia.Geography.prototype.getFilter=function(a){return this._filterHash[a]};
ia.Geography.prototype.getChildren=function(){return this._themeArray};ia.Geography.prototype.getFirstIndicator=function(a){return this._themeArray[0].getFirstIndicator(a)};ia.Geography.prototype.getIndicator=function(a,b,c){for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e].getNestedIndicator(a,b,c);if(f!=void 0)return f}};
ia.Geography.prototype.loadIndicator=function(a,b,c){function d(){var d=e.getIndicator(a,b);d&&d.parent.loadIndicator(a,b,c)}var e=this;e.reportData.model!=void 0?e.getFeatures().length==0||e.reportData.model.hasData(e.id)==!1?e.reportData.model.getGeography(e.id,function(a){e.parseData(a);d()}):d():d()};ia.Geography.prototype.getFilteredFeatures=function(a,b){for(var c=this._featureArray.length,d=[],e=0;e<c;e++){var f=this._featureArray[e];f.getFilterValue(a)==b&&d.push(f.id)}return d};
ia.Geography.prototype.getFilterTree=function(){var a={},b={id:"topLevel",label:"topLevel",type:"branch"};a[b.id]=b;for(var c=[],d=this._filterArray.length,e=this._featureArray.length,f=0;f<d;f++){var g=this._filterArray[f],h={};h.id=g.id;h.label=g.name;h.type="branch";h.parent=b.id;a[h.id]=h;c.push(h.id);for(var k=[],i=0;i<e;i++){var l=this._featureArray[i].getFilterValue(g.id);if(l!=void 0&&k.indexOf(g.id+"~"+l)==-1){var j={};j.id=g.id+"~"+l;j.label=l;j.type="leaf";j.parent=g.id;a[j.id]=j;k.push(j.id)}}k.sort();
h.children=k}b.children=c;return a};ia.Geography.prototype.loadData=function(a){function b(){d++;d==c._themeArray.length?a.call(null,c):c._themeArray[d].loadData(b)}var c=this,d=0;this._themeArray.length>0&&this._themeArray[0].loadData(b)};
ia.Geography.prototype.getFeatureData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.features=[];for(var d=this.getThemes(),e=d.length,f=a.length,g=0;g<f;g++){var h=this.getFeature(a[g]);if(h!=void 0){var k={};k.id=h.id;k.name=h.name;k.href=h.href;k.properties=[];var i=h.getProperties(),l;for(l in i){var j={};j.name=l;j.value=i[l];k.properties[k.properties.length]=j}k.themes=[];c.features[c.features.length]=k;for(i=0;i<e;i++)j=d[i],j.hasData&&(j=j.getFeatureData(h,b),k.themes[k.themes.length]=
j)}}return c};ia.Geography.prototype.getIndicatorData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.themes=[];for(var d=this.getThemes(),e=d.length,f=0;f<e;f++){var g=d[f];g.hasData&&(g=g.getIndicatorData(a,b),c.themes[c.themes.length]=g)}return c};ia.Geography.prototype.getProfileData=function(a,b,c){var d={};d.id=this.id;d.name=this.name;d.themes=[];for(var e=this.getThemes(),f=e.length,g=0;g<f;g++)e[g].getProfileData(a,d.themes,b,c);return d};
ia.Theme=function(a,b,c){ia.Theme.baseConstructor.call(this,c,b||a);this.hasThemes=!1;this.geography=a;this.parseData(c)};ia.extend(ia.BaseData,ia.Theme);
ia.Theme.prototype.getCSV=function(a,b){var c=[],d=-1,e=this.getData(a,b),f=e.dates,g=f.length,h=e[f[0]];c[++d]='"id","name",';for(var k=0;k<g;k++){var i=f[k];c[++d]='"'+i+'"';k!=g-1&&(c[++d]=",")}c[++d]="\n";for(var l in h){i=h[l];c[++d]='"'+i.id+'",';c[++d]='"'+i.name+'",';for(k=0;k<g;k++)i=f[k],i=e[i][l],i=i.value,ia.isNumber(i)?c[++d]=i:c[++d]='"'+i+'"',k!=g-1&&(c[++d]=",");c[++d]="\n"}c.join("")};
ia.Theme.prototype.parseData=function(){if(this.data.fileName!=void 0)this.fileName=this.geography.reportData.path+this.data.fileName;this._themeArray=[];var a=this.data.themes;if(a!=void 0)for(var b=a.length,c=0;c<b;c++)this.hasThemes=!0,this._themeArray[c]=new ia.Theme(this.geography,this,a[c]);this._indicatorArray=[];this._indicatorHash={};this._indicatorDateHash={};a=this.data.indicators;if(a!=void 0)for(var d=[],e,b=a.length,c=0;c<b;c++){var f=new ia.Indicator(this.geography,this,a[c]);this._indicatorArray[c]=
f;f.date?(this._indicatorHash[f.id+"_"+f.date]=f,f.id!=e&&(d=[]),d.push(f.date),e=f.id,this._indicatorDateHash[f.id]=d):this._indicatorHash[f.id]=f}};ia.Theme.prototype.getThemes=function(){return this._themeArray};ia.Theme.prototype.getParentThemes=function(){for(var a=[this.name],b=this.parent;b.hasThemes==!0;)a.push(b.name),b=b.parent;return a.reverse()};ia.Theme.prototype.getChildren=function(){return this.hasThemes?this._indicatorArray.concat(this._themeArray):this._indicatorArray};
ia.Theme.prototype.getData=function(a,b){var c={dates:[],type:[]},d;d=a?this.getIndicators(a):this.getIndicators();for(var e=d.length,f=0;f<e;f++){var g=d[f];g.date!=void 0?(c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.date,c[g.date]=g.getData(b)):(c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.name,c[g.name]=g.getData(b))}return c};
ia.Theme.prototype.getDataForDate=function(a,b){for(var c={dates:[],type:[]},d=this.getIndicators(),e=d.length,f=0;f<e;f++){var g=d[f];if(g.date==a)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.name,c[g.name]=g.getData(b)}return c};ia.Theme.prototype.getComparisonData=function(a){for(var b={dates:[],type:[]},a=this.getIndicators(a),c=a.length,d=0;d<c;d++){var e=a[d];if(e.date!=void 0)b.type[b.type.length]=e.type,b.dates[b.dates.length]=e.date,b[e.date]=e.getComparisonData()}return b};
ia.Theme.prototype.getComparisonDataForDate=function(a){for(var b={dates:[],type:[]},c=this.getIndicators(),d=c.length,e=0;e<d;e++){var f=c[e];if(f.date==a)b.type[b.type.length]=f.type,b.dates[b.dates.length]=f.name,b[f.name]=f.getComparisonData()}return b};
ia.Theme.prototype.getIndicators=function(a){if(a==null||a==void 0)return this._indicatorArray;else{var b=this.getIndicatorDates(a),c=[];if(b!=void 0)for(var d=b.length,e=0;e<d;e++)c.push(this.getIndicator(a,b[e]));else c.push(this.getIndicator(a));return c}};ia.Theme.prototype.getIndicatorsWithDate=function(a){for(var b=this.getIndicatorIds(),c=[],d=0;d<b.length;d++)c[c.length]=this.getIndicator(b[d],a);return c};
ia.Theme.prototype.getFirstIndicator=function(a){a==void 0&&(a=!0);if(this._indicatorArray.length>0){var b=this.getIndicators(this._indicatorArray[0].id);return a?b[b.length-1]:b[0]}else if(this.hasThemes)for(b=this._themeArray.length;0<b;)return this._themeArray[0].getFirstIndicator(a)};
ia.Theme.prototype.getIndicator=function(a,b,c){c==void 0&&(c=!0);if(b!=void 0&&b!=""&&this._indicatorHash[a+"_"+b]!=void 0)return this._indicatorHash[a+"_"+b];else if(this._indicatorHash[a]!=void 0)return this._indicatorHash[a];else if(b=this.getIndicatorDates(a))return c?this._indicatorHash[a+"_"+b[b.length-1]]:this._indicatorHash[a+"_"+b[0]]};
ia.Theme.prototype.getNestedIndicator=function(a,b,c){var d=this.getIndicator(a,b,c);if(d!=void 0)return d;if(this.hasThemes)for(var e=this._themeArray.length,f=0;f<e;f++)if(d=this._themeArray[f].getNestedIndicator(a,b,c),d!=void 0)return d};ia.Theme.prototype.getIndicatorDates=function(a){return this._indicatorDateHash[a]};ia.Theme.prototype.getIndicatorIds=function(){for(var a=this._indicatorArray.length,b=[],c=0;c<a;c++){var d=this._indicatorArray[c];b.indexOf(d.id)==-1&&b.push(d.id)}return b};
ia.Theme.prototype.getIndicatorNames=function(){for(var a=this._indicatorArray.length,b=[],c=0;c<a;c++){var d=this._indicatorArray[c];b.indexOf(d.name)==-1&&b.push(d.name)}return b};
ia.Theme.prototype.loadData=function(a){var b=this;b.hasData==!1?ia.File.load({url:b.fileName,dataType:"json",onSuccess:function(c){b.data=c;b.hasData=!0;b.parseData();if(this.hasThemes){var d=0,e=function(){d++;d==b._themeArray.length?a.call(null,b):b._themeArray[d].loadData(e)};this._themeArray.length>0&&this._themeArray[0].loadData(e)}else a.call(null,b)}}):a.call(null,b)};
ia.Theme.prototype.loadIndicator=function(a,b,c){var d=this,e=d.getIndicator(a,b);e!=void 0&&(d.hasData==!1?d.loadData(function(){var e=d.getIndicator(a,b);c.call(null,e)}):c.call(null,e))};
ia.Theme.prototype.getProfileData=function(a,b,c,d){var e={};e.id=this.id;e.name=this.name;e.indicators=[];b[b.length]=e;if(this.hasThemes)for(var f=this._themeArray.length,g=0;g<f;g++)this._themeArray[g].getProfileData(a,b,c,d);if(d&&c!=void 0)b=this.getIndicatorsWithDate(c);else if(d&&c==void 0){c=this.getIndicatorIds();b=[];for(g=0;g<c.length;g++)b[b.length]=this.getIndicator(c[g],void 0,!0)}else b=this.getIndicators();c=b.length;for(g=0;g<c;g++){d=b[g];f={};f.id=d.id;f.name=d.name;f.date=d.date;
f.type=d.type;f.href=d.href;f.features=[];e.indicators[e.indicators.length]=f;f.minValue=d.minValue;f.maxValue=d.maxValue;f.sum=d.sum;f.mean=d.mean;f.median=d.median;f.range=d.range;f.lowerQuartile=d.lowerQuartile;f.upperQuartile=d.upperQuartile;f.interquartileRange=d.interquartileRange;f.variance=d.variance;f.standardDeviation=d.standardDeviation;f.minValue_formatted=d.minValue_formatted;f.maxValue_formatted=d.maxValue_formatted;f.sum_formatted=d.sum_formatted;f.mean_formatted=d.mean_formatted;f.median_formatted=
d.median_formatted;f.range_formatted=d.range_formatted;f.lowerQuartile_formatted=d.lowerQuartile_formatted;f.upperQuartile_formatted=d.upperQuartile_formatted;f.interquartileRange_formatted=d.interquartileRange_formatted;f.variance_formatted=d.variance_formatted;f.standardDeviation_formatted=d.standardDeviation_formatted;for(var h=a.length,k=0;k<h;k++){var i=this.geography.getFeature(a[k]);if(i){var l={};l.id=i.id;l.name=i.name;l.value=d.getValue(i.id);l.value_formatted=d.getFormattedValue(i.id);
for(var j=d.getAssociates(),m=j.length,n=0;n<m;n++){var o=j[n];l[o.name]=o.getValue(i.id);l[o.name+"_formatted"]=o.getFormattedValue(i.id);l[o.name+"_type"]=o.type;l[o.name+"_minValue"]=o.minValue;l[o.name+"_maxValue"]=o.maxValue;l[o.name+"_sum"]=o.sum;l[o.name+"_mean"]=o.mean;l[o.name+"_median"]=o.median;l[o.name+"_range"]=o.range;l[o.name+"_lowerQuartile"]=o.lowerQuartile;l[o.name+"_upperQuartile"]=o.upperQuartile;l[o.name+"_interquartileRange"]=o.interquartileRange;l[o.name+"_variance"]=o.variance;
l[o.name+"_standardDeviation"]=o.standardDeviation;l[o.name+"_minValue_formatted"]=o.minValue_formatted;l[o.name+"_maxValue_formatted"]=o.maxValue_formatted;l[o.name+"_sum_formatted"]=o.sum_formatted;l[o.name+"_mean_formatted"]=o.mean_formatted;l[o.name+"_median_formatted"]=o.median_formatted;l[o.name+"_range_formatted"]=o.range_formatted;l[o.name+"_lowerQuartile_formatted"]=o.lowerQuartile_formatted;l[o.name+"_upperQuartile_formatted"]=o.upperQuartile_formatted;l[o.name+"_interquartileRange_formatted"]=
o.interquartileRange_formatted;l[o.name+"_variance_formatted"]=o.variance_formatted;l[o.name+"_standardDeviation_formatted"]=o.standardDeviation_formatted}var i=d.getProperties(),p;for(p in i)l[p]=i[p],l[p+"_formatted"]=i[p],l[p+"_type"]=ia.Thematic.CATEGORIC;f.features[f.features.length]=l}}}};
ia.Theme.prototype.getFeatureData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.href=this.href;c.precision=this.precision;c.themes=[];c.indicators=[];if(this.hasThemes)for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e];f.hasData&&(f=f.getFeatureData(a,b),c.themes[c.themes.length]=f)}d=this.getIndicators();f=d.length;for(e=0;e<f;e++){var g=d[e];if(b==void 0||b==g.date){var h={};h.id=g.id;h.name=g.name;h.date=g.date;h.type=g.type;h.href=g.href;h.precision=g.precision;
h.value=g.getValue(a.id);h.formattedValue=g.getFormattedValue(a.id);h.associates=[];h.properties=[];for(var k=g.getAssociates(),i=k.length,l=0;l<i;l++){var j=k[l],m={};m.name=j.name;m.type=j.type;m.precision=j.precision;m.value=j.getValue(a.id);m.formattedValue=j.getFormattedValue(a.id);h.associates[h.associates.length]=m}if(i=g.getLowerLimits())k={},k.value=i.getValue(a.id),k.precision=i.precision,k.formattedValue=i.getFormattedValue(a.id),h.lowerLimit=k;if(i=g.getUpperLimits())k={},k.value=i.getValue(a.id),
k.precision=i.precision,k.formattedValue=i.getFormattedValue(a.id),h.upperLimit=k;var g=g.getProperties(),n;for(n in g)k={},k.name=n,k.value=g[n],h.properties[h.properties.length]=k;c.indicators[c.indicators.length]=h}}return c};
ia.Theme.prototype.getIndicatorData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.href=this.href;c.precision=this.precision;c.themes=[];c.indicators=[];if(this.hasThemes)for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e];f.hasData&&(f=f.getIndicatorData(n,b),c.themes[c.themes.length]=f)}d=this.getIndicators();f=d.length;for(e=0;e<f;e++){var g=d[e];if(b==void 0||b==g.date){var h={};h.id=g.id;h.name=g.name;h.date=g.date;h.type=g.type;h.href=g.href;h.precision=g.precision;
h.properties=[];var k=g.getProperties(),i;for(i in k){var l={};l.name=i;l.value=k[i];h.properties[h.properties.length]=l}h.features=[];for(var j=a.length,m=0;m<j;m++){var n=this.geography.getFeature(a[m]),o={};o.id=n.id;o.name=n.name;o.href=n.href;o.value=g.getValue(n.id);o.formattedValue=g.getFormattedValue(n.id);o.associates=[];o.properties=[];k=n.getProperties();for(i in k)l={},l.name=i,l.value=k[i],o.properties[o.properties.length]=l;for(var k=g.getAssociates(),l=k.length,p=0;p<l;p++){var q=k[p],
r={};r.name=q.name;r.type=q.type;r.precision=q.precision;r.value=q.getValue(n.id);r.formattedValue=q.getFormattedValue(n.id);o.associates[o.associates.length]=r}if(l=g.getLowerLimits())k={},k.value=l.getValue(n.id),k.precision=l.precision,k.formattedValue=l.getFormattedValue(n.id),o.lowerLimit=k;if(l=g.getUpperLimits())k={},k.value=l.getValue(n.id),k.precision=l.precision,k.formattedValue=l.getFormattedValue(n.id),o.upperLimit=k;h.features[h.features.length]=o}c.indicators[c.indicators.length]=h}}return c};
ia.Associate=function(a,b,c){ia.Associate.baseConstructor.call(this,c,b);this._stats=new ia.Statistics;this.indicator=b;this.geography=a;this.parseData()};ia.extend(ia.BaseData,ia.Associate);
ia.Associate.prototype.parseData=function(){this.id=this.data.name;this._indexHash={};this._valueArray=this.data.values;this._fValueArray=[];if(this._valueArray){for(var a=this.geography.getFeatures(),b=a.length,c,d,e=0;e<b;e++)d=a[e].id,c=this._valueArray[e],c=this.geography.reportData.formatter.format(c,this.precision),c==this.geography.reportData.formatter.noDataValue&&(this._valueArray[e]=c),this._indexHash[d]=e,this._fValueArray.push(c);this._stats.setData(this._valueArray);this.mean=this._stats.mean;
this.median=this._stats.median;this.sum=this._stats.sum;this.minValue=this._stats.minValue;this.maxValue=this._stats.maxValue;this.range=this._stats.range;this.lowerQuartile=this._stats.lowerQuartile;this.upperQuartile=this._stats.upperQuartile;this.interquartileRange=this._stats.interquartileRange;this.variance=this._stats.variance;this.standardDeviation=this._stats.standardDeviation;this.mean_formatted=this.geography.reportData.formatter.format(this.mean,this.precision);this.median_formatted=this.geography.reportData.formatter.format(this.median,
this.precision);this.sum_formatted=this.geography.reportData.formatter.format(this.sum,this.precision);this.minValue_formatted=this.geography.reportData.formatter.format(this.minValue,this.precision);this.maxValue_formatted=this.geography.reportData.formatter.format(this.maxValue,this.precision);this.range_formatted=this.geography.reportData.formatter.format(this.range,this.precision);this.lowerQuartile_formatted=this.geography.reportData.formatter.format(this.lowerQuartile,this.precision);this.upperQuartile_formatted=
this.geography.reportData.formatter.format(this.upperQuartile,this.precision);this.interquartileRange_formatted=this.geography.reportData.formatter.format(this.interquartileRange,this.precision);this.variance_formatted=this.geography.reportData.formatter.format(this.variance,this.precision);this.standardDeviation_formatted=this.geography.reportData.formatter.format(this.standardDeviation,this.precision)}this._comparisonIndexHash={};this._comparisonArray=this.data.comparisonValues;this._fComparisonArray=
[];if(this._comparisonArray){a=this.geography.getComparisonFeatures();b=a.length;for(e=0;e<b;e++)d=a[e].id,c=this._comparisonArray[e],this._comparisonIndexHash[d]=e,c=this.geography.reportData.formatter.format(c,this.precision),this._fComparisonArray.push(c)}};ia.Associate.prototype.getValue=function(a){return this._indexHash[a]!=void 0?this._valueArray[this._indexHash[a]]:this.getComparisonValue(a)};ia.Associate.prototype.getValues=function(){return this._valueArray};
ia.Associate.prototype.getFormattedValue=function(a){return this._indexHash[a]!=void 0?this._fValueArray[this._indexHash[a]]:this.getFormattedComparisonValue(a)};ia.Associate.prototype.getFormattedValues=function(){return this._fValueArray};ia.Associate.prototype.getComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._comparisonArray[this._comparisonIndexHash[a]]};ia.Associate.prototype.getComparisonValues=function(){return this._comparisonArray};
ia.Associate.prototype.getFormattedComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._fComparisonArray[this._comparisonIndexHash[a]]};ia.Associate.prototype.getFormattedComparisonValues=function(){return this._fComparisonArray};
ia.Associate.prototype.getData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getFeatures(),c=d.length);for(var e=0;e<c;e++){var f;f=a!=null?this.geography.getFeature(a[e]):d[e];var g={};g.id=f.id;g.name=f.name;g.value=this.getValue(f.id);g.value_formatted=this.getFormattedValue(f.id);b[f.id]=g}return b};
ia.Associate.prototype.getComparisonData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getComparisonFeatures(),c=d.length);for(var e=0;e<c;e++){var f;f=a!=null?this.geography.getComparisonFeature(a[e]):d[e];var g={};g.id=f.id;g.name=f.name;g.value=this.getComparisonValue(f.id);g.value_formatted=this.getFormattedComparisonValue(f.id);b[f.id]=g}return b};
ia.Indicator=function(a,b,c){ia.Indicator.baseConstructor.call(this,c,b);this._stats=new ia.Statistics;this.theme=b;this.geography=a;this.parseData()};ia.extend(ia.BaseData,ia.Indicator);
ia.Indicator.prototype.parseData=function(){if(this.data.fileName!=void 0)this.fileName=this.geography.reportData.path+this.data.fileName;if(this.data.date!=void 0)this.date=this.data.date;this._indexHash={};this._valueArray=this.data.values;this._fValueArray=[];if(this._valueArray){for(var a=this.geography.getFeatures(),b=a.length,c,d,e=0;e<b;e++)d=a[e].id,c=this._valueArray[e],c=this.geography.reportData.formatter.format(c,this.precision),c==this.geography.reportData.formatter.noDataValue&&(this._valueArray[e]=
c),this._indexHash[d]=e,this._fValueArray.push(c);this._stats.setData(this._valueArray);this.mean=this._stats.mean;this.median=this._stats.median;this.sum=this._stats.sum;this.minValue=this._stats.minValue;this.maxValue=this._stats.maxValue;this.range=this._stats.range;this.lowerQuartile=this._stats.lowerQuartile;this.upperQuartile=this._stats.upperQuartile;this.interquartileRange=this._stats.interquartileRange;this.variance=this._stats.variance;this.standardDeviation=this._stats.standardDeviation;
this.mean_formatted=this.geography.reportData.formatter.format(this.mean,this.precision);this.median_formatted=this.geography.reportData.formatter.format(this.median,this.precision);this.sum_formatted=this.geography.reportData.formatter.format(this.sum,this.precision);this.minValue_formatted=this.geography.reportData.formatter.format(this.minValue,this.precision);this.maxValue_formatted=this.geography.reportData.formatter.format(this.maxValue,this.precision);this.range_formatted=this.geography.reportData.formatter.format(this.range,
this.precision);this.lowerQuartile_formatted=this.geography.reportData.formatter.format(this.lowerQuartile,this.precision);this.upperQuartile_formatted=this.geography.reportData.formatter.format(this.upperQuartile,this.precision);this.interquartileRange_formatted=this.geography.reportData.formatter.format(this.interquartileRange,this.precision);this.variance_formatted=this.geography.reportData.formatter.format(this.variance,this.precision);this.standardDeviation_formatted=this.geography.reportData.formatter.format(this.standardDeviation,
this.precision)}this._comparisonIndexHash={};this._comparisonArray=this.data.comparisonValues;this._fComparisonArray=[];if(this._comparisonArray){a=this.geography.getComparisonFeatures();b=a.length;for(e=0;e<b;e++)d=a[e].id,c=this._comparisonArray[e],this._comparisonIndexHash[d]=e,c=this.geography.reportData.formatter.format(c,this.precision),this._fComparisonArray.push(c)}this._associateArray=[];this._associateHash={};d=this.data.associates;if(d!=void 0){c=d.length;for(e=0;e<c;e++)a=new ia.Associate(this.geography,
this,d[e]),this._associateArray[e]=a,this._associateHash[a.id]=a}if(this.data.limits!=void 0)this._lowerLimits=new ia.Limits(this.geography,this,this.data.limits.lower),this._upperLimits=new ia.Limits(this.geography,this,this.data.limits.upper)};ia.Indicator.prototype.getLowerLimits=function(){return this._lowerLimits};ia.Indicator.prototype.getUpperLimits=function(){return this._upperLimits};
ia.Indicator.prototype.getValue=function(a){return this._indexHash[a]!=void 0?this._valueArray[this._indexHash[a]]:this.getComparisonValue(a)};ia.Indicator.prototype.getValues=function(){return this._valueArray};ia.Indicator.prototype.getFormattedValue=function(a){return this._indexHash[a]!=void 0?this._fValueArray[this._indexHash[a]]:this.getFormattedComparisonValue(a)};ia.Indicator.prototype.getFormattedValues=function(){return this._fValueArray};
ia.Indicator.prototype.getComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._comparisonArray[this._comparisonIndexHash[a]]};ia.Indicator.prototype.getComparisonValues=function(){return this._comparisonArray};ia.Indicator.prototype.getFormattedComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._fComparisonArray[this._comparisonIndexHash[a]]};ia.Indicator.prototype.getFormattedComparisonValues=function(){return this._fComparisonArray};
ia.Indicator.prototype.getAssociate=function(a){return this._associateHash[a]};ia.Indicator.prototype.getAssociates=function(){return this._associateArray};ia.Indicator.prototype.getDataType=function(a){if(a=="value")return this.type;else if(this.getAssociate(a)!=void 0)return this.getAssociate(a).type;else if(a=="name")return ia.Thematic.CATEGORIC};ia.Indicator.prototype.getDataPrecision=function(a){if(a=="value")return this.precision;else if(this.getAssociate(a)!=void 0)return this.getAssociate(a).precision};
ia.Indicator.prototype.getData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getFeatures(),c=d.length);for(var e=this.getAssociates(),f=e.length,g=this.getLowerLimits(),h=this.getUpperLimits(),k=0;k<c;k++){var i;i=a!=null?this.geography.getFeature(a[k]):d[k];var l={};l.id=i.id;l.name=i.name;l.value=this.getValue(i.id);l.value_formatted=this.getFormattedValue(i.id);var j=i.getProperties(),m;for(m in j)l[m]=j[m],l[m+"_formatted"]=j[m];if(g)l.lowerLimit=g.getValue(i.id),l.lowerLimit_formatted=
g.getFormattedValue(i.id);if(h)l.upperLimit=h.getValue(i.id),l.upperLimit_formatted=h.getFormattedValue(i.id);if(i.href)l.href=i.href;for(j=0;j<f;j++)l[e[j].name]=e[j].getValue(i.id),l[e[j].name+"_formatted"]=e[j].getFormattedValue(i.id);b[i.id]=l}return b};
ia.Indicator.prototype.getComparisonData=function(){for(var a={},b=this.geography.getComparisonFeatures(),c=b.length,d=this.getAssociates(),e=d.length,f=0;f<c;f++){var g=b[f],h={};h.id=g.id;h.name=g.name;h.value=this.getComparisonValue(g.id);h.value_formatted=this.getFormattedComparisonValue(g.id);if(g.href)h.href=g.href;var k=g.getProperties(),i;for(i in k)h[i]=k[i],h[i+"_formatted"]=k[i];for(k=0;k<e;k++)h[d[k].name]=d[k].getComparisonValue(g.id),h[d[k].name+"_formatted"]=d[k].getFormattedComparisonValue(g.id);
a[g.id]=h}return a};ia.Indicator.prototype.getAssociateData=function(a,b){for(var c={dates:[],type:[]},d=this.getAssociates(),e=d.length,f=0;f<e;f++){var g=d[f];if(a!=void 0){if(a.indexOf(g.id)!=-1)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getData(b)}else c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getData(b)}return c};
ia.Indicator.prototype.getAssociateComparisonData=function(a,b){for(var c={dates:[],type:[]},d=this.getAssociates(),e=d.length,f=0;f<e;f++){var g=d[f];if(a!=void 0){if(a.indexOf(g.id)!=-1)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getComparisonData(b)}else c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getComparisonData(b)}return c};
ia.Feature=function(a){ia.Feature.baseConstructor.call(this,a);this._filterHash={};this._filterHash={};a=this.data.filters;if(a!=void 0)for(var b=a.length,c=0;c<b;c++){var d=a[c];this._filterHash[d["for"]]=d.name}};ia.extend(ia.BaseData,ia.Feature);ia.Feature.prototype.getFilterValue=function(a){return this._filterHash[a]};ia.Filter=function(a){ia.Filter.baseConstructor.call(this,a)};ia.extend(ia.BaseData,ia.Filter);
ia.Limits=function(a,b,c){this._indexHash={};this._valueArray=c;this._fValueArray=[];if(this._valueArray){b=a.getFeatures();c=b.length;this.minValue=Infinity;this.maxValue=-Infinity;for(var d,e,f,g=0;g<c;g++)f=b[g].id,d=this._valueArray[g],e=a.reportData.formatter.format(d,this.precision),this._indexHash[f]=g,this.minValue=d<this.minValue?d:this.minValue,this.maxValue=d>this.maxValue?d:this.maxValue,this._fValueArray.push(e)}};ia.Limits.prototype.getValue=function(a){return this._valueArray[this._indexHash[a]]};
ia.Limits.prototype.getValues=function(){return this._valueArray};ia.Limits.prototype.getFormattedValue=function(a){return this._fValueArray[this._indexHash[a]]};ia.Limits.prototype.getFormattedValues=function(){return this._fValueArray};ia.MapData=function(){ia.MapData.baseConstructor.call(this);this._layerCount=-1;this._visibleLayers=[];this._callbackFnc=void 0;this._layerHash={};this.tilePath="./";this.useGoogleMaps=!1;this.path="";this.maintainLayerOrder=!1};ia.extend(ia.EventDispatcher,ia.MapData);
ia.MapData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(a);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseData(a,b)}})};ia.MapData.prototype.getLayer=function(a){return this._layerHash[a]};
ia.MapData.prototype.parseData=function(a,b){this._layerCount=-1;this.useGoogleMaps=!1;this._callbackFnc=b;for(var c in this._layerHash)delete this._layerHash[c];this._visibleLayers=[];this.layers=[];this.baseLayers=[];this.noneBaseLayers=[];c=[];var d=[],e=[],f=[],g=[];this._layerHash={};if(a.template!=void 0)this.template=a.template;if(a.version!=void 0)this.version=a.version;if(a.boundingBox!=void 0){var h=a.boundingBox.split(" ");this.mapBBox=new ia.BoundingBox(parseFloat(h[0]),parseFloat(h[1]),
parseFloat(h[2]),parseFloat(h[3]))}if(a.maintainLayerOrder!=void 0)this.maintainLayerOrder=a.maintainLayerOrder;h=a.layers;if(h!=void 0){for(var k=h.length,i=0;i<k;i++){var l=h[i];if(l.type=="google-layer"&&navigator.onLine)this.useGoogleMaps=!0,this.googleMapType=l.mapType,this.googleApiKey=l.apiKey}for(i=0;i<k;i++){l=h[i];if(l.geometry=="image"&&this.useGoogleMaps==!1){var j;l.type=="tile-layer"?(j=new ia.TileLayer(this.path+l.url),j.path=this.tilePath,this._parseLayerProperties(l,j)):l.type=="ags-layer"&&
navigator.onLine?(j=new ia.AGSLayer,this._parseLayerProperties(l,j)):l.type=="wms-layer"&&navigator.onLine&&(j=new ia.WMSLayer,this._parseLayerProperties(l,j));l.isReference?d[d.length]=j:c[c.length]=j}if(l.geometry!="image"){var m=l.idField!=void 0;if(l.type=="base-layer"){if(j=m?new ia.FeatureServiceLayer(l.url):new ia.FeatureLayer(this.path+l.url),this.baseLayers[this.baseLayers.length]=j,this.baseLayers.length==1)this.baseLayer=j}else l.type=="contextual-layer"?j=m?new ia.FeatureServiceLayer(l.url):
new ia.FeatureLayer(this.path+l.url):l.type=="rss-layer"&&(j=new ia.GeoRSSLayer(l.url));this._parseLayerProperties(l,j);l.type=="base-layer"&&this.baseLayers.length>1&&(j=this._visibleLayers.pop(),j.setVisible(!1));l.type!="base-layer"&&(j.geometry=="point"?e[e.length]=j:j.geometry=="line"?f[f.length]=j:j.geometry=="polygon"&&(g[g.length]=j));this._layerHash[j.id]=j}this.maintainLayerOrder&&(this.layers[this.layers.length]=j)}this.noneBaseLayers=c.concat(g).concat(f).concat(e).concat(d);if(!this.maintainLayerOrder){for(i=
0;i<this.baseLayers.length;i++)j=this.baseLayers[i],j.geometry=="point"?e.unshift(j):j.geometry=="line"?f.unshift(j):j.geometry=="polygon"&&g.unshift(j);this.layers=c.concat(g).concat(f).concat(e).concat(d)}}this.useGoogleMaps&&ia.googleMapsLoaded==!1?(j=document.createElement("script"),j.type="text/javascript",j.src=this.googleApiKey!=""?"http://maps.googleapis.com/maps/api/js?key="+this.googleApiKey+"&sensor=false&callback=ia.initGoogleMaps":"http://maps.google.com/maps/api/js?sensor=false&callback=ia.initGoogleMaps",
document.body.appendChild(j)):this.loadVisibleLayers()};
ia.MapData.prototype._parseLayerProperties=function(a,b){b.id=a.id;b.name=a.name;b.showInLayerList=a.showInLayerList;if(a.visible!=void 0&&(b.setVisible(a.visible),a.visible==!0||a.type=="base-layer"))this._visibleLayers[this._visibleLayers.length]=b;if(a.minLabelExtent!=void 0)b.minLabelExtent=a.minLabelExtent;if(a.maxLabelExtent!=void 0)b.maxLabelExtent=a.maxLabelExtent;if(a.showLabels!=void 0)b.showLabels=a.showLabels;if(a.showDataTips!=void 0)b.showDataTips=a.showDataTips;if(a.iconPath!=void 0&&
a.iconPath!=""&&(b.iconPath=a.iconPath,b.iconPath.indexOf("http")==-1&&b.iconPath.indexOf("javascript")==-1))b.iconPath=ia.IAS_PATH+b.iconPath;if(a.idField!=void 0)b.idField=a.idField;if(a.nameField!=void 0)b.nameField=a.nameField;if(a.srs!=void 0)b.srs=a.srs;if(a.featureIds!=void 0)b.featureIds=a.featureIds;if(a.objectIds!=void 0)b.objectIds=a.objectIds;if(a.boundingBox!=void 0){var c=a.boundingBox.split(" ");b.bBox=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))}if(a.themeColors!=
void 0)b.themeColors=a.themeColors;b.geometry=a.geometry;if(a.geometry!="image"){c=b.style;if(a.symbolSize!=void 0)b.symbolSize=a.symbolSize;if(a.fillColor!=void 0)c.fillStyle=ia.Color.toRGBA(a.fillColor,a.fillOpacity);if(a.borderThickness!=void 0)c.lineWidth=a.borderThickness;if(a.borderColor!=void 0){var d=1;c.lineWidth==0&&(d=0);c.strokeStyle=ia.Color.toRGBA(a.borderColor,d)}b.style=c}if(a.url!=void 0)b.url=a.url;if(a.layers!=void 0)b.layers=a.layers;if(a.srs!=void 0)b.srs=a.srs;if(a.version!=
void 0)b.version=a.version;if(a.params!=void 0)b.params=a.params;if(a.requiresAxisSwitch!=void 0)b.requiresAxisSwitch=a.requiresAxisSwitch;if(a.minExtent!=void 0)b.minExtent=a.minExtent;if(a.maxExtent!=void 0)b.maxExtent=a.maxExtent};
ia.MapData.prototype.loadVisibleLayers=function(){this._layerCount++;var a=this;if(this._visibleLayers.length>this._layerCount){var b=this._visibleLayers[this._layerCount];b.addEventListener(ia.Event.LAYER_READY,function(){a.loadVisibleLayers()});b.loadSource()}else this._callbackFnc.call(null,this),a.dispatchEvent(new ia.DataEvent(ia.DataEvent.MAP_DATA_CHANGED,a))};
ia.DataEvent=function(a,b,c,d,e){ia.DataEvent.baseConstructor.call(this,a,b);this.data=b;this.geography=c;this.theme=d;this.indicator=e};ia.extend(ia.Event,ia.DataEvent);ia.DataEvent.DATA_CHANGED="dataChanged";ia.DataEvent.GEOG_CHANGED="geogChanged";ia.DataEvent.THEME_CHANGED="themeChanged";ia.DataEvent.INDICATOR_CHANGED="indicatorChanged";
ia.FilterEvent=function(a,b,c,d,e,f){ia.FilterEvent.baseConstructor.call(this,a,b);this.data=b;this.filterId=c;this.filterName=d;this.filterValue=e;this.filterFeatures=f.concat()};ia.extend(ia.Event,ia.FilterEvent);ia.FilterEvent.FILTER_CHANGED="filterChanged";ia.AGOLData=function(){this.iaData={};this.geogsWithData={};this.geogModels={};this.geogs={}};
ia.AGOLData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(this.url);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseDataModel(a,b)}})};
ia.AGOLData.prototype.parseData=function(a,b){var c=this;this.geogsWithData={};this.geogModels={};this.geogs={};this.dataModel=a;this.iaData={version:a.version,geographies:[]};var d=a.geographies;if(d!=void 0&&d.length>0){var e=-1,f=function(){e++;e==d.length?b.call(null,c.iaData):c.buildGeography(d[e],function(){f()})};f()}else b.call(null,c.iaData)};
ia.AGOLData.prototype.buildGeography=function(a,b){var c={id:a.id,name:a.name,type:a.type,url:a.url,idField:a.idField,nameField:a.nameField,themes:[],features:[],comparisonFeatures:[],fieldNames:[a.idField,a.nameField],urlList:[],indicatorList:[]};this.geogs[c.id]==void 0&&(this.iaData.geographies[this.iaData.geographies.length]=c);delete this.geogsWithData[a.id];this.geogModels[a.id]=a;this.geogs[c.id]=c;if(a.objectIds!=void 0)c.objectIds=a.objectIds.split(",");if(a.model.filters!=void 0)c.filters=
a.model.filters;if(a.model.features!=void 0){var d=a.model.features.properties;if(d!=void 0)for(var e=0;e<d.length;e++)c.fieldNames[c.fieldNames.length]=d[e].src.fieldName;d=a.model.features.filters;if(d!=void 0)for(e=0;e<d.length;e++)c.fieldNames[c.fieldNames.length]=d[e].src.fieldName}e=a.model.themes;e!=void 0&&e.length>0?this.buildThemes(c,c,e,function(){b.call(null,c)}):b.call(null,c)};
ia.AGOLData.prototype.buildThemes=function(a,b,c,d){function e(){g++;g==c.length?d.call(null):f.buildTheme(a,b,c[g],e)}var f=this,g=-1;e()};
ia.AGOLData.prototype.buildTheme=function(a,b,c,d){if(c.sourceType&&c.sourceType=="IA-JSON")$j.getJSON(ia.getDomainSafeUrl(c.url)).done(function(a){if(a.geographies)for(var c=0;c<a.geographies.length;c++)for(var e=a.geographies[c],f=0;f<e.themes.length;f++)b.themes[b.themes.length]=e.themes[f];else b.themes[b.themes.length]=a;d.call(null)}).fail(function(){});else{var e={id:c.id,name:c.name,indicators:[]};b.themes[b.themes.length]=e;for(var f=c.indicators,g=0;g<f.length;g++){var h=f[g],k=this.buildIndicator(a,
h);e.indicators[e.indicators.length]=k;if(h.associates!=void 0&&h.associates.length>0){k.associates=[];for(var i=0;i<h.associates.length;i++){var l=this.buildIndicator(a,h.associates[i]);k.associates[k.associates.length]=l}}}c.themes&&c.themes.length>0?(e.themes=[],this.buildThemes(a,e,c.themes,function(){d.call(null)})):d.call(null)}return e};
ia.AGOLData.prototype.buildIndicator=function(a,b){var c={id:b.id,name:b.name,precision:b.precision,url:b.src.url,fieldName:b.src.fieldName,rowFilters:b.src.rowFilters,properties:b.properties,values:[],comparisonValues:[]};if(b.date!="")c.date=b.date;c.type=b.type?b.type.toLowerCase():"numeric";if(c.url==a.url||c.url==void 0)a.fieldNames[a.fieldNames.length]=c.fieldName,a.indicatorList[a.indicatorList.length]=c;else{if(c.url.indexOf("FeatureServer")==-1)c.fieldName=b.src.fieldName.split(",")[0],c.idField=
b.src.fieldName.split(",")[1];for(var d=a.urlList.length,e=!0,f=0;f<d;f++){var g=a.urlList[f];if(g.url==c.url){g.indicators[g.indicators.length]=c;e=!1;break}}e&&(a.urlList[a.urlList.length]={url:c.url,indicators:[c]})}return c};ia.AGOLData.prototype.hasData=function(a){return this.geogsWithData[a]!=void 0?!0:!1};
ia.AGOLData.prototype.getGeography=function(a,b){var c=this;if(c.geogsWithData[a])return c.geogsWithData[a];else{var d=c.geogModels[a],e=c.geogs[a],f=ia.FeatureServiceReader.buildQuery(e.url,e.fieldNames,e.objectIds);ia.FeatureServiceReader.sendQuery(f,ia.accessToken,function(a){function f(){p++;if(p==e.urlList.length)c.geogsWithData[e.id]=e,b.call(null,e);else{var d=e.urlList[p].url,i=e.urlList[p].indicators;d.indexOf("FeatureServer")!=-1?c.getQueryData(e.idField,a,d,i,f):c.readCsvFile(e.idField,
a,d,i,f)}}for(var k=a.length,i=0;i<k;i++){var l=a[i],j={id:String(l.attributes[e.idField]),name:String(l.attributes[e.nameField])};if(d.model.features!=void 0){var m=d.model.features.properties;if(m!=void 0){j.properties=[];for(var n=0;n<m.length;n++){var o=m[n];j.properties[j.properties.length]={name:o.name,value:l.attributes[o.src.fieldName]}}}m=d.model.features.filters;if(m!=void 0){j.filters=[];for(n=0;n<m.length;n++)o=m[n],j.filters[j.filters.length]={"for":o["for"],name:l.attributes[o.src.fieldName]}}}j.id.indexOf("#")==
0?e.comparisonFeatures[e.comparisonFeatures.length]=j:e.features[e.features.length]=j;for(n=0;n<e.indicatorList.length;n++)m=e.indicatorList[n],j.id.indexOf("#")==0?m.comparisonValues[m.comparisonValues.length]=l.attributes[m.fieldName]:m.values[m.values.length]=l.attributes[m.fieldName]}var p=-1;f()})}};ia.AGOLData.prototype.getQueryData=function(a,b,c,d,e){var f=this;ia.FeatureServiceReader.sendQuery(c,ia.accessToken,function(c){for(var h=0;h<d.length;h++)f._getDataValues(a,b,c,d[h]);e.call(null)})};
ia.AGOLData.prototype._getDataValues=function(a,b,c,d){for(var e={},f={},g=c.length,h=0;h<g;h++){var k=c[h],i=!0;if(d.rowFilters!=void 0)for(var l in d.rowFilters)if(k.attributes[l]!=d.rowFilters[l]){i=!1;break}i==!0&&(i=String(k.attributes[a]),k=k.attributes[d.fieldName],d.type=="numeric"&&ia.isNumber(k)&&(k=parseFloat(k)),i.indexOf("#")==0?f[i]=k:e[i]=k)}g=b.length;for(h=0;h<g;h++)k=b[h],i=String(k.attributes[a]),i.indexOf("#")==0?(k=f[i],d.comparisonValues[d.comparisonValues.length]=k?f[i]:this.formatter.noDataValue):
(k=e[i],d.values[d.values.length]=k?e[i]:this.formatter.noDataValue)};
ia.AGOLData.prototype.readCsvFile=function(a,b,c,d,e){function f(a){a.charAt(0)=='"'&&a.charAt(a.length-1)=='"'?a=a.substring(1,a.length-1):a.charAt(0)=="'"&&a.charAt(a.length-1)=="'"&&(a=a.substring(1,a.length-2));return a}var g=this;ia.accessToken!=""&&(c+=c.indexOf("?")==-1?"?":"&",c+="token="+ia.accessToken);ia.File.load({url:c,contentType:"text/csv; charset=utf-8",dataType:"text",onSuccess:function(c){c=c.split(/\n/);c.pop(c.length-1);for(var k=c[0].split(","),i=0;i<d.length;i++){for(var l=d[i],
j=0,m=0,n=0;n<k.length;n++){var o=$j.trim(k[n]),o=f(o);$j.trim(l.idField)==o&&(j=n);$j.trim(l.fieldName)==o&&(m=n)}for(var o={},p={},q=c.slice(1,c.length),n=0;n<q.length;n++){var r=$j.trim(q[n].split(",")[j]),r=f(r),t=$j.trim(q[n].split(",")[m]),t=f(t);l.type=="numeric"&&ia.isNumber(t)&&(t=parseFloat(t));r.indexOf("#")==0?p[r]=t:o[r]=t}j=b.length;for(n=0;n<j;n++)r=String(b[n].attributes[a]),r.indexOf("#")==0?(m=p[r],l.comparisonValues[l.comparisonValues.length]=m?p[r]:g.formatter.noDataValue):(m=
o[r],l.values[l.values.length]=m?o[r]:g.formatter.noDataValue)}e.call(null)}})};ia.Widget=function(a){this.id=a;this._zIndex=void 0;this._xAnchor="left";this._yAnchor="top";this._visible=!1};ia.Widget.prototype.rescale=!0;ia.Widget.prototype.id="";ia.Widget.prototype.name="";ia.Widget.prototype.x=function(a){if(a!=void 0)this.setPosition(a,this._y,this._xAnchor,this._yAnchor);else return this._x};
ia.Widget.prototype.y=function(a){if(a!=void 0)this.setPosition(this._x,a,this._xAnchor,this._yAnchor);else return this._y};ia.Widget.prototype.width=function(a){if(a!=void 0)this.setSize(a,this._height);else return this._width};ia.Widget.prototype.height=function(a){if(a!=void 0)this.setSize(this._width,a);else return this._height};
ia.Widget.prototype.zIndex=function(a){if(a!=void 0)this._zIndex=a,this.container.css({"z-index":this._zIndex});else{if(this._zIndex==void 0)this._zIndex=this.container.css("z-index");return this._zIndex}};ia.Widget.prototype.xAnchor=function(a){if(a!=void 0)this.setPosition(this._x,this._y,a,this._yAnchor);else return this._xAnchor};ia.Widget.prototype.yAnchor=function(a){if(a!=void 0)this.setPosition(this._x,this._y,this._xAnchor,a);else return this._yAnchor};
ia.Widget.prototype.setDimensions=function(a,b,c,d,e,f){this.setSize(c,d);this.setPosition(a,b,e,f)};ia.Widget.prototype.restore=function(){this.setDimensions(this._x,this._y,this._width,this._height,this._xAnchor,this._yAnchor);this.zIndex(this._zIndex)};ia.Widget.prototype.maximize=function(){this.container.css({left:0,top:0,width:"100%",height:"100%","z-index":500})};
ia.Widget.prototype.setSize=function(a,b){var c="%";this.rescale=="false"&&(c="px");this._width=a;this._height=b;this._width!=void 0&&this.container.css({width:this._width+c});this._height!=void 0&&this.container.css({height:this._height+c})};ia.Widget.prototype._addedResizeListener=!1;
ia.Widget.prototype.setPosition=function(a,b,c,d){this._x=a;this._y=b;this._xAnchor=c||this._xAnchor;this._yAnchor=d||this._xAnchor;this.container.css({left:"","margin-left":"",right:"",bottom:"",top:""});if(this._xAnchor=="end"||this._xAnchor=="right")this.container.css({right:100-this._x+"%"});else if(this._xAnchor=="middle"||this._xAnchor=="center"){this.container.css({left:this._x+"%"});if(this._width==void 0&&this._addedResizeListener==!1)this._addedResizeListener=!0,this.container.resize(function(){this.setPosition(this._x,
this._y)}.bind(this));this.container.css({"margin-left":this.container.width()/2*-1+"px"})}else this.container.css({left:this._x+"%"});this._yAnchor=="bottom"?this.container.css({bottom:this._y+"%"}):this.container.css({top:this._y+"%"})};ia.Widget.prototype.toggle=function(){this.visible(!this._visible)};ia.Widget.prototype.show=function(){this.visible(!0)};ia.Widget.prototype.hide=function(){this.visible(!1)};
ia.Widget.prototype.visible=function(a){if(a!=void 0){var b=this;b._visible=a;b.container.stop();b._visible?(b._zIndex&&b.container.css("z-index",b._zIndex),b.container.css("visibility","visible").animate({opacity:1})):b.container.animate({opacity:0},function(){b._zIndex&&b.container.css("z-index",0);b.container.css("visibility","hidden")})}else return this._visible};ia.Widget.prototype.tooltip=function(a){this.container.attr("title",a)};
ia.Widget.prototype.onclick=function(a,b){var c=this;c.container.off(ia.CLICK_TYPE);if(a)if(c.container.css("cursor","pointer"),typeof a=="function")c.container.on(ia.CLICK_TYPE,function(b){b.stopPropagation();ia.IS_TOUCH_DEVICE&&b.preventDefault();a.call(null,b)});else(function(){c.container.on(ia.CLICK_TYPE,function(c){c.stopPropagation();ia.IS_TOUCH_DEVICE&&c.preventDefault();ia.callFunction(a,b,c)})})()};ia.Widget.prototype.addCssClass=function(a){a&&a!=""&&this.container.addClass(a)};
ia.Widget.prototype.updateWidget=function(a){this.name=a.name;this.setDimensions(a.x,a.y,a.width,a.height,a.anchor,"top")};ia.Panel=function(a,b){ia.Panel.baseConstructor.call(this,a);this._title=b;this._popup=!1;this._settingsBtn=void 0;this._hasSettings=!1;this._closeBtn=void 0;this._closeable=!1;this._exportBtn=void 0;this._exportable=!1;this._resizeBtn=void 0;this._isMaximized=this._resizeable=!1;this._borderRadius=0;this._build()};ia.extend(ia.Widget,ia.Panel);
ia.Panel.prototype._build=function(){var a=this;this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.container=$j("<div>").addClass("ia-widget ia-panel").attr("id","ia-widget-"+this.id);this.container.css("visibility","hidden");this.container.resize(function(){a._size()});this.content=$j("<div>").addClass("ia-panel-content").attr("id","ia-widget-"+this.id+"-content");this.contentText=$j("<div>").addClass("ia-panel-content-text ia-nodata-text").attr("id",
"ia-widget-"+this.id+"-content-text");this.header=$j("<div>").addClass("ia-panel-header").attr("id","ia-widget-"+this.id+"-header");this.header.css("border-top-left-radius",this._borderRadius+"px");this.header.css("border-top-right-radius",this._borderRadius+"px");this.header.css({display:"none"});this.container.append(this.header);this.container.append(this.content);this.container.append(this.contentText);this.footer=$j("<div>").addClass("ia-panel-footer").attr("id","ia-widget-"+this.id+"-footer");
this.container.append(this.footer);var b=$j("<div>").addClass("ia-panel-btns").attr("id","ia-widget-"+this.id+"-btns");this.container.append(b);if(ia.IS_TOUCH_DEVICE){var c;this.container.bind("touchstart",function(){b.stop();b.css({visibility:"visible"}).animate({opacity:1});clearTimeout(c);c=setTimeout(function(){clearTimeout(c);b.stop().animate({opacity:0},function(){b.css({visibility:"hidden"})})},5E3)})}else this.container.mouseenter(function(){b.stop().css({visibility:"visible"}).animate({opacity:0.5})}),
this.container.mouseleave(function(){b.stop().animate({opacity:0},function(){b.css({visibility:"hidden"})})}),b.mouseenter(function(){b.stop().animate({opacity:1})}),b.mouseleave(function(){b.stop().animate({opacity:0.5})});this._resizeBtn=$j("<div>").addClass("ia-panel-btn ia-panel-resize-btn-maximize").attr("id","ia-widget-"+this.id+"-resize").css("display","none");b.append(this._resizeBtn);this._resizeBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.resizeFunction&&a.resizeFunction.call(null,
a)});this._exportBtn=$j("<div>").addClass("ia-panel-btn ia-panel-export-btn").attr("id","ia-widget-"+this.id+"-export").css("display","none");this._exportBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.exportFunction&&a.exportFunction.call(null,a)});b.append(this._exportBtn);this._closeBtn=$j("<div>").addClass("ia-panel-btn ia-panel-close-btn").attr("id","ia-widget-"+this.id+"-close").css("display","none");this._closeBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();
b.preventDefault();a.closeFunction&&a.closeFunction.call(null,a)});b.append(this._closeBtn);this._settingsBtn=$j("<div>").addClass("ia-panel-btn ia-panel-settings-btn").attr("id","ia-widget-"+this.id+"-settings").css("display","none");this._settingsBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.settingsFunction&&a.settingsFunction.call(null,b)});b.append(this._settingsBtn);this.title(this._title);this._size()};
ia.Panel.prototype.popup=function(a){var b=this;if(a==!0)this._popup=!0,this.container.addClass("ia-popup-panel"),$j("body").bind(ia.CLICK_TYPE+".popup-"+this.id,function(){b.hide()}),this.container.bind(ia.CLICK_TYPE+".popup-"+this.id,function(a){a.stopPropagation()});else if(a==!1)this._popup=!1,this.container.removeClass("ia-popup-panel"),$j("body").unbind(ia.CLICK_TYPE+".popup-"+this.id),this.container.unbind(ia.CLICK_TYPE+".popup-"+this.id);else return this._popup};
ia.Panel.prototype.hasSettings=function(a){if(a==!0)this._hasSettings=!0,this._settingsBtn.css("display","");else if(a==!1)this._hasSettings=!1,this._settingsBtn.css("display","none");else return this._hasSettings};ia.Panel.prototype.closeable=function(a){if(a==!0)this._closeable=!0,this._closeBtn.css("display","");else if(a==!1)this._closeable=!1,this._closeBtn.css("display","none");else return this._closeable};ia.Panel.prototype.closeFunction=function(a){a.hide()};
ia.Panel.prototype.exportable=function(a){if(a==!0)this._exportable=!0,this._exportBtn.css("display","");else if(a==!1)this._exportable=!1,this._exportBtn.css("display","none");else return this._exportable};ia.Panel.prototype.resizeable=function(a){if(a==!0)this._resizeable=!0,this._resizeBtn.css("display","");else if(a==!1)this._resizeable=!1,this._resizeBtn.css("display","none");else return this._resizeable};ia.Panel.prototype.resizeFunction=function(a){a.resize()};
ia.Panel.prototype.resize=function(){this._isMaximized?(this._resizeBtn.addClass("ia-panel-resize-btn-maximize").removeClass("ia-panel-resize-btn-minimize"),this.restore()):(this._resizeBtn.addClass("ia-panel-resize-btn-minimize").removeClass("ia-panel-resize-btn-maximize"),this.maximize());this._isMaximized=!this._isMaximized};ia.Panel.prototype.append=function(a){this.content.append(a)};ia.Panel.prototype.appendToFooter=function(a){this.footer.append(a)};
ia.Panel.prototype.title=function(a){a!=void 0&&a!="undefined"&&a!=""?(this.header.css("display",""),this.header.html(a)):(this.header.css("display","none"),this.header.html(""));this._size()};ia.Panel.prototype.text=function(a){this.contentText.html(a);a==""?this.contentText.css("display","none"):this.contentText.css("display","inline")};
ia.Panel.prototype._size=function(){var a=this.container.height(),b=0;this.header.css("display")!="none"&&(b=this.header.outerHeight());footerHeight=this.footer.outerHeight();this.content.height(a-b-footerHeight)};
ia.Panel.prototype.update=function(a){var b=a.getProperty("isPopUp")||!1,c=!0;if(a.id.indexOf("menuBar")!=-1||a.id.indexOf("timeControl")!=-1||a.id.indexOf("featureLegend")!=-1||a.id.indexOf("legend")!=-1||a.id.indexOf("stackedLegend")!=-1||a.id.indexOf("areaBreakdownPieLegend")!=-1||a.id.indexOf("profileLegend")!=-1)c=!1;var d=a.getProperty("isExportable")||!1,e=a.getProperty("visible")||!1;this.popup(b);this.closeable(b);this.resizeable(c);this.exportable(d);this.visible(e);this.zIndex(a.zIndex);
this.updateWidget(a)};ia.Button=function(a,b){ia.Button.baseConstructor.call(this,a);this.container=$j("<button type='button'>").addClass("ia-widget ia-button button").attr("id","ia-widget-"+a);b!=void 0&&this.text(b)};ia.extend(ia.Widget,ia.Button);ia.Button.prototype.text=function(a){this.container.html(a)};ia.Button.prototype.update=function(a){a.text!=void 0&&this.text(a.text);this.onclick(a.href,a.target);this.tooltip(a.tooltip);this.addCssClass(a["css-class"]);this.updateWidget(a)};
ia.MenuButton=function(a,b){ia.MenuButton.baseConstructor.call(this,a,b);this.container.addClass("menuButton")};ia.extend(ia.Button,ia.MenuButton);ia.Text=function(a,b){ia.Text.baseConstructor.call(this,a);this.container=$j("<div>").addClass("ia-widget ia-text").attr("id","ia-widget-"+a);b!=void 0&&this.text(b)};ia.extend(ia.Widget,ia.Text);ia.Text.prototype.text=function(a){this.container.html(a)};
ia.Text.prototype.update=function(a){var b=this;a.text!=""&&this.text(a.text);this.tooltip(a.tooltip);this.addCssClass(a["css-class"]);a.href!=""&&(this.onclick(a.href,a.target),this.addCssClass("ia-link"));$j.each(a.cssProps,function(a,d){b.container.css(a,d)});this.updateWidget(a)};ia.Image=function(a,b){ia.Image.baseConstructor.call(this,a);this.container=$j("<img>").addClass("ia-widget ia-image").attr("id","ia-widget-"+a).attr("src",b)};ia.extend(ia.Widget,ia.Image);
ia.Image.prototype.src=function(a){this.container.attr("src",a)};ia.Image.prototype.update=function(a){a.src!=void 0&&this.src(a.src);this.onclick(a.href,a.target);this.tooltip(a.tooltip);this.addCssClass(a["css-class"]);this.rescale=a.rescale;this.updateWidget(a)};ia.ScrollBox=function(a){this._touchScroll=void 0;this.isScrolling=!1;this.container=a;var b=this;this.container.resize(function(){b._resize()})};ia.ScrollBox.prototype._resize=function(){this._touchScroll!=null&&this._touchScroll.refresh()};
ia.ScrollBox.prototype.scrollToElement=function(a){this._touchScroll!=null&&this._touchScroll.scrollToElement(a,300)};
ia.ScrollBox.prototype.refresh=function(){var a=this;if(ia.IS_TOUCH_DEVICE&&document.getElementById(a.container.attr("id"))!=null){if(a._touchScroll!=null)a._touchScroll.destroy(),a._touchScroll=null;a._touchScroll=new iScroll(a.container.attr("id"),{hideScrollbar:!0,scrollbarClass:"touchScrollbar",onScrollMove:function(){a.isScrolling=!0},onScrollEnd:function(){a.isScrolling=!1},onTouchEnd:function(){a.isScrolling=!1}})}};
ia.DataExplorer=function(a,b){this.id=a;this._data=void 0;this._treeId="";this.closeBranchesOnSelection=!0;this.container=$j("<div id='"+a+"' class='ia-explorer'>");this.$sb=$j("<div id='"+a+"-scrollbox' class='ia-explorer-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$sb);this.container.append(this.$sb);this.$sb.bind(ia.CLICK_TYPE,function(a){a.stopPropagation()});this.$tree=$j("<div class='ia-explorer-tree'>");this.$sb.append(this.$tree);if(b)this.callbackFunction=b;var c=this;this.container.resize(function(){c._size()})};
ia.DataExplorer.prototype.closeBranchesOnSelection=!1;ia.DataExplorer.prototype._size=function(){this.$sb.height(this.container.height());this.$sb.width(this.container.width())};ia.DataExplorer.prototype.data=function(a){if(a!=void 0)this._data=a;else return this._data};ia.DataExplorer.prototype.refresh=function(){this._treeId!=""&&this.build(this._treeId)};
ia.DataExplorer.prototype.build=function(a){this._treeId=a;if(this._treeId==void 0)this._treeId="topLevel";this.$tree.empty();for(var a=this._data[this._treeId],b=a.children.length,c=0;c<b;c++)this._buildItem(a.children[c],this.$tree);this._scrollBox.refresh()};
ia.DataExplorer.prototype._buildItem=function(a,b){var c=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),d=this._data[a],e=$j("<div id='"+c+"' class='ia-explorer-item ia-list-item'>");b.append(e);c=$j("<div class='ia-explorer-label'>").html(d.label);e.append(c);var f=this;if(d.type=="branch"){e.addClass("ia-explorer-branch-icon");e.addClass("ia-explorer-branch");c=$j("<div class='ia-explorer-group'>");c.hide();b.append(c);e.data("childGroup",c);(function(){ia.IS_TOUCH_DEVICE?e.bind(ia.CLICK_TYPE,
function(a){f._scrollBox.isScrolling||(a.stopPropagation(),a.preventDefault(),f._toggleBranch(e))}):e.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();f._toggleBranch(e)})})();for(var g=d.children.length,h=0;h<g;h++)f._buildItem(d.children[h],c)}else{e.addClass("ia-explorer-leaf");if(d.href!=void 0){var k=$j("<div class='ia-explorer-notes-icon'>");e.prepend(k);(function(){var a=d.href;ia.IS_TOUCH_DEVICE?k.bind(ia.CLICK_TYPE,function(b){f._scrollBox.isScrolling||(b.stopPropagation(),b.preventDefault(),
ia.callFunction(a,"_blank"))}):k.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();ia.callFunction(a,"_blank")})})()}(function(){ia.IS_TOUCH_DEVICE?e.bind(ia.CLICK_TYPE,function(a){f._scrollBox.isScrolling||(a.stopPropagation(),a.preventDefault(),f._selectLeaf(e))}):e.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();f._selectLeaf(e)})})()}};ia.DataExplorer.prototype.clearSelection=function(){this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item");this.isFilterExplorer&&this.$tree.find(".ia-explorer-leaf").removeClass("ia-filter-explorer-selected-item")};
ia.DataExplorer.prototype.showItem=function(a){var b=this.$tree.find("div[id='"+String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#")+"']");b&&(b.hasClass("ia-explorer-branch")?this._openBranch(b):b.hasClass("ia-explorer-leaf")&&(this.$tree.find(".ia-explorer-leaf").removeClass("ia-explorer-selected-item"),b.addClass("ia-explorer-selected-item")),this._data[a]&&this._data[a].parent&&this.showItem(this._data[a].parent))};
ia.DataExplorer.prototype._selectLeaf=function(a){var b=a.attr("id");this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item");a.addClass("ia-explorer-selected-item");this.isFilterExplorer&&(a.hasClass("ia-filter-explorer-selected-item")?(b="clearFilter",a.removeClass("ia-filter-explorer-selected-item")):(this.$tree.find(".ia-explorer-leaf").removeClass("ia-filter-explorer-selected-item"),a.addClass("ia-filter-explorer-selected-item")));a=String(b).replace(/#quote#/g,"'").replace(/#double-quote#/g,
'"');this.callbackFunction&&this.callbackFunction.call(null,a)};ia.DataExplorer.prototype._toggleBranch=function(a){a.hasClass("ia-explorer-branch")&&(this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item"),a.data("childGroup").is(":visible")?this._closeBranch(a):(a.addClass("ia-explorer-selected-item"),this._openBranch(a)))};
ia.DataExplorer.prototype._closeBranch=function(a){if(a.hasClass("ia-explorer-branch")){a.addClass("ia-explorer-branch-icon");a.removeClass("ia-explorer-branch-expanded-icon");var b=this;a.data("childGroup").slideUp("fast",function(){b._size()})}};
ia.DataExplorer.prototype._openBranch=function(a){if(a.hasClass("ia-explorer-branch")){this.closeBranchesOnSelection&&a.siblings(".ia-explorer-branch-expanded-icon").each(function(){$j(this).addClass("ia-explorer-branch-icon");$j(this).removeClass("ia-explorer-branch-expanded-icon");$j(this).data("childGroup").slideToggle("fast",function(){})});a.removeClass("ia-explorer-branch-icon");a.addClass("ia-explorer-branch-expanded-icon");var b=this;a.data("childGroup").slideDown("fast",function(){b._size()})}};
ia.Table=function(a){ia.Table.baseConstructor.call(this);this.id=a;this._sDirection=this._cId=this._data=void 0;this._selectedRows={};this._scrollTimeout=void 0;this._highlightRows={};this._stickyIds=[];this.allowUserSorting=this.showLegendColor=!0;this.container=$j("<div id='"+a+"' class='ia-table'>");this._containerId=a+"-";this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.$tableCorner=$j("<span class='ia-table-header ia-table-header-corner'>");
this.$tableCorner.css("border-top-right-radius",this._borderRadius+"px");this.container.append(this.$tableCorner);this.$tableHeaders=$j("<table>");this.container.append(this.$tableHeaders);this.$tableContainer=$j("<div id='"+a+"-container' class='ia-table-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$table=$j("<table>");this.$tableContainer.append(this.$table);this._addMouseEvents();var b,c=this;this.container.resize(function(){clearTimeout(b);
b=setTimeout(function(){clearTimeout(b);c._size()},500)})};ia.extend(ia.EventDispatcher,ia.Table);ia.Table.prototype._size=function(){var a=this.container.width(),b=this.$tableContainer.get(0).offsetWidth-this.$tableContainer.get(0).clientWidth;a-=b;this.$table.width(a);this.$tableHeaders.width(a);var a=this.container.height(),c=this.$tableHeaders.outerHeight();this.$tableContainer.height(a-c);this.$tableCorner.width(b);this.$tableCorner.height(c)};ia.Table.prototype.getData=function(){return this._data};
ia.Table.prototype.setData=function(a){this._data=a};
ia.Table.prototype.render=function(){var a=this;this.$table.empty();this.$tableHeaders.empty();var b=$j("<thead>"),c=$j("<tr>");b.append(c);this.$tableHeaders.append(b);for(var d=!1,e,f=this.columns.length,g=0;g<f;g++){e=this.columns[g];var h=e.width*110,k=$j("<th id='"+e.id+"' class='ia-table-header' style='width:"+h+"%'>").html(e.label);k.data("type",e.type);e.label!=""&&(d=!0);g==0&&k.css("border-top-left-radius",this._borderRadius+"px");c.append(k);this.allowUserSorting&&function(){var b=e.id;
k.click(function(){var c="ascending";$j(this).is(".sort-asc")&&(c="descending");a.sort(b,c)})}()}d==!1&&b.css("display","none");var b=[],g=-1,d=0,i,l;b[++g]="<tbody>";for(id in this._data){c=this._data[id];h=String(id).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#");d%2==0?b[++g]="<tr id='"+this._containerId+h+"' class='ia-table-row ia-table-row-even'>":b[++g]="<tr id='"+this._containerId+h+"' class='ia-table-row ia-table-row-odd'>";d++;var j=void 0,m=0;if(c.color&&this.showLegendColor)j=ia.Color.toRGBA(c.color,
1),m=c.symbolSize;for(var n=0;n<f;n++)e=this.columns[n],e.id.indexOf("~")!=-1?(h=e.id.split("~")[0],l=e.id.split("~")[1],i=this["data"+l][id][h],l=this["data"+l][id][h+"_formatted"]):(i=c[e.id],l=c[e.formattedId]),h=e.width*110,e.type=="categoric"?b[++g]="<td class='ia-table-cell ia-table-cell-categoric' data-value='"+l+"'  style='width:"+h+"%'>":b[++g]="<td class='ia-table-cell ia-table-cell-numeric' data-value='"+i+"'  style='width:"+h+"%'>",j&&e.id=="name"&&m>0&&(b[++g]="<span class='ia-table-legend-swatch' style='background-color:"+
j+";'></span>"),c.href&&e.id=="name"&&(b[++g]="<span id='"+c.href+"' class='ia-table-notes-icon'></span>"),b[++g]=l,b[++g]="</td>";b[++g]="</tr>"}b[++g]="</tbody>";this.$table.append(b.join(""));this._scrollBox.refresh();this._size();this._cId!=void 0&&this.sort(this._cId,this._sDirection);this.renderSelection()};
ia.Table.prototype.exportData=function(a){for(var b=this.columns.length,c=[],d=-1,e,f,g,h=0;h<b;h++){var k=this.columns[h];h>0&&(c[++d]=",");c[++d]='"'+k.label+'"'}c[++d]="\n";if(Object.keys(this._selectedRows).length>0)for(id in this._selectedRows){var i=String(id).replace(/#quote#/g,"'").replace(/#double-quote#/g,'"');e=this._data[i];for(h=0;h<b;h++)k=this.columns[h],k.id.indexOf("~")!=-1?(g=k.id.split("~")[0],k=k.id.split("~")[1],f=this["data"+k][i][g],g=this["data"+k][i][g+"_formatted"]):(f=e[k.id],
g=e[k.formattedId]),h>0&&(c[++d]=","),ia.isNumber(f)?c[++d]=g:c[++d]='"'+g+'"';c[++d]="\n"}else for(i in this._data){e=this._data[i];for(h=0;h<b;h++)k=this.columns[h],k.id.indexOf("~")!=-1?(g=k.id.split("~")[0],k=k.id.split("~")[1],f=this["data"+k][i][g],g=this["data"+k][i][g+"_formatted"]):(f=e[k.id],g=e[k.formattedId]),h>0&&(c[++d]=","),ia.isNumber(f)?c[++d]=g:c[++d]='"'+g+'"';c[++d]="\n"}b=c.join("");a!=void 0?(a='<div style="font-family:Verdana;font-size:12px;color:#888888;">'+a+"</div>",a+='<p><textarea rows="25" cols="60">'+
b+"</textarea></p>"):a='<textarea rows="25" cols="60">'+b+"</textarea>";window.open().document.write(a)};ia.Table.prototype.renderSelection=function(){for(var a in this._selectedRows){var b=$j("[id='"+this._containerId+a+"']");b.addClass("ia-table-row-select");var c=ia.Color.adjustSV(this.selectionColor,30,100);b.css("background-color",c)}};
ia.Table.prototype._addMouseEvents=function(){var a=this;ia.IS_TOUCH_DEVICE?a.$table.delegate("tr","touchend",function(){if(!a._scrollBox.isScrolling){var b=$j(this).attr("id").substring(a._containerId.length);$j(this).hasClass("ia-table-row-select")?($j(this).removeClass("ia-table-row-select"),delete a._selectedRows[b],a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),b=""):($j(this).addClass("ia-table-row-select"),a._selectedRows[b]=b,a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,
ia.ItemLayer.SELECTED),b=ia.Color.adjustSV(a.selectionColor,30,100));$j(this).css("background-color",b)}}):(this.$table.delegate("tr","mouseover",function(){var b=$j(this).attr("id").substring(a._containerId.length);a._highlightRows[b]=$j(this);if($j(this).hasClass("ia-table-row-select")){$j(this).addClass("ia-table-row-highlight-select");var c=ia.Color.adjustSV(a.selectionColor,40,100)}else $j(this).addClass("ia-table-row-highlight"),c=ia.Color.adjustSV(a.highlightColor,20,100);$j(this).css("background-color",
c);a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OVER,ia.ItemLayer.ROLLOVER)}),this.$table.delegate("tr","mouseout",function(){var b=$j(this).attr("id").substring(a._containerId.length);delete a._highlightRows[b];$j(this).removeClass("ia-table-row-highlight");$j(this).hasClass("ia-table-row-highlight-select")?($j(this).removeClass("ia-table-row-highlight-select").addClass("ia-table-row-select"),a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.SELECTED),b=ia.Color.adjustSV(a.selectionColor,
30,100)):(a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.UNSELECTED),b="");$j(this).css("background-color",b)}),this.$table.delegate("tr",ia.CLICK_TYPE,function(){var b=$j(this).attr("id").substring(a._containerId.length);$j(this).hasClass("ia-table-row-highlight-select")?($j(this).removeClass("ia-table-row-highlight-select").removeClass("ia-table-row-select").addClass("ia-table-row-highlight"),delete a._selectedRows[b],a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),
b=ia.Color.adjustSV(a.highlightColor,20,100)):($j(this).removeClass("ia-table-row-highlight").addClass("ia-table-row-highlight-select"),a._selectedRows[b]=b,a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.SELECTED),b=ia.Color.adjustSV(a.selectionColor,40,100));$j(this).css("background-color",b)}));this.$table.delegate("span.ia-table-notes-icon",ia.CLICK_TYPE,function(a){a.stopPropagation();a=$j(this).attr("id");window.open(a,"_blank")});this.$table.delegate("span.ia-table-notes-icon",
"mouseover touchstart",function(a){a.stopPropagation()})};
ia.Table.prototype.sort=function(a,b){var c=this._getColumnIndex(a);if(c!=-1){this._cId=a;this._sDirection=b;b!=void 0&&(b=b.toLowerCase());var d=1;b=="descending"&&(d=-1);var e=this.$tableHeaders.find("th:eq("+c+")");this.$tableHeaders.find("th").removeClass("sort-asc").removeClass("sort-desc");var f;d==1?(e.addClass("sort-asc"),f=Infinity):(e.addClass("sort-desc"),f=-Infinity);var g;g=e.data("type")=="categoric"?function(a){return a.toUpperCase()}:function(a){a=parseFloat(a);return isNaN(a)?f:a};
for(var e=[],h=this.$table.find("tbody > tr").get(),k,i=h.length,l=0;l<i;l++)k=$j(h[l].childNodes[c]).attr("data-value"),h[l].sortKey=g(k);c=Object.prototype.toString;Object.prototype.toString=function(){return this.key};h.sort(function(a,b){return a.sortKey<b.sortKey?-d:a.sortKey>b.sortKey?d:0});Object.prototype.toString=c;for(l=0;l<i;l++)e.push(h[l]),h[l].sortKey=null;this.$table.children("tbody").append(e);this.$table.find("tbody > tr.ia-table-row:odd").removeClass("ia-table-row-even").addClass("ia-table-row-odd");
this.$table.find("tbody > tr.ia-table-row:even").removeClass("ia-table-row-odd").addClass("ia-table-row-even");this.promoteToTop(this._stickyIds)}};ia.Table.prototype.stickToTop=function(a){this._stickyIds=a.concat();this.promoteToTop(this._stickyIds)};ia.Table.prototype.promoteToTop=function(a){for(var b=a.length-1;b>=0;b--){var c=$j("tr[id='"+this._containerId+a[b]+"']");c&&this.$table.prepend(c)}};
ia.Table.prototype.selectText=function(){var a=this.container.get(0),b=document.body;b.createTextRange?(b=b.createTextRange(),b.moveToElementText(a),b.select()):document.createRange&&window.getSelection&&(sel=window.getSelection(),sel.removeAllRanges(),b=document.createRange(),b.selectNodeContents(a),sel.addRange(b))};
ia.Table.prototype._dispatchItemEvent=function(a,b,c){var a=String(a).replace(/#quote#/g,"'").replace(/#double-quote#/g,'"'),d={};d.id=a;d.state=c;d.parent=this;this.dispatchEvent(new ia.ItemEvent(b,d))};ia.Table.prototype._getColumnIndex=function(a){for(var b=-1,c=0;c<this.columns.length;c++)if(this.columns[c].id==a){b=c;break}return b};
ia.Table.prototype.select=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");b.addClass("ia-table-row-select");this._selectedRows[a]=a;a=ia.Color.adjustSV(this.selectionColor,30,100);b.css("background-color",a);clearTimeout(this._scrollTimeout);var c=this;this._scrollTimeout=setTimeout(function(){clearTimeout(c._scrollTimeout);c._scrollIntoView(b)},500)};
ia.Table.prototype._scrollIntoView=function(a){var b=a.get(0);if(b!=void 0)if(ia.IS_TOUCH_DEVICE)this._scrollBox.scrollToElement(b);else{var c=this.$tableContainer.scrollTop(),d=c+this.$tableContainer.height(),b=b.offsetTop;(b+a.height()>d||b<c)&&this.$tableContainer.scrollTop(b)}};
ia.Table.prototype.unselect=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");b.removeClass("ia-table-row-select");delete this._selectedRows[a];b.css("background-color","")};ia.Table.prototype.clearSelection=function(){for(var a in this._selectedRows)this.unselect(a)};
ia.Table.prototype.highlight=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");if(b.hasClass("ia-table-row-select")){b.addClass("ia-table-row-highlight-select");var c=ia.Color.adjustSV(this.selectionColor,40,100)}else b.addClass("ia-table-row-highlight"),c=ia.Color.adjustSV(this.highlightColor,20,100);b.css("background-color",c);this._highlightRows[a]=b};
ia.Table.prototype.clearHighlight=function(){for(var a in this._highlightRows){var b=this._highlightRows[a];b.removeClass("ia-table-row-highlight").removeClass("ia-table-row-highlight-select");delete this._highlightRows[a];var c=b.hasClass("ia-table-row-select")?ia.Color.adjustSV(this.selectionColor,30,100):"";b.css("background-color",c)}};ia.ComparisonTable=function(a){ia.ComparisonTable.baseConstructor.call(this,a)};ia.extend(ia.Table,ia.ComparisonTable);
ia.ComparisonTable.prototype.clearSelection=function(){};ia.LayerList=function(a){ia.LayerList.baseConstructor.call(this);this.id=a;this.container=$j("<div id='"+a+"' class='ia-layer-list'>");this.$tableContainer=$j("<div id='"+a+"-container' class='ia-layer-list-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$tableList=$j("<table class='ia-layer-list-table'>");this.$tableContainer.append(this.$tableList);var b=this;this.container.resize(function(){b._size()})};
ia.extend(ia.EventDispatcher,ia.LayerList);ia.LayerList.prototype._size=function(){this.$tableContainer.height(this.container.height());this.$tableContainer.width(this.container.width())};
ia.LayerList.prototype.render=function(){function a(){b._buildLayerItem(b.mapData.baseLayer,!0);var a=$j("<tr>");b.$tableList.append(a);var c=$j("<td colspan='2' class='ia-layer-list-legend-td'>");a.append(c);b.gradientLegend&&(c.append(b.gradientLegend.container),b.gradientLegend.container.resize(function(){b._size()}));if(b.discreteLegend)c.append(b.discreteLegend.container),b.discreteLegend.scrollBox=b._scrollBox,b.discreteLegend.container.resize(function(){b._size()})}var b=this;this.$tableList.empty();
if(this.mapData)if(this.mapData.maintainLayerOrder)for(var c=this.mapData.layers.length,d=0;d<c;d++){var e=this.mapData.layers[d];e.id==this.mapData.baseLayer.id?a():this._buildLayerItem(e)}else{a();c=this.mapData.noneBaseLayers.length;for(d=c-1;d>=0;d--)e=this.mapData.noneBaseLayers[d],this._buildLayerItem(e)}this._scrollBox.refresh()};
ia.LayerList.prototype._buildLayerItem=function(a,b){if(a.showInLayerList){var c=this;a.addEventListener(ia.Event.LAYER_VISIBLE_CHANGED,this._layerEventHandler.bind(this));var d=$j("<tr id='"+this.id+"_"+a.id+"' class='ia-list-item'>");this.$tableList.append(d);if(!b&&a.geometry!="image"){var e=$j("<td class='ia-legend-item' style='text-align:center'>");d.append(e);if(a.iconPath!=""){var f=$j("<img>").attr("src",a.iconPath);e.append(f)}else{var g=a.style.lineWidth,f=a.symbolSize+g*2,g=a.symbolSize+
g*2,h=$j("<div class='ia-legend-symbol' style='width:"+f+";height:"+g+";'>");e.append(h);var k=document.createElement("canvas");k.width=f;k.height=g;h.append($j(k));this._drawSymbol(k,a)}}e=$j("<td style='width:100%' id='"+a.id+"' class='ia-layer-list-item ia-layer-list-item-unchecked'>");(b||a.geometry=="image")&&e.attr("colspan",2);e.html(a.name);d.append(e);a.getVisible()==!0&&e.addClass("ia-layer-list-item-checked");(function(){var b=e;d.bind(ia.CLICK_TYPE,function(d){c._scrollBox.isScrolling||
(d.preventDefault(),b.hasClass("ia-layer-list-item-checked")?(b.removeClass("ia-layer-list-item-checked"),a.setVisible(!1)):(b.addClass("ia-layer-list-item-checked"),a.setVisible(!0),a.isLoaded||a.loadSource()))})})()}};ia.LayerList.prototype.showLayer=function(a){this.$tableList.find("tr[id='"+this.id+"_"+a+"']").show()};ia.LayerList.prototype.hideLayer=function(a){this.$tableList.find("tr[id='"+this.id+"_"+a+"']").hide()};ia.LayerList.prototype.clickFunction=function(){};
ia.LayerList.prototype._drawSymbol=function(a,b){var c=a.getContext("2d"),d=b.style,e;for(e in d)c[e]=d[e];if(b.geometry=="line")c.beginPath(),ia.Shape.draw(ia.Shape.LINE,c,a.width/2,a.height/2,b.symbolSize);else{c.beginPath();d=ia.Shape.SQUARE;if(b.geometry=="point")d=ia.Shape.CIRCLE;ia.Shape.draw(d,c,a.width/2,a.height/2,b.symbolSize);c.fill()}c.stroke()};
ia.LayerList.prototype._layerEventHandler=function(a){if(a.type==ia.Event.LAYER_VISIBLE_CHANGED)a=a.object,a.getVisible()?this.$tableList.find("#"+a.id).addClass("ia-layer-list-item-checked"):this.$tableList.find("#"+a.id).removeClass("ia-layer-list-item-checked")};
ia.DiscreteLegend=function(a){ia.DiscreteLegend.baseConstructor.call(this);this.id=a;this.container=$j("<div id='"+a+"' class='ia-legend'>");this.$table=$j("<table class='ia-legend-table'>");this.container.append(this.$table);this.style={fillStyle:"#EFEFEF",strokeStyle:"#cccccc",lineWidth:"0.5",lineJoin:"miter"};this.interactive=this.isLegendComponent=!0;this.layout="vertical";this.thematic=new ia.Thematic;this._touchStart=0};ia.extend(ia.EventDispatcher,ia.DiscreteLegend);
ia.DiscreteLegend.prototype.render=function(){this.renderLegend(this.thematic.getClasses())};ia.DiscreteLegend.prototype.renderNumeric=function(){this.renderLegend(this.thematic.numericClassifier.getClasses())};ia.DiscreteLegend.prototype.renderCategoric=function(){this.renderLegend(this.thematic.categoricClassifier.getClasses())};
ia.DiscreteLegend.prototype.renderLegend=function(a){this.$table.empty();var b;this.layout=="horizontal"&&(this.container.hasClass("ia-legend-horizontal")||this.container.addClass("ia-legend-horizontal"),this.$table.css("height","100%"),this.$table.css("width","auto"),this.container.css("width","auto"),b=$j("<tr>"),this.$table.append(b));for(var c=0;c<a.length;c++){var d=a[c];this.layout=="vertical"&&(b=$j("<tr>"),this.$table.append(b));d.size==0&&b.css("display","none");var e=$j("<td class='ia-legend-item'>");
this.interactive&&e.addClass("ia-legend-item-interactive");b.append(e);var f=this.style.lineWidth,g=d.size+f*2;d.symbol==ia.Shape.LINE&&(g=30);var f=d.size+f*2,h=$j("<div class='ia-legend-symbol' style='width:"+g+";height:"+f+";'>");e.append(h);e=document.createElement("canvas");e.width=g;e.height=f;h.append($j(e));var g=e.getContext("2d"),k;for(k in this.style)g[k]=this.style[k];g.lineJoin="miter";g.fillStyle=d.color;d.symbol==ia.Shape.LINE?(g.strokeStyle=d.color,g.lineWidth=d.size,g.beginPath(),
ia.Shape.draw(d.symbol,g,e.width/2,e.height/2,e.width)):(g.beginPath(),ia.Shape.draw(d.symbol,g,e.width/2,e.height/2,d.size+0.5),g.fill());g.stroke();d=$j("<td class='ia-legend-item ia-legend-label'>").html(d.getLabel());this.interactive&&d.addClass("ia-legend-item-interactive");this.layout=="horizontal"&&(d.css("white-space","nowrap"),d.css("width","auto"));b.append(d);this.interactive&&this._addMouseEvents(b)}};
ia.DiscreteLegend.prototype._addMouseEvents=function(a){var b=this;ia.IS_TOUCH_DEVICE||a.hover(function(){var a=b.$table.find("tbody > tr").index($j(this));if($j(this).hasClass("ia-legend-select")){$j(this).addClass("ia-legend-highlight-select");var d=ia.Color.adjustSV(b.selectionColor,40,100);b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OVER,ia.ItemLayer.ROLLOVER_SELECTED)}else $j(this).addClass("ia-legend-highlight"),d=ia.Color.adjustSV(b.highlightColor,20,100),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OVER,
ia.ItemLayer.ROLLOVER);$j(this).css("background-color",d)},function(){var a=b.$table.find("tbody > tr").index($j(this));$j(this).removeClass("ia-legend-highlight");if($j(this).hasClass("ia-legend-highlight-select")){$j(this).removeClass("ia-legend-highlight-select");$j(this).addClass("ia-legend-select");var d=ia.Color.adjustSV(b.selectionColor,30,100);b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.SELECTED)}else d="",b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.UNSELECTED);
$j(this).css("background-color",d)});ia.IS_TOUCH_DEVICE&&a.bind("touchstart",function(){b._touchStart=(new Date).getTime()});a.bind(ia.CLICK_TYPE,function(){var a=b.$table.find("tbody > tr").index($j(this));ia.IS_TOUCH_DEVICE?(new Date).getTime()-b._touchStart<500&&b.scrollBox&&!b.scrollBox.isScrolling&&($j(this).hasClass("ia-legend-select")?($j(this).removeClass("ia-legend-select"),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),a=""):($j(this).addClass("ia-legend-select"),
b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.SELECTED),a=ia.Color.adjustSV(b.selectionColor,40,100)),$j(this).css("background-color",a)):($j(this).hasClass("ia-legend-highlight-select")?($j(this).removeClass("ia-legend-highlight-select").removeClass("ia-legend-select").addClass("ia-legend-highlight"),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),a=ia.Color.adjustSV(b.highlightColor,20,100)):($j(this).removeClass("ia-legend-highlight").addClass("ia-legend-highlight-select"),
b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.SELECTED),a=ia.Color.adjustSV(b.selectionColor,40,100)),$j(this).css("background-color",a))})};ia.DiscreteLegend.prototype._dispatchItemEvent=function(a,b,c){var d={};d.id=a;d.parent=this;d.state=c;d.legendClass=this.thematic.getClasses()[a];this.dispatchEvent(new ia.ItemEvent(b,d))};
ia.DiscreteLegend.prototype.select=function(a){a=this.$table.find("tr:eq("+a+")");a!=void 0&&(a.removeClass("ia-legend-highlight").addClass("ia-legend-select"),a.css("background-color",ia.Color.adjustSV(this.selectionColor,40,100)))};ia.DiscreteLegend.prototype.unselect=function(a){a=this.$table.find("tr:eq("+a+")");a!=void 0&&(a.removeClass("ia-legend-highlight-select").removeClass("ia-legend-select").addClass("ia-legend-highlight"),a.css("background-color",""))};
ia.DiscreteLegend.prototype.clearSelection=function(){this.$table.find("tbody > tr").removeClass("ia-legend-select").css("background-color","")};ia.DiscreteLegend.prototype.highlight=function(a){a=this.$table.find("tr:eq("+a+")");if(a.hasClass("ia-legend-select")){a.addClass("ia-legend-highlight-select");var b=ia.Color.adjustSV(this.selectionColor,40,100)}else a.addClass("ia-legend-highlight"),b=ia.Color.adjustSV(this.highlightColor,20,100);a.css("background-color",b)};
ia.DiscreteLegend.prototype.clearHighlight=function(){var a=this.$table.find("tbody > tr");a.removeClass("ia-legend-highlight").removeClass("ia-legend-highlight-select");var b=this;a.each(function(){var a=$j(this).hasClass("ia-legend-select")?ia.Color.adjustSV(b.selectionColor,30,100):"";$j(this).css("background-color",a)})};ia.DiscreteLegend.prototype.hide=function(){};ia.DiscreteLegend.prototype.show=function(){};
ia.GradientLegend=function(a){ia.GradientLegend.baseConstructor.call(this);this.id=a;this._context=this._canvas=this._maxLabel=this._minLabel=this._maxValue=this._minValue=void 0;this.container=$j("<div id='"+a+"' class='ia-legend'>");this.$table=$j("<table>");this.container.append(this.$table);this.style={fillStyle:"#EFEFEF",strokeStyle:"#cccccc",lineWidth:"1",lineJoin:"miter"}};ia.extend(ia.EventDispatcher,ia.GradientLegend);
ia.GradientLegend.prototype.render=function(){if(this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE)this._build(20,120),this._renderBlock();else{var a=Math.max(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize);this._build(a+10,a+10);this._renderPoint()}};
ia.GradientLegend.prototype._build=function(a,b){this.$table.empty();var c=this.thematic.numericClassifier.getBreaks();this._minValue=c[0];this._maxValue=c[c.length-1];var d;this.thematic.numericClassifier.sizePalette.maxSize>=this.thematic.numericClassifier.sizePalette.minSize?(c=this.thematic.numericClassifier.formatter.format(this._minValue),d=this.thematic.numericClassifier.formatter.format(this._maxValue)):(c=this.thematic.numericClassifier.formatter.format(this._maxValue),d=this.thematic.numericClassifier.formatter.format(this._minValue));
var e=$j("<tr>");this._maxLabel=$j("<td class='ia-legend-item ia-legend-label ia-gradient-legend-label'>");this._maxLabel.html(d);e.append(this._maxLabel);this.$table.append(e);e=$j("<tr>");d=$j("<td class='ia-legend-item'>");e.append(d);this.$table.append(e);e=$j("<div class='ia-legend-symbol' style='width:"+a+";height:"+b+";'>");d.append(e);this._canvas=document.createElement("canvas");this._canvas.width=a;this._canvas.height=b;e.append($j(this._canvas));this._context=this._canvas.getContext("2d");
e=$j("<tr>");this._minLabel=$j("<td class='ia-legend-item ia-legend-label ia-gradient-legend-label'>");this._minLabel.html(c);e.append(this._minLabel);this.$table.append(e)};
ia.GradientLegend.prototype._renderBlock=function(){if(this._context){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);this._context.strokeStyle=this.style.strokeStyle;this._context.lineWidth=this.style.lineWidth;var a=this.thematic.numericClassifier.colorPalette.getColorList();this._context.beginPath();ia.Shape.drawGradient(this._canvas,a,"bottomToTop");this._context.fill();this._context.stroke()}};
ia.GradientLegend.prototype._renderPoint=function(){if(this._context){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var a=Math.min(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize),b=Math.max(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize),c=this._canvas.width/2,d=this._canvas.height/2;this._context.strokeStyle=this.style.strokeStyle;this._context.lineWidth=this.style.lineWidth;
this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,c,d,a);this._context.stroke();this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,c,d,b);this._context.stroke()}};ia.GradientLegend.prototype.highlight=function(a){if(this._context&&this.thematic&&(a=this.thematic.getData()[a])&&a.legendClass)a=a.legendClass.value,this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE?this._highlightBlock(a):this._highlightPoint(a)};
ia.GradientLegend.prototype._highlightBlock=function(a){this._renderBlock();if(ia.isNumber(a))this._context.strokeStyle=this.highlightColor,this._context.lineWidth=3,a=this._canvas.height-(a-this._minValue)/(this._maxValue-this._minValue)*this._canvas.height,this._context.beginPath(),this._context.moveTo(1,a),this._context.lineTo(this._canvas.width-1,a),this._context.stroke()};
ia.GradientLegend.prototype._highlightPoint=function(a){this._renderPoint();if(ia.isNumber(a)&&(a=this.thematic.getClass(a),a!=void 0)){var b=this._canvas.width/2,c=this._canvas.height/2;this._context.fillStyle=a.color;this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,b,c,a.size);this._context.fill()}};ia.GradientLegend.prototype.clearHighlight=function(){this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE?this._renderBlock():this._renderPoint()};
ia.GradientLegend.prototype.select=function(){};ia.GradientLegend.prototype.unselect=function(){};ia.GradientLegend.prototype.clearSelection=function(){};ia.GradientLegend.prototype.hide=function(){this.container.css("display","none")};ia.GradientLegend.prototype.show=function(){this.container.css("display","inline")};
ia.Metadata=function(a){this.container=$j("<div id='"+a+"' class='ia-metadata-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this._textBox=$j("<div class='ia-metadata'>");this.container.append(this._textBox)};ia.Metadata.prototype.setHtml=function(a){if(a!=void 0)if(a.indexOf(".htm")!=-1&&a.indexOf("href=")==-1){var b=this;this._textBox.load(a,function(){b._scrollBox.refresh()})}else this._textBox.html(a),this._scrollBox.refresh()};
ia.HTMLContainer=function(a){this.container=$j("<div id='"+a+"'>")};ia.HTMLContainer.prototype.setHtml=function(a){a!=void 0&&(a.indexOf(".htm")!=-1&&a.indexOf("href=")==-1?this.container.load(a,function(){}):this.container.html(a))};
ia.LegendEditor=function(a,b,c){var d=this;this.showSizePanel=this.showPalettePanel=this.showLegendTools=this.showLegendTypePanel=!0;this._updateTimeout=void 0;this._isVisible=this._lockEditor=!1;this._thematic=a;this._thematic.addEventListener(ia.Event.THEME_CHANGED,function(){d.render()});this._reportConfig=b;this._settings=c;this.container=$j('<div class="ia-editor"></div>');$j("body").bind(ia.CLICK_TYPE,function(){d.hide()});this.container.bind(ia.CLICK_TYPE,function(a){a.stopPropagation()});
d.render()};
ia.LegendEditor.prototype.render=function(){var a=this;this.container.empty();var b=$j("<div>");this.container.append(b);var c=this._thematic.numericClassifier,d=this._thematic.categoricClassifier,e=this._reportConfig.getMapPalette();if(this._thematic.getDataType()==ia.Thematic.CATEGORIC){if(this.showPalettePanel){var f=$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);var g=$j("<tr>");f.append(g);var h=$j("<td>");g.append(h);var k=$j("<table class='ia-editor-color-panel'>");h.append(k);
f=$j("<tr>");k.append(f);for(var k=e.getColorSchemes(),i=0;i<k.length;i++){var l=k[i],h=$j("<td class='ia-list-item'>");f.append(h);(function(){var b=l;h.bind(ia.CLICK_TYPE,function(){d.colorPalette=b;a._settings.schemeId=b.id;a._updateTheme()})})();for(var j=l.getColorList(),m=0;m<j.length;m++){var n=j[m],o=$j("<div class='ia-editor-color-panel-discrete-swatch'>");l.id==d.colorPalette.id&&o.addClass("ia-editor-swatch-selected");o.css({"background-color":n});h.append(o)}}}if(this._thematic.symbol!=
ia.Shape.SQUARE&&this.showSizePanel){this.showPalettePanel&&(f=$j("<div class='ia-editor-separator'>"),b.append(f));var p=5,q=5;this._thematic.symbol==ia.Shape.LINE&&(q=p=1);var r=d.symbolSize,j=$j("<table class='ia-editor-panel ia-editor-size-panel'>");b.append(j);f=$j("<tr>");j.append(f);h=$j("<td class='ia-list-item' style='width:50px'>").html("-");f.append(h);h.bind(ia.CLICK_TYPE,function(){var b=r-p;b<q&&(b=q);d.symbolSize=b;a._updateTheme()});h=$j("<td style='padding:5px'>");f.append(h);j=document.createElement("canvas");
j.width=r+2;if(this._thematic.symbol==ia.Shape.LINE)j.width=100;j.height=r+2;h.append($j(j));m=j.getContext("2d");this._thematic.symbol==ia.Shape.LINE?(m.strokeStyle="#cccccc",m.lineWidth=r,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,j.width)):(m.strokeStyle="#cccccc",m.fillStyle="#f9f9f9",m.lineWidth=1,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,r),m.fill());m.stroke();h=$j("<td class='ia-list-item' style='width:50px'>").html("+");f.append(h);
h.bind(ia.CLICK_TYPE,function(){d.symbolSize=r+p;a._updateTheme()})}}else{j=c.classificationName;k=$j("<table class='ia-editor-panel ia-editor-classifier-panel'>");b.append(k);f=$j("<tr>");k.append(f);if(this.showLegendTypePanel){g=[ia.Thematic.QUANTILE,ia.Thematic.EQUAL_INTERVAL,ia.Thematic.NATURAL,ia.Thematic.CONTINUOUS,ia.Thematic.STANDARD_DEVIATION];k=[this._reportConfig.getProperty("quantile"),this._reportConfig.getProperty("equalInterval"),this._reportConfig.getProperty("natural"),this._reportConfig.getProperty("continuous"),
this._reportConfig.getProperty("standardDeviation")];m=k[g.indexOf(j)];for(i=0;i<g.length;i++){var t=g[i],s=k[i];s!=void 0&&(h=$j("<td class='ia-list-item'>").html(s),s==m&&h.addClass("ia-editor-classifier-selected"),f.append(h),function(){var b=t;h.bind(ia.CLICK_TYPE,function(){a._typeMenuOpen=!1;c.classificationName=b;a._settings.legendType=b;a._updateTheme()})}())}}if(j!=ia.Thematic.CONTINUOUS){if(this.showPalettePanel){this.showLegendTypePanel&&(f=$j("<div class='ia-editor-separator'>"),b.append(f));
f=$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);g=$j("<tr>");f.append(g);h=$j("<td>");g.append(h);k=$j("<table class='ia-editor-color-panel'>");h.append(k);f=$j("<tr>");k.append(f);k=e.getColorPalettes();for(i=0;i<k.length;i++){l=k[i];h=$j("<td class='ia-list-item'>");l.id==c.colorPalette.id&&h.addClass("ia-editor-selected");f.append(h);(function(){var b=l;h.bind(ia.CLICK_TYPE,function(){c.colorPalette=b;a._settings.paletteId=b.id;a._updateTheme()})})();m=c.noClasses;j==
ia.Thematic.STANDARD_DEVIATION&&(m=6);s=l.getInterpolatedColors(m);for(m=0;m<s.length;m++)n=s[m],o=$j("<div class='ia-editor-color-panel-discrete-swatch'>"),l.id==c.colorPalette.id&&o.addClass("ia-editor-swatch-selected"),o.css({"background-color":n}),h.append(o)}this.showLegendTools&&(h=$j("<td>"),g.append(h),k=$j("<table class='ia-editor-tool-panel'>"),h.append(k),f=$j("<tr>"),k.append(f),h=$j("<td class='ia-list-item'>").html("&uArr;&dArr;"),f.append(h),h.bind(ia.CLICK_TYPE,function(){c.colorPalette.getColorList().reverse();
a._updateTheme()}),j!=ia.Thematic.STANDARD_DEVIATION&&(f=$j("<tr>"),k.append(f),h=$j("<td class='ia-list-item'>").html("-"),f.append(h),h.bind(ia.CLICK_TYPE,function(){c.noClasses>e.minNoClasses&&(c.noClasses--,a._updateTheme())}),f=$j("<tr>"),k.append(f),h=$j("<td class='ia-list-item'>").html("+"),f.append(h),h.bind(ia.CLICK_TYPE,function(){c.noClasses<e.maxNoClasses&&(a._thematic.numericClassifier.noClasses++,a._updateTheme())})))}}else if(this.showPalettePanel){this.showLegendTypePanel&&(f=$j("<div class='ia-editor-separator'>"),
b.append(f));f=$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);g=$j("<tr>");f.append(g);h=$j("<td>");g.append(h);k=$j("<table class='ia-editor-color-panel'>");h.append(k);f=$j("<tr>");k.append(f);k=e.getColorPalettes();for(i=0;i<k.length;i++)l=k[i],h=$j("<td class='ia-list-item'>"),f.append(h),function(){var b=l;h.bind(ia.CLICK_TYPE,function(){c.colorPalette=b;a._settings.paletteId=b.id;a._updateTheme()})}(),s=l.getColorList(),j=document.createElement("canvas"),$j(j).addClass("ia-editor-color-panel-continuous-swatch"),
l.id==c.colorPalette.id&&$j(j).addClass("ia-editor-swatch-selected"),h.append($j(j)),m=j.getContext("2d"),m.beginPath(),ia.Shape.drawGradient(j,s,"bottomToTop"),m.fill();this.showLegendTools&&(h=$j("<td>"),g.append(h),k=$j("<table class='ia-editor-tool-panel'>"),h.append(k),f=$j("<tr>"),k.append(f),h=$j("<td class='ia-list-item'>").html("&uArr;&dArr;"),f.append(h),h.bind(ia.CLICK_TYPE,function(){c.colorPalette.getColorList().reverse();a._updateTheme()}))}if(this._thematic.symbol!=ia.Shape.SQUARE&&
this.showSizePanel){if(this.showPalettePanel||this.showLegendTypePanel)f=$j("<div class='ia-editor-separator'>"),b.append(f);q=p=5;this._thematic.symbol==ia.Shape.LINE&&(q=p=1);var u=c.sizePalette,j=c.colorPalette.getColorList(),i=j[0],g=j[j.length-1],j=$j("<table class='ia-editor-panel ia-editor-size-panel'>");b.append(j);b=$j("<tr>");j.append(b);h=$j("<td style='vertical-align:top;width:50px;padding:0px'>");b.append(h);k=$j("<table style='width:100%'>");h.append(k);f=$j("<tr>");k.append(f);h=$j("<td class='ia-list-item'>").html("-");
f.append(h);h.bind(ia.CLICK_TYPE,function(){var b=u.minSize-p;b<q&&(b=q);u.minSize=b;a._updateTheme()});f=$j("<tr>");k.append(f);h=$j("<td class='ia-list-item'>").html("+");f.append(h);h.bind(ia.CLICK_TYPE,function(){u.minSize+=p;a._updateTheme()});h=$j("<td style='padding:5px'>");b.append(h);f=Math.max(u.minSize,u.maxSize)+2;j=document.createElement("canvas");j.width=f;if(this._thematic.symbol==ia.Shape.LINE)j.width=100;j.height=f;h.append($j(j));m=j.getContext("2d");this._thematic.symbol==ia.Shape.LINE?
(m.strokeStyle=i,m.lineWidth=u.minSize,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,j.width)):(m.strokeStyle="#cccccc",m.fillStyle=i,m.lineWidth=1,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,u.minSize),m.fill());m.stroke();h=$j("<td style='padding:5px'>");b.append(h);j=document.createElement("canvas");j.width=f;if(this._thematic.symbol==ia.Shape.LINE)j.width=100;j.height=f;h.append($j(j));m=j.getContext("2d");this._thematic.symbol==ia.Shape.LINE?
(m.strokeStyle=g,m.lineWidth=u.maxSize,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,j.width)):(m.strokeStyle="#cccccc",m.fillStyle=g,m.lineWidth=1,m.beginPath(),ia.Shape.draw(this._thematic.symbol,m,j.width/2,j.height/2,u.maxSize),m.fill());m.stroke();h=$j("<td style='vertical-align:top;width:50px;padding:0px'>");b.append(h);k=$j("<table style='width:100%'>");h.append(k);f=$j("<tr>");k.append(f);h=$j("<td class='ia-list-item'>").html("-");f.append(h);h.bind(ia.CLICK_TYPE,
function(){var b=u.maxSize-p;b<q&&(b=q);u.maxSize=b;a._updateTheme()});f=$j("<tr>");k.append(f);h=$j("<td class='ia-list-item'>").html("+");f.append(h);h.bind(ia.CLICK_TYPE,function(){u.maxSize+=p;a._updateTheme()})}}this._lockEditor=!1};ia.LegendEditor.prototype._updateTheme=function(){if(!this._lockEditor){var a=this;clearTimeout(this._updateTimeout);this._updateTimeout=setTimeout(function(){a._lockEditor=!0;a._thematic.commitChanges()},100)}};
ia.LegendEditor.prototype.toggle=function(){this._isVisible?this.hide():this.show()};ia.LegendEditor.prototype.hide=function(){this._isVisible&&this.container.animate({opacity:0},function(){this.container.css({visibility:"hidden"});this._isVisible=!1})};ia.LegendEditor.prototype.show=function(){this._isVisible||this.container.css({visibility:"visible"}).animate({opacity:1},function(){this._isVisible=!0})};
ia.MapTools=function(a,b,c,d,e){this._filterBtn=this._clearBtn=void 0;this._map=a;this._useGoogleMaps=d;this._includeSearchTool=e;this._searching=!1;this._interactionGroup=c;this._dataGroup=b;this._marker=new Image;this._marker.src="./map_tool_search.png";this.container=$j('<div class="ia-map-toolbar"></div>');c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,this._updateToolbar.bind(this));b.addEventListener(ia.FilterEvent.FILTER_CHANGED,this._updateToolbar.bind(this))};
ia.MapTools.prototype._updateToolbar=function(){this._interactionGroup.getSelection().length>0?(this._clearBtn&&this._clearBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"),this._filterBtn&&this._filterBtn.removeClass("ia-cross-btn ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn-disabled")):(this._clearBtn&&this._clearBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled"),
this._filterBtn&&(this._dataGroup.getFilteredFeatures().length>0?this._filterBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"):this._filterBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled")))};ia.MapTools.prototype.filterFunction=function(){};ia.MapTools.prototype.clearFunction=function(){};
ia.MapTools.prototype.searchFunction=function(a,b){var c=this._map.controller.defaultBBox,c='{"xmin":'+c.getXMin()+',"ymin":'+c.getXMin()+',"xmax":'+c.getXMax()+',"ymax":'+c.getYMax()+',"spatialReference":{"wkid":102100}}';ia.File.load({url:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find?text="+a+"&outSR=102100&bbox="+c+"&maxLocations=4&f=json",dataType:"json",onSuccess:function(a){var c=[];if(a.locations!=void 0)for(var a=a.locations,f=0;f<a.length;f++){var g=a[f],h={};h.name=
g.name;h.location=g.feature.geometry;h.bounds=g.extent;c[c.length]=h}b.call(null,c)}})};
ia.MapTools.prototype.render=function(){this.container.empty();var a=this;if(ia.IS_TOUCH_DEVICE){var b;this.container.bind("touchstart",function(){a.container.stop();a.container.css({visibility:"visible"}).animate({opacity:1});clearTimeout(b);b=setTimeout(function(){clearTimeout(b);a.container.stop();a._searching||a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})})},5E3)});this._map.container.bind("touchstart",function(){a._searching=!1;a.container.stop();a.container.css({visibility:"visible"}).animate({opacity:1});
clearTimeout(b);b=setTimeout(function(){clearTimeout(b);a.container.stop();a._searching||a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})})},5E3)})}else{var c=!1;this._map.container.mouseenter(function(){c||(a.container.stop(),a.container.css({visibility:"visible"}).animate({opacity:1}))});this._map.container.mouseleave(function(){a.container.stop();a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})});c=!1});this.container.mouseenter(function(){c=
!0;a.container.stop();a.container.animate({opacity:1})});this.container.mouseleave(function(){c=!1;a.container.stop();a.container.animate({opacity:1})})}var d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomfull-btn"></div>');this.container.append(d);d.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a._map.controller.zoomFull()});d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomout-btn"></div>');this.container.append(d);d.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();
b.preventDefault();a._useGoogleMaps?a._map.gMap.setZoom(a._map.gMap.getZoom()-1):a._map.controller.zoomOut()});d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomin-btn"></div>');this.container.append(d);d.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a._useGoogleMaps?a._map.gMap.setZoom(a._map.gMap.getZoom()+1):a._map.controller.zoomIn()});var e;this._includeSearchTool&&(e=$j('<div class="ia-toolbar-btn ia-list-item ia-search-btn"></div>'),a.container.append(e));if(this.clearButtonText)a._clearBtn=
$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(a.clearButtonText),a.container.append(a._clearBtn),a._clearBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.clearFunction()});if(this.filterButtonText)this._filterBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.filterButtonText),this.container.append(this._filterBtn),this._filterBtn.bind(ia.CLICK_TYPE,
function(b){b.stopPropagation();b.preventDefault();a.filterFunction()});if(this._includeSearchTool)if(this._useGoogleMaps){var f=$j("<div id='ia-search-holder-"+this._map.id+"' class='ui-widget'>"),g=$j("<input id='ia-search-"+this._map.id+"' class='ia-search-input'>");f.append(g);this.container.append(f);f.hide();var h=!0,k=new google.maps.Geocoder,i;e.bind(ia.CLICK_TYPE,function(b){a._searching=!0;b.stopPropagation();b.preventDefault();f.toggle();h&&(h=!1,g.autocomplete({source:function(b,c){k.geocode({address:b.term,
bounds:a._map.defaultBounds},function(b,d){if(d==google.maps.GeocoderStatus.OK){var e=[],f;for(f in b){var g=b[f];g.geometry.bounds&&a._map.defaultBounds.intersects(g.geometry.bounds)&&(e[e.length]=b[f])}c($j.map(e,function(a){return{label:a.formatted_address,value:a.formatted_address,location:a.geometry.location,bounds:a.geometry.bounds}}))}})},minLength:2,select:function(b,c){a._map.gMap.fitBounds(c.item.bounds);i&&i.setMap(null);i=new google.maps.Marker({map:a._map.gMap,position:c.item.location});
f.toggle()},open:function(){},close:function(){},appendTo:"#ia-search-holder-"+a._map.id+""}));g.focus();g.val([]);g.autocomplete("close")})}else f=$j("<div id='ia-search-holder-"+this._map.id+"' class='ui-widget'>"),g=$j("<input id='ia-search-"+this._map.id+"' class='ia-search-input'>"),f.append(g),this.container.append(f),f.hide(),h=!0,e.bind(ia.CLICK_TYPE,function(b){a._searching=!0;a._map.markerLayer.clearMarkers();b.stopPropagation();b.preventDefault();f.toggle();h&&(h=!1,g.autocomplete({source:function(b,
c){a.searchFunction(b.term,function(a){c($j.map(a,function(a){return{label:a.name,value:a.name,location:a.location,bounds:a.bounds}}))})},minLength:2,select:function(b,c){var d=c.item.bounds,e=c.item.location;d!=void 0?a._map.controller.zoomToBBox(new ia.BoundingBox(d.xmin,d.ymin,d.xmax,d.ymax)):e!=void 0&&a._map.controller.centerOnCoords(e.x,e.y);e!=void 0&&(a._map.markerLayer.clearMarkers(),a._map.markerLayer.addMarker(a._marker,e.x,e.y),a._map.markerLayer.render());f.toggle();a.container.animate({opacity:0},
function(){a.container.css({visibility:"hidden"})})},open:function(){},close:function(){},appendTo:"#ia-search-holder-"+a._map.id+""}));g.focus();g.val([]);g.autocomplete("close")});this._updateToolbar()};
ia.TableTools=function(a,b){this._filterBtn=this._clearBtn=void 0;this._interactionGroup=b;this._dataGroup=a;this._borderRadius=0;this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.container=$j('<div class="ia-table-toolbar"></div>');this.container.css("border-bottom-left-radius",this._borderRadius+"px");this.container.css("border-bottom-right-radius",this._borderRadius+"px");b.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,
this._updateToolbar.bind(this));a.addEventListener(ia.FilterEvent.FILTER_CHANGED,this._updateToolbar.bind(this))};
ia.TableTools.prototype._updateToolbar=function(){this._interactionGroup.getSelection().length>0?(this._clearBtn&&this._clearBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"),this._filterBtn&&this._filterBtn.removeClass("ia-cross-btn ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn-disabled")):(this._clearBtn&&this._clearBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled"),
this._filterBtn&&(this._dataGroup.getFilteredFeatures().length>0?this._filterBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"):this._filterBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled")))};ia.TableTools.prototype.filterFunction=function(){};ia.TableTools.prototype.clearFunction=function(){};
ia.TableTools.prototype.render=function(){this.container.empty();var a=this;if(this.clearButtonText)this._clearBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.clearButtonText),this.container.append(this._clearBtn),this._clearBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.clearFunction()}),this._clearBtn.css("border-radius",this._borderRadius+"px");if(this.filterButtonText)this._filterBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.filterButtonText),
this.container.append(this._filterBtn),this._filterBtn.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();b.preventDefault();a.filterFunction()}),this._filterBtn.css("border-radius",this._borderRadius+"px");this._updateToolbar()};
ia.AdvancedPieComponent=function(a,b){ia.AdvancedPieComponent.baseConstructor.call(this);this.id=a;this.tip="";this._layout=b;this._chartTitle1="";this._layer1=this._chart1=void 0;this._chartTitle2="";this._legend=this._layer2=this._chart2=void 0;this._selectionIds=[];this._scrollContainer=this._scrollBox=void 0;this._multiLayout=!0;this._data=void 0;this._isVisible=!0};ia.extend(ia.EventDispatcher,ia.AdvancedPieComponent);
ia.AdvancedPieComponent.prototype.build=function(){var a=new ia.InteractionGroup;this.container=$j("<div id='"+this.id+"' class='ia-advanced-chart'>");var b=this;this.container.resize(function(){b._size()});this._scrollContainer=$j("<div id='"+this.id+"-scroll-container' class='ia-advanced-chart-scrollbox'>");this._scrollBox=new ia.ScrollBox(this._scrollContainer);this.container.append(this._scrollContainer);this.thematic=new ia.Thematic;this.thematic.setDataType(ia.Thematic.CATEGORIC);this.thematic.setDataField("value");
var c,d,e;this._layout=="vertical"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:90%;height:30%'>"),d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:35%;width:90%;height:30%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:70%;width:90%'>")):this._layout=="horizontal"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:30%;height:80%'>"),
d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:30%;top:0%;width:30%;height:80%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:60%;top:0%;height:80%;width:35%'>")):this._layout=="box"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:50%;height:40%'>"),d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:50%;width:50%;height:40%'>"),
e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:50%;top:0%;width:45%'>")):(this._multiLayout=!1,c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:50%;height:90%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:50%;top:0%;width:45%;'>"));this._scrollContainer.append(c);this._multiLayout&&this._scrollContainer.append(d);this._scrollContainer.append(e);this._chartTitle1=$j("<div>").html("");
c.append(this._chartTitle1);this._chart1=new ia.PieChart(this.id+"-pie-chart-1");this._chart1.container.css("position","relative");c.append(this._chart1.container);this._layer1=new ia.AdvancedPieLayer;this._layer1.thematic=this.thematic;this._layer1.highlightColor=this.highlightColor;this._layer1.selectionColor=this.selectionColor;this._layer1.tip=this.tip;this._layer1.setVisible(!0);this._layer1.interactive=!0;a.addComponent(this._layer1);this._chart1.addLayer(this._layer1);if(this._multiLayout)this._chartTitle2=
$j("<div>"),d.append(this._chartTitle2).html(""),this._chart2=new ia.PieChart(this.id+"-pie-chart-2"),this._chart2.container.css("position","relative"),d.append(this._chart2.container),this._layer2=new ia.AdvancedPieLayer,this._layer2.thematic=this.thematic,this._layer2.highlightColor=this.highlightColor,this._layer2.selectionColor=this.selectionColor,this._layer2.tip=this.tip,this._layer2.setVisible(!0),this._layer2.interactive=!0,a.addComponent(this._layer2),this._chart2.addLayer(this._layer2);
this._legend=new ia.DiscreteLegend(this.id+"-this._legend-discrete");this._legend.thematic=this.thematic;this._legend.highlightColor=this.highlightColor;this._legend.selectionColor=this.selectionColor;a.addComponent(this._legend);e.append(this._legend.container);this._legend.container.resize(function(){b._size()})};ia.AdvancedPieComponent.prototype._size=function(){this._scrollContainer.height(this.container.height());this._scrollContainer.width(this.container.width());this._scrollBox.refresh()};
ia.AdvancedPieComponent.prototype.setData=function(a){this._data=a;this._layer1.setData(a);this._multiLayout&&this._layer2.setData(a)};
ia.AdvancedPieComponent.prototype.highlight=function(a){if(this._multiLayout)if(this._selectionIds.length==1)this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName);else{if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)}else if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)};
ia.AdvancedPieComponent.prototype.clearHighlight=function(){if(this._multiLayout)if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render();else{if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};
ia.AdvancedPieComponent.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._multiLayout?this._selectionIds.length>1?(this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName))};
ia.AdvancedPieComponent.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);if(this._multiLayout)if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render();else{if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=
null,this._layer1.update(),this._layer1.render()};ia.AdvancedPieComponent.prototype.clearSelection=function(){this._selectionIds=[];this._layer1.itemId=null;this._layer1.update();this._layer1.render();this._chartTitle1.html(this.title1);if(this._multiLayout)this._layer2.itemId=null,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this.title2)};
ia.AdvancedPieComponent.prototype.render=function(){this._legend.render();this._layer1.update();this._layer1.render();this._chartTitle1.html()==""&&this._chartTitle1.html(this.title1);this._multiLayout&&(this._layer2.update(),this._layer2.render(),this._chartTitle2.html()==""&&this._chartTitle2.html(this.title2));this._size()};ia.AdvancedPieComponent.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.AdvancedPieComponent.prototype.hide=function(){if(this._isVisible)this._isVisible=!1,this.container.stop(),this.container.animate({opacity:0},function(){})};ia.AdvancedPieComponent.prototype.show=function(){if(!this._isVisible)this._isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};
ia.FeatureLegend=function(a){ia.FeatureLegend.baseConstructor.call(this,a);this._selectionIds=[];this.container.addClass("ia-feature-legend");this._scrollBox=new ia.ScrollBox(this.container);this._renderTimeout=null;this.interactive=this.isLegendComponent=!1;this.colorPalette=new ia.ColorPalette};ia.extend(ia.DiscreteLegend,ia.FeatureLegend);
ia.FeatureLegend.prototype.render=function(){this._renderTimeout=null;for(var a=[],b=this._selectionIds.length,c=this.colorPalette.getColors(b),d=0;d<b;d++){var e=this.geography.getFeature(this._selectionIds[d]);if(e!=void 0)e=new ia.CategoricClass(e.name),e.color=c[d],a[d]=e}this.renderLegend(a);this._scrollBox.refresh()};ia.FeatureLegend.prototype.highlight=function(){};ia.FeatureLegend.prototype.clearHighlight=function(){};
ia.FeatureLegend.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._triggerRender()};ia.FeatureLegend.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);this._triggerRender()};ia.FeatureLegend.prototype.clearSelection=function(){this._selectionIds=[];this._triggerRender()};
ia.FeatureLegend.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};ia.MenuBar=function(a){this.container=$j("<div id='"+a+"' class='ia-menubar'>")};
ia.MenuBar.prototype.render=function(a){this.container.empty();var b=$j("<table class='ia-menubar-table'>");this.container.append(b);var c=$j("<tr>");b.append(c);var b=a.getProperties(),d;for(d in b)if(d.indexOf("menuItem")!=-1){var e=d.substring(8,d.length),f=a.getProperty("menuItem"+e);if(f){$td=$j("<td class='ia-list-item ia-menubar-btn'>").html(f);c.append($td);var g=a.getProperty("menuFunc"+e);g!=void 0&&function(){var a=g;a.indexOf("http")==-1&&a.indexOf("javascript")==-1&&(a=ia.IAS_PATH+a);
$td.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();ia.IS_TOUCH_DEVICE&&b.preventDefault();ia.callFunction(a,"_blank",b)})}()}}};
ia.CalloutBox=function(a,b){this.id=a;this.notchPosition=b||"left-right";this.container=$j('<div id="'+a+'" class="callout"></div>');this._py=this._px=0;this._popup=this._isVisible=!1;this._notchBorder=$j('<div class="callout-notch"></div>');this._notchBorder.addClass("callout-notch-"+this.notchPosition);this.container.append(this._notchBorder);this._notchFill=$j('<div class="callout-notch"></div>');this._notchFill.addClass("callout-notch-"+this.notchPosition);this.container.append(this._notchFill);
this.notchPosition=="none"&&(this._notchBorder.css({display:"none"}),this._notchFill.css({display:"none"}));var c=$j("<div>").addClass("ia-panel-btns").attr("id",a+"-btns");this.container.append(c);if(ia.IS_TOUCH_DEVICE){var d;this.container.bind("touchstart",function(){c.stop();c.css({visibility:"visible"}).animate({opacity:1});clearTimeout(d);d=setTimeout(function(){clearTimeout(d);c.stop();c.animate({opacity:0},function(){c.css({visibility:"hidden"})})},5E3)})}else{var e=!1;this.container.mouseenter(function(){e||
(c.stop(),c.css({visibility:"visible"}).animate({opacity:0.4}))});this.container.mouseleave(function(){c.stop();c.animate({opacity:0},function(){c.css({visibility:"hidden"})})});c.mouseenter(function(){e=!0;c.animate({opacity:1})});c.mouseleave(function(){e=!1;c.stop();c.animate({opacity:0.4})})}var f=this,g=$j("<div>").addClass("ia-panel-btn ia-panel-close-btn").attr("id",a+"-close");g.bind(ia.CLICK_TYPE,function(){f.hide()});c.append(g);var h;this.container.resize(function(){clearTimeout(h);h=setTimeout(function(){clearTimeout(h);
f._isVisible&&f.position()},300)})};
ia.CalloutBox.prototype.position=function(a,b){if(this.container.parent()!=void 0){if(a)a-=this.container.parent().offset().left,this._px=a;if(b)b-=this.container.parent().offset().top,this._py=b;this._notchBorder.removeClass("callout-notch-left callout-notch-right callout-notch-border-left callout-notch-border-right");this._notchFill.removeClass("callout-notch-left callout-notch-right");this._notchBorder.css({left:"",right:"",top:"",bottom:""});this._notchFill.css({left:"",right:"",top:"",bottom:""});
var c=a||this._px,d=b||this._py,e=this.container.parent().width(),f=this.container.parent().height(),g=this.container.outerWidth(),h=this.container.outerHeight(),k=e/2,i=f/2,l,j;this.notchPosition=="left-right"?(l=30,j=Math.min(30,h/2),d-=j):(l=Math.min(30,g/2),j=30,c-=l);this.notchPosition=="left-right"?c<k?(this._notchBorder.hasClass("callout-notch-right")&&(this._notchBorder.removeClass("callout-notch-right callout-notch-border-right"),this._notchFill.removeClass("callout-notch-right")),c+=l,this._notchBorder.addClass("callout-notch-left callout-notch-border-left"),
this._notchFill.addClass("callout-notch-left"),this._notchBorder.css({left:"-11px"}),this._notchFill.css({left:"-10px"})):(this._notchBorder.hasClass("callout-notch-left")&&(this._notchBorder.removeClass("callout-notch-left callout-notch-border-left"),this._notchFill.removeClass("callout-notch-left")),c=c-g-l,this._notchBorder.addClass("callout-notch-right callout-notch-border-right"),this._notchFill.addClass("callout-notch-right"),this._notchBorder.css({right:"-11px"}),this._notchFill.css({right:"-10px"})):
d<i?(this._notchBorder.hasClass("callout-notch-bottom")&&(this._notchBorder.removeClass("callout-notch-bottom callout-notch-border-bottom"),this._notchFill.removeClass("callout-notch-bottom")),d+=j,this._notchBorder.addClass("callout-notch-top callout-notch-border-top"),this._notchFill.addClass("callout-notch-top"),this._notchBorder.css({top:"-11px"}),this._notchFill.css({top:"-10px"})):(this._notchBorder.hasClass("callout-notch-top")&&(this._notchBorder.removeClass("callout-notch-top callout-notch-border-top"),
this._notchFill.removeClass("callout-notch-top")),d=d-h-j,this._notchBorder.addClass("callout-notch-bottom callout-notch-border-bottom"),this._notchFill.addClass("callout-notch-bottom"),this._notchBorder.css({bottom:"-11px"}),this._notchFill.css({bottom:"-10px"}));l=c+g-(e-10);l>0&&(c-=l);c<10&&(c=10);j=d+h-(f-10);j>0&&(d-=j);d<10&&(d=10);this.notchPosition=="left-right"?(e=this._py-d-5,this._notchBorder.css({top:e+"px"}),this._notchFill.css({top:e+"px"})):(e=this._px-c-5,this._notchBorder.css({left:e+
"px"}),this._notchFill.css({left:e+"px"}));this.container.css({left:c+"px",top:d+"px"})}};ia.CalloutBox.prototype.popup=function(a){if(a==!0){this._popup=!0;var b=this;$j("body").bind(ia.CLICK_TYPE,function(){b.hide()});this.container.bind(ia.CLICK_TYPE,function(a){a.stopPropagation()})}else if(a==!1)this._popup=!1;else return this._popup};ia.CalloutBox.prototype.append=function(a){this.container.append(a)};ia.CalloutBox.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.CalloutBox.prototype.hide=function(){this._isVisible=!1;this.container.hide()};ia.CalloutBox.prototype.show=function(){this._isVisible=!0;this.container.fadeIn()};ia.PrintBar=function(a){this._report=a;this._ratio=this._report.container.height()/this._report.container.width();this.container=$j('<div class="ia-print-bar"></div>')};
ia.PrintBar.prototype.render=function(){this.container.empty();var a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-print-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.container.append(a);a.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();a.preventDefault();window.print()});var b=this,a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-minus-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
this.container.append(a);a.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();a.preventDefault();a=b._report.container.width()-10;b._report.container.css({width:a+"px",height:a*b._ratio+"px"})});a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-plus-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.container.append(a);a.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();a.preventDefault();a=b._report.container.width()+10;b._report.container.css({width:a+
"px",height:a*b._ratio+"px"})})};
ia.Profile=function(a,b,c){ia.Profile.baseConstructor.call(this);this.displayMode="Selected date";this.displayDatesInProfile=!1;this.symbols=[];this.targets=[];this.breaks=[];this.id=a;this._useMouseClick=b;this._data=void 0;this._isCollapsed=!1;this._tip=void 0;this._renderTimeout=null;this._featureIds=[];this._collapseIds=[];this.container=$j("<div id='"+a+"' class='ia-table'>");this._containerId=a;this.$tableCorner=$j("<span class='ia-table-header-corner'>");this.container.append(this.$tableCorner);this.$tableHeaders=
$j("<table>");this.container.append(this.$tableHeaders);this.$tableContainer=$j("<div id='"+a+"-container' class='ia-table-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$table=$j("<table>");this.$tableContainer.append(this.$table);this._addMouseEvents();if(c)this.callbackFunction=c;var d,e=this;this.container.resize(function(){clearTimeout(d);d=setTimeout(function(){clearTimeout(d);e._size()},250)})};
ia.extend(ia.EventDispatcher,ia.Profile);ia.Profile.prototype._size=function(){var a=this.container.width(),b=this.$tableContainer.get(0).offsetWidth-this.$tableContainer.get(0).clientWidth;a-=b;this.$table.width(a);this.$tableHeaders.width(a);var a=this.container.height(),c=this.$tableHeaders.outerHeight();this.$tableContainer.height(a-c);this.$tableCorner.css("background-color",$j(".ia-table-header").css("background-color"));this.$tableCorner.width(b);this.$tableCorner.height(c);this._renderCanvasColumns()};
ia.Profile.prototype.expandThemes=function(a){if(this._data){var b=this,c=a.length;this._isCollapsed=!1;this._collapseIds=[];$j.each(this._data.themes,function(d,e){for(var f=!0,g=0;g<c;g++)if(e.id==a[g]){f=!1;b.$table.find("td[id='"+e.id+"']").removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");b.$table.find("tbody[id='"+e.id+"-children']").show();break}if(f==!0)b._collapseIds[b._collapseIds.length]=e.id,b.$table.find("td[id='"+e.id+"']").removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),
b.$table.find("tbody[id='"+e.id+"-children']").hide()})}};
ia.Profile.prototype.toggleTree=function(){if(this._data){var a=this;this._isCollapsed=!this._isCollapsed;this._collapseIds=[];var b=this._data.themes;this._isCollapsed?$j.each(b,function(b,d){a._collapseIds[a._collapseIds.length]=d.id;a.$table.find("td[id='"+d.id+"']").removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand");a.$table.find("tbody[id='"+d.id+"-children']").hide()}):$j.each(b,function(b,d){a.$table.find("td[id='"+d.id+"']").removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");
a.$table.find("tbody[id='"+d.id+"-children']").show()})}};
ia.Profile.prototype.render=function(){this._renderTimeout=null;if(this.displayMode==void 0)this.displayMode="Selected date";this._data=this.displayMode=="Selected date"?this.geography.getProfileData(this._featureIds,this.indicator.date,!0):this.displayMode=="Most recent date"?this.geography.getProfileData(this._featureIds,void 0,!0):this.geography.getProfileData(this._featureIds);this.$table.empty();this.$tableHeaders.empty();var a=$j("<thead>"),b=$j("<tr>");a.append(b);this.$tableHeaders.append(a);
for(var c=this.columns.length,a=0;a<c;a++){var d=this.columns[a],e=d.width*100;if(d.id=="performance"){var f=e*0.15,g=$j("<th id='"+d.id+"' class='ia-table-header' style='width:"+f+"%'>");b.append(g);f=e*0.7;g=$j("<th id='"+d.id+"' class='ia-table-header' style='width:"+f+"%;border-left-width:0px'>");g.html(d.label);b.append(g);f=e*0.15;g=$j("<th id='"+d.id+"' class='ia-table-header' style='width:"+f+"%;border-left-width:0px'>")}else g=$j("<th id='"+d.id+"' class='ia-table-header' style='width:"+
e+"%'>"),g.html(d.label);b.append(g);if(d.id=="profile"){var h=this.bar.minValue+(this.bar.maxValue-this.bar.minValue)/2,e=$j("<div style='display:table;width:100%'>"),f=$j("<div style='display:table-cell;width:30%;text-align:left'>").html(this.bar.minValue),h=$j("<div style='display:table-cell;width:40%'>").html(h),k=$j("<div style='display:table-cell;width:30%;text-align:right'>").html(this.bar.maxValue);e.append(f);e.append(h);e.append(k);g.append(e);d.canvasHeight=this.bar.height;e=this.targets.length;
for(g=0;g<e;g++)f=this.targets[g],d.canvasHeight=Math.max(d.canvasHeight,f.size)}else if(d.id=="election"){d.canvasHeight=this.bar.height;e=this.targets.length;for(g=0;g<e;g++)f=this.targets[g],d.canvasHeight=Math.max(d.canvasHeight,f.size)}else if(d.id=="performance"){d.canvasHeight=this.bar.height;e=this.targets.length;for(g=0;g<e;g++)f=this.targets[g],d.canvasHeight=Math.max(d.canvasHeight,f.size);if(d.canvasHeight<=this.bar.height+8)d.canvasHeight=this.bar.height+8}else if(d.id.indexOf("health")!=
-1){e=$j("<div style='display:table;width:100%'>");f=$j("<div style='display:table-cell;width:30%;text-align:left'>").html(this.bar.minValue);h=$j("<div style='display:table-cell;width:40%'>").html(this.bar.midValue);k=$j("<div style='display:table-cell;width:30%;text-align:right'>").html(this.bar.maxValue);e.append(f);e.append(h);e.append(k);g.append(e);d.canvasHeight=0;e=this.targets.length;for(g=0;g<e;g++)f=this.targets[g],d.canvasHeight=Math.max(d.canvasHeight,f.size);e=this.symbols.length;for(g=
0;g<e;g++)d.canvasHeight=Math.max(d.canvasHeight,this.symbols[g].size);g=d.id.substring(d.id.indexOf("(")+1,d.id.indexOf(")"));e=g.split(",");d.symbolAlign="right";for(g=0;g<e.length;g++)h=e[g].split(":"),f=h[0],h=h[1],d[f]=h}else if(d.id.indexOf("symbol(")!=-1){g=d.id.substring(d.id.indexOf("(")+1,d.id.indexOf(")"));e=g.split(",");d.symbolAlign="right";for(g=0;g<e.length;g++)h=e[g].split(":"),f=h[0],h=h[1],d[f]=h}}b=$j("<tr class='ia-table-row'>");this.$table.append(b);for(var i=c,g=0;g<c;g++)d=
this.columns[g],e=d.width*100,d.id=="performance"||d.id.indexOf("health")!=-1?(i=c+2,f=e*0.15,a=$j("<td class='ia-table-cell' style='width:"+f+"%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px'>"),b.append(a),f=e*0.7,a=$j("<td class='ia-table-cell' style='width:"+f+"%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px'>"),b.append(a),f=e*0.15,a=$j("<td class='ia-table-cell' style='width:"+f+"%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px'>")):
a=$j("<td class='ia-table-cell' style='width:"+e+"%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px'>"),b.append(a);var l=this;$j.each(this._data.themes,function(a,b){var d=$j("<tbody>");l.$table.append(d);var e=$j("<tr class='ia-table-row'>");d.append(e);var f=$j("<td id='"+b.id+"' class='ia-table-cell ia-profile-theme-name-cell ia-profile-theme-collapse ia-profile-row' colspan='"+i+"'>");f.html(b.name);e.append(f);d=$j("<tbody id='"+b.id+"-children'>");l.$table.append(d);$j.each(b.indicators,
function(a,b){var e=b.features;if(e.length==0){var f=a%2==0?$j("<tr class='ia-table-row ia-profile-row ia-table-row-even indicator-row'>"):$j("<tr class='ia-table-row ia-profile-row ia-table-row-odd indicator-row'>");b.date!=void 0?f.data("linkId",b.id+"~"+b.date):f.data("linkId",b.id);d.append(f);for(var g=0;g<c;g++){var h=l.columns[g],i=h.width*100;if(h.id=="performance"||h.id.indexOf("health")!=-1)h=i*0.15,h=$j("<td class='ia-table-cell' style='width:"+h+"%'>"),f.append(h),h=i*0.7,h=$j("<td class='ia-table-cell' style='width:"+
h+"%;border-left-width:0px'>"),f.append(h),h=i*0.15,h=$j("<td class='ia-table-cell' style='width:"+h+"%;border-left-width:0px'>"),f.append(h);else if(h.id=="indicatorName"){var j,h=$j("<td class='ia-profile-indicator-name-cell' style='width:"+i+"%'>");l.displayDatesInProfile?(b.href&&(j=$j("<span class='ia-table-notes-icon'>"),h.append(j)),b.date?h.append(b.name+" ("+b.date+")"):h.append(b.name)):(b.href&&(j=$j("<span class='ia-table-notes-icon'>"),h.append(j)),h.append(b.name));f.append(h);b.href&&
function(){var a=b.href;j.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();window.open(a,"_blank")});j.bind("mouseover touchstart",function(a){a.stopPropagation()})}()}else h=$j("<td class='ia-table-cell' style='width:"+i+"%'>"),f.append(h)}}$j.each(e,function(f,g){var h=a%2==0?$j("<tr class='ia-table-row ia-profile-row ia-table-row-even indicator-row'>"):$j("<tr class='ia-table-row ia-profile-row ia-table-row-odd indicator-row'>");b.date!=void 0?h.data("linkId",b.id+"~"+b.date):h.data("linkId",
b.id);d.append(h);for(var i=0;i<c;i++){var j=l.columns[i],k=g[j.formattedId],m=j.width*100;if(f==0&&j.id=="indicatorName"){var o,p=$j("<td class='ia-profile-indicator-name-cell' rowspan='"+e.length+"' style='width:"+m+"%'>");l.displayDatesInProfile?(b.href&&(o=$j("<span class='ia-table-notes-icon'>"),p.append(o)),b.date?p.append(b.name+" ("+b.date+")"):p.append(b.name)):(b.href&&(o=$j("<span class='ia-table-notes-icon'>"),p.append(o)),p.append(b.name));h.append(p);b.href&&function(){var a=b.href;
o.bind(ia.CLICK_TYPE,function(b){b.stopPropagation();window.open(a,"_blank")});o.bind("mouseover touchstart",function(a){a.stopPropagation()})}()}else if(j.id=="name")p=$j("<td class='ia-table-cell ia-table-cell-categoric' style='width:"+m+"%'>"),p.html(k),h.append(p);else if(j.id=="profile"||j.id=="election"){var p=$j("<td class='ia-table-cell ia-profile-cell' style='width:"+m+"%'>"),s=document.createElement("canvas");s.width=0;s.height=0;p.append($j(s));var v=g[l.bar.data],s=g[l.bar.symbolValue];
p.data("id",g.id);p.data("barValue",v);p.data("canvasHeight",j.canvasHeight);p.data("symbolValue",s);j=g[l.bar.data+"_formatted"];p.data("barValue_formatted",j);j=l.targets.length;for(s=0;s<j;s++){var v=l.targets[s],u=g[v.data];p.data("targetValue"+s,u);v=g[v.data+"_formatted"];p.data("targetValue"+s+"_formatted",v)}h.append(p)}else if(j.id=="performance"||j.id.indexOf("health")!=-1){s=m*0.15;k=$j("<td class='ia-table-cell' style='text-align:right' style='width:"+s+"%'>");h.append(k);s=m*0.7;p=$j("<td class='ia-table-cell' style='width:"+
s+"%;border-left-width:0px'>");if(j.id=="performance")p.addClass("ia-performance-cell");else if(j.id.indexOf("health")!=-1){p.addClass("ia-health-cell");var s=g[j.symbolValue],v=g[j.areaValue],u=g[j.nationalValue],w=g[j.areaValue+"_formatted"],x=g[j.nationalValue+"_formatted"];p.data("symbolValue",s);p.data("areaValue",v);p.data("nationalValue",u);p.data("areaValue_formatted",w);p.data("nationalValue_formatted",x);p.data("usingMedian",!1);u==void 0&&(p.data("nationalValue",b.median),p.data("nationalValue_formatted",
b.median_formatted),p.data("usingMedian",!0))}h.append(p);s=document.createElement("canvas");s.width=0;s.height=0;p.append($j(s));s=m*0.15;m=$j("<td class='ia-table-cell' style='text-align:left;border-left-width:0px' style='width:"+s+"%'>");h.append(m);v=g[l.bar.data];s=g[l.bar.breaksFlip];p.data("id",g.id);p.data("barValue",v);p.data("breaksFlip",s);p.data("canvasHeight",j.canvasHeight);j=g[l.bar.data+"_formatted"];p.data("barValue_formatted",j);j=l.targets.length;for(s=0;s<j;s++)v=l.targets[s],
u=g[v.data],p.data("targetValue"+s,u),v=g[v.data+"_formatted"],p.data("targetValue"+s+"_formatted",v);if(l.bar.breaksData)if(j=g[l.bar.breaksData],j!=void 0){v=j.split(",");u=Infinity;w=-Infinity;j=v.length;for(s=0;s<j;s++)x=v[s],u=Math.min(u,x),w=Math.max(w,x),p.data("breakValue"+s,x),p.data("breakValue"+s+"_formatted",x);p.data("minValue",u);p.data("maxValue",w);p.data("minValue_formatted",u);p.data("maxValue_formatted",w);k.html(u);m.html(w)}else p.data("breakValue0",b.minValue),p.data("breakValue1",
b.lowerQuartile),p.data("breakValue2",b.upperQuartile),p.data("breakValue3",b.maxValue),p.data("minValue",b.minValue),p.data("maxValue",b.maxValue),p.data("breakValue0_formatted",b.minValue_formatted),p.data("breakValue1_formatted",b.lowerQuartile_formatted),p.data("breakValue2_formatted",b.upperQuartile_formatted),p.data("breakValue3_formatted",b.maxValue_formatted),p.data("minValue_formatted",b.minValue_formatted),p.data("maxValue_formatted",b.maxValue_formatted),k.html(b.minValue_formatted),m.html(b.maxValue_formatted);
else p.data("breakValue0",b.minValue),p.data("breakValue1",b.lowerQuartile),p.data("breakValue2",b.upperQuartile),p.data("breakValue3",b.maxValue),p.data("minValue",b.minValue),p.data("maxValue",b.maxValue),p.data("breakValue0_formatted",b.minValue_formatted),p.data("breakValue1_formatted",b.lowerQuartile_formatted),p.data("breakValue2_formatted",b.upperQuartile_formatted),p.data("breakValue3_formatted",b.maxValue_formatted),p.data("minValue_formatted",b.minValue_formatted),p.data("maxValue_formatted",
b.maxValue_formatted),k.html(b.minValue_formatted),m.html(b.maxValue_formatted)}else j.id.indexOf("symbol(")!=-1?(s=g[j.symbolValue],j.textValue!=void 0?(v=g[j.textValue+"_formatted"],p=$j("<td class='ia-table-cell ia-symbol-cell' style='width:"+m+"%'>"),p.data("symbolValue",s),k=$j("<div style='display:table'>"),p.append(k),m=$j("<div style='display:table-cell;vertical-align:middle;width:100%'>"),v!=void 0&&m.html(v+"&nbsp;"),s=b.type,j.textValue!="value"&&(s=g[j.textValue+"_type"]),s=="categoric"?
m.addClass("ia-table-cell-categoric"):m.addClass("ia-table-cell-numeric"),v=$j("<div style='display:table-cell;vertical-align:middle'>"),s=document.createElement("canvas"),s.width=0,s.height=0,v.append($j(s)),j.symbolAlign=="right"?(k.append(m),k.append(v)):j.symbolAlign=="left"&&(k.append(v),k.append(m))):(p=$j("<td class='ia-table-cell ia-symbol-cell' style='width:"+m+"%'>"),p.data("symbolValue",s),v=$j("<div style='vertical-align:middle;text-align:"+j.symbolAlign+";width:100%'>"),s=document.createElement("canvas"),
s.width=0,s.height=0,v.append($j(s)),p.append(v)),h.append(p)):j.id=="value"?(p=b.type=="categoric"?$j("<td class='ia-table-cell ia-table-cell-categoric' style='width:"+m+"%'>"):$j("<td class='ia-table-cell ia-table-cell-numeric' style='width:"+m+"%'>"),k!=void 0&&p.html(k),h.append(p)):j.id!="indicatorName"&&j.id!="name"&&(s=g[j.id+"_type"],p=s=="categoric"?$j("<td class='ia-table-cell ia-table-cell-categoric' style='width:"+m+"%'>"):$j("<td class='ia-table-cell ia-table-cell-numeric' style='width:"+
m+"%'>"),k!=void 0&&p.html(k),h.append(p))}})})});for(a=0;a<this._collapseIds.length;a++)b=this._collapseIds[a],this.$table.find("td[id='"+b+"']").removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),this.$table.find("tbody[id='"+b+"-children']").hide();this._scrollBox.refresh();this._size()};
ia.Profile.prototype._renderCanvasColumns=function(){var a=this;this.$table.find("tbody > tr > td.ia-profile-cell").each(function(){var b=[],c=$j(this).data("id"),d=$j(this).data("barValue"),e=$j(this).data("barValue_formatted"),f=a.bar.maxValue-a.bar.minValue,g=$j(this).data("symbolValue"),h=$j(this).find("canvas:first").get(0),k=$j(this).width(),i=$j(this).data("canvasHeight");h.width=k;h.height=i;var l=h.getContext("2d");l.clearRect(0,0,h.width,h.height);if(d!=void 0){var j=Math.abs(d)/f*k,m=a.bar.minValue/
f*k*-1,n=m;d<0&&(n=m-j);i=(i-a.bar.height)/2;if(a.colorPalette)d=a._featureIds.length,d=a.colorPalette.getColors(d),c=a._featureIds.indexOf(c),l.fillStyle=d[c];else if(g!=void 0){d=a.symbols.length;for(c=0;c<d;c++)if(m=a.symbols[c],m.value==g){l.fillStyle=m.color;break}}else l.fillStyle=a.bar.color;l.beginPath();l.rect(n,i,j,a.bar.height);l.fill();g={};g.label=e;g.rect=new ia.Rectangle(n,i,j,a.bar.height);b[b.length]=g}d=a.targets.length;for(c=0;c<d;c++)if(e=a.targets[c],n=$j(this).data("targetValue"+
c),j=$j(this).data("targetValue"+c+"_formatted"),n!=void 0)n=(n-a.bar.minValue)/f*k,l.fillStyle=e.color,l.beginPath(),ia.Shape.draw(e.shape,l,n,h.height/2,e.size),l.fill(),g={},g.label=e.label+" : "+j,g.rect=new ia.Rectangle(n-e.size/2,(h.height-e.size)/2,e.size,e.size),b[b.length]=g;a._setToolTip($j(h),b)});this.$table.find("tbody > tr > td.ia-performance-cell").each(function(){var b=[],c=$j(this).data("id"),d=$j(this).data("breaksFlip"),e=$j(this).data("barValue"),f=$j(this).data("barValue_formatted"),
g=$j(this).data("minValue"),h=$j(this).data("maxValue")-g,k=$j(this).find("canvas:first").get(0),i=$j(this).width(),l=$j(this).data("canvasHeight");k.width=i;k.height=l;var j=k.getContext("2d");j.clearRect(0,0,k.width,k.height);for(var m=a.breaks.length,n=0;n<m;n++){var o=d==!0||d=="true"?a.breaks[m-n-1]:a.breaks[n],p=$j(this).data("breakValue"+n),q=n+1,r=$j(this).data("breakValue"+q),t=(p-g)/h*i,r=(r-p)/h*i;j.fillStyle=o.color;j.beginPath();j.rect(t,0,r,k.height);j.fill();p={};p.label=o.label+" : "+
$j(this).data("breakValue"+n+"_formatted")+" - "+$j(this).data("breakValue"+q+"_formatted");p.rect=new ia.Rectangle(t,0,r,k.height);b[b.length]=p}if(e!=void 0)n=(Math.abs(e)-g)/h*i,d=0,l=(l-a.bar.height)/2,e<0&&(d=Math.abs(e-g)/h*i,n=g/h*i*-1-d),a.colorPalette?(m=a._featureIds.length,m=a.colorPalette.getColors(m),c=a._featureIds.indexOf(c),j.fillStyle=m[c]):j.fillStyle=a.bar.color,j.beginPath(),j.rect(d,l,n,a.bar.height),j.fill(),p={},p.label=f,p.rect=new ia.Rectangle(d,l,n,a.bar.height),b[b.length]=
p;m=a.targets.length;for(n=0;n<m;n++)if(f=a.targets[n],p=$j(this).data("targetValue"+n),c=$j(this).data("targetValue"+n+"_formatted"),p!=void 0)e=(p-g)/h*i,j.fillStyle=f.color,j.beginPath(),ia.Shape.draw(f.shape,j,e,k.height/2,f.size),j.fill(),p={},p.label=f.label+" : "+c,p.rect=new ia.Rectangle(e-f.size/2,(k.height-f.size)/2,f.size,f.size),b[b.length]=p;a._setToolTip($j(k),b)});this.$table.find("tbody > tr > td.ia-health-cell").each(function(){var b=[];$j(this).data("id");var c=$j(this).data("breaksFlip"),
d=parseFloat($j(this).data("minValue")),e=parseFloat($j(this).data("maxValue")),f=e-d,g=$j(this).data("symbolValue"),h=parseFloat($j(this).data("areaValue")),k=parseFloat($j(this).data("nationalValue")),f=Math.max(Math.abs(e-k),Math.abs(k-d)),d=k-f,f=k+f-d,e=$j(this).find("canvas:first").get(0),i=$j(this).width(),l=$j(this).data("canvasHeight");e.width=i;e.height=l;l=e.getContext("2d");l.clearRect(0,0,e.width,e.height);for(var j=a.breaks.length,m=0;m<j;m++){var n=c==!0||c=="true"?a.breaks[j-m-1]:
a.breaks[m],o=$j(this).data("breakValue"+m),p=m+1,q=$j(this).data("breakValue"+p),r=(o-d)/f*i,q=(q-o)/f*i;l.fillStyle=n.color;l.beginPath();l.rect(r,0,q,e.height);l.fill();o={};o.label=n.label+" : "+$j(this).data("breakValue"+m+"_formatted")+" - "+$j(this).data("breakValue"+p+"_formatted");o.rect=new ia.Rectangle(r,0,q,e.height);b[b.length]=o}if($j(this).data("usingMedian"))c={color:"#999999",size:14},c.shape=ia.Shape.VERTICAL_LINE,n=(k-d)/f*i,l.fillStyle=c.color,l.beginPath(),ia.Shape.draw(c.shape,
l,n,e.height/2,c.size),l.fill(),o={},o.label=$j(this).data("nationalValue_formatted"),o.rect=new ia.Rectangle(n-c.size/2,(e.height-c.size)/2,c.size,c.size),b[b.length]=o;j=a.targets.length;for(m=0;m<j;m++)if(c=a.targets[m],o=$j(this).data("targetValue"+m),k=$j(this).data("targetValue"+m+"_formatted"),o!=void 0)n=(o-d)/f*i,l.fillStyle=c.color,l.beginPath(),ia.Shape.draw(c.shape,l,n,e.height/2,c.size),l.fill(),o={},o.label=c.label+" : "+k,o.rect=new ia.Rectangle(n-c.size/2,(e.height-c.size)/2,c.size,
c.size),b[b.length]=o;if(g!=void 0){j=a.symbols.length;for(m=0;m<j;m++)if(k=a.symbols[m],k.value==g){d=(h-d)/f*i;l.fillStyle=k.color;l.beginPath();ia.Shape.draw(k.shape,l,d,e.height/2,k.size);l.fill();o={};o.label=k.label+" : "+$j(this).data("areaValue_formatted");o.rect=new ia.Rectangle(d-k.size/2,(e.height-k.size)/2,k.size,k.size);b[b.length]=o;break}}else k={color:"#999999",size:14},k.shape=ia.Shape.DIAMOND,d=(h-d)/f*i,l.fillStyle=k.color,l.beginPath(),ia.Shape.draw(k.shape,l,d,e.height/2,k.size),
l.fill(),o={},o.label=$j(this).data("areaValue_formatted"),o.rect=new ia.Rectangle(d-k.size/2,(e.height-k.size)/2,k.size,k.size),b[b.length]=o;a._setToolTip($j(e),b)});this.$table.find("tbody > tr > td.ia-symbol-cell").each(function(){var b=[],c=$j(this).data("symbolValue");if(c!=void 0){for(var d,e,f,g,h=a.symbols.length,k=0;k<h;k++){var i=a.symbols[k];if(i.value==c){g=i.label;d=i.shape;e=i.size;f=i.color;break}}if(d!=void 0){var l=$j(this).find("canvas:first").get(0);l.width=e;l.height=e;c=l.getContext("2d");
c.clearRect(0,0,l.width,l.height);c.fillStyle=f;f=e/2;h=e/2;c.beginPath();ia.Shape.draw(d,c,f,h,e);c.fill();d={};d.label=g;d.rect=new ia.Rectangle(0,0,l.width,l.height);b[b.length]=d}}a._setToolTip($j(l),b)})};
ia.Profile.prototype._setToolTip=function(a,b){var c=this;a.hover(function(){c._tip=$j("<div id='ia-tooltip' class='ia-datatip'>");$j("body").append(c._tip)},function(){c._tip.remove()});var d=!1;a.mousemove(function(e){for(var f=e.pageX-a.offset().left,g=e.pageY-a.offset().top,h=!1,k=b.length-1;k>=0;k--){var i=b[k];if(i.rect.intersects(f,g)){h=d=!0;c._tip.html(i.label);c._tip.fadeIn("fast");break}}!h&&d==!0&&(d=!1,c._tip.fadeOut("fast"));f=c._tip.outerWidth()/2;g=c._tip.outerHeight()+10;c._tip.css("top",
e.pageY-g+"px").css("left",e.pageX-f+"px")})};
ia.Profile.prototype._addMouseEvents=function(){var a=this;ia.IS_TOUCH_DEVICE?(this.$table.delegate("td.ia-profile-theme-name-cell","touchend",function(){a._scrollBox.isScrolling||a._onThemeClick($j(this))}),this._useMouseClick&&this.$table.delegate("tr.indicator-row","touchend",function(){a._scrollBox.isScrolling||a._onIndicatorClick($j(this))})):(this.$table.delegate("td.ia-profile-theme-name-cell",ia.CLICK_TYPE,function(){a._onThemeClick($j(this))}),this._useMouseClick&&this.$table.delegate("tr.indicator-row",
ia.CLICK_TYPE,function(){a._onIndicatorClick($j(this))}))};
ia.Profile.prototype._onThemeClick=function(a){var b=a.attr("id");if(a.hasClass("ia-profile-theme-expand")){var c=this._collapseIds.indexOf(b);c!=-1&&this._collapseIds.splice(c,1);a.removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");this.$table.find("tbody[id='"+b+"-children']").show()}else this._collapseIds[this._collapseIds.length]=b,a.removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),this.$table.find("tbody[id='"+b+"-children']").hide();this._size()};
ia.Profile.prototype._onIndicatorClick=function(a){this._tip&&this._tip.remove();this.callbackFunction&&this.callbackFunction.call(null,a.data("linkId"))};ia.Profile.prototype.select=function(a){this._featureIds.indexOf(a)==-1&&this._featureIds.push(a);this._triggerRender()};ia.Profile.prototype.unselect=function(a){a=this._featureIds.indexOf(a);a!=-1&&this._featureIds.splice(a,1);this._triggerRender()};ia.Profile.prototype.clearSelection=function(){this._featureIds=[];this._triggerRender()};
ia.Profile.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};ia.Profile.prototype.highlight=function(){};ia.Profile.prototype.clearHighlight=function(){};ia.ProfileLegend=function(a){ia.ProfileLegend.baseConstructor.call(this,a);this.container.addClass("ia-profile-legend");this._scrollBox=new ia.ScrollBox(this.container);this.interactive=this.isLegendComponent=!1;this.legendClasses=[]};ia.extend(ia.DiscreteLegend,ia.ProfileLegend);
ia.ProfileLegend.prototype.render=function(){this.renderLegend(this.legendClasses);this._scrollBox.refresh()};
ia.FeatureCard=function(a){ia.FeatureCard.baseConstructor.call(this);this.id=a;this.displaySelectedDateOnly=!1;this.ignoreThemeIds=[];this.ignoreIndicatorIds=[];this.displayFeatureHeader=this.displayThemeHeader=!1;this.displayMode="All themes";this.dataOrder="Order data by feature";this._renderTimeout=null;this._featureIds=[];this.container=$j("<div id='"+a+"' class='ia-feature-card-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this.$content=$j("<div>");this.container.append(this.$content);
this._textSubstitution=new ia.TextSubstitution;this._snippet=""};ia.extend(ia.EventDispatcher,ia.FeatureCard);ia.FeatureCard.prototype.noDataValue="";ia.FeatureCard.prototype.setSnippet=function(a,b){var c=this;a!=""&&a!=void 0?(c._snippet=a,c._snippet.indexOf(".htm")!=-1&&c._snippet.indexOf("href=")==-1?ia.File.load({url:a,dataType:"html",onSuccess:function(a){c._snippet=a;b!=void 0&&b.call(null)},onFail:function(){b!=void 0&&b.call(null)}}):b!=void 0&&b.call(null)):b!=void 0&&b.call(null)};
ia.FeatureCard.prototype.render=function(){this._renderTimeout=null;if(this._snippet!=""){this.$content.empty();this._textSubstitution.clearVariables();var a=!0;this.dataOrder!="Order data by feature"&&(a=!1);var b=this._featureIds.concat().reverse();data=this.displaySelectedDateOnly?a?this.geography.getFeatureData(b,this.indicator.date):this.geography.getIndicatorData(b,this.indicator.date):a?this.geography.getFeatureData(b):this.geography.getIndicatorData(b);a?this._renderFeatureList(data):this._renderIndicatorList(data);
this._scrollBox.refresh()}};
ia.FeatureCard.prototype._renderFeatureList=function(a){var b=this;b._textSubstitution.setVariable("geog-id",a.id);b._textSubstitution.setVariable("geog-name",a.name);$j.each(a.features,function(a,d){b._textSubstitution.setVariable("feature-id",d.id);b._textSubstitution.setVariable("feature-name",d.name);b._textSubstitution.setVariable("feature-href",d.href);b._textSubstitution.setVariable("feature-index",a);$j.each(d.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value)});
var e=$j("<div class='ia-feature-card'>");b.$content.append(e);if(b.displayFeatureHeader){var f=$j("<div id='"+d.id+"' class='ia-feature-card-header'>").html(d.name);e.append(f)}$j.each(d.themes,function(a,c){var d=!0;if(b.displayMode=="Selected theme only")b.indicator.theme.id!=c.id&&(d=!1);else for(var f=0;f<b.ignoreThemeIds.length;f++)if(c.id==b.ignoreThemeIds[f]){d=!1;break}if(d){b._textSubstitution.setVariable("theme-id",c.id);b._textSubstitution.setVariable("theme-name",c.name);b._textSubstitution.setVariable("theme-index",
a);if(b.displayThemeHeader&&c.indicators.length>0)if(b.displayMode=="Selected indicator only"){var l=!1,d=c.indicators;$j.each(d,function(a,c){b.indicator.id==c.id&&(l=!0)});l==!0&&(d=$j("<div id='"+c.id+"' class='ia-feature-card-sub-header'>").html(c.name),e.append(d))}else d=$j("<div id='"+c.id+"' class='ia-feature-card-sub-header'>").html(c.name),e.append(d);var j=$j("<div class='ia-feature-card-content'>");e.append(j);var d=c.indicators,m,n="";$j.each(d,function(a,c){var d=!0;if(b.displayMode==
"Selected indicator only")b.indicator.id!=c.id&&(d=!1);else for(var e=0;e<b.ignoreIndicatorIds.length;e++)if(c.id==b.ignoreIndicatorIds[e]){d=!1;break}if(d){b._textSubstitution.setVariable("indicator-id",c.id);b._textSubstitution.setVariable("indicator-name",c.name);b._textSubstitution.setVariable("indicator-index",a);b._textSubstitution.setVariable("indicator-type",c.type);b._textSubstitution.setVariable("indicator-href",c.href);b._textSubstitution.setVariable("indicator-formatted-value",c.formattedValue);
b._textSubstitution.setVariable("indicator-date",c.date);if(c.id!=n)n=c.id,m=0;b._textSubstitution.setVariable("indicator-date-index",m);m++;c.value=="null"||c.value==null||c.value=="NaN"||c.value==""||c.value=="No Data"||c.value==void 0||c.value==b.noDataValue?b._textSubstitution.setVariable("indicator-value",""):b._textSubstitution.setVariable("indicator-value",c.value);$j.each(c.associates,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+
"-formatted-value",c.formattedValue);b._textSubstitution.setVariable(c.name+"-type",c.type)});$j.each(c.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value)});c.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",c.lowerLimit.value),b._textSubstitution.setVariable("lower-limit-formatted-value",c.lowerLimit.formattedValue));c.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",c.upperLimit.value),b._textSubstitution.setVariable("upper-limit-formatted-value",
c.upperLimit.formattedValue));d=b._textSubstitution.formatMessage(b._snippet);j.append(d)}})}})})};
ia.FeatureCard.prototype._renderIndicatorList=function(a){var b=this;b._textSubstitution.setVariable("geog-id",a.id);b._textSubstitution.setVariable("geog-name",a.name);$j.each(a.themes,function(a,d){var e=!0;if(b.displayMode=="Selected theme only")b.indicator.theme.id!=d.id&&(e=!1);else for(var f=0;f<b.ignoreThemeIds.length;f++)if(d.id==b.ignoreThemeIds[f]){e=!1;break}if(e){e=$j("<div class='ia-feature-card'>");b.$content.append(e);b._textSubstitution.setVariable("theme-id",d.id);b._textSubstitution.setVariable("theme-name",
d.name);b._textSubstitution.setVariable("theme-index",a);if(b.displayThemeHeader&&d.indicators.length>0)if(b.displayMode=="Selected indicator only"){var g=!1,f=d.indicators;$j.each(f,function(a,c){b.indicator.id==c.id&&(g=!0)});g==!0&&(f=$j("<div id='"+d.id+"' class='ia-feature-card-header'>").html(d.name),e.append(f))}else f=$j("<div id='"+d.id+"' class='ia-feature-card-header'>").html(d.name),e.append(f);var h=$j("<div class='ia-feature-card-content'>");e.append(h);var f=d.indicators,k,i="";$j.each(f,
function(a,c){var d=!0;if(b.displayMode=="Selected indicator only")b.indicator.id!=c.id&&(d=!1);else for(var e=0;e<b.ignoreIndicatorIds.length;e++)if(c.id==b.ignoreIndicatorIds[e]){d=!1;break}if(d){b.displayFeatureHeader&&(d=$j("<div id='"+c.id+"' class='ia-feature-card-sub-header'>").html(c.name),h.append(d));b._textSubstitution.setVariable("indicator-id",c.id);b._textSubstitution.setVariable("indicator-name",c.name);b._textSubstitution.setVariable("indicator-index",a);b._textSubstitution.setVariable("indicator-type",
c.type);b._textSubstitution.setVariable("indicator-href",c.href);b._textSubstitution.setVariable("indicator-date",c.date);if(c.id!=i)i=c.id,k=0;b._textSubstitution.setVariable("indicator-date-index",k);k++;$j.each(c.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value)});$j.each(c.features,function(a,c){b._textSubstitution.setVariable("feature-id",c.id);b._textSubstitution.setVariable("feature-name",c.name);b._textSubstitution.setVariable("feature-href",c.href);b._textSubstitution.setVariable("feature-index",
a);b._textSubstitution.setVariable("indicator-formatted-value",c.formattedValue);c.value=="null"||c.value==null||c.value=="NaN"||c.value==""||c.value=="No Data"||c.value==void 0||c.value==b.noDataValue?b._textSubstitution.setVariable("indicator-value",""):b._textSubstitution.setVariable("indicator-value",c.value);$j.each(c.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value)});$j.each(c.associates,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value);
b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue);b._textSubstitution.setVariable(c.name+"-type",c.type)});c.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",c.lowerLimit.value),b._textSubstitution.setVariable("lower-limit-formatted-value",c.lowerLimit.formattedValue));c.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",c.upperLimit.value),b._textSubstitution.setVariable("upper-limit-formatted-value",c.upperLimit.formattedValue));var d=b._textSubstitution.formatMessage(b._snippet);
h.append(d)})}})}})};ia.FeatureCard.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};ia.FeatureCard.prototype.select=function(a){this._featureIds.indexOf(a)==-1&&this._featureIds.push(a);this._triggerRender()};ia.FeatureCard.prototype.unselect=function(a){a=this._featureIds.indexOf(a);a!=-1&&this._featureIds.splice(a,1);this._triggerRender()};ia.FeatureCard.prototype.clearSelection=function(){this._featureIds=[];this._triggerRender()};
ia.FeatureCard.prototype.highlight=function(){};ia.FeatureCard.prototype.clearHighlight=function(){};
ia.TimeControl=function(a,b,c){this.id=a;if(c)this._callbackFunction=c;this._dataGroup=b;this.delay=1.5;this._playing=!1;this._currentIndicatorId=this._currentGeographyId=this.$playBtn=void 0;this.container=$j("<div id='"+a+"-container' class='ia-time-control-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this.$table=$j("<table class='ia-time-control-table'>");this.container.append(this.$table);var d=this;this._dataGroup.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){d._stop();
d._currentIndicatorId=a.indicator.id;d._currentGeographyId=a.indicator.geography.id;d._render(a.indicator);a.indicator.date!=void 0&&(a=a.indicator.date.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),d.$table.find("td.ia-time-control-date-btn[id='"+a+"-btn']").addClass("ia-time-control-date-btn-active"))});this._dataGroup.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(a){if(a.indicator.geography.id!=d._currentGeographyId||d._currentIndicatorId!=a.indicator.id)d._stop(),d._currentIndicatorId=
a.indicator.id,d._currentGeographyId=a.indicator.geography.id,d._render(a.indicator);else if(d._playing)var b=setTimeout(function(){clearTimeout(b);if(d._playing){var c=a.theme.getIndicatorDates(a.indicator.id),g=c.indexOf(a.indicator.date)+1;g<c.length?d._dataGroup.setData(a.geography.id,a.indicator.id,c[g]):d._stop()}},d.delay*1E3);d.$table.find("td.ia-time-control-date-btn").removeClass("ia-time-control-date-btn-active");if(a.indicator.date!=void 0){var c=a.indicator.date.replace(/'/g,"#quote#").replace(/"/g,
"#double-quote#");d.$table.find("td.ia-time-control-date-btn[id='"+c+"-btn']").addClass("ia-time-control-date-btn-active")}})};
ia.TimeControl.prototype._play=function(){if(this._playing)this._stop();else{this._callbackFunction&&this._callbackFunction.call(null,!0);this._playing=!0;this.$playBtn.removeClass("ia-time-control-btn-play");this.$playBtn.addClass("ia-time-control-btn-stop");var a=this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id),b=a.indexOf(this._dataGroup.indicator.date)+1;b<a.length?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,
this._dataGroup.indicator.id,a[0])}};ia.TimeControl.prototype._stop=function(){this._callbackFunction&&this._callbackFunction.call(null,!1);this._playing=!1;this.$playBtn&&(this.$playBtn.removeClass("ia-time-control-btn-stop"),this.$playBtn.addClass("ia-time-control-btn-play"))};
ia.TimeControl.prototype._back=function(){this._stop();var a=this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id),b=a.indexOf(this._dataGroup.indicator.date)-1;b>-1?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[a.length-1])};
ia.TimeControl.prototype._next=function(){this._stop();var a=this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id),b=a.indexOf(this._dataGroup.indicator.date)+1;b<a.length?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[0])};
ia.TimeControl.prototype.setData=function(a){this._stop();this._currentIndicatorId=a.id;this._currentGeographyId=a.geography.id;this._render(a);this.$table.find("td.ia-time-control-date-btn").removeClass("ia-time-control-date-btn-active");a.date!=void 0&&this.$table.find("td.ia-time-control-date-btn[id='"+a.date.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#")+"-btn']").addClass("ia-time-control-date-btn-active")};
ia.TimeControl.prototype._render=function(a){this.$table.empty();var b=a.theme.getIndicatorDates(a.id);if(b){var c=this;$tr=$j("<tr>");this.$table.append($tr);this.$playBtn=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-play'>");$tr.append(this.$playBtn);this.$playBtn.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();ia.IS_TOUCH_DEVICE&&a.preventDefault();c._play()});var d=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-back'>");$tr.append(d);d.bind(ia.CLICK_TYPE,
function(a){a.stopPropagation();ia.IS_TOUCH_DEVICE&&a.preventDefault();c._back()});d=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-forward'>");$tr.append(d);d.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();ia.IS_TOUCH_DEVICE&&a.preventDefault();c._next()});for(d=0;d<b.length;d++){var e=b[d],f=e.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#");$dateBtn=$j("<td id='"+f+"-btn' class='ia-list-item ia-time-control-td ia-time-control-date-btn'>").html(e);$tr.append($dateBtn);
(function(){var b=a.geography.id,d=a.id,f=e;$dateBtn.bind(ia.CLICK_TYPE,function(a){a.stopPropagation();ia.IS_TOUCH_DEVICE&&a.preventDefault();c._stop();c._dataGroup.setData(b,d,f)})})()}}this._scrollBox.refresh()};ia.TextBox=function(a){this.container=$j("<div id='"+a+"' class='ia-textbox-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this._textBox=$j("<div class='ia-textbox'>");this.container.append(this._textBox)};
ia.TextBox.prototype.setHtml=function(a){if(a!=void 0)if(a.indexOf(".htm")!=-1&&a.indexOf("href=")==-1){var b=this;this._textBox.load(a,function(){b._scrollBox.refresh()})}else this._textBox.html(a),this._scrollBox.refresh()};
ia.AreaBreakdownPieComponent=function(a,b){ia.AreaBreakdownPieComponent.baseConstructor.call(this);this.id=a;this.tip="";this._layout=b;this._chartTitle1="";this._layer1=this._chart1=void 0;this._chartTitle2="";this._layer2=this._chart2=void 0;this._selectionIds=[];this._multiLayout=!0;this._data=void 0;this._isVisible=!0};ia.extend(ia.EventDispatcher,ia.AreaBreakdownPieComponent);
ia.AreaBreakdownPieComponent.prototype.build=function(a){var b=new ia.InteractionGroup;this.container=$j("<div id='"+this.id+"'class='ia-area-breakdown-pie-chart'>");this.thematic=new ia.Thematic;this.thematic.setDataType(ia.Thematic.CATEGORIC);this.thematic.setDataField("value");var c,d;this._layout=="vertical"?(c=$j("<div style='padding:8px;text-align:center;width:100%;height:50%'>"),d=$j("<div style='padding:8px;text-align:center;width:100%;height:50%'>")):this._layout=="horizontal"?(c=$j("<div style='display:inline-block;padding:8px;text-align:center;width:50%;height:100%'>"),
d=$j("<div style='display:inline-block;padding:8px;text-align:center;width:50%;height:100%'>")):(this._multiLayout=!1,c=$j("<div style='padding:8px;text-align:center;width:100%;height:100%'>"));this.container.append(c);this._multiLayout&&this.container.append(d);this._chartTitle1=$j("<div>").html("");c.append(this._chartTitle1);this._chart1=new ia.PieChart(this.id+"-pie-chart-1");this._chart1.container.css("position","relative");c.append(this._chart1.container);this._layer1=new ia.AdvancedPieLayer;
this._layer1.thematic=this.thematic;this._layer1.highlightColor=this.highlightColor;this._layer1.selectionColor=this.selectionColor;this._layer1.tip=this.tip;this._layer1.setVisible(!0);this._layer1.interactive=!0;b.addComponent(this._layer1);this._chart1.addLayer(this._layer1);this._multiLayout?(this._chartTitle2=$j("<div>").html(""),d.append(this._chartTitle2),this._chart2=new ia.PieChart(this.id+"-pie-chart-2"),this._chart2.container.css("position","relative"),d.append(this._chart2.container),
this._layer2=new ia.AdvancedPieLayer,this._layer2.thematic=this.thematic,this._layer2.highlightColor=this.highlightColor,this._layer2.selectionColor=this.selectionColor,this._layer2.tip=this.tip,this._layer2.setVisible(!0),this._layer2.interactive=!0,b.addComponent(this._layer2),this._chart2.addLayer(this._layer2),this._chart2.addEventListener(ia.Event.MAP_READY,function(){a!=void 0&&a.call(null)})):this._chart1.addEventListener(ia.Event.MAP_READY,function(){a!=void 0&&a.call(null)})};
ia.AreaBreakdownPieComponent.prototype.setData=function(a){this._data=a;this._layer1.setData(a);this._multiLayout&&this._layer2.setData(a)};
ia.AreaBreakdownPieComponent.prototype.highlight=function(a){if(this._multiLayout)if(this._selectionIds.length==1)this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName);else{if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)}else if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)};
ia.AreaBreakdownPieComponent.prototype.clearHighlight=function(){if(this._multiLayout)if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render();else{if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};
ia.AreaBreakdownPieComponent.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._multiLayout?this._selectionIds.length>1?(this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName))};
ia.AreaBreakdownPieComponent.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);if(this._multiLayout)if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render();else{if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),
this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};ia.AreaBreakdownPieComponent.prototype.clearSelection=function(){this._selectionIds=[];this._layer1.itemId=null;this._layer1.update();this._layer1.render();this._chartTitle1.html(this.title1);if(this._multiLayout)this._layer2.itemId=null,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this.title2)};
ia.AreaBreakdownPieComponent.prototype.render=function(){this._layer1.update();this._layer1.render();this._chartTitle1.html()==""&&this._chartTitle1.html(this.title1);this._multiLayout&&(this._layer2.update(),this._layer2.render(),this._chartTitle2.html()==""&&this._chartTitle2.html(this.title2))};ia.AreaBreakdownPieComponent.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.AreaBreakdownPieComponent.prototype.hide=function(){if(this._isVisible)this._isVisible=!1,this.container.stop(),this.container.animate({opacity:0},function(){})};ia.AreaBreakdownPieComponent.prototype.show=function(){if(!this._isVisible)this._isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};ia.BoundingBox=function(a,b,c,d){this.setXMin(a||0);this.setYMin(b||0);this.setXMax(c||100);this.setYMax(d||100)};ia.BoundingBox.prototype.left=function(){return this._xMin};
ia.BoundingBox.prototype.right=function(){return this._xMax};ia.BoundingBox.prototype.bottom=function(){return this._yMin};ia.BoundingBox.prototype.top=function(){return this._yMax};ia.BoundingBox.prototype.getXMin=function(){return this._xMin};ia.BoundingBox.prototype.setXMin=function(a){this._xMin=a;this._width=Math.abs(this._xMax-this._xMin);this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getXMax=function(){return this._xMax};
ia.BoundingBox.prototype.setXMax=function(a){this._xMax=a;this._width=Math.abs(this._xMax-this._xMin);this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getXCenter=function(){return this._xCenter};ia.BoundingBox.prototype.setXCenter=function(a){this._xCenter=a;this._xMin=this._xCenter-this._width/2;this._xMax=this._xCenter+this._width/2};ia.BoundingBox.prototype.getWidth=function(){return this._width};
ia.BoundingBox.prototype.setWidth=function(a){this._width=a;this._xMax=this._xMin+this._width;this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getYMin=function(){return this._yMin};ia.BoundingBox.prototype.setYMin=function(a){this._yMin=a;this._height=Math.abs(this._yMax-this._yMin);this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.getYMax=function(){return this._yMax};
ia.BoundingBox.prototype.setYMax=function(a){this._yMax=a;this._height=Math.abs(this._yMax-this._yMin);this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.getYCenter=function(){return this._yCenter};ia.BoundingBox.prototype.setYCenter=function(a){this._yCenter=a;this._yMin=this._yCenter-this._height/2;this._yMax=this._yCenter+this._height/2};ia.BoundingBox.prototype.getHeight=function(){return this._height};
ia.BoundingBox.prototype.setHeight=function(a){this._height=a;this._yMax=this._yMin+this._height;this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.clone=function(){return new ia.BoundingBox(this._xMin,this._yMin,this._xMax,this._yMax)};ia.BoundingBox.prototype.equals=function(a){return a.getXMin()!=this._xMin?!1:a.getYMin()!=this._yMin?!1:a.getXMax()!=this._xMax?!1:a.getYMax()!=this._yMax?!1:!0};
ia.BoundingBox.prototype.intersects=function(a){return a.getXMin()>this._xMax?!1:a.getXMax()<this._xMin?!1:a.getYMin()>this._yMax?!1:a.getYMax()<this._yMin?!1:!0};ia.BoundingBox.prototype.contains=function(a){return a.getXMin()<this._xMin?!1:a.getXMax()>this._xMax?!1:a.getYMin()<this._yMin?!1:a.getYMax()>this._yMax?!1:!0};
ia.BoundingBox.prototype.addMargin=function(a){var b=this.clone(),a=a||0.2,c=b.getWidth()*a;a*=b.getHeight();var d=b.getXCenter(),e=b.getYCenter();b.setWidth(b.getWidth()+c*2);b.setHeight(b.getHeight()+a*2);b.setXCenter(d);b.setYCenter(e);return b};ia.BoundingBox.prototype.toString=function(){return"[object ia.BoundingBox xMin='"+this._xMin+"' yMin='"+this._yMin+"' xMax='"+this._xMax+"' yMax='"+this._yMax+"']"};
ia.BBoxEvent=function(a,b,c,d){ia.BBoxEvent.baseConstructor.call(this,a,b);this.bBox=c;this.oldBBox=d};ia.extend(ia.Event,ia.BBoxEvent);ia.BBoxEvent.BBOX_TRANSLATE=0;ia.BBoxEvent.BBOX_SCALE=1;ia.CartesianSpace=function(a,b,c,d){ia.CartesianSpace.baseConstructor.call(this);this.canvasX=a||0;this.canvasY=b||0;this.canvasWidth=c||0;this.canvasHeight=d||0;this.bBox=new ia.BoundingBox;this.oldBBox=new ia.BoundingBox;this.maxZoom=this.minZoom=-1;this.maintainAspectRatio=!1};
ia.extend(ia.EventDispatcher,ia.CartesianSpace);ia.CartesianSpace.prototype.getBBox=function(){return this.bBox};ia.CartesianSpace.prototype.setBBox=function(a){this.oldBBox=this.bBox.clone();this.bBox=a.clone();this.commitChanges()};ia.CartesianSpace.prototype.getPixelPoint=function(a){return new ia.Point(this.getPixelX(a.x),this.getPixelY(a.y))};
ia.CartesianSpace.prototype.getPixelRect=function(a){return new ia.Rectangle(this.getPixelX(a.getXMin()),this.getPixelY(a.getYMax()),this.getPixelWidth(a.getWidth()),this.getPixelHeight(a.getHeight()))};ia.CartesianSpace.prototype.getPixelX=function(a){return this.canvasX+this.getPixelWidth(a-this.bBox.getXMin())};ia.CartesianSpace.prototype.getPixelY=function(a){return this.canvasY+this.canvasHeight-this.getPixelHeight(a-this.bBox.getYMin())};
ia.CartesianSpace.prototype.getPixelWidth=function(a){return a==0?0:a/this.bBox.getWidth()*this.canvasWidth};ia.CartesianSpace.prototype.getPixelHeight=function(a){return a==0?0:a/this.bBox.getHeight()*this.canvasHeight};ia.CartesianSpace.prototype.getDataPoint=function(a){return new ia.Point(this.getDataX(a.x),this.getDataY(a.y))};
ia.CartesianSpace.prototype.getDataBBox=function(a){var b=this.getPixelX(a.left()),c=this.getPixelY(a.bottom()),d=b+this.getPixelWidth(a.width),a=c+this.getPixelHeight(a.height);return new ia.BoundingBox(b,c,d,a)};ia.CartesianSpace.prototype.getDataX=function(a){return this.bBox.getXMin()+this.getDataWidth(a)};ia.CartesianSpace.prototype.getDataY=function(a){return this.bBox.getYMin()+this.getDataHeight(this.canvasHeight-a)};
ia.CartesianSpace.prototype.getDataWidth=function(a){return a==0?0:a/this.canvasWidth*this.bBox.getWidth()};ia.CartesianSpace.prototype.getDataHeight=function(a){return a==0?0:a/this.canvasHeight*this.bBox.getHeight()};
ia.CartesianSpace.prototype.commitChanges=function(){this.maintainAspectRatio&&this.adjustBBox(this.bBox);var a=!0;this.minZoom!=-1&&Math.max(this.bBox.getWidth(),this.bBox.getHeight())>this.minZoom&&(a=!1);this.maxZoom!=-1&&Math.min(this.bBox.getWidth(),this.bBox.getHeight())<this.maxZoom&&(a=!1);a?(eventType=this.bBox.getWidth()==this.oldBBox.getWidth()&&this.bBox.getHeight()==this.oldBBox.getHeight()?ia.BBoxEvent.BBOX_TRANSLATE:ia.BBoxEvent.BBOX_SCALE,this.dispatchEvent(new ia.BBoxEvent(eventType,
this,this.bBox,this.oldBBox))):this.bBox=this.oldBBox.clone()};
ia.CartesianSpace.prototype.adjustBBox=function(a){var b=a.getHeight()/this.canvasHeight,c=a.getWidth()/this.canvasWidth,d,e;b>c?(c=a.getYMin(),e=a.getHeight(),d=this.canvasWidth/this.canvasHeight*e,b=a.getXMin()-(d-a.getWidth())/2):c>b?(b=a.getXMin(),d=a.getWidth(),e=this.canvasHeight/this.canvasWidth*d,c=a.getYMin()-(e-a.getHeight())/2):(b=a.getXMin(),c=a.getYMin(),d=a.getWidth(),e=a.getHeight());a.setXMin(b);a.setYMin(c);a.setWidth(d);a.setHeight(e)};
ia.CartesianSpace.prototype.adjustY=function(a){var b=a.getXMin(),c=a.getWidth(),d=this.canvasHeight/this.canvasWidth*c,e=a.getYMin()-(d-a.getHeight())/2;a.setXMin(b);a.setYMin(e);a.setWidth(c);a.setHeight(d)};ia.Rectangle=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};ia.Rectangle.prototype.left=function(){return this.x};ia.Rectangle.prototype.right=function(){return this.x+this.width};ia.Rectangle.prototype.bottom=function(){return this.y+this.height};
ia.Rectangle.prototype.top=function(){return this.y};ia.Rectangle.prototype.clone=function(){return new ia.Rectangle(this.x,this.y,this.width,this.height)};ia.Rectangle.prototype.intersects=function(a,b){return b<this.top()?!1:b>this.bottom()?!1:a>this.right()?!1:a<this.left()?!1:!0};
ia.Rectangle.prototype.intersectsLine=function(a,b){return this.lineIntersectsLine({x:this.left(),y:this.top()},{x:this.right(),y:this.top()},a,b)||this.lineIntersectsLine({x:this.right(),y:this.top()},{x:this.right(),y:this.bottom()},a,b)||this.lineIntersectsLine({x:this.right(),y:this.bottom()},{x:this.left(),y:this.bottom()},a,b)||this.lineIntersectsLine({x:this.left(),y:this.bottom()},{x:this.left(),y:this.top()},a,b)||this.intersects(a.x,a.y)&&this.intersects(b.x,b.y)};
ia.Rectangle.prototype.lineIntersectsLine=function(a,b,c,d){var e=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),f=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),a=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);return a!=0?(e/=a,f/=a,0<=e&&e<=1&&0<=f&&f<=1?!0:!1):!1};ia.Rectangle.prototype.toString=function(){return"[object Rectangle x='"+this.x+"' y='"+this.y+"' width='"+this.width+"' height='"+this.height+"']"};ia.Point=function(a,b){this.x=a||0;this.y=b||0};
ia.Point.prototype.subtract=function(a){return new ia.Point(this.x-a.x,this.y-a.y)};ia.Point.prototype.toString=function(){return"[object Point x='"+this.x+"' y='"+this.y+"']"};ia.ChartTip=function(a){this._container=a;this._tipContainer=$j("<svg>").addClass("ia-datatip").hide();$j("body").append(this._tipContainer)};
ia.ChartTip.prototype.position=function(a,b){var c=$j("body").width(),d=$j("body").height(),e=this._tipContainer.outerWidth(),f=this._tipContainer.outerHeight();this._container!=void 0&&(a+=this._container.offset().left,b+=this._container.offset().top);a<10?a=10:(c=a+e-(c-10),c>0&&(a-=c));b<10?b=10:(d=b+f-(d-10),d>0&&(b-=d));this._tipContainer.css("left",a+"px").css("top",b+"px")};ia.ChartTip.prototype.text=function(a){this._tipContainer.html(a)};ia.ChartTip.prototype.getWidth=function(){return this._tipContainer.outerWidth()};
ia.ChartTip.prototype.getHeight=function(){return this._tipContainer.outerHeight()};ia.ChartTip.prototype.show=function(){this._tipContainer.css("display","inline")};ia.ChartTip.prototype.hide=function(){this._tipContainer.css("display","none")};
ia.CanvasBase=function(a){ia.CanvasBase.baseConstructor.call(this,0,0,100,100);this._touchStart=0;this._pinching=this._mouseOverMap=this._mouseDragged=this._dragging=this._mouseDown=!1;this._layers=[];this._mouseDownY=this._mouseDownX=0;this.id=a;this.isVisible=!0;this.mouseY=this.mouseX=0;this.animationMode=this.isDraggable=this.embeddedInGoogleMaps=!1;this.container=$j("<div id='"+a+"' class='ia-chart'>");this.mapContainer=$j("<div id='mapContainer'>");this.backgroundContainer=$j("<div id='backgroundContainer'>");
this.layerContainer=$j("<div id='layercontainer'>");this.foregroundContainer=$j("<div id='foregroundContainer'>");this.mapContainer.append(this.backgroundContainer);this.mapContainer.append(this.layerContainer);this.mapContainer.append(this.foregroundContainer);this.container.append(this.mapContainer);this.labelStyle=$j("<div class='ia-map-labels' style='visibility:hidden'>");this.mapContainer.append(this.labelStyle);this.canvas=this._createCanvas(this.backgroundContainer);this.context=this.canvas.getContext("2d");
this.foregroundCanvas=this._createCanvas(this.foregroundContainer);this.foregroundContext=this.foregroundCanvas.getContext("2d");this.datatip=new ia.ChartTip(this.foregroundContainer);this._addListeners();var b,c=!1,d=this;this.container.resize(function(){clearTimeout(b);b=setTimeout(function(){clearTimeout(b);var a=d.container.width(),f=d.container.height();d.foregroundContainer.width(a);d.foregroundContainer.height(f);d.canvas.width=a;d.canvas.height=f;d.foregroundCanvas.width=a;d.foregroundCanvas.height=
f;d.canvasX=0;d.canvasY=0;d.canvasWidth=a;d.canvasHeight=f;a=new ia.Event(ia.Event.MAP_RESIZE,d);d.dispatchEvent(a);d.commitChanges();c==!1&&(c=!0,a=new ia.Event(ia.Event.MAP_READY,d),d.dispatchEvent(a))},500)}.bind(this))};ia.extend(ia.CartesianSpace,ia.CanvasBase);ia.CanvasBase.prototype._createCanvas=function(a){var b=document.createElement("canvas");b.width=a.width();b.height=a.height();$j(b).css({position:"absolute",left:0,top:0});a.append($j(b));return b};
ia.CanvasBase.prototype._addListeners=function(){if(ia.IS_TOUCH_DEVICE)this.mapContainer.on("touchstart.canvasbase touchmove.canvasbase touchend.canvasbase",this._touchEventHandler.bind(this));else{this.mapContainer.on("mousemove.canvasbase mouseup.canvasbase mouseenter.canvasbase mouseleave.canvasbase mousedown.canvasbase click.canvasbase",this._mouseEventHandler.bind(this));var a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener&&document.addEventListener(a,
this._mouseEventHandler.bind(this),!1)}};
ia.CanvasBase.prototype._mouseEventHandler=function(a){var b=!0,c=$j("#widget-"+this.id);c&&c.css("visibility")=="hidden"&&(b=!1);if(this.isVisible&&b){var d;this.mouseX=a.pageX-this.container.offset().left;this.mouseY=a.pageY-this.container.offset().top;this._mouseOverMap=this.mouseX>this.canvasX&&this.mouseX<this.canvasX+this.canvasWidth&&this.mouseY>this.canvasY&&this.mouseY<this.canvasY+this.canvasHeight?!0:!1;if(a.type=="mouseenter")d=ia.MapMouseEvent.MAP_MOUSE_OVER,this._dragging&&$j(document).off(".canvasbasedoc"),
this._mouseOverMap=!0;else if(a.type=="mouseleave"){d=ia.MapMouseEvent.MAP_MOUSE_OUT;if(this._dragging)$j(document).on("mousemove.canvasbasedoc mouseup.canvasbasedoc",this._mouseEventHandler.bind(this));this._mouseOverMap=!1}else if(a.type=="mousemove")if(this._mouseOverMap=!0,this._mouseDown&&(this._mouseDownX!=a.pageX||this._mouseDownY!=a.pageY))d=ia.MapMouseEvent.MAP_MOUSE_DRAG,this._dragging=!0;else{if(this._mouseOverMap)d=ia.MapMouseEvent.MAP_MOUSE_MOVE}else if(a.type=="mouseup"){if(this._dragging)d=
ia.MapMouseEvent.MAP_MOUSE_DRAG_UP,$j(document).off(".canvasbasedoc"),this._dragging=!1,this._mouseDragged=!0;else if(this._mouseOverMap)d=ia.MapMouseEvent.MAP_MOUSE_UP;this._mouseDown=!1}else if(a.type=="mousedown")d=ia.MapMouseEvent.MAP_MOUSE_DOWN,this._mouseDownX=a.pageX,this._mouseDownY=a.pageY,this._mouseDragged=!1,this._mouseDown=!0;else if(a.type=="mousewheel"||a.type=="onmousewheel"||a.type=="DOMMouseScroll")this._mouseOverMap&&a.preventDefault(),d=ia.MapMouseEvent.MAP_MOUSE_WHEEL;else if(a.type==
"click"){if(this._mouseDragged==!1)d=ia.MapMouseEvent.MAP_MOUSE_CLICK;this._mouseDragged=this._mouseDown=this._dragging=!1}d!=null&&(b=this.getDataX(this.mouseX),c=this.getDataY(this.mouseY),this.dispatchEvent(new ia.MapMouseEvent(this,a,d,b,c,this.mouseX,this.mouseY,void 0,void 0,a.pageX,a.pageY)))}};
ia.CanvasBase.prototype._touchEventHandler=function(a){if(this.isVisible){var b;this.embeddedInGoogleMaps||a.preventDefault();var c,d,e,f;if(a.originalEvent.touches.length==2){var g=a.originalEvent.touches[0];f=a.originalEvent.touches[1];c=g.pageX-this.container.offset().left;d=g.pageY-this.container.offset().top;e=f.pageX-this.container.offset().left;f=f.pageY-this.container.offset().top;if(a.type=="touchstart")b=ia.MapMouseEvent.MAP_PINCH_DOWN;else if(a.type=="touchmove")b=ia.MapMouseEvent.MAP_PINCH_MOVE,
this._pinching=!0}else if(g=a.originalEvent.changedTouches[0],c=g.pageX-this.container.offset().left,d=g.pageY-this.container.offset().top,f=e=null,a.type=="touchstart")this._touchStart=(new Date).getTime(),b=ia.MapMouseEvent.MAP_MOUSE_DOWN;else if(a.type=="touchmove")this._pinching?(this.mouseX=c,this.mouseY=d,mouseDownCoords=this.mouseCoords(),mouseDownPixels=new ia.Point(this.mouseX,this.mouseY),this._pinching=!1,doPan=this._dragging=!0):(b=this.isDraggable?ia.MapMouseEvent.MAP_MOUSE_DRAG:ia.MapMouseEvent.MAP_MOUSE_MOVE,
this._dragging=!0);else if(a.type=="touchend")if(b=(new Date).getTime()-this._touchStart,this._dragging)b=this.isDraggable?ia.MapMouseEvent.MAP_MOUSE_DRAG_UP:ia.MapMouseEvent.MAP_MOUSE_UP,this._dragging=!1;else if(this._pinching){if(b=ia.MapMouseEvent.MAP_PINCH_UP,a.originalEvent.touches.length==0)this._pinching=!1}else b=b<500?ia.MapMouseEvent.MAP_MOUSE_CLICK:ia.MapMouseEvent.MAP_MOUSE_UP;if(b!=null){e!=null?(this.mouseX=Math.min(c,e),this.mouseY=Math.min(d,f)):(this.mouseX=c,this.mouseY=d);f=this.getDataX(this.mouseX);
var h=this.getDataY(this.mouseY);this.dispatchEvent(new ia.MapMouseEvent(this,a,b,f,h,c,d,e,g.pageX,g.pageX))}}};ia.CanvasBase.prototype.mouseCoords=function(){var a=this.getDataX(this.mouseX),b=this.getDataY(this.mouseY);return new ia.Point(a,b)};
ia.CanvasBase.prototype.exportData=function(a){for(var b=0;b<this._layers.length;b++){var c=this._layers[b];c.geometry!="image"&&c.canvas&&(this.context.drawImage(c.canvas,0,0),c.selectionCanvas&&this.context.drawImage(c.selectionCanvas,0,0),c.labelCanvas&&this.context.drawImage(c.labelCanvas,0,0))}b=this.canvas.toDataURL("image/png");window.open().document.write('<div style="font-family:Verdana;font-size:12px;color:#888888;">'+a+'</div><p><img style="border-width:1px;border-style:solid;border-color:#DCDCDC;" src="'+
b+'"/></p>');this.clear();this.render()};ia.CanvasBase.prototype.render=function(){this.datatip.hide();for(var a=0;a<this._layers.length;a++)this._layers[a].render()};ia.CanvasBase.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a=0;a<this._layers.length;a++)this._layers[a].clear()};ia.CanvasBase.prototype.clearForeground=function(){this.foregroundContext.clearRect(0,0,this.foregroundCanvas.width,this.foregroundCanvas.height)};
ia.CanvasBase.prototype.addLayer=function(a){this._layers.push(a);a.setMap(this,this.layerContainer)};ia.CanvasBase.prototype.getLayers=function(){return this._layers};ia.CanvasBase.prototype.removeLayers=function(){for(var a=0;a<this._layers.length;a++){var b=this._layers[a];b.removeCanvases();this.removeListener(b)}this._layers=[]};ia.CanvasBase.prototype.getLayer=function(a){for(var b=0;b<this._layers.length;b++){var c=this._layers[b];if(c.id==a)return c}};
ia.CanvasBase.prototype.startDrag=function(){this._dragging=!0};ia.CanvasBase.prototype.endDrag=function(){$j(document).off(".canvasbasedoc");this._dragging=!1;this._mouseDragged=!0;this._mouseDown=!1};ia.CanvasBase.prototype.toggle=function(){this.isVisible?this.hide():this.show()};ia.CanvasBase.prototype.hide=function(){if(this.isVisible){var a=this;a.isVisible=!1;a.container.stop();a.container.animate({opacity:0},function(){a.clear()})}};
ia.CanvasBase.prototype.show=function(){if(!this.isVisible)this.isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};
ia.ChartBase=function(a){ia.ChartBase.baseConstructor.call(this,a);this.itemStyle=$j("<div class='ia-chart-items' style='visibility:hidden'>");this.mapContainer.append(this.itemStyle);this.orientation="vertical";this.showXAxisLabels=!0;this.xAxisTitle=void 0;this.showYAxisLabels=!0;this.yAxisTitle=void 0;this.showRightBorder=this.showLeftBorder=this.showTopBorder=this.showBottomBorder=this.showBox=!1;this.showYAxisGrid=this.showXAxisGrid=!0;this.useTightLabels=this.showYAxisTickMarks=this.showXAxisTickMarks=
this.centerYAxisLabels=this.centerXAxisLabels=!1;this.formatter=new ia.Formatter;this.wrapXAxisLabels=!1;var b=this,c=!1;b.addEventListener(ia.Event.MAP_READY,function(){c=!0});b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,function(){c&&b.render()});b.addEventListener(ia.BBoxEvent.BBOX_SCALE,function(){c&&b.render()})};ia.extend(ia.CanvasBase,ia.ChartBase);
ia.ChartBase.prototype.renderAxes=function(a,b,c,d){if(ia.isNumber(a)&&ia.isNumber(b)&&ia.isNumber(c)&&ia.isNumber(d)&&this.canvas.width>0&&this.canvas.height>0){var e="Verdana",f="#AAAAAA",g=10,h="#E5E5E5";this.container.css("font-family")&&(e=this.container.css("font-family"));this.container.css("color")&&(f=ia.Color.toHex(this.container.css("color")));this.container.css("font-size")&&(g=this.container.css("font-size"),g.indexOf("px")>-1&&(g=g.substring(0,g.indexOf("px"))),g=ia.parseInt(g));this.container.css("borderRightColor")&&
(h=ia.Color.toHex(this.container.css("borderRightColor")));this.canvasY=this.canvasX=0;this.canvasWidth=this.canvas.width;this.canvasHeight=this.canvas.height;this.context.lineWidth=1;this.context.strokeStyle=h;this.context.font=""+g+"px "+e;this.context.fillStyle=f;g+=2;var k=g+10,h=f=20,i=10,e=10;if(this.showYAxisLabels){var l=this.canvasHeight-(e+i),j=this._getYAxisLabels(c,d,5,l,k);f+=this._getMaxLabelWidth(j,5);this.centerYAxisLabels||(i+=k/2,e+=k/2)}if(this.showXAxisLabels){var l=this.canvasWidth-
(f+h),m=this._getXAxisLabels(a,b,5,l,5),j=k;if(this.wrapXAxisLabels)var n=l/m.length,j=this._getMaxLabelHeight(m,5,g,n);i=10+j;this.centerXAxisLabels||(n=this._getLabelWidth(m[0],5),n>f-20&&(f=n/2+20),n=this._getLabelWidth(m[m.length-1],5),h+=n/2)}this.xAxisTitle!=void 0&&(n=this.canvasWidth-(f+h),j=this._getLabelHeight(this.xAxisTitle,5,g,n),i=i+j-5);this.yAxisTitle!=void 0&&(n=this.canvasHeight-(i+e),j=this._getLabelHeight(this.yAxisTitle,5,g,n),f=f+j-5);l=this.canvasWidth-(f+h);j=0;if(this.showXAxisLabels){m=
this._getXAxisLabels(a,b,5,l,5);j=k;this.wrapXAxisLabels&&(n=l/m.length,j=this._getMaxLabelHeight(m,5,g,n));i=0;this.xAxisTitle!=void 0&&(n=this.canvasWidth-(f+h),i=this._getLabelHeight(this.xAxisTitle,5,g,n));i=10+j+i;this.context.textAlign="center";this.context.textBaseline="top";var a=m.length,b=this.canvasHeight-i+5,o,p,q;this.centerXAxisLabels?(o=l/a,n=f+o/2,p=o,q=f):(o=l/(a-1),n=f,p=o,q=n);for(l=0;l<a;l++){var r=m[l];this.isPyramidChart==!0&&r.indexOf("-")!=-1&&(r=r.substring(1));this.wrapXAxisLabels?
this._wrapText(r,n,b,o-10,g):this.context.fillText(r,n,b);if(this.showXAxisTickMarks){var r=n,t=Math.floor(this.canvasHeight-i)+0.5,s=n,u=t+5;this.context.beginPath();this.context.moveTo(r,t);this.context.lineTo(s,u);this.context.stroke()}this.showXAxisGrid&&(r=Math.floor(q)+0.5,t=Math.floor(e)+0.5,s=r,u=Math.floor(this.canvasHeight-i)+0.5,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke());n+=o;q+=p}this.showXAxisGrid&&this.centerXAxisLabels&&(r=Math.floor(q)+
0.5,t=Math.floor(e)+0.5,s=r,u=Math.floor(this.canvasHeight-i)+0.5,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke())}if(this.xAxisTitle!=void 0)n=this.canvasWidth-(f+h),this.showXAxisLabels||(i=this._getLabelHeight(this.xAxisTitle,5,g,n),i=10+i),this.context.textAlign="center",this.context.textBaseline="top",a=this.canvasHeight-i+(j+5),this._wrapText(this.xAxisTitle,f+n/2,a,n,g);l=this.canvasHeight-(e+i);m=0;if(this.showYAxisLabels){j=this._getYAxisLabels(c,
d,5,l,k);m=this._getMaxLabelWidth(j,5);this.context.textAlign="right";this.context.textBaseline="middle";a=j.length;n=f-5;this.centerYAxisLabels?(c=l/a,b=e+c/2,d=c,k=e):(c=l/(a-1),b=e,d=c,k=b);for(l=0;l<a;l++)r=j[l],this.context.fillText(r,n,b),this.showYAxisTickMarks&&(r=Math.floor(f)+0.5,t=b,s=r-5,u=b,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke()),this.showYAxisGrid&&(r=Math.floor(f)+0.5,t=Math.floor(k)+0.5,s=Math.floor(this.canvasWidth-h)+0.5,
u=t,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke()),b+=c,k+=d;this.showYAxisGrid&&this.centerYAxisLabels&&(r=Math.floor(f)+0.5,t=Math.floor(k)+0.5,s=Math.floor(this.canvasWidth-h)+0.5,u=t,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke())}if(this.yAxisTitle!=void 0)n=this.canvasHeight-(i+e),j=this._getLabelHeight(this.yAxisTitle,5,g,n),a=e+n/2,c=f-m-j+5,this.context.save(),this.context.translate(c,a),
this.context.rotate(-Math.PI/2),this.context.textAlign="center",this.context.textBaseline="top",this._wrapText(this.yAxisTitle,0,0,n,g),this.context.restore();this.canvasX=f;this.canvasWidth-=f+h;this.canvasY=e;this.canvasHeight-=e+i;c=Math.floor(f)+0.5;f=Math.floor(f+this.canvasWidth)+0.5;d=Math.floor(e)+0.5;e=Math.floor(e+this.canvasHeight)+0.5;this.showBox&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(f,d),this.context.lineTo(f,e),this.context.lineTo(c,e),this.context.closePath(),
this.context.stroke());this.showBottomBorder&&(this.context.beginPath(),this.context.moveTo(c,e),this.context.lineTo(f,e),this.context.closePath(),this.context.stroke());this.showTopBorder&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(f,d),this.context.closePath(),this.context.stroke());this.showLeftBorder&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(c,e),this.context.closePath(),this.context.stroke());this.showRightBorder&&(this.context.beginPath(),
this.context.moveTo(f,d),this.context.lineTo(f,e),this.context.closePath(),this.context.stroke())}};ia.ChartBase.prototype._getLabelWidth=function(a,b){return this.context.measureText(a).width+b*2};ia.ChartBase.prototype._getMaxLabelWidth=function(a,b){for(var c=0,d=0;d<a.length;d++)c=Math.max(c,this._getLabelWidth(a[d],b));return c};ia.ChartBase.prototype._getLabelHeight=function(a,b,c,d){return this._getNoLines(a,d-b*2)*c+b*2};
ia.ChartBase.prototype._getMaxLabelHeight=function(a,b,c,d){for(var e=0,f=0;f<a.length;f++)e=Math.max(e,this._getLabelHeight(a[f],b,c,d));return e};ia.ChartBase.prototype._getNoLines=function(a,b){for(var c=a.split(" "),d="",e=1,f=0;f<c.length;f++)d=d+c[f]+" ",this.context.measureText(d).width>b&&(d=c[f]+" ",e++);return e};
ia.ChartBase.prototype._wrapText=function(a,b,c,d,e){for(var a=a.split(" "),f="",g=0;g<a.length;g++){var h=a[g],k;k=g==0?h:f+" "+h;var i=this.context.measureText(k).width;g!=0&&i>d?(this.context.fillText(f,b,c),f=h,c+=e):f=k}this.context.fillText(f,b,c)};ia.ChartBase.prototype._getXAxisLabels=function(a,b,c,d,e){return this.xAxisLabels?this._dropXLabels(this.xAxisLabels,d,e):this._calculateXAxisLabels(a,b,c,d,e)};
ia.ChartBase.prototype._calculateXAxisLabels=function(a,b,c,d,e){for(var f,g=!0,h=c;g;){f=this.useTightLabels?this._getTightLabels(a,b,h):this._getLooseLabels(a,b,h);var k=f.labels;f=f.values;c=k.length;if(c<3)k=[this.formatter.format(a),this.formatter.format(b)],f=[a,b],g=!1;else if(c==3)g=!1;else{for(var i=0,l=0;l<c;l++){var j=this.context.measureText(k[l]).width+e*2;i+=j}i>d?h--:g=!1}}a=this.getBBox();a.setXMin(f[0]);a.setXMax(f[f.length-1]);return k};
ia.ChartBase.prototype._dropXLabels=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;f++)for(var g=a[f].split(" "),h=g.length,k=0,i=0;i<h;i++){var l=g[i],j=this.context.measureText(l).width;j>k&&(k=j,d[f]=l)}e=d.concat();for(g=!0;g;){g=!1;for(f=k=0;f<e.length;f++)h=e[f],h!=""&&k++;if(k<=2){for(f=0;f<d.length;f++)e[f]="";e[0]=d[0];e[e.length-1]=d[d.length-1]}else{k=b/k;for(f=0;f<e.length;f++)if(h=e[f],h!=""&&this.context.measureText(h).width+c*2>k){g=!0;break}if(g)for(f=k=0;f<e.length;f++)h=e[f],h!=
""&&(k%2==0&&(e[f]=""),k++)}}for(f=0;f<d.length;f++)h=a[f],e[f]!=""&&(e[f]=h);return e};ia.ChartBase.prototype._getYAxisLabels=function(a,b,c,d,e){this.yAxisLabels?(a=this.yAxisLabels.concat(),a=this._dropYLabels(a,d,e)):(a=this._calculateYAxisLabels(a,b,c,d,e).concat(),a.reverse());return a};
ia.ChartBase.prototype._calculateYAxisLabels=function(a,b,c,d,e){for(var f,g=!0,h=c;g;){f=this.useTightLabels?this._getTightLabels(a,b,h):this._getLooseLabels(a,b,h);var k=f.labels;f=f.values;c=k.length;c<3?(k=[this.formatter.format(a),this.formatter.format(b)],f=[a,b],g=!1):c==3?g=!1:d/c<e?h--:g=!1}a=this.getBBox();a.setYMin(f[0]);a.setYMax(f[f.length-1]);return k};
ia.ChartBase.prototype._dropYLabels=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];d[e]=f}for(var g=!0;g;){for(var h=0,e=0;e<d.length;e++)f=d[e],f!=""&&h++;if(h<=2){for(e=0;e<a.length;e++)d[e]="";d[0]=a[0];d[d.length-1]=a[a.length-1];g=!1}else{for(e=h=0;e<d.length;e++)f=d[e],f!=""&&(h+=c);if(h>b)for(e=h=0;e<d.length;e++)f=d[e],f!=""&&(h%2==0&&(d[e]=""),h++);else g=!1}}return d};
ia.ChartBase.prototype.getAxisValues=function(a,b,c){var d=[];if(c<=2)d=[a,b];else for(var e=(b-a)/(c-1),f=0;f<c;f++)d[f]=f==c-1?b:a,a+=e;return d};ia.ChartBase.prototype._getLooseLabels=function(a,b,c){for(var c=ia.getNiceNum((b-a)/(c-1),!0),a=Math.floor(a/c)*c,b=Math.ceil(b/c)*c,d=Math.max(-1*Math.floor(ia.log10(c)),0),e=[],f=[];a<b+0.5*c;a+=c)e[e.length]=ia.round(a,d),f[f.length]=this.formatter.format(ia.round(a,d));return{values:e,labels:f}};
ia.ChartBase.prototype._getTightLabels=function(a,b,c){var d=(b-a)/(c-1),e=parseFloat(a),f=[];f.push(a);for(a=1;a<c-1;a++)e+=d,f.push(e);f.push(b);b=[];d=ia.getPrecision(f);for(a=0;a<c;a++)b.push(this.formatter.format(f[a],d));return{values:f,labels:b}};ia.BarChart=function(a){ia.BarChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.BarChart);
ia.BarChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;d=this.getBBox();this.orientation=="vertical"?(this.showXAxisLabels=!1,this.showYAxisLabels=!0,this.showXAxisGrid=
!1,this.showYAxisGrid=!0,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisLabels=!0,this.showYAxisLabels=!1,this.showXAxisGrid=!0,this.showYAxisGrid=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.GridChart=function(a){ia.GridChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.GridChart);
ia.GridChart.prototype.render=function(){this.clear();for(var a=this.getLayers(),b=0;b<a.length;b++)a[b].update();b=this.getBBox();this.yAxisLabels=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.centerXAxisLabels=!1;this.centerYAxisLabels=!0;this.showXAxisLabels=!1;this.showYAxisLabels=!0;this.showYAxisGrid=this.showXAxisGrid=!1;this.renderAxes(b.getXMin(),b.getXMax(),b.getYMin(),b.getYMax());for(b=0;b<a.length;b++)a[b].render()};
ia.PyramidChart=function(a){ia.PyramidChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1;this.isPyramidChart=!0};ia.extend(ia.ChartBase,ia.PyramidChart);
ia.PyramidChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update(this.date);a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;Math.abs(a)>b?b=Math.abs(a):a=b*-1;d=this.getBBox();this.showXAxisGrid=this.showXAxisLabels=
this.centerYAxisLabels=!0;this.showYAxisGrid=!1;this.renderAxes(a,b,d.getYMin(),d.getYMax());for(d=0;d<c.length;d++)c[d].render()};ia.TimeChart=function(a){ia.TimeChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.TimeChart);
ia.TimeChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;d=this.getBBox();this.orientation=="vertical"?(this.centerXAxisLabels=!0,this.showXAxisGrid=this.centerYAxisLabels=!1,this.showYAxisGrid=!0,this.renderAxes(d.getXMin(),
d.getXMax(),a,b)):(this.centerXAxisLabels=!1,this.showXAxisGrid=this.centerYAxisLabels=!0,this.showYAxisGrid=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.PieChart=function(a){ia.PieChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.PieChart);ia.PieChart.prototype.render=function(){this.clear();for(var a=this.getLayers(),b=0;b<a.length;b++){var c=a[b];c.update();c.render()}};ia.BoxChart=function(a){ia.BoxChart.baseConstructor.call(this,a)};
ia.extend(ia.ChartBase,ia.BoxChart);
ia.BoxChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;d=this.getBBox();this.orientation=="vertical"?(this.showXAxisLabels=!1,this.showYAxisLabels=!0,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisLabels=
!0,this.showYAxisLabels=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.TimeBarChart=function(a){ia.TimeBarChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.TimeBarChart);
ia.TimeBarChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;d=this.getBBox();this.orientation=="vertical"?(this.showXAxisGrid=!1,this.centerXAxisLabels=this.showYAxisGrid=
!0,this.centerYAxisLabels=!1,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisGrid=!0,this.centerXAxisLabels=this.showYAxisGrid=!1,this.centerYAxisLabels=!0,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.Plot=function(a){ia.Plot.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.Plot);
ia.Plot.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=Infinity,d=-Infinity,e=this.getLayers(),f=0;f<e.length;f++){var g=e[f];g.update();a=Math.min(a,g.xMinValue);b=Math.max(b,g.xMaxValue);c=Math.min(c,g.yMinValue);d=Math.max(d,g.yMaxValue)}if(this.fixedMinValueX!=void 0)a=this.fixedMinValueX;if(this.fixedMaxValueX!=void 0)b=this.fixedMaxValueX;if(this.fixedMinValueY!=void 0)c=this.fixedMinValueY;if(this.fixedMaxValueY!=void 0)d=this.fixedMaxValueY;a==b&&(b<0?b=0:a=0);c==
d&&(d<0?d=0:c=0);if(a==Infinity||b==-Infinity)a=0,b=100;if(c==Infinity||d==-Infinity)c=0,d=100;this.renderAxes(a,b,c,d);for(f=0;f<e.length;f++)e[f].render()};ia.StackedTimeChart=function(a){ia.StackedTimeChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.StackedTimeChart);
ia.StackedTimeChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;d=this.getBBox();this.orientation=="vertical"?(this.showXAxisGrid=!1,this.centerXAxisLabels=
this.showYAxisGrid=!0,this.centerYAxisLabels=!1,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisGrid=!0,this.centerXAxisLabels=this.showYAxisGrid=!1,this.centerYAxisLabels=!0,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.LayerBase=function(){ia.LayerBase.baseConstructor.call(this);this.showLabels=this.interactive=this.isLoaded=this.showInLayerList=this._visible=!1;this.showDataTips=!0};ia.extend(ia.EventDispatcher,ia.LayerBase);
ia.LayerBase.prototype.loadSource=function(){this.isLoaded=!0;this.dispatchEvent(new ia.Event(ia.Event.LAYER_READY,this))};ia.LayerBase.prototype.getVisible=function(){return this._visible};ia.LayerBase.prototype.setVisible=function(a){this._visible=a;this.map&&(this._visible?(this.addCanvases(),this.render()):this.removeCanvases());this.dispatchEvent(new ia.Event(ia.Event.LAYER_VISIBLE_CHANGED,this))};
ia.LayerBase.prototype.setMap=function(a,b){this.map=a;var c=this;this._canvasContainer=$j("<div>");b.append(this._canvasContainer);if(this.interactive||this.showDataTips)a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_MOVE,this._mapEventHandler.bind(this),this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OVER,this._mapEventHandler.bind(this),this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OUT,this._mapEventHandler.bind(this),this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_CLICK,this._mapEventHandler.bind(this),
this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DOWN,this._mapEventHandler.bind(this),this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_UP,this._mapEventHandler.bind(this),this),a.addEventListener(ia.MapMouseEvent.MAP_MOUSE_WHEEL_END,this._mapEventHandler.bind(this),this);a.addEventListener(ia.Event.MAP_RESIZE,function(){var a=c.map.container.width(),b=c.map.container.height();if(c.canvas)c.canvas.width=a,c.canvas.height=b;if(c.selectionCanvas)c.selectionCanvas.width=a,c.selectionCanvas.height=
b;if(c.highlightCanvas)c.highlightCanvas.width=a,c.highlightCanvas.height=b;if(c.showLabels&&c.labelCanvas)c.labelCanvas.width=a,c.labelCanvas.height=b},this);this._visible&&this.addCanvases()};
ia.LayerBase.prototype.addCanvases=function(){var a=this.map.container.width(),b=this.map.container.height();if(this.canvas==void 0)this.canvas=this.createCanvas(this._canvasContainer),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b;if(this.interactive){if(this.selectionCanvas==void 0)this.selectionCanvas=this.createCanvas(this.map.foregroundContainer),this.selectionContext=this.selectionCanvas.getContext("2d"),this.selectionCanvas.width=a,this.selectionCanvas.height=
b;if(this.highlightCanvas==void 0)this.highlightCanvas=this.createCanvas(this.map.foregroundContainer),this.highlightContext=this.highlightCanvas.getContext("2d"),this.highlightCanvas.width=a,this.highlightCanvas.height=b}if(this.showLabels&&this.labelCanvas==void 0)this.labelCanvas=this.createCanvas(this._canvasContainer),this.labelContext=this.labelCanvas.getContext("2d"),this.labelCanvas.width=a,this.labelCanvas.height=b,this._setLabelStyle()};
ia.LayerBase.prototype.removeCanvases=function(){if(this.canvas!=void 0)$j(this.canvas).remove(),this.canvas=void 0;if(this.selectionCanvas!=void 0)$j(this.selectionCanvas).remove(),this.selectionCanvas=void 0;if(this.highlightCanvas!=void 0)$j(this.highlightCanvas).remove(),this.highlightCanvas=void 0;if(this.labelCanvas!=void 0)$j(this.labelCanvas).remove(),this.labelCanvas=void 0};ia.LayerBase.prototype._mapEventHandler=function(){};
ia.LayerBase.prototype.createCanvas=function(a){var b=document.createElement("canvas");b.width=a.width();b.height=a.height();$j(b).css({position:"absolute",left:0,top:0});a.append($j(b));return b};ia.LayerBase.prototype.render=function(){};ia.LayerBase.prototype.clear=function(){this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};
ia.ItemEvent=function(a,b,c,d,e,f,g,h){ia.ItemEvent.baseConstructor.call(this,a,b);this.item=b;this.x=c;this.y=d;this.dataX=e;this.dataY=f;this.pageX=g;this.pageY=h};ia.extend(ia.Event,ia.ItemEvent);ia.ItemEvent.NONE_ITEM_CLICK="noneItemClick";ia.ItemEvent.ITEM_CLICK="itemClick";ia.ItemEvent.ITEM_MOUSE_DOWN="itemMouseDown";ia.ItemEvent.ITEM_MOUSE_UP="itemMouseUp";ia.ItemEvent.ITEM_MOUSE_MOVE="itemMouseMove";ia.ItemEvent.ITEM_MOUSE_OVER="itemMouseOver";ia.ItemEvent.ITEM_MOUSE_OUT="itemMouseOut";
ia.ItemLayer=function(){ia.ItemLayer.baseConstructor.call(this);this._data={};this._rollOverItem=void 0;this._redrawSelectionTimeout=null;this.items={};this.itemArray=[];this.doHitTest=!0;this.style={fillStyle:"#ffffff",strokeStyle:"#bbbbbb",lineWidth:"1",lineJoin:"round"};this.selectionColor="#ff0000";this.highlightColor="#00ff00";this.selectionIds=[];this.dataField="value";this.dataChanged=!1;this.tip=""};ia.extend(ia.LayerBase,ia.ItemLayer);ia.ItemLayer.SELECTED="selected";
ia.ItemLayer.ROLLOVER_SELECTED="rollOverSelected";ia.ItemLayer.ROLLOVER="rollOver";ia.ItemLayer.UNSELECTED="unselected";ia.ItemLayer.prototype.getData=function(){return this._data};ia.ItemLayer.prototype.setData=function(a){this._data=a;this.dataChanged=!0};
ia.ItemLayer.prototype._setLabelStyle=function(){var a="Verdana",b=10,c="normal",d="#ffffff",e="#333333";this.map.labelStyle&&(this.map.labelStyle.css("font-family")&&(a=this.map.labelStyle.css("font-family")),this.map.labelStyle.css("color")&&(d=ia.Color.toHex(this.map.labelStyle.css("color"))),this.map.labelStyle.css("font-weight")&&(c=this.map.labelStyle.css("font-weight")),this.map.labelStyle.css("font-size")&&(b=this.map.labelStyle.css("font-size"),b.indexOf("px")>-1&&(b=b.substring(0,b.indexOf("px"))),
b=ia.parseInt(b)),this.map.labelStyle.css("borderRightColor")&&(e=ia.Color.toHex(this.map.labelStyle.css("borderRightColor"))));this.labelContext.font=c+" "+b+"px "+a;this.labelContext.lineWidth=2;this.labelContext.strokeStyle=e;this.labelContext.fillStyle=d};ia.ItemLayer.prototype.getItem=function(a){return this.items[a]};ia.ItemLayer.prototype.clearItems=function(){for(var a in this.items)delete this.items[a]};
ia.ItemLayer.prototype._mapEventHandler=function(a){a.type==ia.MapMouseEvent.MAP_MOUSE_OVER?this.doHitTest=!0:a.type==ia.MapMouseEvent.MAP_MOUSE_OUT?(this._hitTest(a),this.doHitTest=!1):this.doHitTest&&this._hitTest(a)};
ia.ItemLayer.prototype._hitTest=function(a){if((this.showDataTips||this.interactive)&&this.getVisible()){var b=a.type;if(b==ia.MapMouseEvent.MAP_MOUSE_MOVE||b==ia.MapMouseEvent.MAP_MOUSE_DOWN){for(var b=[],c=this.itemArray.length-1;c>=0;c--){var d=this.itemArray[c];d.disabled!=!0&&this.hitItem(d,a)&&(b[b.length]=d)}if(b.length>0)b[0].size&&b.sort(function(a,b){return a.size<b.size?-1:a.size>b.size?1:0}),d=b[0],this._rollOverItem&&d!=this._rollOverItem&&this._dispatchItemEvent(a,!1,this._rollOverItem),
this._rollOverItem=d,this._dispatchItemEvent(a,!0,this._rollOverItem);else if(this._rollOverItem)this._dispatchItemEvent(a,!1,this._rollOverItem),this._rollOverItem=null}else this._rollOverItem!=null?this._dispatchItemEvent(a,!0,this._rollOverItem):b==ia.MapMouseEvent.MAP_MOUSE_CLICK&&(ia.IS_TOUCH_DEVICE||this.dispatchEvent(new ia.ItemEvent(ia.ItemEvent.NONE_ITEM_CLICK,{parent:this})))}};ia.ItemLayer.prototype.hitItem=function(){return!1};
ia.ItemLayer.prototype._dispatchItemEvent=function(a,b,c){var d=c.state,e=a.type,f;if(b)if(e==ia.MapMouseEvent.MAP_MOUSE_MOVE)f=d==ia.ItemLayer.ROLLOVER||d==ia.ItemLayer.ROLLOVER_SELECTED?ia.ItemEvent.ITEM_MOUSE_MOVE:ia.ItemEvent.ITEM_MOUSE_OVER;else if(e==ia.MapMouseEvent.MAP_MOUSE_CLICK)f=ia.ItemEvent.ITEM_CLICK;else if(e==ia.MapMouseEvent.MAP_MOUSE_UP)f=ia.ItemEvent.ITEM_MOUSE_UP;else if(e==ia.MapMouseEvent.MAP_MOUSE_DOWN)f=ia.ItemEvent.ITEM_MOUSE_DOWN;else if(e==ia.MapMouseEvent.MAP_MOUSE_OUT)if(d==
ia.ItemLayer.ROLLOVER)f=ia.ItemEvent.ITEM_MOUSE_OUT;else{if(d==ia.ItemLayer.ROLLOVER_SELECTED)f=ia.ItemEvent.ITEM_MOUSE_OUT}else{if(e==ia.MapMouseEvent.MAP_MOUSE_WHEEL_END)f=ia.ItemEvent.ITEM_MOUSE_OVER}else if(e==ia.MapMouseEvent.MAP_MOUSE_MOVE&&(d==ia.ItemLayer.ROLLOVER||d==ia.ItemLayer.ROLLOVER_SELECTED))f=ia.ItemEvent.ITEM_MOUSE_OUT;if(f==ia.ItemEvent.ITEM_MOUSE_OVER)if(d==ia.ItemLayer.UNSELECTED)c.state=ia.ItemLayer.ROLLOVER;else{if(d==ia.ItemLayer.SELECTED)c.state=ia.ItemLayer.ROLLOVER_SELECTED}else if(f==
ia.ItemEvent.ITEM_CLICK)c.state=d==ia.ItemLayer.ROLLOVER_SELECTED||d==ia.ItemLayer.SELECTED?ia.ItemLayer.UNSELECTED:ia.ItemLayer.ROLLOVER_SELECTED;else if(f==ia.ItemEvent.ITEM_MOUSE_OUT)if(d==ia.ItemLayer.ROLLOVER)c.state=ia.ItemLayer.UNSELECTED;else if(d==ia.ItemLayer.ROLLOVER_SELECTED)c.state=ia.ItemLayer.SELECTED;a=new ia.ItemEvent(f,c,a.x,a.y,a.dataX,a.dataY,a.pageX,a.pageY);this._itemEventHandler(a);f!=null&&this.dispatchEvent(a)};
ia.ItemLayer.prototype._itemEventHandler=function(a){var b=a.item;this.interactive&&(a.type==ia.ItemEvent.ITEM_MOUSE_OVER?(ia.showPointerCursor(),this.clearHighlight(),this.highlightItem(b,this.highlightContext)):a.type==ia.ItemEvent.ITEM_MOUSE_DOWN&&ia.IS_TOUCH_DEVICE&&(this.clearHighlight(),this.highlightItem(b,this.highlightContext)),a.type==ia.ItemEvent.ITEM_CLICK?(b.state==ia.ItemLayer.UNSELECTED?(this._removeFromSelection(b.id),this.renderSelection()):(this._addToSelection(b.id),this.selectItem(b)),
this.clearHighlight()):a.type==ia.ItemEvent.ITEM_MOUSE_OUT?(ia.showDefaultCursor(),this.clearHighlight()):a.type==ia.ItemEvent.ITEM_MOUSE_UP?this.clearHighlight():a.type==ia.ItemEvent.NONE_ITEM_CLICK&&this.clearSelection());this.showDataTips&&(a.type==ia.ItemEvent.ITEM_MOUSE_OVER?this.showTip(b,a):a.type==ia.ItemEvent.ITEM_MOUSE_DOWN?ia.IS_TOUCH_DEVICE&&this.showTip(b,a):a.type==ia.ItemEvent.ITEM_MOUSE_MOVE?ia.IS_TOUCH_DEVICE||this.showTip(b,a):a.type==ia.ItemEvent.ITEM_MOUSE_OUT?ia.IS_TOUCH_DEVICE||
this.hideTip():a.type==ia.ItemEvent.ITEM_MOUSE_UP?this.hideTip():a.type==ia.ItemEvent.ITEM_CLICK&&this.hideTip())};ia.ItemLayer.prototype.tipFunction=function(a){return a.name};ia.ItemLayer.prototype.showTip=function(){};ia.ItemLayer.prototype.hideTip=function(){this.map.datatip.hide()};ia.ItemLayer.prototype._removeFromSelection=function(a){a=this.selectionIds.indexOf(a);a!=-1&&this.selectionIds.splice(a,1)};ia.ItemLayer.prototype._addToSelection=function(a){this.selectionIds.indexOf(a)==-1&&this.selectionIds.push(a)};
ia.ItemLayer.prototype.isSelected=function(a){return this.selectionIds.indexOf(a)!=-1?!0:!1};ia.ItemLayer.prototype.selectAll=function(){this.clearSelection();for(var a in this.items)this.select(a)};ia.ItemLayer.prototype.select=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.SELECTED,this._addToSelection(a),this.selectItem(b)};ia.ItemLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,this._removeFromSelection(a),this._triggerRenderSelection()};
ia.ItemLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._clearSelectionGraphics()};ia.ItemLayer.prototype._triggerRenderSelection=function(){if(!this._redrawSelectionTimeout)this._redrawSelectionTimeout=setTimeout(function(){this.renderSelection()}.bind(this),5)};
ia.ItemLayer.prototype.renderSelection=function(){this._redrawSelectionTimeout=null;this._clearSelectionGraphics();for(var a=this.selectionIds.length,b=0;b<a;b++){var c=this.items[this.selectionIds[b]];c&&this.selectItem(c)}};ia.ItemLayer.prototype.selectItem=function(){};ia.ItemLayer.prototype.highlight=function(a){(a=this.getItem(a))&&this.highlightItem(a)};ia.ItemLayer.prototype.clearHighlight=function(){this._clearHighlightGraphics()};ia.ItemLayer.prototype.highlightItem=function(){};
ia.ItemLayer.prototype.clear=function(){this._rollOverItem=null;this._clearHighlightGraphics();this._clearSelectionGraphics();this._clearLayerGraphics();this._clearLabelGraphics()};ia.ItemLayer.prototype._clearCanvas=function(a,b){a&&b.clearRect(0,0,a.width,a.height)};ia.ItemLayer.prototype._clearHighlightGraphics=function(){(this.showDataTips||this.interactive)&&this._clearCanvas(this.highlightCanvas,this.highlightContext)};
ia.ItemLayer.prototype._clearSelectionGraphics=function(){(this.showDataTips||this.interactive)&&this._clearCanvas(this.selectionCanvas,this.selectionContext)};ia.ItemLayer.prototype._clearLabelGraphics=function(){this.showLabels&&this.labelCanvas&&(this._clearCanvas(this.labelCanvas,this.labelContext),this._setLabelStyle())};ia.ItemLayer.prototype._clearLayerGraphics=function(){this._clearCanvas(this.canvas,this.context)};
ia.TimeLayer=function(){ia.TimeLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.selectedDate="";this.drawLinesThroughMissingValues=!0;this.highlightSelectedDate=!1};ia.extend(ia.ItemLayer,ia.TimeLayer);ia.TimeLayer.prototype.markerSize=7;
ia.TimeLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){var b=a[a.dates[0]],c=a.dates.length,d;for(d in b){var e=b[d],f={};f.id=e.id;f.name=e.name;f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;this.items[e.id]=f;this.itemArray.push(f);f.childItems=[];for(var g=0;g<c;g++){var h=a.dates[g],
e=a[h][d],k=e[this.dataField];if(ia.isNumber(k)){var i={};i.id=d+"~"+h;i.name=h;i.shape=new ia.Rectangle;i.hitArea=new ia.Rectangle;i.value=k;i.formattedValue=e[this.dataField+"_formatted"];if(this.isComparison){if(this.selectionIds.indexOf(f.id)!=-1)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k),f.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k)}else if(this.matchAxisToSelectedData==!1||
this.matchAxisToSelectedData==!0&&f.state==ia.ItemLayer.SELECTED)this.minValue=Math.min(this.minValue,i.value),this.maxValue=Math.max(this.maxValue,i.value);f.childItems[f.childItems.length]=i}else f.childItems[f.childItems.length]={name:h,value:void 0}}}}this.dataChanged=!1}};
ia.TimeLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);this.selectionContext.strokeStyle=ia.Color.toRGBA(this.selectionColor);a=this.itemArray.length;for(var b=0;b<a;b++)for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}if(this.highlightSelectedDate&&
this.getData().dates&&(this.context.fillStyle=ia.Color.toRGBA("#cccccc",0.2),this.context.lineWidth=0,b=this.getData().dates,c=b.indexOf(this.selectedDate),c!=-1))this.map.orientation=="vertical"?(a=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,d=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(a=this.map.canvasX,c=this.map.canvasY+c/b.length*this.map.canvasHeight,d=this.map.canvasWidth,b=this.map.canvasHeight/b.length),this.context.beginPath(),this.context.rect(a,c,d,
b),this.context.fill();this.renderSelection()};
ia.TimeLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical"){var d=this.map.canvasX,e=this.map.canvasWidth;if(this.map.centerXAxisLabels)var f=this.map.canvasWidth/(c*2),d=this.map.canvasX+f,e=this.map.canvasWidth-f*2;d=c==1?d:d+b/(c-1)*e;b=this.map.getPixelY(a.value)}else e=this.map.canvasY,f=this.map.canvasHeight,this.map.centerYAxisLabels&&(f=this.map.canvasHeight/(c*2),e=this.map.canvasY+f,f=this.map.canvasHeight-f*2),d=this.map.getPixelX(a.value),b=c==1?e:e+b/(c-
1)*f;e=c=this.markerSize;a.shape.x=d;a.shape.y=b;a.shape.width=c;a.shape.height=e;ia.IS_TOUCH_DEVICE?e=c=30:(c*=2,e*=2);a.hitArea.x=d-c/2;a.hitArea.y=b-e/2;a.hitArea.width=c;a.hitArea.height=e};ia.TimeLayer.prototype.selectItem=function(a){var b=this.selectionIds.length;if(this.colorPalette){var b=this.colorPalette.getColors(b),c=this.selectionIds.indexOf(a.id);this.selectionContext.strokeStyle=b[c]}this._drawItem(a,this.selectionContext)};
ia.TimeLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext)};
ia.TimeLayer.prototype._drawItem=function(a,b){var c=!0,d=a.childItems.length;b.beginPath();for(var e=0;e<d;e++){var f=a.childItems[e];f.value!=void 0?(c?b.moveTo(f.shape.x,f.shape.y):b.lineTo(f.shape.x,f.shape.y),c=!1):this.drawLinesThroughMissingValues!=!0&&(c=!0);if(this.map.animationMode&&f.name==this.selectedDate)break}b.stroke();for(e=0;e<d;e++)if(f=a.childItems[e],f.value!=void 0&&(b.beginPath(),ia.Shape.drawCircle(b,f.shape.x,f.shape.y,f.shape.width),b.fill(),b.stroke()),this.map.animationMode&&
f.name==this.selectedDate)break};ia.TimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.TimeLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${date}").join(e.name),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" : "+e.name+" : "+e.formattedValue);ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+30)):(c=e.shape.x+
e.shape.width/2-this.map.datatip.getWidth()/2,e=e.shape.y-e.shape.height/2-(this.map.datatip.getHeight()+5));this.map.datatip.position(c,e);this.map.datatip.show();break}}};ia.BarLayer=function(){ia.BarLayer.baseConstructor.call(this);this._maxBarWidth=20;this._barSize=this._minBarWidthForStroke=10;this.sortDirection="ascending"};ia.extend(ia.ItemLayer,ia.BarLayer);
ia.BarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b],d=c[this.dataField];if(ia.isNumber(d)){this.minValue=Math.min(this.minValue,d);this.maxValue=Math.max(this.maxValue,d);var e={};e.id=c.id;e.name=c.name;e.color=c.color;e.value=d;e.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(e.id)!=-1)e.state=ia.ItemLayer.SELECTED;e.parent=this;e.layer=
this;e.rect=new ia.Rectangle;e.hitArea=new ia.Rectangle;this.items[b]=e;this.itemArray.push(e);if(c.upperLimit&&c.lowerLimit&&ia.isNumber(c.upperLimit)&&ia.isNumber(c.lowerLimit))e.upperLimit=c.upperLimit,e.lowerLimit=c.lowerLimit,this.maxValue=Math.max(this.maxValue,e.upperLimit),this.minValue=Math.min(this.minValue,e.lowerLimit)}}if(this.sortDirection!=void 0){var f;f=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return a.value<b.value?-f:a.value>b.value?f:0})}this.dataChanged=
!1}};
ia.BarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.orientation=="vertical"?
this.map.canvasWidth/a:this.map.canvasHeight/a;this._barSize>=this._minBarWidthForStroke?(this.selectionContext.fillStyle="rgba(0, 0, 0, 0)",this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3)):(this.selectionContext.fillStyle=ia.Color.toRGBA(this.selectionColor),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor));for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}this.renderSelection()};
ia.BarLayer.prototype._setItemShape=function(a,b){if(this.map.orientation=="vertical"){var c=this.itemArray.length,d,e;this.map.getBBox().getYMin()<0?(d=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),e=this.map.getPixelHeight(Math.abs(a.value))):(d=this.map.getPixelY(a.value),e=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(d=this.map.canvasY+this.map.canvasHeight,e-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));
if(a.value>this.map.getBBox().getYMax())d=this.map.canvasY,e-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());a.rect.y=d;a.rect.height=e;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth;a.rect.width=this.map.canvasWidth/c;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;if(a.upperLimit&&a.lowerLimit)a.ul={},a.ll={},a.ul.x=a.rect.x+a.rect.width/2,a.ul.y=this.map.getPixelY(a.upperLimit),a.ll.x=a.rect.x+a.rect.width/
2,a.ll.y=this.map.getPixelY(a.lowerLimit);a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else{c=this.itemArray.length;this.map.getBBox().getXMin()<0?(d=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),e=this.map.getPixelWidth(Math.abs(a.value))):(d=this.map.getPixelX(this.map.getBBox().getXMin()),e=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));
if(a.value<this.map.getBBox().getXMin())d=this.map.canvasX,e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=d;a.rect.width=e;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight;a.rect.height=this.map.canvasHeight/c;a.hitArea.x=this.map.canvasX;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth;a.hitArea.height=a.rect.height;
if(a.upperLimit&&a.lowerLimit)a.ul={},a.ll={},a.ul.x=this.map.getPixelX(a.upperLimit),a.ul.y=a.rect.y+a.rect.height/2,a.ll.x=this.map.getPixelX(a.lowerLimit),a.ll.y=a.rect.y+a.rect.height/2;a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<this._minBarWidthForStroke&&a.rect.height++}};ia.BarLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};
ia.BarLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.BarLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.BarLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=this._minBarWidthForStroke&&b.stroke();a.ul&&a.ll&&(b.beginPath(),b.moveTo(a.ul.x,a.ul.y),b.lineTo(a.ll.x,a.ll.y),this._barSize>=this._minBarWidthForStroke&&(this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.ul.y),b.lineTo(a.rect.x+a.rect.width,a.ul.y),b.moveTo(a.rect.x,a.ll.y),b.lineTo(a.rect.x+a.rect.width,a.ll.y)):(b.moveTo(a.ul.x,a.rect.y),b.lineTo(a.ul.x,
a.rect.y+a.rect.height),b.moveTo(a.ll.x,a.rect.y),b.lineTo(a.ll.x,a.rect.y+a.rect.height))),b.stroke())};ia.BarLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.BarLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.value<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,
d);this.map.datatip.show()};ia.GridLayer=function(){ia.GridLayer.baseConstructor.call(this);this._noRows=7;this._noCols=53;this._letters=["A","B","C","D","E","F","G","H","I","J","K","L","M"]};ia.extend(ia.ItemLayer,ia.GridLayer);
ia.GridLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();for(var b=0;b<this._noRows;b++)for(var c=this._letters[b],d=1;d<=this._noCols;d++){var e=c+d,f={};f.id=e;f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.rect=new ia.Rectangle;f.hitArea=new ia.Rectangle;this.items[e]=f;this.itemArray.push(f);e=a[e];if(e!=void 0)f.name=e.name,f.color=e.color,
f.value=e[this.dataField]}this.dataChanged=!1}};
ia.GridLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";this.highlightContext.fillStyle=
ia.Color.toRGBA(this.highlightColor,0.3);for(var b=a=this.context.lineWidth=0,c=this.itemArray.length,d=0;d<c;d++){var e=this.itemArray[d];this._setItemShape(e,a,b);this._renderItem(e);b==this._noCols-1?(b=0,a++):b++}this.renderSelection()};
ia.GridLayer.prototype._setItemShape=function(a,b,c){var d=this.map.canvasWidth/this._noCols,c=this.map.canvasX+c*d,e=this.map.canvasHeight/this._noRows,b=this.map.canvasY+b*e;a.rect.width=d;a.rect.height=e;a.rect.x=c;a.rect.y=b;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height};ia.GridLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};
ia.GridLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.GridLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.GridLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();b.stroke()};ia.GridLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.GridLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.rect.y-this.map.datatip.getHeight()-5);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.PyramidLayer=function(){ia.PyramidLayer.baseConstructor.call(this);this._maxBarWidth=20;this._barSize=this._minBarWidthForStroke=10;this.sortDirection="ascending";this.gender="male"};ia.extend(ia.ItemLayer,ia.PyramidLayer);
ia.PyramidLayer.prototype.update=function(a){if(this.map){var b=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var c=0;c<b.length;c++){var d=b[c],e=d.features[0];if(e){var f=e[this.dataField];if(ia.isNumber(f))this.gender=="female"&&(f*=-1),this.minValue=Math.min(this.minValue,f),this.maxValue=Math.max(this.maxValue,f);if(a==void 0||d.date==a){var g={};g.id=e.id;g.name=e.name;g.ageGroup=d.name;g.value=ia.isNumber(f)?f:0;g.formattedValue=e[this.dataField+
"_formatted"];g.parent=this;g.layer=this;g.state=ia.ItemLayer.UNSELECTED;g.rect=new ia.Rectangle;g.hitArea=new ia.Rectangle;this.items[g.id]=g;this.itemArray.push(g)}}}this.itemArray.reverse()}};
ia.PyramidLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.canvasHeight/a;this.highlightContext.fillStyle=this._barSize>=this._minBarWidthForStroke?ia.Color.toRGBA(this.highlightColor,0.3):ia.Color.toRGBA(this.highlightColor);
for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}};
ia.PyramidLayer.prototype._setItemShape=function(a,b){var c=this.itemArray.length,d,e;this.map.getBBox().getXMin()<0?(d=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),e=this.map.getPixelWidth(Math.abs(a.value))):(d=this.map.getPixelX(this.map.getBBox().getXMin()),e=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())d=this.map.canvasX,e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>
this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=d;a.rect.width=e;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight;a.rect.height=this.map.canvasHeight/c;a.hitArea.x=this.gender=="female"?this.map.canvasX:a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth/2;a.hitArea.height=a.rect.height;a.rect.height<this._minBarWidthForStroke&&a.rect.height++};
ia.PyramidLayer.prototype._renderItem=function(a){this._drawItem(a,this.context)};ia.PyramidLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.PyramidLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=this._minBarWidthForStroke&&b.stroke()};ia.PyramidLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.PyramidLayer.prototype.showTip=function(a,b){if(this.tip!=""){var c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${ageGroup}").join(a.ageGroup),c=c.split("${value}").join(a.formattedValue);this.map.datatip.text(c)}else this.map.datatip.text(a.name+" <br/> "+a.ageGroup+" <br/> "+a.formattedValue);var d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+
a.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,d);this.map.datatip.show()};ia.CountLayer=function(){ia.CountLayer.baseConstructor.call(this);this.isLegendComponent=!0};ia.extend(ia.BarLayer,ia.CountLayer);
ia.CountLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var a=this.thematic.getClasses(),b=0;b<a.length;b++){var c=a[b],d={};d.id=c.index;d.legendClass=c;d.color=c.color;d.value=c.items.length;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;d.label=c.getLabel()+" : "+d.value;d.rect=new ia.Rectangle;d.hitArea=
new ia.Rectangle;this.items[d.id]=d;this.itemArray.push(d);this.minValue=Math.min(this.minValue,d.value);this.maxValue=Math.max(this.maxValue,d.value)}if(this.sortDirection!=void 0){var e;e=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return a.value<b.value?-e:a.value>b.value?e:0})}this.dataChanged=!1}};
ia.CountLayer.prototype.showTip=function(a,b){this.map.datatip.text(a.label);var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.value<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,
d);this.map.datatip.show()};ia.PieLayer=function(){ia.PieLayer.baseConstructor.call(this);this._piePadding=10;this._pieCenterY=this._pieCenterX=this._pieRadius=this._pieTotal=0;this.isLegendComponent=!0};ia.extend(ia.ItemLayer,ia.PieLayer);
ia.PieLayer.prototype.update=function(){this.itemArray=[];this.clearItems();for(var a=this.thematic.getClasses(),b=0;b<a.length;b++){var c=a[b],d={};d.id=c.index;d.legendClass=c;d.color=c.color;d.value=c.items.length;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;this.items[d.id]=d;this.itemArray.push(d)}};
ia.PieLayer.prototype.render=function(){this.clear();this._pieRadius=Math.min(this.map.canvasWidth,this.map.canvasHeight)/2-this._piePadding;this._pieCenterX=this.map.canvasWidth/2;this._pieCenterY=this.map.canvasHeight/2;for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+
1;this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3);this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=1.5*Math.PI;var b=0,c=this.itemArray.length;if(c==0)this.context.beginPath(),ia.Shape.drawCircle(this.context,this._pieCenterX,this._pieCenterY,this._pieRadius*2),this.context.stroke();else{for(var d=this._pieTotal=0;d<c;d++){var e=this.itemArray[d],b=parseFloat(e.value);b>0&&(this._pieTotal+=
b)}for(d=0;d<c;d++)if(e=this.itemArray[d],b=parseFloat(e.value),b>0){var f=ia.round(b/this._pieTotal*100,2);if(this.tip!=""){var g=this.tip,g=g.split("${name}").join(e.legendClass.getLabel()),g=g.split("${value}").join(b),g=g.split("${percentage}").join(f);e.label=g}else e.label=e.legendClass.getLabel()+" : "+f+"%";b=a+Math.PI*2*(b/this._pieTotal);e.startAngle=a;e.endAngle=b;e.angleSize=b-a;a=b;this._renderItem(e)}this.renderSelection()}};
ia.PieLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.PieLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.PieLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.PieLayer.prototype._drawItem=function(a,b){b.beginPath();b.moveTo(this._pieCenterX,this._pieCenterY);b.arc(this._pieCenterX,this._pieCenterY,this._pieRadius,a.startAngle,a.endAngle,!1);b.lineTo(this._pieCenterX,this._pieCenterY);b.fill();b.stroke()};ia.PieLayer.prototype.hitItem=function(a,b){return this._pointInSlice(a,b.x,b.y)};
ia.PieLayer.prototype._pointInSlice=function(a,b,c){var d=a.endAngle-a.startAngle,e=this._pieCenterX,f=this._pieCenterY;return this._pointInPoly([{x:e,y:f},{x:e+this._pieRadius*Math.cos(a.startAngle),y:f+this._pieRadius*Math.sin(a.startAngle)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/4),y:f+this._pieRadius*Math.sin(a.startAngle+d/4)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/2),y:f+this._pieRadius*Math.sin(a.startAngle+d/2)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/1.5),y:f+this._pieRadius*
Math.sin(a.startAngle+d/1.5)},{x:e+this._pieRadius*Math.cos(a.startAngle+d),y:f+this._pieRadius*Math.sin(a.startAngle+d)},{x:e,y:f}],b,c)};ia.PieLayer.prototype._pointInPoly=function(a,b,c){var d,e,f=0;d=0;for(e=a.length-1;d<a.length;e=d++)a[d].y>c!=a[e].y>c&&b<(a[e].x-a[d].x)*(c-a[d].y)/(a[e].y-a[d].y)+a[d].x&&(f=!f);return f};
ia.PieLayer.prototype.showTip=function(a,b){this.map.datatip.text(a.label);var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=b.x/2,d=b.y-(this.map.datatip.getHeight()+5));this.map.datatip.position(c,d);this.map.datatip.show()};ia.AdvancedPieLayer=function(){ia.AdvancedPieLayer.baseConstructor.call(this)};ia.extend(ia.PieLayer,ia.AdvancedPieLayer);
ia.AdvancedPieLayer.prototype.update=function(){this.itemArray=[];this.clearItems();var a=this.getData();if(a&&this.itemId)if(a.dates)for(var b=a.dates.length,c=0;c<b;c++){var d=a.dates[c],e=a[d][this.itemId];if(e&&(this.itemName=e.name,d=this.thematic.getClass(d))){var f={};f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.id=d.index;f.legendClass=d;f.value=e.value;f.label=d.getLabel()+" : "+f.value;f.color=d.color;this.items[f.id]=
f;this.itemArray.push(f)}}else if(e=a[this.itemId]){this.itemName=e.name;a=this.thematic.getClasses();for(c=0;c<a.length;c++){d=a[c];b=d.value;f={};f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.id=d.index;f.legendClass=d;f.value=e[b];f.label=d.getLabel()+" : "+f.value;f.color=d.color;this.items[f.id]=f;this.itemArray.push(f)}}};
ia.BoxLayer=function(){ia.BoxLayer.baseConstructor.call(this);this._maxBarWidth=20;this._minBarWidthForStroke=2;this._barSize=10;this.sortDirection="ascending"};ia.extend(ia.ItemLayer,ia.BoxLayer);
ia.BoxLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b];if(ia.isNumber(c[this.medianField])){var d={};d.id=c.id;d.name=c.name;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;d.color=c.color;d.rect=new ia.Rectangle;d.hitArea=new ia.Rectangle;this.items[b]=d;this.itemArray.push(d);
d.median=c[this.medianField];d.largestObservation=c[this.largestObservationField];d.upperQuartile=c[this.upperQuartileField];d.lowerQuartile=c[this.lowerQuartileField];d.smallestObservation=c[this.smallestObservationField];this.maxValue=Math.max(this.maxValue,d.largestObservation);this.minValue=Math.min(this.minValue,d.smallestObservation)}}if(this.sortDirection!=void 0){var e;e=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return a.median<b.median?-e:a.median>b.median?e:
0})}this.dataChanged=!1}};
ia.BoxLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.orientation==
"vertical"?this.map.canvasWidth/a:this.map.canvasHeight/a;this._barSize>=this._minBarWidthForStroke?(this.selectionContext.fillStyle="rgba(0, 0, 0, 0)",this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3)):(this.highlightContext.fillStyle=ia.Color.toRGBA(this.selectionColor),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor));for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}this.renderSelection()};
ia.BoxLayer.prototype._setItemShape=function(a,b){if(this.map.orientation=="vertical"){var c=this.itemArray.length;a.rect.y=this.map.getPixelY(a.upperQuartile);a.rect.height=this.map.getPixelY(a.lowerQuartile)-a.rect.y;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth;a.rect.width=this.map.canvasWidth/c;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;a.uq={};a.uq.x=a.rect.x+a.rect.width/2;a.uq.y=this.map.getPixelY(a.largestObservation);
a.lq={};a.lq.x=a.rect.x+a.rect.width/2;a.lq.y=this.map.getPixelY(a.smallestObservation);a.m={};a.m.x=a.rect.x+a.rect.width/2;a.m.y=this.map.getPixelY(a.median);a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else c=this.itemArray.length,a.rect.x=this.map.getPixelX(a.lowerQuartile),a.rect.width=this.map.getPixelX(a.upperQuartile)-a.rect.x,a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight,
a.rect.height=this.map.canvasHeight/c,a.hitArea.x=this.map.canvasX,a.hitArea.y=a.rect.y,a.hitArea.width=this.map.canvasWidth,a.hitArea.height=a.rect.height,a.uq={},a.uq.x=this.map.getPixelX(a.largestObservation),a.uq.y=a.rect.y+a.rect.height/2,a.lq={},a.lq.x=this.map.getPixelX(a.smallestObservation),a.lq.y=a.rect.y+a.rect.height/2,a.m={},a.m.x=this.map.getPixelX(a.median),a.m.y=a.rect.y+a.rect.height/2,a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):
a.rect.height<this._minBarWidthForStroke&&a.rect.height++};ia.BoxLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.BoxLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.BoxLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.BoxLayer.prototype._drawItem=function(a,b){b.beginPath();b.moveTo(a.uq.x,a.uq.y);b.lineTo(a.lq.x,a.lq.y);this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.uq.y),b.lineTo(a.rect.x+a.rect.width,a.uq.y),b.moveTo(a.rect.x,a.lq.y),b.lineTo(a.rect.x+a.rect.width,a.lq.y)):(b.moveTo(a.uq.x,a.rect.y),b.lineTo(a.uq.x,a.rect.y+a.rect.height),b.moveTo(a.lq.x,a.rect.y),b.lineTo(a.lq.x,a.rect.y+a.rect.height));b.stroke();b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=
this._minBarWidthForStroke&&b.stroke();b.beginPath();this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.m.y),b.lineTo(a.rect.x+a.rect.width,a.m.y)):(b.moveTo(a.m.x,a.rect.y),b.lineTo(a.m.x,a.rect.y+a.rect.height));b.stroke()};ia.BoxLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.BoxLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width,d=a.median<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.median<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.TimeBarLayer=function(){ia.TimeBarLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this._renderTimeout=null;this.selectedDate="";this.highlightSelectedDate=!1;this._numericDates=[];this.colorPalette=new ia.ColorPalette};ia.extend(ia.ItemLayer,ia.TimeBarLayer);
ia.TimeBarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){this._numericDates=[];for(var b=0;b<a.type.length;b++){var c=a.dates[b];a.type[b]!=ia.Thematic.CATEGORIC&&(this._numericDates[this._numericDates.length]=c)}if(this._numericDates.length>0){var d=a[this._numericDates[0]],e=this._numericDates.length,f;for(f in d){var g=d[f],h={};h.id=g.id;h.name=g.name;h.state=ia.ItemLayer.UNSELECTED;
if(this.selectionIds.indexOf(h.id)!=-1)h.state=ia.ItemLayer.SELECTED;h.parent=this;h.layer=this;if(this.isComparison&&(b=this.thematic.getClass(h.id)))h.color=b.color;this.items[g.id]=h;this.itemArray.push(h);h.childItems=[];for(b=0;b<e;b++){var c=this._numericDates[b],g=a[c][f],k=g[this.dataField];if(ia.isNumber(k)){var i={};i.id=f+"~"+c;i.name=c;i.rect=new ia.Rectangle;i.hitArea=new ia.Rectangle;i.value=k;i.formattedValue=g[this.dataField+"_formatted"];if(this.isComparison){if(this.selectionIds.indexOf(h.id)!=
-1)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k),h.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k)}else this.minValue=Math.min(this.minValue,i.value),this.maxValue=Math.max(this.maxValue,i.value);h.childItems[h.childItems.length]=i}else h.childItems[h.childItems.length]={name:c,value:void 0}}}}}this.dataChanged=!1}};
ia.TimeBarLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.getData();if(this._numericDates.length>0){a=this._numericDates.length;this._maxBarWidth=this.map.orientation==
"vertical"?this.map.canvasWidth/a*0.7:this.map.canvasHeight/a*0.7;this._barSize=this._maxBarWidth/this.selectionIds.length;if(this.highlightSelectedDate){var b=this._numericDates,c=b.indexOf(this.selectedDate);if(c!=-1){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var d;this.map.orientation=="vertical"?(a=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,d=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(a=this.map.canvasX,c=this.map.canvasY+
c/b.length*this.map.canvasHeight,d=this.map.canvasWidth,b=this.map.canvasHeight/b.length);this.context.beginPath();this.context.rect(a,c,d,b);this.context.fill()}}var e=this.itemArray.length;for(a=0;a<e;a++){b=this.itemArray[a];c=b.childItems.length;for(d=0;d<c;d++){var f=b.childItems[d];f.value!=void 0&&this._setItemShape(f,d,c)}}var e=this.selectionIds.length,g=this.colorPalette.getColors(e);for(a=0;a<e;a++)if(b=this.items[this.selectionIds[a]]){b.color=g[a];c=b.childItems.length;for(d=0;d<c;d++)f=
b.childItems[d],f.value!=void 0&&this._setItemShape(f,d,c,a);this._renderItem(b)}}};
ia.TimeBarLayer.prototype._setItemShape=function(a,b,c,d){if(this.map.orientation=="vertical"){var e,f;this.map.getBBox().getYMin()<0?(e=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value))):(e=this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(e=this.map.canvasY+this.map.canvasHeight,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));
if(a.value>this.map.getBBox().getYMax())e=this.map.canvasY,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());a.rect.y=e;a.rect.height=f;a.rect.width=this._barSize;e=(this.map.canvasWidth/c-this._maxBarWidth)/2;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth+e+d*a.rect.width;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=
this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else{this.map.getBBox().getXMin()<0?(e=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),f=this.map.getPixelWidth(Math.abs(a.value))):(e=this.map.getPixelX(this.map.getBBox().getXMin()),f=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())e=this.map.canvasX,f-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&
(f-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=e;a.rect.width=f;a.rect.height=this._barSize;e=(this.map.canvasHeight/c-this._maxBarWidth)/2;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight+e+d*a.rect.height;a.hitArea.x=this.map.canvasX;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth;a.hitArea.height=a.rect.height;a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<
this._minBarWidthForStroke&&a.rect.height++}};ia.TimeBarLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.TimeBarLayer.prototype.selectItem=function(){this._triggerRender()};ia.TimeBarLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};
ia.TimeBarLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};ia.TimeBarLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};
ia.TimeBarLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0){var e=!1;if(this.map.orientation=="vertical"){var f=this.map.canvasX+this.map.canvasWidth/b*c,g=this.map.canvasX+this.map.canvasWidth/b*(c+1),h=d.rect.y;d.value<0&&(h+=d.rect.height);var k=h;d.value>=this.map.getBBox().getYMin()&&d.value<=this.map.getBBox().getYMax()&&(e=!0)}else f=d.rect.x+d.rect.width,d.value<0&&(f-=d.rect.width),g=f,h=this.map.canvasY+this.map.canvasHeight/
b*c,k=this.map.canvasY+this.map.canvasHeight/b*(c+1),d.value>=this.map.getBBox().getXMin()&&d.value<=this.map.getBBox().getXMax()&&(e=!0);e&&(this.highlightContext.beginPath(),this.highlightContext.moveTo(f,h),this.highlightContext.lineTo(g,k),this.highlightContext.stroke());this.highlightContext.beginPath();this.map.orientation=="vertical"?this.highlightContext.rect(f,d.rect.y,g-f,d.rect.height):this.highlightContext.rect(d.rect.x,h,d.rect.width,k-h);this.highlightContext.fill()}}};
ia.TimeBarLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&(b.beginPath(),b.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),b.fill(),this.map.animationMode&&e.name==this.selectedDate))break}};ia.TimeBarLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.TimeBarLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${date}").join(e.name),c=c.split("${label}").join(e.name),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" : "+e.name+" : "+e.formattedValue);ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+
30)):this.map.orientation=="vertical"?(c=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(c=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};
ia.PlotLayer=function(){ia.PlotLayer.baseConstructor.call(this);this._xData={};this._yData={};this.style={fillStyle:"#ffffff",strokeStyle:"#888888",lineWidth:"2",lineJoin:"round"};this.yDataField=this.xDataField="value";this.correlationInfo={};this.showCorrelationLine=!1;this.pointSize=6};ia.extend(ia.ItemLayer,ia.PlotLayer);ia.PlotLayer.prototype.getXData=function(){return this._xData};ia.PlotLayer.prototype.setXData=function(a){this._xData=a;this.dataChanged=!0};
ia.PlotLayer.prototype.getYData=function(){return this._yData};ia.PlotLayer.prototype.setYData=function(a){this._yData=a;this.dataChanged=!0};ia.PlotLayer.prototype.getColorData=function(){return this._colorData};ia.PlotLayer.prototype.setColorData=function(a){this._colorData=a;this.dataChanged=!0};ia.PlotLayer.prototype.getSizeData=function(){return this._sizeData};ia.PlotLayer.prototype.setSizeData=function(a){this._sizeData=a;this.dataChanged=!0};
ia.PlotLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.itemArray=[];this.clearItems();this.xMinValue=Infinity;this.xMaxValue=-Infinity;this.yMinValue=Infinity;this.yMaxValue=-Infinity;var a=0,b=0,c=0,d=0,e=0,f=c=c=0,g=0,h;for(h in this._xData){var c=this._xData[h],k=c[this.xDataField],i=this._yData[h][this.yDataField];if(ia.isNumber(k)&&ia.isNumber(i)){var k=parseFloat(k),i=parseFloat(i),l={};l.id=c.id;l.name=c.name;l.xValue=k;l.yValue=i;l.color=this._colorData!=void 0?this._colorData[h].color:
c.color;l.symbolSize=this._sizeData!=void 0?this._sizeData[h].symbolSize:this.pointSize;l.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(l.id)!=-1)l.state=ia.ItemLayer.SELECTED;l.parent=this;l.layer=this;l.shape=new ia.Rectangle;l.hitArea=new ia.Rectangle;this.items[h]=l;this.itemArray.push(l);c=k*k;a+=k;b+=c;c=i*i;d+=i;e+=c;c=k*i;f+=c;g++;if(this.isComparison){if(this.selectionIds.indexOf(l.id)!=-1)this.xMinValue=Math.min(this.xMinValue,k),this.xMaxValue=Math.max(this.xMaxValue,k),this.yMinValue=
Math.min(this.yMinValue,i),this.yMaxValue=Math.max(this.yMaxValue,i),l.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.xMinValue=Math.min(this.xMinValue,k),this.xMaxValue=Math.max(this.xMaxValue,k),this.yMinValue=Math.min(this.yMinValue,i),this.yMaxValue=Math.max(this.yMaxValue,i)}else this.xMinValue=Math.min(this.xMinValue,k),this.xMaxValue=Math.max(this.xMaxValue,k),this.yMinValue=Math.min(this.yMinValue,i),this.yMaxValue=Math.max(this.yMaxValue,i)}}e=(f/g-a*(d/Math.pow(g,2)))/Math.sqrt((b/
g-Math.pow(a/g,2))*(e/g-Math.pow(d/g,2)));h=(a*d-g*f)/(Math.pow(a,2)-g*b);a=(a*f-d*b)/(Math.pow(a,2)-g*b);this.correlationInfo.correlationCoeff=e;this.correlationInfo.rSquare=Math.pow(e,2);this.correlationInfo.gradient=h;this.correlationInfo.intercept=a;this._sizeData!=void 0&&this.itemArray.sort(function(a,b){return a.symbolSize<b.symbolSize?1:a.symbolSize>b.symbolSize?-1:0});this.dataChanged=!1}};
ia.PlotLayer.prototype.render=function(){this.clear();if(this.showCorrelationLine){this.context.save();this.context.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight);this.context.clip();this.context.strokeStyle=ia.Color.toRGBA(this.selectionColor,0.3);this.context.lineWidth=2;var a=this.map.getPixelX(this.map.getBBox().getXMin()),b=this.map.getPixelX(this.map.getBBox().getXMax()),c=this.map.getPixelY(this.map.getBBox().getXMin()*this.correlationInfo.gradient+this.correlationInfo.intercept),
d=this.map.getPixelY(this.map.getBBox().getXMax()*this.correlationInfo.gradient+this.correlationInfo.intercept);this.context.beginPath();this.context.moveTo(a,c);this.context.lineTo(b,d);this.context.stroke();this.context.restore()}for(var e in this.style)this.context[e]=this.style[e],this.selectionContext[e]=this.style[e],this.highlightContext[e]=this.style[e];this.highlightContext.strokeStyle=this.highlightColor;this.selectionContext.strokeStyle=this.selectionColor;this.highlightContext.fillStyle=
"rgba(0, 0, 0, 0)";this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";a=this.itemArray.length;for(b=0;b<a;b++)c=this.itemArray[b],this._setItemShape(c),this._renderItem(c);this.renderSelection()};
ia.PlotLayer.prototype._setItemShape=function(a){var b=this.map.getPixelX(a.xValue),c=this.map.getPixelY(a.yValue),d=a.symbolSize,e=a.symbolSize;a.shape.x=b;a.shape.y=c;a.shape.width=d;a.shape.height=e;d=Math.max(15,d);e=Math.max(15,e);ia.IS_TOUCH_DEVICE&&(d=Math.max(30,d),e=Math.max(30,e));a.hitArea.x=b-d/2;a.hitArea.y=c-e/2;a.hitArea.width=d;a.hitArea.height=e};
ia.PlotLayer.prototype._renderItem=function(a){if(this._colorData!=void 0)this.context.fillStyle=a.color,this.context.strokeStyle="#CCCCCC",this.context.lineWidth=1;this._drawItem(a,this.context,a.symbolSize)};ia.PlotLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext,a.symbolSize)};
ia.PlotLayer.prototype.highlightItem=function(a){this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.3);var b=this.map.getPixelX(this.map.getBBox().getXMin()),c=this.map.getPixelX(this.map.getBBox().getXMax()),d=this.map.getPixelY(this.map.getBBox().getYMin()),e=this.map.getPixelY(this.map.getBBox().getYMax());this.highlightContext.beginPath();this.highlightContext.moveTo(a.shape.x,d);this.highlightContext.lineTo(a.shape.x,e);this.highlightContext.moveTo(b,a.shape.y);this.highlightContext.lineTo(c,
a.shape.y);this.highlightContext.stroke();this.highlightContext.strokeStyle=this.highlightColor;this._drawItem(a,this.highlightContext,a.symbolSize)};ia.PlotLayer.prototype._drawItem=function(a,b,c){b.beginPath();ia.Shape.drawCircle(b,a.shape.x,a.shape.y,c);b.fill();b.stroke()};ia.PlotLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)?!0:!1};
ia.PlotLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.shape.x+a.shape.width/2,d=a.shape.y-a.shape.height/2-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};
ia.PlotLayer.prototype._getCorrelation=function(){var a=0,b=0,c=0,d=0,e=0,f=c=0,g=0,h=0,k;for(k in xData){var f=xData[k][xDataField],i=yData[k][yDataField];ia.isNumber(f)&&ia.isNumber(i)&&(c=f*f,a+=f,b+=c,c=i*i,d+=i,e+=c,f*=i,g+=f,h++)}e=(g/h-a*(d/Math.pow(h,2)))/Math.sqrt((b/h-Math.pow(a/h,2))*(e/h-Math.pow(d/h,2)));e=Math.round(e*100)/100;k=(a*d-h*g)/(Math.pow(a,2)-h*b);a=(a*g-d*b)/(Math.pow(a,2)-h*b);a=Math.round(a*100)/100;b={};b.correlationCoeff=e;b.rSquare=Math.pow(e,2);b.gradient=k;b.intercept=
a;ia.log("[coefficient="+b.correlationCoeff+",rSquare="+b.rSquare+",gradient="+b.gradient+",intercept="+b.intercept+"]");return b};ia.LineLayer=function(){ia.LineLayer.baseConstructor.call(this);this._xData=[];this._yData=[];this.style={fillStyle:"#ffffff",strokeStyle:"#888888",lineWidth:"2",lineJoin:"round"};this.connectMissingValues=!1};ia.extend(ia.ItemLayer,ia.LineLayer);ia.LineLayer.prototype.getXData=function(){return this._xData};
ia.LineLayer.prototype.setXData=function(a){this._xData=a;this.dataChanged=!0};ia.LineLayer.prototype.getYData=function(){return this._yData};ia.LineLayer.prototype.setYData=function(a){this._yData=a;this.dataChanged=!0};
ia.LineLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.itemArray=[];this.clearItems();this.xMinValue=Infinity;this.xMaxValue=-Infinity;this.yMinValue=Infinity;this.yMaxValue=-Infinity;var a={id:"myLineId",name:"myLineName"};a.state=ia.ItemLayer.UNSELECTED;a.parent=this;a.layer=this;this.items[a.id]=a;this.itemArray.push(a);this.dataChanged=!1}};
ia.LineLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++)this._renderItem(this.itemArray[b])};
ia.LineLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext)};ia.LineLayer.prototype._renderItem=function(a){ia.IS_IE_TEN||(this.context.beginPath(),this.context.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.context.clip());this._drawItem(a,this.context)};
ia.LineLayer.prototype._drawItem=function(a,b){b.beginPath();for(var c=this._xData.length,d=!1,e=0;e<c;e++){var f=this._xData[e],g=this._yData[e];ia.isNumber(f)&&ia.isNumber(g)&&(f=this.map.getPixelX(f),g=this.map.getPixelY(g),d==!1?(d=!0,b.moveTo(f,g)):b.lineTo(f,g))}b.stroke()};ia.LineLayer.prototype.hitItem=function(a,b){return this._pointInLine(b.x,b.y)};
ia.LineLayer.prototype._pointInLine=function(a,b){for(var c=new ia.Rectangle(a-4,b-4,8,8),d=this._xData.length,e=0;e<d-1;e++){var f=this.map.getPixelX(this._xData[e]),g=this.map.getPixelY(this._yData[e]),h=this.map.getPixelX(this._xData[e+1]),k=this.map.getPixelY(this._yData[e+1]);if(c.intersectsLine({x:f,y:g},{x:h,y:k}))return!0}return!1};
ia.LineLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=b.x+10,d=b.y-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};ia.StackedTimeLayer=function(){ia.StackedTimeLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this._renderTimeout=null;this.selectedDate="";this.highlightSelectedDate=!1};
ia.extend(ia.ItemLayer,ia.StackedTimeLayer);
ia.StackedTimeLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){var b=a[a.dates[0]],c=a.dates.length,d;for(d in b){var e=b[d],f={};f.id=e.id;f.name=e.name;f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;this.items[e.id]=f;this.itemArray.push(f);f.childItems=[];for(var g=0;g<c;g++)for(var h=
0,k=a.dates[g],e=a[k][d],i=0;i<this.dataFields.length;i++){var l=this.dataFields[i],j=e[l],m={};m.id=d+"~"+k;m.name=l;m.date=k;m.rect=new ia.Rectangle;m.hitArea=new ia.Rectangle;m.dateIndex=g;m.stackIndex=i;if(this.legendClasses)for(var n=0;n<this.legendClasses.length;n++){var o=this.legendClasses[n];if(o.value==l){m.name=o.getLabel();m.color=o.color;break}}m.value=ia.isNumber(j)&&j>=0?parseFloat(j):0;m.formattedValue=e[l+"_formatted"];f.childItems[f.childItems.length]=m;h+=parseFloat(m.value)}if(h!=
0)if(this.isComparison){if(this.selectionIds.indexOf(f.id)!=-1)this.maxValue=Math.max(this.maxValue,h),f.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.maxValue=Math.max(this.maxValue,h)}else this.maxValue=Math.max(this.maxValue,h)}}this.dataChanged=!1}};
ia.StackedTimeLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;var b=this.getData();if(b.dates){a=b.dates.length;this._maxBarWidth=this.map.orientation=="vertical"?this.map.canvasWidth/
a*0.7:this.map.canvasHeight/a*0.7;this._barSize=this._maxBarWidth/this.selectionIds.length;if(this.highlightSelectedDate){var c=b.dates,d=c.indexOf(this.selectedDate);if(d!=-1){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var e;this.map.orientation=="vertical"?(b=this.map.canvasX+d/c.length*this.map.canvasWidth,d=this.map.canvasY,e=this.map.canvasWidth/c.length,c=this.map.canvasHeight):(b=this.map.canvasX,d=this.map.canvasY+d/c.length*this.map.canvasHeight,
e=this.map.canvasWidth,c=this.map.canvasHeight/c.length);this.context.beginPath();this.context.rect(b,d,e,c);this.context.fill()}}for(var f=this.itemArray.length,b=0;b<f;b++){c=this.itemArray[b];d=c.childItems.length;for(e=0;e<d;e++){var g=c.childItems[e];g.value!=void 0&&this._setItemShape(g)}}f=this.selectionIds.length;for(b=0;b<f;b++)if(c=this.items[this.selectionIds[b]]){d=c.childItems.length;for(e=0;e<d;e++)g=c.childItems[e],g.value!=void 0&&this._setItemShape(g,b,a);this._renderItem(c)}}};
ia.StackedTimeLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical"){a.stackIndex==0?this._stackValue=a.value:this._stackValue+=a.value;var d=this.map.getPixelY(this._stackValue),e=this.map.getPixelHeight(a.value);if(this._stackValue>this.map.getBBox().getYMax())d=this.map.canvasY,e-=this.map.getPixelHeight(this._stackValue-this.map.getBBox().getYMax());a.rect.y=d;a.rect.height=e;a.rect.width=this._barSize;d=(this.map.canvasWidth/c-this._maxBarWidth)/2;a.rect.x=this.map.canvasX+
a.dateIndex/c*this.map.canvasWidth+d+b*a.rect.width;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height}else{if(a.stackIndex==0)this._stackValue=0;d=this.map.getPixelX(this._stackValue);e=this.map.getPixelWidth(a.value);this._stackValue>this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(this._stackValue-
this.map.getBBox().getXMax()));a.rect.x=d;a.rect.width=e;a.rect.height=this._barSize;d=(this.map.canvasHeight/c-this._maxBarWidth)/2;a.rect.y=this.map.canvasY+a.dateIndex/c*this.map.canvasHeight+d+b*a.rect.height;a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<this._minBarWidthForStroke&&a.rect.height++;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height;this._stackValue+=
a.value}};ia.StackedTimeLayer.prototype._renderItem=function(a){this._drawItem(a,this.context)};ia.StackedTimeLayer.prototype.selectItem=function(){this._triggerRender()};ia.StackedTimeLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};
ia.StackedTimeLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};ia.StackedTimeLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};
ia.StackedTimeLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0&&d.value!=0&&(this.highlightContext.fillStyle=d.color,this.highlightContext.beginPath(),this.highlightContext.rect(d.rect.x,d.rect.y,d.rect.width,d.rect.height),this.highlightContext.stroke(),this.map.animationMode&&d.date==this.selectedDate))break}};
ia.StackedTimeLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.value!=0&&(b.fillStyle=e.color,b.beginPath(),b.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),b.fill(),this.map.animationMode&&e.date==this.selectedDate))break}};ia.StackedTimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.StackedTimeLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${feature-name}").join(a.name),c=c.split("${date}").join(e.date),c=c.split("${associate-name}").join(e.name),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" ("+e.date+") <br/> "+e.name+" : "+e.formattedValue);ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/
2,e=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(c=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};
ia.ComparisonLineLayer=function(){ia.ComparisonLineLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.displayAll=!1};ia.extend(ia.ItemLayer,ia.ComparisonLineLayer);
ia.ComparisonLineLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b],d=c[this.dataField];if(ia.isNumber(d)){var e={};e.id=c.id;e.name=c.name;e.color=c.color;e.value=c[this.dataField];e.shape=new ia.Rectangle;e.hitArea=new ia.Rectangle;e.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(e.id)!=-1)this.minValue=Math.min(this.minValue,d),this.maxValue=
Math.max(this.maxValue,d),e.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,d),this.maxValue=Math.max(this.maxValue,d);e.parent=this;e.layer=this;this.items[b]=e;this.itemArray.push(e)}}this.dataChanged=!1}};
ia.ComparisonLineLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c);this.displayAll&&this._renderItem(c)}this.displayAll||this.renderSelection()};
ia.ComparisonLineLayer.prototype._setItemShape=function(a){this.map.orientation=="vertical"?(a.shape.x=this.map.canvasX,a.shape.y=this.map.getPixelY(a.value),a.shape.width=this.map.canvasWidth,a.shape.height=0,a.hitArea.x=a.shape.x,a.hitArea.y=a.shape.y-1,a.hitArea.width=a.shape.width,a.hitArea.height=2):(a.shape.x=this.map.getPixelX(a.value),a.shape.y=this.map.canvasY,a.shape.width=0,a.shape.height=this.map.canvasHeight,a.hitArea.x=a.shape.x-1,a.hitArea.y=a.shape.y,a.hitArea.width=2,a.hitArea.height=
a.shape.height)};ia.ComparisonLineLayer.prototype.clearSelection=function(){};ia.ComparisonLineLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonLineLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};
ia.ComparisonLineLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext)};
ia.ComparisonLineLayer.prototype._drawItem=function(a,b){b.beginPath();this.map.orientation=="vertical"?(b.moveTo(a.shape.x,a.shape.y),b.lineTo(a.shape.x+a.shape.width,a.shape.y)):(b.moveTo(a.shape.x,a.shape.y),b.lineTo(a.shape.x,a.shape.y+a.shape.height));b.stroke()};ia.ComparisonLineLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)||this.displayAll?a.hitArea.intersects(b.x,b.y):!1};
ia.ComparisonLineLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=b.x-this.map.datatip.getWidth()/2,d=a.shape.y-this.map.datatip.getHeight()-5):(c=a.shape.x+a.shape.width+5,d=b.y-this.map.datatip.getHeight()/2);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.ComparisonTimeLayer=function(){ia.ComparisonTimeLayer.baseConstructor.call(this);this.isComparison=!0;this.displayAll=!1;this.selectedDate=""};ia.extend(ia.TimeLayer,ia.ComparisonTimeLayer);
ia.ComparisonTimeLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonTimeLayer.prototype.clearSelection=function(){};ia.ComparisonTimeLayer.prototype._renderItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.context.strokeStyle=b.color}this._drawItem(a,this.context)};ia.ComparisonTimeLayer.prototype.selectItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.selectionContext.strokeStyle=b.color}this._drawItem(a,this.selectionContext)};
ia.ComparisonTimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};ia.ComparisonTimeBarLayer=function(){ia.ComparisonTimeBarLayer.baseConstructor.call(this);this.isComparison=!0;this.displayAll=!1;this.selectedDate=""};ia.extend(ia.TimeBarLayer,ia.ComparisonTimeBarLayer);
ia.ComparisonTimeBarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1.5;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1.5;this.context.lineWidth=
parseFloat(this.style.lineWidth)+1.5;a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonTimeBarLayer.prototype._setItemShape=function(a,b,c){var d=4;ia.IS_TOUCH_DEVICE&&(d=8);if(this.map.orientation=="vertical"){var e,f;this.map.getBBox().getYMin()<0?(e=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value))):(e=this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(e=this.map.canvasY+this.map.canvasHeight,f-=this.map.getPixelHeight(Math.abs(a.value)-
this.map.getBBox().getYMin()));if(a.value>this.map.getBBox().getYMax())e=this.map.canvasY,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());var g=this.map.canvasWidth/c,b=this.map.canvasX+g*b;a.rect.y=e;a.rect.height=f;a.rect.width=g;a.rect.x=b;a.hitArea.x=a.rect.x;a.hitArea.y=a.value>0?e-d:e+f-d;a.hitArea.width=a.rect.width;a.hitArea.height=d*2}else{this.map.getBBox().getXMin()<0?(e=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),g=this.map.getPixelWidth(Math.abs(a.value))):
(e=this.map.getPixelX(this.map.getBBox().getXMin()),g=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())e=this.map.canvasX,g-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&(g-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));f=this.map.canvasHeight/c;b=this.map.canvasY+f*b;a.rect.x=e;a.rect.width=g;a.rect.height=f;a.rect.y=b;a.hitArea.x=
a.value<0?e-d:e+g-d;a.hitArea.y=a.rect.y;a.hitArea.width=d*2;a.hitArea.height=a.rect.height}};ia.ComparisonTimeBarLayer.prototype.clearSelection=function(){};ia.ComparisonTimeBarLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonTimeBarLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};
ia.ComparisonTimeBarLayer.prototype.highlightItem=function(a){this.highlightContext.strokeStyle=ia.Color.toRGBA(a.color,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(a.color,0.1);for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0){var e=!1;if(this.map.orientation=="vertical"){var f=this.map.canvasX+this.map.canvasWidth/b*c,g=this.map.canvasX+this.map.canvasWidth/b*(c+1),h=d.rect.y;d.value<0&&(h+=d.rect.height);var k=h;d.value>=this.map.getBBox().getYMin()&&
d.value<=this.map.getBBox().getYMax()&&(e=!0)}else f=d.rect.x+d.rect.width,d.value<0&&(f-=d.rect.width),g=f,h=this.map.canvasY+this.map.canvasHeight/b*c,k=this.map.canvasY+this.map.canvasHeight/b*(c+1),d.value>=this.map.getBBox().getXMin()&&d.value<=this.map.getBBox().getXMax()&&(e=!0);e&&(this.highlightContext.beginPath(),this.highlightContext.moveTo(f,h),this.highlightContext.lineTo(g,k),this.highlightContext.stroke());this.highlightContext.beginPath();this.map.orientation=="vertical"?this.highlightContext.rect(f,
d.rect.y,g-f,d.rect.height):this.highlightContext.rect(d.rect.x,h,d.rect.width,k-h);this.highlightContext.fill()}}};
ia.ComparisonTimeBarLayer.prototype._drawItem=function(a,b){var c=a.childItems.length;b.beginPath();for(var d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0){if(this.map.orientation=="vertical"){var f=e.rect.x,g=e.rect.x+e.rect.width,h=e.rect.y;e.value<0&&(h+=e.rect.height);var k=h}else f=e.rect.x+e.rect.width,e.value<0&&(f-=e.rect.width),g=f,h=e.rect.y,k=e.rect.y+e.rect.height;b.moveTo(f,h);b.lineTo(g,k);if(this.map.animationMode&&e.name==this.selectedDate)break}}b.stroke()};
ia.ComparisonTimeBarLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};ia.ComparisonPlotLayer=function(){ia.ComparisonPlotLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.displayAll=!1;this.isComparison=!0};ia.extend(ia.PlotLayer,ia.ComparisonPlotLayer);
ia.ComparisonPlotLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=this.highlightColor;this.selectionContext.strokeStyle=this.selectionColor;a=this.itemArray.length;for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c);this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonPlotLayer.prototype._setItemShape=function(a){var b=this.map.getPixelX(a.xValue),c=this.map.getPixelY(a.yValue),d=10,e=10;a.shape.x=b;a.shape.y=c;a.shape.width=d;a.shape.height=e;d=Math.max(15,d);e=Math.max(15,e);ia.IS_TOUCH_DEVICE&&(d=Math.max(30,d),e=Math.max(30,e));a.hitArea.x=b-d/2;a.hitArea.y=c-e/2;a.hitArea.width=d;a.hitArea.height=e};ia.ComparisonPlotLayer.prototype.clearSelection=function(){};
ia.ComparisonPlotLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonPlotLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};ia.ComparisonPlotLayer.prototype._drawItem=function(a,b){b.beginPath();ia.Shape.drawCircle(b,a.shape.x,a.shape.y,a.symbolSize);b.fill();b.stroke()};
ia.ComparisonPlotLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)||this.displayAll?a.hitArea.intersects(b.x,b.y):!1};ia.ComparisonPyramidLayer=function(){ia.ComparisonPyramidLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.sortDirection="ascending";this.gender="male";this.displayAll=!1};ia.extend(ia.ItemLayer,ia.ComparisonPyramidLayer);
ia.ComparisonPyramidLayer.prototype.update=function(a){if(this.map){var b=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(b[0])for(var c=b[0].features,d=0;d<c.length;d++){var e=c[d],f=0,g={};g.id=e.id;g.name=e.name;g.state=ia.ItemLayer.UNSELECTED;g.parent=this;g.layer=this;this.items[g.id]=g;this.itemArray.push(g);g.childItems=[];for(e=0;e<b.length;e++){var h=b[e],k=h.features[d];if(k){var i=k[this.dataField];if(ia.isNumber(i)){this.gender=="female"&&
(i*=-1);if(this.selectionIds.indexOf(g.id)!=-1)this.minValue=Math.min(this.minValue,i),this.maxValue=Math.max(this.maxValue,i),g.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,i),this.maxValue=Math.max(this.maxValue,i)}if(a==void 0||h.date==a){if(ia.isNumber(i)){var l={};l.id=g.id+"~"+h.name;l.name=h.name;l.ageGroup=h.name;l.shape=new ia.Rectangle;l.hitArea=new ia.Rectangle;l.value=i;l.index=f;l.formattedValue=k[this.dataField+"_formatted"];g.childItems[g.childItems.length]=
l}f++}}}g.nChildItems=f;g.childItems.reverse()}}};ia.ComparisonPyramidLayer.prototype.clearSelection=function(){};
ia.ComparisonPyramidLayer.prototype.render=function(){this.clear();ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=
this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e],g=c.nChildItems-1-f.index;f!=void 0&&this._setItemShape(f,g,c.nChildItems)}this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonPyramidLayer.prototype._setItemShape=function(a,b,c){var d=this.map.canvasHeight/c,c=this.map.getPixelX(a.value),b=this.map.canvasY+d/2+d*b,e=d=10;a.shape.x=c;a.shape.y=b;a.shape.width=d;a.shape.height=e;ia.IS_TOUCH_DEVICE&&(e=d=30);a.hitArea.x=c-d/2;a.hitArea.y=b-e/2;a.hitArea.width=d;a.hitArea.height=e};ia.ComparisonPyramidLayer.prototype._renderItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.context.strokeStyle=b.color}this._drawItem(a,this.context)};
ia.ComparisonPyramidLayer.prototype.selectItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.selectionContext.strokeStyle=b.color}this._drawItem(a,this.selectionContext)};ia.ComparisonPyramidLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext,!0)};
ia.ComparisonPyramidLayer.prototype._drawSpline=function(a,b){for(var c=[],d=a.childItems.length,e=0;e<d-2;e++)c=c.concat(this._getControlPoints(a.childItems[e].shape.x,a.childItems[e].shape.y,a.childItems[e+1].shape.x,a.childItems[e+1].shape.y,a.childItems[e+2].shape.x,a.childItems[e+2].shape.y,0.3));for(e=1;e<d-2;e++)b.beginPath(),b.moveTo(a.childItems[e].shape.x,a.childItems[e].shape.y),b.bezierCurveTo(c[4*e-2],c[4*e-1],c[4*e],c[4*e+1],a.childItems[e+1].shape.x,a.childItems[e+1].shape.y),b.stroke();
d>0&&(b.beginPath(),b.moveTo(a.childItems[0].shape.x,a.childItems[0].shape.y),b.quadraticCurveTo(c[0],c[1],a.childItems[1].shape.x,a.childItems[1].shape.y),b.stroke(),b.beginPath(),b.moveTo(a.childItems[d-1].shape.x,a.childItems[d-1].shape.y),b.quadraticCurveTo(c[4*d-10],c[4*d-9],a.childItems[d-2].shape.x,a.childItems[d-2].shape.y),b.stroke())};
ia.ComparisonPyramidLayer.prototype._getControlPoints=function(a,b,c,d,e,f,g){var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),h=g*h/(h+Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)));g-=h;return[c+h*(a-e),d+h*(b-f),c-g*(a-e),d-g*(b-f)]};ia.ComparisonPyramidLayer.prototype._drawItem=function(a,b,c){this._drawSpline(a,b);if(c==!0)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];e!=void 0&&(b.beginPath(),ia.Shape.drawCircle(b,e.shape.x,e.shape.y,5),b.fill(),b.stroke())}};
ia.ComparisonPyramidLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.ComparisonPyramidLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${ageGroup}").join(e.ageGroup),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" <br/> "+e.ageGroup+" <br/> "+e.formattedValue);ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+
30)):(c=e.value<0?e.shape.x-(this.map.datatip.getWidth()+5):e.shape.x+e.shape.width+5,e=e.shape.y+e.shape.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};ia.MapMouseEvent=function(a,b,c,d,e,f,g,h,k,i,l){ia.MapMouseEvent.baseConstructor.call(this,b,c,f,g,a);this.x2=h;this.y2=k;this.dataX=d;this.dataY=e;this.map=a;this.pageX=i;this.pageY=l};ia.extend(ia.MouseEvent,ia.MapMouseEvent);ia.MapMouseEvent.MAP_PINCH_DOWN="mapPinchDown";
ia.MapMouseEvent.MAP_PINCH_MOVE="mapPinchMove";ia.MapMouseEvent.MAP_PINCH_UP="mapPinchUp";ia.MapMouseEvent.MAP_MOUSE_CLICK="mapMouseClick";ia.MapMouseEvent.MAP_MOUSE_DOWN="mapMouseDown";ia.MapMouseEvent.MAP_MOUSE_UP="mapMouseUp";ia.MapMouseEvent.MAP_MOUSE_MOVE="mapMouseMove";ia.MapMouseEvent.MAP_MOUSE_OVER="mapMouseOver";ia.MapMouseEvent.MAP_MOUSE_OUT="mapMouseOut";ia.MapMouseEvent.MAP_MOUSE_WHEEL="mapMouseWheel";ia.MapMouseEvent.MAP_MOUSE_WHEEL_END="mapMouseWheelEnd";
ia.MapMouseEvent.MAP_MOUSE_DRAG="mapMouseDrag";ia.MapMouseEvent.MAP_MOUSE_DRAG_UP="mapMouseDragUp";
ia.Map=function(a){ia.Map.baseConstructor.call(this,a);this._bitmapMode=!1;this._mouseDownPixels=this._mouseDownCoords=this._imageDataBBox=void 0;this._doZoom=this._doPan=!1;this._userDefinedRect=void 0;this._doZoomWheel=!1;this._wheelTimeout=this._lastW=void 0;this.container.addClass("ia-map");this.maintainAspectRatio=!0;this.controller=new ia.MapController(this);this.isDraggable=!0;var b=this;b.addEventListener(ia.Event.MAP_READY,function(){b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,b._bBoxChangeHandler.bind(b));
b.addEventListener(ia.BBoxEvent.BBOX_SCALE,b._bBoxChangeHandler.bind(b))});this.markerLayer=new ia.MarkerLayer;this.markerLayer.setMap(this,this.foregroundContainer);this.markerLayer.setVisible(!0)};ia.extend(ia.CanvasBase,ia.Map);
ia.Map.prototype.useNavigation=function(a){a&&(this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_MOVE,this._onMouseMove.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DOWN,this._onMouseDown.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DRAG,this._onMouseDrag.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DRAG_UP,this._onMouseDragUp.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_UP,this._onMouseUp.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OVER,
this._onMouseOver.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OUT,this._onMouseOut.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_WHEEL,this._onMouseWheel.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_DOWN,this._onPinchDown.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_MOVE,this._onPinchMove.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_UP,this._onPinchUp.bind(this)))};
ia.Map.prototype._bBoxChangeHandler=function(){this._bitmapMode?this._drawBitmap():this.render()};ia.Map.prototype.render=function(){this.mapContainer.css({"-moz-transform":"matrix(1, 0, 0, 1, 0, 0)","-webkit-transform":"matrix(1, 0, 0, 1, 0, 0)","-o-transform":"matrix(1, 0, 0, 1, 0, 0)",msTransform:"matrix(1, 0, 0, 1, 0, 0)",transform:"matrix(1, 0, 0, 1, 0, 0)"});for(var a=this.getLayers(),b=0;b<a.length;b++)a[b].render();this.markerLayer.render()};
ia.Map.prototype._drawBitmap=function(){var a=this.getPixelRect(this._imageDataBBox),b,c,d,e,f;this._doPan?(c=b=0,e=d=1,f=a.x,a=a.y):(b=this.mouseX,c=this.mouseY,d=this._imageDataBBox.getWidth()/this.bBox.getWidth(),e=this._imageDataBBox.getHeight()/this.bBox.getHeight(),a=f=0);this.mapContainer.css({"transform-origin":b+"px "+c+"px",msTransformOrigin:b+"px "+c+"px","-moz-transform-origin":b+"px "+c+"px","-webkit-transform-origin":b+"px "+c+"px","-o-transform-origin":b+"px "+c+"px","-moz-transform":"matrix("+
d+", 0, 0, "+e+", "+f+", "+a+")","-webkit-transform":"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")","-o-transform":"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")",msTransform:"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")",transform:"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")"})};ia.Map.prototype._initBitmap=function(){this.datatip.hide();this._bitmapMode=!0;this.doHitTest=!1;this._imageDataBBox=this.getBBox()};
ia.Map.prototype._drawRect=function(a,b,c){for(var d in c)a[d]=c[d];a.beginPath();a.rect(b.x,b.y,b.width,b.height);a.fill();a.stroke()};ia.Map.prototype._drawBBox=function(a,b,c){b=this.getPixelRect(b);this._drawRect(a,b,c)};ia.Map.prototype.zoomToFeatureWithId=function(a,b){for(var c=b||this.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e)if(f==a)return this.zoomToFeature(e[f]),!0}return!1};
ia.Map.prototype.zoomToFeatureWithName=function(a,b){for(var c=b||this.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e){var g=e[f];if(g.name==a)return this.zoomToFeature(g),!0}}return!1};
ia.Map.prototype.zoomToFeature=function(a){if(a.bBox&&a.bBox.getXMin()!=Infinity){var b=a.bBox.clone(),c=b.getWidth()*0.2,d=b.getHeight()*0.2,e=b.getXCenter(),f=b.getYCenter();b.setWidth(b.getWidth()+c*2);b.setHeight(b.getHeight()+d*2);b.setXCenter(e);b.setYCenter(f);this.maxZoom!=-1&&Math.min(b.getWidth(),b.getHeight())<this.maxZoom&&(e=b.getXCenter(),f=b.getYCenter(),b.setWidth(this.maxZoom),b.setHeight(this.maxZoom),b.setXCenter(e),b.setYCenter(f));a.layer.geometry=="point"?this.controller.centerOnCoords(b.getXCenter(),
b.getYCenter()):this.controller.zoomToBBox(b)}};
ia.Map.prototype.zoomToFeatures=function(a,b){if(a.length>0)if(a.length==1)this.zoomToFeatureWithId(a[0],b);else{for(var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=b||this.getLayers(),h=0;h<g.length;h++)for(var k=g[h].items,i=0;i<a.length;i++){var l=k[a[i]];l&&l.bBox&&(c=l.bBox.getXMin()<c?l.bBox.getXMin():c,d=l.bBox.getYMin()<d?l.bBox.getYMin():d,e=l.bBox.getXMax()>e?l.bBox.getXMax():e,f=l.bBox.getYMax()>f?l.bBox.getYMax():f)}c!=Infinity&&d!=Infinity&&e!=Infinity&&f!=Infinity&&(c=(new ia.BoundingBox(c,
d,e,f)).addMargin(),this.maxZoom!=-1&&Math.min(c.getWidth(),c.getHeight())<this.maxZoom&&(cx=c.getXCenter(),cy=c.getYCenter(),c.setWidth(this.maxZoom),c.setHeight(this.maxZoom),c.setXCenter(cx),c.setYCenter(cy)),this.controller.zoomToBBox(c))}};ia.Map.prototype.centerOnFeature=function(a){for(var b=this.getLayers(),c=0;c<b.length;c++){var d=b[c].items,e;for(e in d)if(e==a)return a=d[e].bBox,this.controller.centerOnCoords(a.getXCenter(),a.getYCenter()),!0}return!1};ia.Map.prototype.zoomToLayer=function(a){this.controller.zoomToBBox(a.bBox.addMargin())};
ia.Map.prototype._onMouseOver=function(){this._doZoomWheel=!0};ia.Map.prototype._onMouseOut=function(){this.datatip.hide();this._doZoomWheel=!1};ia.Map.prototype._onMouseDown=function(){ia.disableTextSelection($j("body"));this._mouseDownCoords=this.mouseCoords();this._mouseDownPixels=new ia.Point(this.mouseX,this.mouseY);this._doZoom=this._doPan=!1;this._doPan=!0};ia.Map.prototype._onMouseUp=function(){this._doZoom=this._doPan=!1;ia.enableTextSelection($j("body"))};ia.Map.prototype._onMouseMove=function(){};
ia.Map.prototype._onMouseDrag=function(){var a=this.mouseCoords(),b=new ia.Point(this.mouseX,this.mouseY);if(this._doPan)this._bitmapMode==!1&&this._initBitmap(),ia.showMoveCursor(),a=this._mouseDownCoords.subtract(a),this.controller.translate(a.x,a.y);else if(this._doZoom)this._userDefinedRect=new ia.Rectangle(Math.min(this._mouseDownPixels.x,b.x),Math.min(this._mouseDownPixels.y,b.y),Math.abs(this._mouseDownPixels.x-b.x),Math.abs(this._mouseDownPixels.y-b.y)),this._drawRect(this.context,this._userDefinedRect,
{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"#CCCCCC",lineWidth:"0.5"})};ia.Map.prototype._onMouseDragUp=function(){var a=this.mouseCoords();this._bitmapMode=!1;this._doZoom?this._userDefinedRect.width>5&&this._userDefinedRect.height>5&&this.controller.zoomToPointExtent(this._mouseDownCoords,a):this._doPan&&this.render();ia.showDefaultCursor();this._doZoom=this._doPan=!1;ia.enableTextSelection($j("body"))};ia.Map.prototype._onPinchDown=function(){this._doZoom=this._doPan=!1};
ia.Map.prototype._onPinchMove=function(a){this._bitmapMode==!1&&this._initBitmap();a=Math.abs(a.x-a.x2);if(this._lastW!=void 0)this.mouseX=this.container.width()/2,this.mouseY=this.container.height()/2,this.controller.zoomOnCenter(this._lastW/a);this._lastW=a};ia.Map.prototype._onPinchUp=function(){this._lastW=void 0;this._bitmapMode=!1;this.render()};
ia.Map.prototype._onMouseWheel=function(a){if(this._doZoomWheel)this.datatip.hide(),this._bitmapMode==!1&&this._initBitmap(),this.controller.zoomOnCursor(a.delta>0?1/1.4:1.4),clearTimeout(this._wheelTimeout),this._wheelTimeout=setTimeout(function(){clearTimeout(this._wheelTimeout);this._bitmapMode=!1;this.render();this.dispatchEvent(new ia.MapMouseEvent(this,a,ia.MapMouseEvent.MAP_MOUSE_WHEEL_END,this.mouseX,this.mouseY))}.bind(this),250)};
ia.GoogleMap=function(a,b,c,d,e,f,g){function h(){r==!1&&(k()?n.controller.zoomFull():n.commitChanges())}function k(){var a=o.getProjection(),b=j.gMap.getBounds(),c=b.getNorthEast();return b.getSouthWest().lng()>=c.lng()?!0:a.getWorldWidth()<=j.container.width()?!0:!1}function i(){var a=j.gMap.getBounds(),b;hw1=l(p);hw2=l(a);if(Math.floor(hw1.x)==0)b=0;else if(Math.floor(hw1.y)==0)b=0;else{b=hw2.x/hw1.x;var c=hw2.y/hw1.y;b=b<c?b:c;b=b<1?0:Math.floor(Math.log(b)/Math.log(2))}b>0&&q?j.gMap.setZoom(j.gMap.getZoom()+
b):(b=a.getNorthEast(),a=a.getSouthWest(),a=m.project(a.lng(),a.lat(),!0),b=m.project(b.lng(),b.lat(),!0),j.bBox.setXMin(a.x),j.bBox.setYMin(a.y),j.bBox.setXMax(b.x),j.bBox.setYMax(b.y),j.commitChanges());q=!1}function l(a){var b=o.getProjection(),c=b.fromLatLngToContainerPixel(a.getSouthWest()),a=b.fromLatLngToContainerPixel(a.getNorthEast());return new google.maps.Point(Math.abs(c.y-a.y),Math.abs(c.x-a.x))}ia.GoogleMap.baseConstructor.call(this);var j=this,m=new ia.GoogleMercatorProjection,n,o,
p,q=!1,r=!1,t=-1,s=-1;this.addMapOverlay=function(a){function b(){this.setMap(j.gMap)}n=a;n.embeddedInGoogleMaps=!0;n.isDraggable=!1;n.addEventListener(ia.Event.MAP_RESIZE,h);var c=j.controller.defaultBBox,a=m.unproject(c.getXMin(),c.getYMin(),!0),c=m.unproject(c.getXMax(),c.getYMax(),!0),a=new google.maps.LatLng(a.latitude,a.longitude),c=new google.maps.LatLng(c.latitude,c.longitude);j.defaultBounds=new google.maps.LatLngBounds(a,c);b.prototype=new google.maps.OverlayView;b.prototype.onAdd=function(){this.getPanes().overlayImage.appendChild(n.container.get(0))};
b.prototype.draw=function(){};b.prototype.onRemove=function(){n.container.parentNode.removeChild(n.container)};o=new b;var f=-1;google.maps.event.addListener(j.gMap,"zoom_changed",function(){var a=j.gMap.getZoom(),b=!0;d!=-1&&a<d&&(b=!1);e!=-1&&a>e&&(b=!1);a==f&&(b=!1);b&&(r=!0,f!=-1&&n.clear(),f=a)});google.maps.event.addListener(j.gMap,"idle",function(){n.clear();var a=o.getProjection();if(k()){var b=j.defaultBounds.getSouthWest(),c=j.defaultBounds.getNorthEast(),d=a.fromLatLngToDivPixel(b),c=a.fromLatLngToDivPixel(c),
e=Math.abs(c.x-d.x),f=Math.abs(d.y-c.y),d=d.x,g=c.y;if(j.controller.defaultBBox.getWidth()>=4E7)e=a.getWorldWidth(),a=a.fromLatLngToContainerPixel(b).x,b=j.container.width()/2,a>b&&(d-=e);n.container.css({left:d+"px",top:g+"px",width:e+"px",height:f+"px"})}else e=j.gMap.getBounds(),b=e.getSouthWest(),c=e.getNorthEast(),d=a.fromLatLngToDivPixel(b).x,g=a.fromLatLngToDivPixel(c).y,e=j.container.width(),f=j.container.height(),n.container.css({left:d+"px",top:g+"px",width:e+"px",height:f+"px"}),a=m.project(b.lng(),
b.lat(),!0),b=m.project(c.lng(),c.lat(),!0),n.getBBox().setXMin(a.x),n.getBBox().setYMin(a.y),n.getBBox().setXMax(b.x),n.getBBox().setYMax(b.y);Math.round(e)==Math.round(t)&&Math.round(f)==Math.round(s)&&n.render();t=e;s=f;r=!1});google.maps.event.addListener(j.gMap,"dragstart",function(){n.startDrag()});google.maps.event.addListener(j.gMap,"dragend",function(){n.endDrag()})};var u=google.maps.MapTypeId.ROADMAP;this.setMapType=function(a){if(a=="greyscale")u=f;else if(a=="off")u=g;else if(a=="normal")u=
google.maps.MapTypeId.ROADMAP;else if(a=="satellite")u=google.maps.MapTypeId.SATELLITE;else if(a=="hybrid")u=google.maps.MapTypeId.HYBRID;else if(a=="physical")u=google.maps.MapTypeId.TERRAIN};this.setBBox=function(a){if(j.gMap){a.equals(j.controller.defaultBBox)&&(q=!0);a.getXMin()<-2E7&&(a.setXMin(-2E7),j.adjustY(a));a.getXMax()>2E7&&(a.setXMax(2E7),j.adjustY(a));var b=m.unproject(a.getXMin(),a.getYMin(),!0),a=m.unproject(a.getXMax(),a.getYMax(),!0),b=new google.maps.LatLng(b.latitude,b.longitude),
a=new google.maps.LatLng(a.latitude,a.longitude);p=new google.maps.LatLngBounds(b,a);j.gMap.fitBounds(p)}};this.zoomToFeatureWithId=function(a){for(var b=n.getLayers(),c=0;c<b.length;c++){var d=b[c].items,e;for(e in d)if(e==a)return j.zoomToFeature(d[e]),!0}return!1};this.zoomToFeatureWithName=function(a,b){for(var c=b||n.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e){var g=e[f];if(g.name==a)return j.zoomToFeature(g),!0}}return!1};this.zoomToFeature=function(a){a.bBox&&a.bBox.getXMin()!=
Infinity&&j.controller.zoomToBBox(a.bBox)};this.zoomToFeatures=function(a,b){for(var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=b||this.getLayers(),h=0;h<g.length;h++)for(var i=g[h].items,k=0;k<a.length;k++){var l=i[a[k]];l&&l.bBox&&(c=l.bBox.getXMin()<c?l.bBox.getXMin():c,d=l.bBox.getYMin()<d?l.bBox.getYMin():d,e=l.bBox.getXMax()>e?l.bBox.getXMax():e,f=l.bBox.getYMax()>f?l.bBox.getYMax():f)}c!=Infinity&&d!=Infinity&&e!=Infinity&&f!=Infinity&&(c=new ia.BoundingBox(c,d,e,f),j.controller.zoomToBBox(c))};
this.centerOnFeature=function(a){return this.zoomToFeature(a)};(function(){j.id=a;j.apiKey=c;j.setMapType(b);var h=new google.maps.StyledMapType([{featureType:"all",stylers:[{saturation:-80}]}],{name:f}),k=new google.maps.StyledMapType([{stylers:[{visibility:"off"}]}],{name:g}),l={panControl:!1,zoomControl:!1,streetViewControl:!1,overviewMapControl:!0,disableDoubleClickZoom:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,
google.maps.MapTypeId.TERRAIN,f,g]}};if(d!=-1)l.minZoom=d;if(e!=-1)l.maxZoom=e;j.container=$j("<div id='"+a+"' class='ia-map'>");j.mapContainer=$j("<div id='"+a+"-map-container'>");j.container.append(j.mapContainer);j.controller=new ia.MapController(j);var m;j.container.resize(function(){clearTimeout(m);m=setTimeout(function(){clearTimeout(m);var b=j.container.width(),c=j.container.height();if(j.mapContainer.width()!=b||j.mapContainer.height()!=c){j.mapContainer.width(b);j.mapContainer.height(c);
j.canvasWidth=b;j.canvasHeight=c;j.commitChanges();if(j.gMap==void 0)j.gMap=new google.maps.Map(document.getElementById(a+"-map-container"),l),google.maps.event.addListener(j.gMap,"bounds_changed",i),j.gMap.mapTypes.set(f,h),j.gMap.mapTypes.set(g,k),j.gMap.setMapTypeId(u),b=new ia.Event(ia.Event.MAP_READY,j),j.dispatchEvent(b);google.maps.event.trigger(j.gMap,"resize")}},500)})})()};ia.extend(ia.CartesianSpace,ia.GoogleMap);ia.MapController=function(a){this._map=a};
ia.MapController.prototype.panN=function(){this.pan(0)};ia.MapController.prototype.panNE=function(){this.pan(45)};ia.MapController.prototype.panE=function(){this.pan(90)};ia.MapController.prototype.panSE=function(){this.pan(135)};ia.MapController.prototype.panS=function(){this.pan(180)};ia.MapController.prototype.panSW=function(){this.pan(225)};ia.MapController.prototype.panW=function(){this.pan(270)};ia.MapController.prototype.panNW=function(){this.pan(315)};
ia.MapController.prototype.pan=function(a,b){b==null&&(b=0.5);var c=Math.abs(b),c=a>=45&&a<=135||a>=225&&a<=315?this._map.getBBox().getWidth()*c:this._map.getBBox().getHeight()*c;this.panDistance(a,c)};ia.MapController.prototype.panDistance=function(a,b){if(a>=0&&a<=360){var c=a*(Math.PI/180);this.translate(Math.sin(c)*b,Math.cos(c)*b)}};ia.MapController.prototype.centerOnCursor=function(){this.centerOnPoint(this._map.mouseCoords())};
ia.MapController.prototype.centerOnPoint=function(a){this.centerOnCoords(a.x,a.y)};ia.MapController.prototype.centerOnCoords=function(a,b){var c=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,d=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2;this.translate(a-c,b-d)};
ia.MapController.prototype.translate=function(a,b){var c=this._map.getBBox().getXMin()+a,d=this._map.getBBox().getYMin()+b,e=this._map.getBBox().getWidth(),f=this._map.getBBox().getHeight();this.resetBBox(c,d,e,f)};ia.MapController.prototype.zoomIn=function(){this.zoomOnCenter(0.5)};ia.MapController.prototype.zoomOut=function(){this.zoomOnCenter(2)};
ia.MapController.prototype.zoomOnCenter=function(a){a==null&&(a=0.5);var b=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,c=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2;this.zoomOnCoords(b,c,a)};ia.MapController.prototype.zoomInOnCursor=function(){this.zoomOnPoint(this._map.mouseCoords(),0.5)};ia.MapController.prototype.zoomOutOnCursor=function(){this.zoomOnPoint(this._map.mouseCoords(),2)};
ia.MapController.prototype.zoomOnCursor=function(a){a==null&&(a=0.5);this.zoomOnPoint(this._map.mouseCoords(),a)};ia.MapController.prototype.zoomOnPoint=function(a,b){b==null&&(b=0.5);this.zoomOnCoords(a.x,a.y,b)};
ia.MapController.prototype.zoomOnCoords=function(a,b,c){c==null&&(c=0.5);var d=Math.abs(c),c=this._map.getBBox().getWidth()*d;d*=this._map.getBBox().getHeight();a-=(a-this._map.getBBox().getXMin())/this._map.getBBox().getWidth()*c;b-=(b-this._map.getBBox().getYMin())/this._map.getBBox().getHeight()*d;this.resetBBox(a,b,c,d)};ia.MapController.prototype.zoomToPointExtent=function(a,b){this.resetBBox(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.abs(a.x-b.x),Math.abs(a.y-b.y))};
ia.MapController.prototype.zoomToExtent=function(a){var b=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,c=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2,d=a.width,a=a.height;this.resetBBox(b-d/2,c-a/2,d,a)};ia.MapController.prototype.changeBBox=function(a,b,c,d){a=this._map.getBBox().getXMin()+a;b=this._map.getBBox().getYMin()+b;c=this._map.getBBox().getXMax()+c;d=this._map.getBBox().getYMax()+d;this.resetBBox(a,b,c-a,d-b)};
ia.MapController.prototype.zoomToRect=function(a){a.width>5&&a.height>5&&this.zoomToBBox(this.getDataBBox(a))};ia.MapController.prototype.zoomFull=function(){this.zoomToBBox(this.defaultBBox)};ia.MapController.prototype.zoomToBBox=function(a){a&&this._map.setBBox(a)};ia.MapController.prototype.resetBBox=function(a,b,c,d){this.zoomToBBox(new ia.BoundingBox(a,b,a+c,b+d))};
ia.FeatureLayer=function(a){ia.FeatureLayer.baseConstructor.call(this);this.dataLabel="";this.minLabelExtent=-Infinity;this.maxLabelExtent=Infinity;this.symbolSize=15;this.iconPath="";this.eval=!0;this.uid="";this.symbol=ia.Shape.CIRCLE;this.highlightOpacity=this.selectionOpacity=0.3;if(a!=null)this.source=a};ia.extend(ia.ItemLayer,ia.FeatureLayer);
ia.FeatureLayer.prototype.loadSource=function(){var a=this;ia.File.load({url:a.source,dataType:"json",onSuccess:function(b){a.parseData(b);a.isLoaded=!0;a.render();b=new ia.Event(ia.Event.LAYER_READY,a);a.dispatchEvent(b)}})};
ia.FeatureLayer.prototype.parseData=function(a){this.items={};this.itemArray=[];if(a.e!=void 0)this.eval=!1;if(a.uid!=void 0)this.uid=a.uid;for(var b=a.boundingBox.split(" "),c=new ia.BoundingBox(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),b=c.getXMin(),d=c.getYMin(),e=c.getWidth(),c=c.getHeight(),f=parseFloat(a.pixelWidth),g=parseFloat(a.pixelHeight),h=Infinity,k=Infinity,i=-Infinity,l=-Infinity,j=a.features.length,m=0;m<j;m++){var n=a.features[m],o={};o.state=ia.ItemLayer.UNSELECTED;
o.layer=this;o.id=n.d;o.name=n.n;o.parent=this;o.symbolSize=this.symbolSize;if(this.geometry=="line")o.symbolSize=this.style.lineWidth;if(this.geometry=="polygon"||this.geometry=="line"){for(var p=Infinity,q=Infinity,r=-Infinity,t=-Infinity,s=n.p.length,u=[],v=0;v<s;v++){for(var w=n.p[v],x=w.length-1,A=[],z=0,B=0,C=0;C<x;C+=2){var y={};z+=w[C];B+=w[C+1];y.x=b+z/f*e;y.y=d+B/g*c;A.push(y);p=y.x<p?y.x:p;q=y.y<q?y.y:q;r=y.x>r?y.x:r;t=y.y>t?y.y:t}u.push(A)}o.shapes=u}else y={},y.x=b+n.p[0]/f*e,y.y=d+n.p[1]/
g*c,p=y.x,q=y.y,r=y.x,t=y.y,o.shapes=[y];o.bBox=new ia.BoundingBox(p,q,r,t);o.size=Math.max(o.bBox.getWidth(),o.bBox.getHeight());this.items[o.id]=o;this.itemArray.push(o);h=p<h?p:h;k=q<k?q:k;i=r>i?r:i;l=t>l?t:l}this.bBox=new ia.BoundingBox(h,k,i,l);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};ia.FeatureLayer.prototype.render=function(){this.map&&this.getVisible()&&this.isLoaded&&(this.clear(),this.draw())};
ia.FeatureLayer.prototype.draw=function(){if(this.map&&this.getVisible()&&this.isLoaded){for(var a in this.style)this.context[a]=this.style[a],this.interactive&&(this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a]);if(this.interactive)this.selectionContext.strokeStyle=this.selectionColor,this.selectionContext.fillStyle=ia.Color.toRGBA(this.selectionColor,this.selectionOpacity),this.selectionContext.lineWidth=Math.max(2,parseFloat(this.style.lineWidth)+1.5),this.highlightContext.strokeStyle=
ia.Color.toRGBA(this.highlightColor,0.8),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,this.highlightOpacity),this.highlightContext.lineWidth=Math.max(2,parseFloat(this.style.lineWidth)+1.5);a=this.getData();var b=this.map.getBBox(),c=!1,d=Math.min(b.getWidth(),b.getHeight()),e=Math.max(b.getWidth(),b.getHeight());d>=this.minLabelExtent&&e<=this.maxLabelExtent&&(c=!0);d=this.itemArray.length;for(e=0;e<d;e++){var f=this.itemArray[e];if(this.dataChanged){var g=a[f.id];if(g){f.name=
g.name;f.disabled=!1;var h=ia.Color.a(this.style.fillStyle);if(g.color)f.color=ia.Color.toRGBA(g.color,h);f.symbolSize=g.symbolSize}else f.disabled=!0,f.color=this.style.fillStyle,f.symbolSize=0}this.geometry!="point"&&f.bBox&&f.bBox.intersects(b)&&(this.renderItem(f),this.showLabels&&c&&this.renderItemLabel(f))}if(this.geometry=="point"){this.itemArray.sort(function(a,b){return a.symbolSize<b.symbolSize?1:a.symbolSize>b.symbolSize?-1:0});d=this.itemArray.length;for(e=0;e<d;e++)f=this.itemArray[e],
f.bBox&&f.bBox.intersects(b)&&f.symbolSize>0&&(this.renderItem(f),this.showLabels&&c&&this.renderItemLabel(f))}if(this.dataChanged)this.dataChanged=!1;this.renderSelection()}};ia.FeatureLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.FeatureLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.FeatureLayer.prototype.renderItem=function(a){if(a.color&&(this.context.fillStyle=a.color,this.geometry=="line"))this.context.strokeStyle=a.color;this._drawItem(a,this.context)};
ia.FeatureLayer.prototype._drawItem=function(a,b){if(this.getVisible()&&b){b.beginPath();var c=a.shapes.length;if(this.geometry=="polygon")for(var d=0;d<c;d++){var e=a.shapes[d],f=e.length;b.moveTo(this.map.getPixelX(e[0].x),this.map.getPixelY(e[0].y));for(var g=1;g<f;g++)b.lineTo(this.map.getPixelX(e[g].x),this.map.getPixelY(e[g].y))}else if(this.geometry=="point")for(d=0;d<c;d++)e=a.shapes[d],f=this.map.getPixelX(e.x),e=this.map.getPixelY(e.y),this.icon!=void 0?b.drawImage(this.icon,f-this.icon.width/
2,e-this.icon.height/2,this.icon.width,this.icon.height):a.symbolSize>0&&ia.Shape.draw(this.symbol,b,f,e,a.symbolSize);else if(this.geometry=="line"&&a.symbolSize>0){for(d=0;d<c;d++){e=a.shapes[d];f=e.length;b.moveTo(this.map.getPixelX(e[0].x),this.map.getPixelY(e[0].y));for(g=1;g<f;g++)b.lineTo(this.map.getPixelX(e[g].x),this.map.getPixelY(e[g].y))}b.lineWidth=a.symbolSize}this.geometry!="line"&&b.fill();b.stroke()}};
ia.FeatureLayer.prototype.renderItemLabel=function(a){var b=this.map.getPixelX(a.bBox.getXCenter()),c=this.map.getPixelY(a.bBox.getYCenter());this.geometry=="polygon"?(this.labelContext.textBaseline="middle",this.labelContext.textAlign="center"):(this.labelContext.textBaseline="bottom",this.labelContext.textAlign="left",this.icon?(b+=this.icon.width/2,c-=this.icon.width/2):(b+=a.symbolSize/2,c-=a.symbolSize/2));this.labelContext.strokeText(a.name,b,c);this.labelContext.fillText(a.name,b,c)};
ia.FeatureLayer.prototype.hitItem=function(a,b){var c=b.dataX,d=b.dataY;if(this.geometry=="point")for(var e=a.shapes,f,g=0;g<e.length;g++){if(f=e[g],f=this.iconPath!=""?this._pointInRect(this.icon.width,this.icon.height,f,c,d):this._pointInRect(a.symbolSize,a.symbolSize,f,c,d))return!0}else if(this.geometry=="polygon"){if(a.bBox)if(c<a.bBox.left()||c>a.bBox.right())return!1;else if(d>a.bBox.top()||d<a.bBox.bottom())return!1;e=a.shapes;for(g=0;g<e.length;g++)if(f=this._pointInPoly(e[g],c,d))return!0}else if(this.geometry==
"line"){if(a.bBox)if(c<a.bBox.left()||c>a.bBox.right())return!1;else if(d>a.bBox.top()||d<a.bBox.bottom())return!1;c=a.shapes;for(g=0;g<c.length;g++)if(f=this._pointInLine(c[g],b.x,b.y))return!0}return!1};ia.FeatureLayer.prototype._pointInLine=function(a,b,c){for(var b=new ia.Rectangle(b-4,c-4,8,8),c=a.length,d=0;d<c-1;d++){var e=this.map.getPixelX(a[d].x),f=this.map.getPixelY(a[d].y),g=this.map.getPixelX(a[d+1].x),h=this.map.getPixelY(a[d+1].y);if(b.intersectsLine({x:e,y:f},{x:g,y:h}))return!0}return!1};
ia.FeatureLayer.prototype._pointInPoly=function(a,b,c){var d,e,f=0;d=0;for(e=a.length-1;d<a.length;e=d++)a[d].y>c!=a[e].y>c&&b<(a[e].x-a[d].x)*(c-a[d].y)/(a[e].y-a[d].y)+a[d].x&&(f=!f);return f};ia.FeatureLayer.prototype._pointInRect=function(a,b,c,d,e){var f=c.x,c=c.y,a=this.map.getDataWidth(a),b=this.map.getDataHeight(b);return d>=f-a/2&&d<=f+a/2&&e>=c-b/2&&e<=c+b/2?!0:!1};
ia.FeatureLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.geometry=="point"?(c=this.map.getPixelX(a.bBox.getXCenter())+a.symbolSize/2,d=this.map.getPixelY(a.bBox.getYCenter())-a.symbolSize/2-this.map.datatip.getHeight()):(c=b.x+10,d=b.y-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};
ia.TileLayer=function(a){ia.TileLayer.baseConstructor.call(this);this._tileCache=[];this.path="./";this.minExtent=-Infinity;this.maxExtent=Infinity;if(a!=null)this.source=a};ia.extend(ia.LayerBase,ia.TileLayer);
ia.TileLayer.prototype.render=function(){if(this.map&&this.getVisible()&&this.isLoaded){this.clear();var a=this.map.getBBox(),a=Math.min(a.getWidth(),a.getHeight());if(a>this.minExtent&&a<this.maxExtent)for(var a=this.map.getBBox(),b=this._tileCache.length,c=0;c<b;c++){var d=this._tileCache[c];d.bBox.intersects(a)&&this._renderTile(d)}}};
ia.TileLayer.prototype._renderTile=function(a){if(a.image){var b=this.map.getPixelRect(a.bBox);this.context.drawImage(a.image,b.x,b.y,b.width,b.height)}else{var c=this,d=new Image;d.onload=function(){a.image=d;c._renderTile(a)};d.src=a.path}};ia.TileLayer.prototype.loadSource=function(){var a=this;ia.File.load({url:a.source,dataType:"json",onSuccess:function(b){a.parseData(b);a.isLoaded=!0;a.render();b=new ia.Event(ia.Event.LAYER_READY,a);a.dispatchEvent(b)}})};
ia.TileLayer.prototype.parseData=function(a){this.path.indexOf("/",this.path.length-1)==-1&&(this.path+="/");var b=ia.File.getFileDirectory(this.source)+this.path,c=a.boundingBox.split(" "),d=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),e=parseFloat(a.pixelWidth),f=parseFloat(a.pixelHeight),g=a.tileWidth/e*d.getWidth(),h=a.tileHeight/f*d.getHeight(),k=this;$j.each(a.tiles,function(c,l){var j=d.getXMin()+l.x/e*d.getWidth(),m=j+g,n=d.getYMax()-l.y/f*d.getHeight(),
o=n-h,p={};p.id=l.id;p.bBox=new ia.BoundingBox(j,o,m,n);p.path=b+p.id+"."+a.tileExtension;k._tileCache[k._tileCache.length]=p})};ia.ImageLayer=function(){ia.ImageLayer.baseConstructor.call(this,"");this._item=void 0;this.version=this.srs=this.layers=this.params=this.url=""};ia.extend(ia.LayerBase,ia.ImageLayer);
ia.ImageLayer.prototype.render=function(){if(this.map&&this.getVisible()){this.clear();this.draw(this.context);$j.support.cors=!0;var a=new Image;this._item={};this._item.bBox=this.map.getBBox().clone();this._item.img=a;var b=this;a.onload=function(){var a=b.map.getPixelRect(b._item.bBox);b.clear();b.context.drawImage(b._item.img,a.x,a.y,a.width,a.height)};a.src=this.getUrl(this.map.getBBox(),this.map.canvasWidth,this.map.canvasHeight)}};
ia.ImageLayer.prototype.draw=function(a){try{if(this._item&&this._item.img){var b=this.map.getPixelRect(this._item.bBox);a.drawImage(this._item.img,b.x,b.y,b.width,b.height)}}catch(c){ia.log(c)}};ia.ImageLayer.prototype.getUrl=function(){};ia.AGSLayer=function(){ia.AGSLayer.baseConstructor.call(this)};ia.extend(ia.ImageLayer,ia.AGSLayer);
ia.AGSLayer.prototype.getUrl=function(a,b,c){var d=this.url;this.url.indexOf("?")==-1&&(d+="?");this.url.charAt(this.url.length-1)!="&"&&this.url.charAt(this.url.length-1)!="?"&&(d+="&");d+="bbox="+a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax();this.params.toLowerCase().indexOf("f=")<0&&(d+="&f=image");this.params.toLowerCase().indexOf("layers=")<0&&(d+="&layers="+this.layers);this.params.toLowerCase().indexOf("bboxSR=")<0&&(d+="&bboxSR="+this.srs);this.params.toLowerCase().indexOf("imageSR=")<
0&&(d+="&imageSR="+this.srs);this.params.toLowerCase().indexOf("format=")<0&&(d+="&format=jpg");this.params.toLowerCase().indexOf("size=")<0&&(d+="&size="+Math.round(b)+","+Math.round(c));d+=this.params;return d};ia.FeatureServiceLayer=function(a){ia.FeatureServiceLayer.baseConstructor.call(this,a);this._firstRender=!0;this._renderQueue=this._rendering=!1;this._maxRecordCount=Infinity;this.nameField=this.idField=this._objectIdField="";this.srs=102100};ia.extend(ia.FeatureLayer,ia.FeatureServiceLayer);
ia.FeatureServiceLayer.prototype.loadSource=function(a){var b=this;b.eval=!1;ia.FeatureServiceReader.getInfo(b.source,ia.accessToken,function(c,d){b.token=d;b.esriGeometryType=c.geometryType;b._objectIdField=c.objectIdField;b._maxRecordCount=Infinity;if(c.maxRecordCount!=void 0)b._maxRecordCount=ia.parseInt(c.maxRecordCount);b.items={};b.itemArray=[];if(b.geometry=="line")b.symbolSize=b.style.lineWidth;var e=ia.FeatureServiceReader.buildQuery(b.source,[b._objectIdField,b.idField,b.nameField]);ia.FeatureServiceReader.sendQuery(e,
b.token,function(c){for(var d=c.length,e=0;e<d;e++){var k=c[e],i={};i.objectId=String(k.attributes[b._objectIdField]);i.id=String(k.attributes[b.idField]);i.name=String(k.attributes[b.nameField]);i.parent=b;i.state=ia.ItemLayer.UNSELECTED;i.layer=b;i.symbolSize=b.symbolSize;i.shapes=[];i.id.indexOf("#")!=0&&(b.items[i.id]=i,b.itemArray.push(i))}a&&a.call(null);if(b.isLoaded==!1)b.isLoaded=!0,b.render(),c=new ia.Event(ia.Event.LAYER_READY,b),b.dispatchEvent(c)})})};
ia.FeatureServiceLayer.prototype.render=function(){if(this.map&&this.getVisible()&&this.isLoaded)this._rendering==!1?(this._rendering=!0,this._updateItems(function(){this._rendering=!1;if(this._renderQueue)this._renderQueue=!1,this.render()}.bind(this))):(this._firstRender&&(this.clear(),this.draw()),this._renderQueue=!0)};
ia.FeatureServiceLayer.prototype._updateItems=function(a){if(this.map&&this.getVisible()){var b=Infinity,c=Infinity,d=-Infinity,e=-Infinity;this.clear();this.draw();for(var f=[this._objectIdField,this.idField,this.nameField],g=this.map.getDataWidth(1),h=[],k=[],i=[],l=this.map.getBBox(),j=0,m=[],n=[],o=this.itemArray.length,p=0;p<o;p++){var q=this.itemArray[p];if(q.bBox==void 0)n[n.length]=q,i[i.length]=q,m[m.length]=q.objectId,j++;else if(q.bBox.intersects(l)&&(n[n.length]=q,i[i.length]=q,q.maxAllowableOffset>
g))m[m.length]=q.objectId,j++;q.bBox!=void 0&&(b=q.bBox.getXMin()<b?q.bBox.getXMin():b,c=q.bBox.getYMin()<c?q.bBox.getYMin():c,d=q.bBox.getXMax()>d?q.bBox.getXMax():d,e=q.bBox.getYMax()>e?q.bBox.getYMax():e);if(j==this._maxRecordCount||p==o-1&&m.length>0)h[h.length]=m,k[k.length]=n,j=0,m=[],n=[]}this.bBox=new ia.BoundingBox(b,c,d,e);if(h.length>0){var r=h.length,t=0,s=this,u=function(b){s._firstRender&&t==0&&s.clear();s.parseData(b,g);s._firstRender&&s._renderItems(k[t]);t++;s._renderQueue==!0?a.call(null):
t==r?(s._firstRender||(s.clear(),s._renderItems(i)),s.renderSelection(),s._firstRender=!1,a.call(null)):ia.FeatureServiceReader.getFeatureGeometry(s.source,s.token,h[t],f,this.srs,g,u)};ia.FeatureServiceReader.getFeatureGeometry(s.source,s.token,h[t],f,this.srs,g,u)}else this.renderSelection(),a.call(null)}};
ia.FeatureServiceLayer.prototype.parseData=function(a,b){var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g="rings";this.geometry=="line"&&(g="paths");for(var h=a.length,k=0;k<h;k++){var i=a[k],l=this.items[String(i.attributes[this.idField])];if(l){l.maxAllowableOffset=b;if(this.geometry=="polygon"||this.geometry=="line"){var j=Infinity,m=Infinity,n=-Infinity,o=-Infinity;if(i.geometry){for(var p=i.geometry[g].length,q=[],r=0;r<p;r++){for(var t=i.geometry[g][r],s=t.length,u=[],v=0;v<s;v++){var w=
t[v],x={};x.x=w[0];x.y=w[1];u.push(x);j=x.x<j?x.x:j;m=x.y<m?x.y:m;n=x.x>n?x.x:n;o=x.y>o?x.y:o}q.push(u)}l.shapes=q}}else if(this.esriGeometryType=="esriGeometryPoint"){if(i.geometry)x={},x.x=i.geometry.x,x.y=i.geometry.y,j=x.x,m=x.y,n=x.x,o=x.y,l.shapes=[x]}else if(s=i.geometry.points.length,q=[],i.geometry){for(r=0;r<s;r++)w=i.geometry.points[r],x={},x.x=w[0],x.y=w[1],j=x.x,m=x.y,n=x.x,o=x.y,q.push(u);l.shapes=q}l.bBox=new ia.BoundingBox(j,m,n,o);c=j<c?j:c;d=m<d?m:d;e=n>e?n:e;f=o>f?o:f;l.size=Math.max(l.bBox.getWidth(),
l.bBox.getHeight())}}this.bBox=new ia.BoundingBox(c,d,e,f);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};ia.FeatureServiceLayer.prototype._renderItems=function(a){a==void 0&&(a=this.itemArray.concat());for(var b=a.length,c=0;c<b;c++){var d=a[c];if(this.geometry!="point"||this.geometry=="point"&&d.symbolSize>0)this.renderItem(d),this.showLabels&&this.renderItemLabel(d)}};
ia.WMSLayer=function(){ia.WMSLayer.baseConstructor.call(this);this.requiresAxisSwitch=!1};ia.extend(ia.ImageLayer,ia.WMSLayer);
ia.WMSLayer.prototype.getUrl=function(a,b,c){var d=this.url;this.url.indexOf("?")==-1&&(d+="?");this.url.charAt(this.url.length-1)!="&"&&this.url.charAt(this.url.length-1)!="?"&&(d+="&");d+=this.requiresAxisSwitch==!0?"request=GetMap&bbox="+a.getYMin()+","+a.getXMin()+","+a.getYMax()+","+a.getXMax():"request=GetMap&bbox="+a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax();this.params.toLowerCase().indexOf("layers=")<0&&(d+="&layers="+this.layers);this.params.toLowerCase().indexOf("srs=")<
0&&(d+="&srs="+this.srs);this.params.toLowerCase().indexOf("crs=")<0&&(d+="&crs="+this.srs);this.params.toLowerCase().indexOf("width=")<0&&(d+="&width="+Math.round(b));this.params.toLowerCase().indexOf("height=")<0&&(d+="&height="+Math.round(c));this.params.toLowerCase().indexOf("version=")<0&&(d+="&version="+this.version);this.params.toLowerCase().indexOf("format=")<0&&(d+="&format=image/jpeg");this.params.toLowerCase().indexOf("exceptions=")<0&&(d+="&exceptions=application/vnd.ogc.se_blank");this.params.toLowerCase().indexOf("service=")<
0&&(d+="&service=WMS");this.params.toLowerCase().indexOf("styles=")<0&&(d+="&styles=");d+=this.params;return d};ia.MarkerLayer=function(){ia.MarkerLayer.baseConstructor.call(this);this._markers=[]};ia.extend(ia.LayerBase,ia.MarkerLayer);ia.MarkerLayer.prototype.addMarker=function(a,b,c){var d={};d.icon=a;d.x=b;d.y=c;this._markers[this._markers.length]=d};ia.MarkerLayer.prototype.clearMarkers=function(){this._markers=[];this.clear()};
ia.MarkerLayer.prototype.render=function(){this.clear();for(var a=0;a<this._markers.length;a++){var b=this._markers[a],c=this.map.getPixelX(b.x)-b.icon.width/2,d=this.map.getPixelY(b.y)-b.icon.height;this.context.drawImage(b.icon,c,d)}};ia.GeoRSSLayer=function(a){ia.GeoRSSLayer.baseConstructor.call(this,a);this._mp=new ia.GoogleMercatorProjection;this._layerMinY=this._layerMinX=Infinity;this._layerMaxY=this._layerMaxX=-Infinity;$j.support.cors=!0};ia.extend(ia.FeatureLayer,ia.GeoRSSLayer);
ia.GeoRSSLayer.prototype.loadSource=function(){var a=this;$j.ajax({url:document.location.protocol+"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=10&callback=?&q="+encodeURIComponent(a.source),dataType:"json",success:function(b){a.parseData(b.responseData.xmlString);a.isLoaded=!0;a.render();b=new ia.Event(ia.Event.LAYER_READY,a);a.dispatchEvent(b)}})};
ia.GeoRSSLayer.prototype.parseData=function(a){a=$j(a);this.items={};this.itemArray=[];var b=this,c=a.find("item");$j.each(c,function(a,c){b._toFeature(c)});c=a.find("atom\\:entry, entry");$j.each(c,function(a,c){b._toFeature(c)});this.bBox=new ia.BoundingBox(this._layerMinX,this._layerMinY,this._layerMaxX,this._layerMaxY);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};
ia.GeoRSSLayer.prototype._toFeature=function(a){var b={};b.state=ia.ItemLayer.UNSELECTED;b.layer=this;b.id=$j(a).find("guid").text();b.name=$j(a).find("title").text();b.description=$j(a).find("description").text();b.parent=this;b.symbolSize=this.symbolSize;a=this._toPoint(a);minX=a.x;minY=a.y;maxX=a.x;maxY=a.y;b.shapes=[a];b.bBox=new ia.BoundingBox(minX,minY,maxX,maxY);b.size=Math.max(b.bBox.getWidth(),b.bBox.getHeight());this.items[b.id]=b;this.itemArray.push(b);this._layerMinX=minX<this._layerMinX?
minX:this._layerMinX;this._layerMinY=minY<this._layerMinY?minY:this._layerMinY;this._layerMaxX=maxX>this._layerMaxX?maxX:this._layerMaxX;this._layerMaxY=maxY>this._layerMaxY?maxY:this._layerMaxY};
ia.GeoRSSLayer.prototype._toPoint=function(a){var b={x:0,y:0},c=$j(a).find("geo\\:long, long"),d=$j(a).find("geo\\:lat, lat");if(c.length>0&&d.length>0)return b.x=parseFloat($j(c).text()),b.y=parseFloat($j(d).text()),b=this._mp.project(b.x,b.y,!0);c=$j(a).find("georss\\:point, point");if(c.length>0)return a=jQuery.trim($j(c).text()).split(" "),b.x=parseFloat(a[0]),b.y=parseFloat(a[1]),b=this._mp.project(b.x,b.y,!0);a=$j(a).find("gml\\:pos, pos");if(a.length>0)a=jQuery.trim($j(a).text()).split(" "),
b.x=parseFloat(a[0]),b.y=parseFloat(a[1]),b=this._mp.project(b.x,b.y,!0);return b};ia.GoogleMercatorProjection=function(){this._originLon=this._originLat=0;this._ellipsoid={};this._ellipsoid.id="WGS_84";this._ellipsoid.semiMajorAxis=6378137;this._ellipsoid.inverseFlattening=298.257223563;this._checkEllipsoid()};
ia.GoogleMercatorProjection.prototype._checkEllipsoid=function(){this._ellipsoid.semiMinorAxis==void 0&&(this._ellipsoid.semiMinorAxis=this._ellipsoid.semiMajorAxis-this._ellipsoid.semiMajorAxis/this._ellipsoid.inverseFlattening);if(this._ellipsoid.eccentricity==void 0){var a=(this._ellipsoid.semiMajorAxis-this._ellipsoid.semiMinorAxis)/this._ellipsoid.semiMajorAxis;this._ellipsoid.eccentricity=Math.sqrt(2*a-a*a)}};
ia.GoogleMercatorProjection.prototype.project=function(a,b){var c={},d=Math.PI*(b/180),e=this._ellipsoid.semiMajorAxis;c.x=e*(Math.PI*(a/180)-Math.PI*(this._originLon/180));c.y=e*Math.log(Math.tan(Math.PI/4+d/2));return c};ia.GoogleMercatorProjection.prototype.unproject=function(a,b){var c={},d=this._ellipsoid.semiMajorAxis,e=Math.PI/2-2*Math.atan(Math.pow(Math.E,(0-b)/d));c.longitude=(a/d+Math.PI*(this._originLon/180))*180/Math.PI;c.latitude=e*180/Math.PI;return c};
ia.ColorPalette=function(a){this._colors=[];this.id="";this.matchColorsToValues={};a!=void 0?this.setColorList(a):this.setColorList(ia.ColorPalette.CATEGORY_COLORS)};ia.ColorPalette.NUMERIC_COLORS=["#9EDAE5","#74a9cf","#023858"];ia.ColorPalette.CATEGORY_COLORS=["#B4371F","#FFBB78","#2CA02C","#98DF8A","#D62728","#FF9896","#9467BD","#C5B0D5","#8C564B","#C49C94","#E377C2","#F7B6D2","#7F7F7F","#C7C7C7","#BCBD22","#DBDB8D","#17BECF","#9EDAE5","#AEC7E8","#9EDAE5"];
ia.ColorPalette.prototype.getColorList=function(){return this._colors};ia.ColorPalette.prototype.setColorList=function(a){this._colors=a};ia.ColorPalette.prototype.addColor=function(a){this._colors.push(a)};ia.ColorPalette.prototype.getColorAtIndex=function(a){return this._colors[a%this._colors.length]};ia.ColorPalette.prototype.setColorAtIndex=function(a,b){this._colors[a]=b};
ia.ColorPalette.prototype.getMatchingColors=function(a){for(var b=a.length,c=Array(b),d=this.getColors(b),e=0;e<b;e++)c[e]=this.matchColorsToValues[a[e]]!=void 0?this.matchColorsToValues[a[e]]:d[e];return c};ia.ColorPalette.prototype.getColors=function(a){for(var b=Array(a),c=0,d=0;d<a;d++)d<this._colors.length?b[d]=this._colors[d]:(b[d]=c<ia.ColorPalette.CATEGORY_COLORS.length?ia.ColorPalette.CATEGORY_COLORS[c]:ia.Color.getRandomColor(),c++);return b};
ia.ColorPalette.prototype.getInterpolatedColors=function(a){if(a==1)return[this._colors[0]];else if(a==2)return[this.getColor(0),this.getColor(1)];else{for(var b=Array(a),c=1/(a-1),d=0,e=0;e<a;e++)b[e]=e==0?this.getColor(0):e==a-1?this.getColor(1):this.getColor(d),d+=parseFloat(c);return b}};
ia.ColorPalette.prototype.getColor=function(a){var b=this._colors.length-1;if(b<=0||a<=0)return this._colors[0];else if(a>=1)return this._colors[b];else{for(var c,d=1/b,e=0,f=0;f<b;f++){var g=e,h=g+d;if(a>=g&&a<=h){c=ia.Color.getInterpolatedColor(this._colors[f],this._colors[f+1],(a-g)/(h-g));break}e+=parseFloat(d)}return c}};ia.SizePalette=function(a,b){this.maxSize=this.minSize=15;this.useSqrRoot=!1;if(a!=null)this.minSize=a;if(b!=null)this.maxSize=b};
ia.SizePalette.prototype.getInterpolatedSizes=function(a){var b=[];if(a==1)return[this.minSize];for(var c=0;c<a;c++)b.push(this.getSize(c/(a-1)));return b};ia.SizePalette.prototype.getSize=function(a){if(a==null)return this.minSize;this.useSqrRoot&&(a=Math.sqrt(a));return this.minSize+a*(this.maxSize-this.minSize)};
ia.BreaksCalculator=function(a){this._stats=new ia.Statistics;this._data=[];this._functions={};this.sdSize=1;this.errorMessage="Legend error defaulting to equal interval.";this.addFunction(ia.Thematic.CONTINUOUS,ia.Thematic.CONTINUOUS);this.addFunction(ia.Thematic.EQUAL_INTERVAL,ia.Thematic.EQUAL_INTERVAL);this.addFunction(ia.Thematic.QUANTILE,ia.Thematic.QUANTILE);this.addFunction(ia.Thematic.NATURAL,ia.Thematic.NATURAL);this.addFunction(ia.Thematic.STANDARD_DEVIATION,ia.Thematic.STANDARD_DEVIATION);
a!=void 0&&this.setData(a)};ia.BreaksCalculator.prototype.addFunction=function(a,b){this._functions[a]=b};ia.BreaksCalculator.prototype.getStats=function(){return this._stats};ia.BreaksCalculator.prototype.getData=function(){return this._data};ia.BreaksCalculator.prototype.setData=function(a){this._data=a;this._stats.setData(a)};
ia.BreaksCalculator.prototype.getBreaks=function(a,b){a==null&&(a=5);b==null&&(b="equalInterval");var c;try{if(this._stats.range==0&&b!="customClassifier")c=[this._stats.minValue];else{var d=this._functions[b];d!=void 0&&(c=d==ia.Thematic.CONTINUOUS?this.continuous(a):d==ia.Thematic.EQUAL_INTERVAL?this.equalIntervals(a):d==ia.Thematic.QUANTILE?this.quantiles(a):d==ia.Thematic.NATURAL?this.natural(a):d==ia.Thematic.STANDARD_DEVIATION?this.standardDeviation(a):d.call(null,a))}}catch(e){c=this.equalIntervals(a)}c&&
(c=c.filter(function(a,b,c){return b==c.indexOf(a)}).concat());return c};ia.BreaksCalculator.prototype.continuous=function(){return this._stats.range>0?this._stats.unique:null};ia.BreaksCalculator.prototype.equalIntervals=function(a){a==null&&(a=5);if(this._stats.range>0){var b=a+1,c=Array(b),d=this._stats.range/a;c[0]=this._stats.minValue;for(var e=1;e<a;e++)c[e]=parseFloat(this._stats.minValue)+e*d;c[b-1]=this._stats.maxValue;return c}else return null};
ia.BreaksCalculator.prototype.quantiles=function(a){a==null&&(a=5);for(var b=!1,c=this._quantileFunc(a,this._stats.sorted),d=c.length,e=0;e<d-1;e++)if(c[e]>=c[e+1]){b=!0;break}for(;b;)if(c=this._quantileFunc(a,this._stats.unique),d=c.length,d==1)b=!1;else for(e=0;e<d-1;e++)if(c[e]>=c[e+1]){a--;b=!0;break}else b=!1;return c};
ia.BreaksCalculator.prototype._quantileFunc=function(a,b){if(this._stats.range>0){if(this._stats.unique.length<a)a=this._stats.unique.length;var c=a+1,d=Array(c),e=1/a;d[0]=this._stats.minValue;for(var f=1;f<a;f++){var g=ia.round(e*f,2);d[f]=this._stats.getPercentile(g,b)}d[c-1]=this._stats.maxValue;return d}else return null};
ia.BreaksCalculator.prototype.natural=function(a){a==null&&(a=5);if(this._stats.range>0){var b=this._stats.unique.length;if(this._stats.unique.length<a)a=this._stats.unique.length;for(var c=Array(b+1),d=Array(b+1),e=1;e<=b;e++){c[e]=Array(a+1);d[e]=Array(a+1);for(var f=1;f<=a;f++)f==1?(c[e][f]=1,d[e][f]=0):d[e][f]=Infinity}for(var g,h,k,i,l,j,e=2;e<=b;e++){i=k=h=g=0;for(var m=1;m<=e;m++)if(l=e-m+1,g=this._stats.unique[l-1],h++,k+=parseFloat(g),f=k/h,f*=f,g*=g,i+=parseFloat(g),g=i/h-f,j=l-1,j!=0)for(f=
2;f<=a;f++)d[e][f]>=d[j][f-1]+g&&(c[e][f]=l,d[e][f]=d[j][f-1]+g);c[e][1]=1;d[e][1]=g}e=b;d=Array(a);d[a-1]=b-1;for(f=a;f>=2;f--)l=c[e][f]-2,d[f-2]=l,e=c[e][f]-1;a=[];a[0]=this._stats.minValue;for(e=0;e<=d.length-2;e++)a[a.length]=this._stats.unique[d[e]];a[a.length]=this._stats.maxValue;return a}else return null};
ia.BreaksCalculator.prototype.standardDeviation=function(){if(this._stats.range>0){var a,b=Array(5),c=Math.ceil(b.length/2),d=this._stats.mean,e=this._stats.standardDeviation*this.sdSize;b[0]=-Infinity;for(var f=1;f<=5;f++)a=f==c?d:d+e*(f-c),b[f]=a;b[b.length]=Infinity;return b}else return null};
ia.Thematic=function(a){ia.Thematic.baseConstructor.call(this);this._data={};this._dataField="value";this._dataType="numeric";this._dataChanged=!0;this.symbol=ia.Shape.SQUARE;this.noDataValue="No Data";this.numericClassifier=new ia.NumericClassifier;this.categoricClassifier=new ia.CategoricClassifier;a!=void 0&&this.setData(a)};ia.extend(ia.EventDispatcher,ia.Thematic);ia.Thematic.CONTINUOUS="continuous";ia.Thematic.EQUAL_INTERVAL="equalInterval";ia.Thematic.QUANTILE="quantile";
ia.Thematic.NATURAL="natural";ia.Thematic.STANDARD_DEVIATION="standardDeviation";ia.Thematic.NUMERIC="numeric";ia.Thematic.CATEGORIC="categoric";ia.Thematic.prototype.getData=function(){return this._data};ia.Thematic.prototype.setData=function(a){this._data=a;this._dataChanged=!0};ia.Thematic.prototype.getDataField=function(){return this._dataField};ia.Thematic.prototype.setDataField=function(a){this._dataField=a;this._dataChanged=!0};ia.Thematic.prototype.getDataType=function(){return this._dataType};
ia.Thematic.prototype.setDataType=function(a){this._dataType=a;this._dataChanged=!0};ia.Thematic.prototype.getClasses=function(){return this.numericClassifier.getClasses().concat(this.categoricClassifier.getClasses())};ia.Thematic.prototype.getClass=function(a){return this._dataType==ia.Thematic.CATEGORIC?this.categoricClassifier.getClass(a):ia.isNumber(a)?this.numericClassifier.getClass(a):this.categoricClassifier.getClass(a)};
ia.Thematic.prototype.commitChanges=function(){if(this._dataChanged){var a=[],b=[],c,d,e;for(e in this._data)c=this._data[e],d=c[this._dataField],this._dataType==ia.Thematic.CATEGORIC?b.push(d):ia.isNumber(d)?a.push(d):b.push(d);this.numericClassifier.setData(a);this.categoricClassifier.setData(b)}this.numericClassifier.commitChanges();this.categoricClassifier.commitChanges();for(var a=this.getClasses(),b=a.length,f,g=0;g<b;g++)if(f=a[g],f.symbol=this.symbol,f.index=g,f.getLabel()==this.noDataValue&&
f.symbol!=ia.Shape.LINE&&f.symbol!=ia.Shape.SQUARE)f.size=0;for(e in this._data){c=this._data[e];d=c[this._dataField];for(g=0;g<b;g++)if(f=a[g],f.contains(d)){c.color=f.color;c.symbolSize=f.size;c.legendClass=f;f.items.push(c);break}}this.dispatchEvent(new ia.Event(ia.Event.THEME_CHANGED,this))};
ia.NumericClassifier=function(a){this._breaks=[];this._classes=[];this._adjustedNoClasses=0;this._calculator=new ia.BreaksCalculator;this._data=[];this.formatter=new ia.Formatter;this.colorPalette=new ia.ColorPalette;this.sizePalette=new ia.SizePalette;this.classificationName=ia.Thematic.EQUAL_INTERVAL;this.labels=[];this.sdLabels=["> 2 SD below mean","1 - 2 SD below mean","0 - 1 SD below mean","0 - 1 SD above mean","1 - 2 SD above mean","> 2 SD above mean"];this.noClasses=5;this.minRule=ia.RangeClass.GREATER_THAN_OR_EQUAL_TO;
this.maxRule=ia.RangeClass.LESS_THAN_OR_EQUAL_TO;a!=void 0&&this.setData(a)};ia.NumericClassifier.prototype.getData=function(){return this._data};ia.NumericClassifier.prototype.setData=function(a){this._data=a;this._calculator.setData(this._data)};ia.NumericClassifier.prototype.getBreaks=function(){return this._breaks};ia.NumericClassifier.prototype.getLabels=function(){for(var a=[],b=0;b<this._classes.length;b++)a[b]=this._classes[b].getLabel();return a};
ia.NumericClassifier.prototype.getCalculator=function(){return this._calculator};ia.NumericClassifier.prototype.getClasses=function(){return this._classes};ia.NumericClassifier.prototype.commitChanges=function(){this._buildClasses();this._buildPalettes()};ia.NumericClassifier.prototype.getClass=function(a){for(var b=0;b<this._classes.length;b++){var c=this._classes[b];if(c.contains(a))return c}return null};
ia.NumericClassifier.prototype._buildClasses=function(a){var b,c=!1,d;this._classes=[];this._breaks=this._calculator.getBreaks(this.noClasses,this.classificationName);if(this._breaks!=null)if(d=a!=void 0?a:this.precision!=void 0?this.precision:ia.getPrecision(this._breaks),a=this.classificationName==ia.Thematic.CONTINUOUS?this._breaks.length:this._breaks.length==1?1:this._breaks.length-1,this._breaks.length==1)b=new ia.NumberClass(this._breaks[0]),b.formatter=this.formatter,this._classes.push(b);
else for(var e=0;e<a;e++)if(this.classificationName==ia.Thematic.CONTINUOUS)b=new ia.NumberClass(this._breaks[e]),b.formatter=this.formatter,this._classes.push(b);else{var f=this._breaks[e],g=this._breaks[e+1];b=new ia.RangeClass(f,g);b.minRule=this.minRule;b.maxRule=this.maxRule;b.formatter=this.formatter;this._classes.push(b);if(this.labels.length>e)b.setLabel(this.labels[e]);else if(this.classificationName==ia.Thematic.STANDARD_DEVIATION&&this.sdLabels.length>e)b.setLabel(this.sdLabels[e]);else if(f=
this.formatter.format(f,d),g=this.formatter.format(g,d),this.minRule==ia.RangeClass.GREATER_THAN_OR_EQUAL_TO&&this.maxRule==ia.RangeClass.LESS_THAN_OR_EQUAL_TO&&e!=0&&(f=this.formatter.format(this._adjustBreak(f),d)),this.formatter.unformat(f)>this.formatter.unformat(g)){c=!0;break}else f==g?b.setLabel(f):b.setLabel(f+" - "+g)}else this._breaks=[],this._classes=[],a=0;this._adjustedNoClasses=a;c&&this._buildClasses(d+1)};
ia.NumericClassifier.prototype._adjustBreak=function(a){var b=this.formatter.unformat(a);if(a.indexOf(this.formatter.decimalSeparatorTo)>-1){for(var a=a.length-a.toString().indexOf(this.formatter.decimalSeparatorTo)-1,c="0.",d=0;d<a;d++)c+=d==a-1?"1":"0";b=parseFloat(b)+parseFloat(c)}else b=parseFloat(b)+1;return b};
ia.NumericClassifier.prototype._buildPalettes=function(){var a,b;if(this.classificationName==ia.Thematic.CONTINUOUS){var c=this._breaks.length,d=this._breaks[c-1]-this._breaks[0];a=[];this.sizePalette.useSqrRoot=!0;b=[];for(var e=0;e<c;e++){var f=(this._breaks[e]-this._breaks[0])/d;ia.isNumber(f)||(f=0);a.push(this.colorPalette.getColor(f));b.push(this.sizePalette.getSize(f))}}else a=this.colorPalette.getInterpolatedColors(this._adjustedNoClasses),this.sizePalette.useSqrRoot=!1,b=this.sizePalette.getInterpolatedSizes(this._adjustedNoClasses);
for(e=0;e<this._classes.length;e++)c=this._classes[e],c.color=a[e],c.size=b[e]};ia.CategoricClassifier=function(a){this._uniqueValues=[];this._classes=[];this._data=[];this.formatter=new ia.Formatter;this.colorPalette=new ia.ColorPalette;this.colorPalette.setColorList(ia.ColorPalette.CATEGORY_COLORS);this.symbolSize=10;this.noClasses=0;this.labels=[];this.breaks=[];this.uniqueValues=[];a!=void 0&&this.setData(a)};ia.CategoricClassifier.prototype.getData=function(){return this._data};
ia.CategoricClassifier.prototype.setData=function(a){this._data=a;this._uniqueValues=this.breaks.length>0?this.breaks.concat():this._getUniqueValues(this._data)};ia.CategoricClassifier.prototype.getClasses=function(){return this._classes};
ia.CategoricClassifier.prototype.commitChanges=function(){this._buildClasses();this._buildPalettes();for(var a=0;a<this._classes.length;a++){var b=this._classes[a];if(this.colorPalette.matchColorsToValues[b.value]==void 0)this.colorPalette.matchColorsToValues[b.value]=b.color}};ia.CategoricClassifier.prototype.getClass=function(a){for(var b=0;b<this._classes.length;b++){var c=this._classes[b];if(c.contains(a))return c}return null};
ia.CategoricClassifier.prototype._getUniqueValues=function(a){var b=[];if(a.length>0){a=a.concat();a.sort();for(var c,d=0,e=a.length,f=0;f<e;f++){var g=a[f];g!=c&&(b.push(g),d=0);c=g;d++}}return b};
ia.CategoricClassifier.prototype._buildClasses=function(){this._classes=[];if(this.noClasses!=this._uniqueValues.length)this.noClasses=this._uniqueValues.length;for(var a=0;a<this.noClasses;a++){var b=new ia.CategoricClass(this._uniqueValues[a]);this.labels.length>a&&b.setLabel(this.labels[a]);b.formatter=this.formatter;this._classes.push(b)}};
ia.CategoricClassifier.prototype._buildPalettes=function(){if(this._uniqueValues.length>0)for(var a=this.colorPalette.getMatchingColors(this._uniqueValues),b=0;b<this._classes.length;b++){var c=this._classes[b];c.color=a[b];c.size=this.symbolSize}};ia.LegendClass=function(a,b,c){this.formatter=new ia.Formatter;this.color="#FFFFFF";this.size=15;this.items=[];this.symbol=ia.Shape.SQUARE;this.index=0;if(a!=null)this.value=a;if(b!=null)this.color=b;if(c!=null)this.size=c};
ia.NumberClass=function(a,b,c){ia.NumberClass.baseConstructor.call(this,a,b,c);this._label=void 0};ia.extend(ia.LegendClass,ia.NumberClass);ia.NumberClass.prototype.getLabel=function(){return this._label!=void 0?this._label:this.formatter.format(this.value)};ia.NumberClass.prototype.setLabel=function(a){this._label=a};ia.NumberClass.prototype.contains=function(a){return ia.parseInt(a)==ia.parseInt(this.value)?!0:!1};
ia.RangeClass=function(a,b,c,d){ia.RangeClass.baseConstructor.call(this,NaN,c,d);this._range=this._label=void 0;this.minValue=a;this.maxValue=b;this.minRule=ia.RangeClass.GREATER_THAN_OR_EQUAL_TO;this.maxRule=ia.RangeClass.LESS_THAN_OR_EQUAL_TO};ia.extend(ia.LegendClass,ia.RangeClass);ia.RangeClass.LESS_THAN="lessThan";ia.RangeClass.LESS_THAN_OR_EQUAL_TO="lessThanOrEqual";ia.RangeClass.GREATER_THAN="greaterThan";ia.RangeClass.GREATER_THAN_OR_EQUAL_TO="greaterThanOrEqual";
ia.RangeClass.prototype.getLabel=function(){if(this._label!=void 0)return this._label;else{var a=this.formatter.format(this.minValue),b=this.formatter.format(this.maxValue);return a+" - "+b}};ia.RangeClass.prototype.setLabel=function(a){this._label=a};ia.RangeClass.prototype.getRange=function(){return maxValue-minValue};
ia.RangeClass.prototype.contains=function(a){if(ia.isNumber(a)){if(this.minRule==ia.RangeClass.GREATER_THAN){if(!(parseFloat(a)>this.minValue))return!1}else if(!(parseFloat(a)>=this.minValue))return!1;if(this.maxRule==ia.RangeClass.LESS_THAN){if(!(parseFloat(a)<this.maxValue))return!1}else if(!(parseFloat(a)<=this.maxValue))return!1;return!0}else return!1};ia.CategoricClass=function(a,b,c){ia.CategoricClass.baseConstructor.call(this,a,b,c);this._label=void 0};ia.extend(ia.LegendClass,ia.CategoricClass);
ia.CategoricClass.prototype.getLabel=function(){return this._label!=void 0?this._label:this.formatter.formatText(this.value)};ia.CategoricClass.prototype.setLabel=function(a){this._label=a};ia.CategoricClass.prototype.contains=function(a){return a==this.value?!0:!1};
ia.ComponentFactory=function(a,b,c){this._config=a;this._report=b;this._componentGroups=c;this._dataGroups=[];this._factories={};for(a=0;a<this._componentGroups.length;a++){var d=c[a];this.buildInteractionGroups(b,d.dataGroup,d.interactionGroup,d.comparisonInteractionGroup);this._dataGroups[a]=d.dataGroup}};ia.ComponentFactory.prototype.update=function(a,b){var c=this._factories[a];c!=void 0?c.update(function(){b.call(null,a)}):b.call(null,a)};
ia.ComponentFactory.prototype.render=function(a,b){var c=this._factories[a];c!=void 0?c.render(function(){b.call(null,a)}):b.call(null,a)};
ia.ComponentFactory.prototype.build=function(a,b){var c=this,d=this._config.getComponent(a);if(d){var e=this._getSuffix(a),f=this._getType(a),g=e-1;e==""&&(g=0);e=this._componentGroups[g];if(e!=void 0){var h;f=="legend"?h=new ia.LegendFactory(d,this._report,e):f=="featureLegend"?h=new ia.FeatureLegendFactory(d,this._report,e):f=="areaBreakdownBarChart"?h=new ia.AreaBreakdownBarChartFactory(d,this._report,e):f=="areaBreakdownLineChart"?h=new ia.AreaBreakdownLineChartFactory(d,this._report,e):f=="areaBreakdownPieChart"?
h=new ia.AreaBreakdownPieChartFactory(d,this._report,e):f=="barChart"?h=new ia.BarChartFactory(d,this._report,e):f=="gridChart"?h=new ia.GridChartFactory(d,this._report,e):f=="boxAndWhisker"?h=new ia.BoxAndWhiskerFactory(d,this._report,e):f=="timeSeries"?h=new ia.TimeSeriesFactory(d,this._report,e):f=="discreteTimeSeries"?h=new ia.DiscreteTimeSeriesFactory(d,this._report,e):f=="stackedTimeSeries"?h=new ia.StackedTimeSeriesFactory(d,this._report,e):f=="pyramidChart"?h=new ia.PyramidChartFactory(d,
this._report,e):f=="timeControl"?h=new ia.TimeControlFactory(d,this._report,e):f=="featureCard"?h=new ia.FeatureCardFactory(d,this._report,e):f=="metadata"?h=new ia.MetadataFactory(d,this._report,e):f=="textbox"?h=new ia.TextBoxFactory(d,this._report,e):f=="statsbox"?h=new ia.StatsBoxFactory(d,this._report,e):f=="advancedPieChart"?h=new ia.AdvancedPieChartFactory(d,this._report,e):f=="pieChart"?h=new ia.PieChartFactory(d,this._report,e):f=="dataExplorer"?h=new ia.DataExplorerFactory(d,this._report,
e):f=="geogExplorer"?h=new ia.GeogExplorerFactory(d,this._report,e):f=="filterExplorer"?h=new ia.FilterExplorerFactory(d,this._report,e):f=="menuBar"?h=new ia.MenuBarFactory(d,this._report,e):f=="spineChart"?h=new ia.AreaProfileFactory(d,this._report,e):f=="map"?h=new ia.MapFactory(d,this._report,e):f=="scatterPlot"?h=new ia.ScatterPlotFactory(d,this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):f=="table"?this._config.template==ia.DOUBLE_GEOG_REPORT||this._config.template==
ia.DOUBLE_BASELAYER_REPORT?(g=this._dataGroups[g],h=new ia.DataTableFactory(d,this._report,[g],e.interactionGroup,e.comparisonInteractionGroup)):h=new ia.DataTableFactory(d,this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):f=="comparisonTable"?this._config.template==ia.DOUBLE_GEOG_REPORT||this._config.template==ia.DOUBLE_BASELAYER_REPORT?(g=this._dataGroups[g],h=new ia.ComparisonTableFactory(d,this._report,[g],e.interactionGroup,e.comparisonInteractionGroup)):h=new ia.ComparisonTableFactory(d,
this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):b.call(null,a);h!=void 0&&(this._factories[d.id]=h,f=="map"&&(this._config.template==ia.DOUBLE_BASELAYER_REPORT||this._config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)?h.build(function(){h.update(function(){h.render(function(){factory2=new ia.MapFactory(void 0,c._report,c._componentGroups[1]);factory2.build(function(){factory2.update(function(){factory2.render(function(){b.call(null,a)})})})})})}):h.build(function(){h.update(function(){h.render(function(){b.call(null,
a)})})}))}else b.call(null,a)}else b.call(null,a)};ia.ComponentFactory.prototype.buildComponents=function(a){function b(){f++;f==e?a.call(null):c.build(d[f].id,b)}var c=this,d=c._config.getComponents(),e=d.length,f=0;c.build(d[0].id,b)};ia.ComponentFactory.prototype._getSuffix=function(a){var b=a.slice(-1);ia.isNumber(b)||(b="");a.indexOf("_")!=-1&&(b=a.slice(-3).charAt(0),ia.isNumber(b)||(b=""));return b};
ia.ComponentFactory.prototype._getType=function(a){var b=a,c=a.slice(-1);ia.isNumber(c)&&(b=b.substring(0,b.length-1));a.indexOf("_")!=-1&&(b=a,c=a.slice(-3).charAt(0),b=ia.isNumber(c)?b.substring(0,b.length-3):b.substring(0,b.length-2));return b};
ia.ChartFactory=function(a,b,c){var d=c.interactionGroup,e=c.dataGroup,f=c.comparisonInteractionGroup;this.buildChart=function(c,e,k){c.formatter=b.locale.formatter;b.addComponent(a.id,c);if(e)e.setVisible(!0),e.interactive=!0,e.highlightColor=b.highlightColor,e.selectionColor=b.selectionColor,c.addLayer(e),d.addComponent(e);if(k)k.setVisible(!0),k.interactive=!0,k.highlightColor=b.highlightColor,k.selectionColor=b.selectionColor,c.addLayer(k),f.addComponent(k)};this.updateChart=function(c,d,f){var i=
e.indicator;c.orientation=a.getProperty("orientation");c.fixedMinValue=i.getProperty(a.getProperty("minChartValue"));c.fixedMaxValue=i.getProperty(a.getProperty("maxChartValue"));c.fixedMinValue!=void 0&&c.fixedMaxValue!=void 0?c.useTightLabels=!0:a.getProperty("useFixedValues")?(c.useTightLabels=!0,c.fixedMinValue=a.getProperty("fixedMinValue"),c.fixedMaxValue=a.getProperty("fixedMaxValue")):c.useTightLabels=a.getProperty("useTightLabels");i=a.getProperty("xAxisTitle");c.xAxisTitle=i?b.textSubstitution.formatMessage(i):
void 0;i=a.getProperty("yAxisTitle");c.yAxisTitle=i?b.textSubstitution.formatMessage(i):void 0;if(d)d.dataField=a.getProperty("data")||"value",d.tip=a.getProperty("tip"),d.matchAxisToSelectedData=a.getProperty("matchAxisToSelectedData");if(f)f.dataField=a.getProperty("data")||"value",f.tip=a.getProperty("tip"),f.displayAll=a.getProperty("showComparison"),f.matchAxisToSelectedData=a.getProperty("matchAxisToSelectedData")};this.build=function(b){b!=void 0&&b.call(null,a.id)};this.update=function(b){b!=
void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.LegendFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update();d.render()});f.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.settingsFunction=function(b){ia.toggleCallout(a.id+"-callout",b)};var h,k,i,l,j;this.build=function(c){g.content.empty();h=new ia.DiscreteLegend(a.id+"-discrete");if(b.config.template==ia.SPINE_REPORT||b.config.template==ia.ELECTION_REPORT)h.interactive=
!1;h.highlightColor=b.highlightColor;h.selectionColor=b.selectionColor;h.thematic=f.thematic;e.addComponent(h);k=new ia.GradientLegend(a.id+"-gradient");k.highlightColor=b.highlightColor;k.thematic=f.thematic;e.addComponent(k);i=new ia.LayerList(a.id);i.discreteLegend=h;i.gradientLegend=k;g.append(i.container);b.addComponent(a.id,i);l=new ia.CalloutBox(a.id+"-callout","left-right");l.popup(!0);b.addCallout(l);j=new ia.LegendEditor(f.thematic,b.config,f.legendSettings);l.container.append(j.container);
c!=void 0&&c.call(null,a.id)};this.update=function(c){if(a.getProperty("showLegendEditorButton")==!0){var d=b.config.getProperty("showLegendTypePanel");d==void 0&&(d=!0);var e=b.config.getProperty("showLegendTools");e==void 0&&(e=!0);var k=b.config.getProperty("showPalettePanel");k==void 0&&(k=!0);var l=b.config.getProperty("showSizePanel");l==void 0&&(l=!0);j.showLegendTypePanel=d;j.showLegendTools=e;j.showPalettePanel=k;j.showSizePanel=l;g.hasSettings(!0)}else g.hasSettings(!1);j.render();i.mapData=
f.mapData;h.style=f.mapData.baseLayer.style;c!=void 0&&c.call(null,a.id)};this.render=function(b){var c=f.thematic,d=f.indicator.getDataType(c.getDataField());i.render();d!=ia.Thematic.CATEGORIC&&c.numericClassifier.classificationName==ia.Thematic.CONTINUOUS?(k.show(),k.render(),h.renderCategoric()):(k.hide(),h.render());b!=void 0&&b.call(null,a.id)}};
ia.FeatureLegendFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id),h;this.build=function(c){g.content.empty();h=new ia.FeatureLegend(a.id);h.highlightColor=b.highlightColor;h.selectionColor=b.selectionColor;g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){if(a.getProperty("layout"))h.layout=a.getProperty("layout");
var d=a.getProperty("colorSchemeId");h.colorPalette=b.config.getMapPalette().getColorScheme(d);h.geography=f.geography;h.clearSelection();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.AreaBreakdownBarChartFactory=function(a,b,c){ia.AreaBreakdownBarChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){i.dataChanged=!0;d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){h.exportData(b.config.getProperty("saveImageText"))};var g=[],h,k,i;this.build=function(b){f.content.empty();
h=new ia.TimeBarChart(a.id);h.wrapXAxisLabels=!0;k=new ia.TimeBarLayer;i=new ia.ComparisonTimeBarLayer;i.thematic=e.comparisonThematic;d.buildChart(h,k,i);k.interactive=!1;h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});f.append(h.container)};this.update=function(c){d.updateChart(h,k,i);h.drawBarsFromZero=a.getProperty("drawBarsFromZero");if(b.config.getComponent("featureLegend"+e.suffix)){var f=b.config.getComponent("featureLegend"+e.suffix),f=f.getProperty("colorSchemeId");
k.colorPalette=b.config.getMapPalette().getColorScheme(f)}else if(b.config.getComponent("featureLegend"))f=b.config.getComponent("featureLegend"),f=f.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(f);else if(a.getProperty("colorSchemeId"))k.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var m=e.theme,f=e.indicator;g=[];if(a.getProperty("datasource")=="associate"){var n=a.getProperty("ignoreAssociateIds"),o=f.getAssociates();
if(n)for(m=0;m<o.length;m++){for(var p=o[m],q=!0,r=0;r<n.length;r++)if(p.id==n[r]){q=!1;break}if(q&&p.type!=ia.Thematic.CATEGORIC)g[g.length]=p.id}else for(m=0;m<o.length;m++)if(p=o[m],p.type!=ia.Thematic.CATEGORIC)g[g.length]=p.id;n=f.getAssociateData(g);k.setData(n);n=f.getAssociateComparisonData(g);i.setData(n);if(f=a.getProperty("associateLabels"))for(m=n=0;m<g.length;m++)n<f.length&&(g[m]=f[n],n++)}else if(f.date!=void 0){n=m.getDataForDate(f.date);k.setData(n);n=m.getComparisonDataForDate(f.date);
i.setData(n);n=m.getIndicators();for(m=0;m<n.length;m++)if(o=n[m],o.date==f.date&&o.type!=ia.Thematic.CATEGORIC)g[g.length]=o.name}else{n=m.getData();k.setData(n);n=m.getComparisonData();i.setData(n);n=m.getIndicators();for(m=0;m<n.length;m++)if(o=n[m],o.type!=ia.Thematic.CATEGORIC)g[g.length]=o.name}if(g.length>0)h.orientation=a.getProperty("orientation"),h.orientation=="vertical"?(h.xAxisLabels=g,h.yAxisLabels=void 0):(h.xAxisLabels=void 0,h.yAxisLabels=g);c!=void 0&&c.call(null,a.id)};this.render=
function(b){g.length>0?(f.text(""),h.show(),h.render()):(h.hide(),f.text(a.getProperty("notAvailableText")));b&&(b.call(null,a.id),b=void 0);b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.AreaBreakdownBarChartFactory);
ia.AreaBreakdownLineChartFactory=function(a,b,c){ia.AreaBreakdownLineChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){i.dataChanged=!0;d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){h.exportData(b.config.getProperty("saveImageText"))};var g=[],h,k,i;this.build=function(b){f.content.empty();
h=new ia.TimeChart(a.id);h.wrapXAxisLabels=!0;k=new ia.TimeLayer;i=new ia.ComparisonTimeLayer;i.thematic=e.comparisonThematic;d.buildChart(h,k,i);h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});f.append(h.container)};this.update=function(c){d.updateChart(h,k,i);if(b.config.getComponent("featureLegend"+e.suffix)){var f=b.config.getComponent("featureLegend"+e.suffix),f=f.getProperty("colorSchemeId");k.colorPalette=b.config.getMapPalette().getColorScheme(f)}else if(b.config.getComponent("featureLegend"))f=
b.config.getComponent("featureLegend"),f=f.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(f);else if(a.getProperty("colorSchemeId"))k.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var m=e.theme,f=e.indicator;g=[];if(a.getProperty("datasource")=="associate"){var n=a.getProperty("ignoreAssociateIds");if(n)for(var o=f.getAssociates(),m=0;m<o.length;m++){for(var p=o[m],q=!0,r=0;r<n.length;r++)if(p.id==n[r]){q=!1;break}if(q&&p.type!=
ia.Thematic.CATEGORIC)g[g.length]=p.id}else{o=f.getAssociates();for(m=0;m<o.length;m++)if(p=o[m],p.type!=ia.Thematic.CATEGORIC)g[g.length]=p.id}n=f.getAssociateData(g);k.setData(n);n=f.getAssociateComparisonData(g);i.setData(n);(f=a.getProperty("associateLabels"))&&(g=f)}else if(f.date!=void 0){n=m.getDataForDate(f.date);k.setData(n);n=m.getComparisonDataForDate(f.date);i.setData(n);n=m.getIndicators();for(m=0;m<n.length;m++)if(o=n[m],o.date==f.date&&o.type!=ia.Thematic.CATEGORIC)g[g.length]=o.name}else{n=
m.getData();k.setData(n);n=m.getComparisonData();i.setData(n);n=m.getIndicators();for(m=0;m<n.length;m++)if(o=n[m],o.type!=ia.Thematic.CATEGORIC)g[g.length]=o.name}if(g.length>0)h.orientation=a.getProperty("orientation"),h.orientation=="vertical"?(h.xAxisLabels=g,h.yAxisLabels=void 0):(h.xAxisLabels=void 0,h.yAxisLabels=g);c!=void 0&&c.call(null,a.id)};this.render=function(b){g.length>0?(f.text(""),h.show(),h.render()):(h.hide(),f.text(a.getProperty("notAvailableText")));b&&(b.call(null,a.id),b=void 0);
b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.AreaBreakdownLineChartFactory);
ia.AreaBreakdownPieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id),h=[],k,i,l;this.build=function(c){g.content.empty();var d=b.config.getComponent("areaBreakdownPieLegend"+f.suffix);if(d){i=new ia.DiscreteLegend(a.id);i.container.addClass("ia-profile-legend");i.interactive=!1;if(d.getProperty("layout"))i.layout=d.getProperty("layout");l=b.getWidget(d.id);l.append(i.container);
b.addComponent(d.id,i)}k=new ia.AreaBreakdownPieComponent(a.id,a.getProperty("layout"));k.highlightColor=b.highlightColor;k.selectionColor=b.selectionColor;k.tip=a.getProperty("tip");k.title1=a.getProperty("title1");k.title2=a.getProperty("title2");k.build(function(){c!=void 0&&c.call(null,a.id)});g.append(k.container);b.addComponent(a.id,k);e.addComponent(k)};this.update=function(c){k.tip=a.getProperty("tip");k.title1=a.getProperty("title1");k.title2=a.getProperty("title2");k.thematic.categoricClassifier.colorPalette=
b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var d=f.theme,e=f.indicator;h=[];var g={};if(a.getProperty("datasource")=="associate"){k.setData(f.indicatorData);var l=a.getProperty("ignoreAssociateIds");if(l){e=e.getAssociates();for(d=0;d<e.length;d++){for(var q=e[d],r=!0,t=0;t<l.length;t++)if(q.id==l[t]){r=!1;break}if(r&&q.type!=ia.Thematic.CATEGORIC)h[h.length]=q.id,g[q.id]={value:q.id}}}else{e=e.getAssociates();for(d=0;d<e.length;d++)if(q=e[d],q.type!=ia.Thematic.CATEGORIC)g[q.id]=
{value:q.id},h[h.length]=q.id}if(d=a.getProperty("associateLabels"))k.thematic.categoricClassifier.labels=d}else if(e.date!=void 0){l=d.getDataForDate(e.date);k.setData(l);l=d.getIndicators();for(d=0;d<l.length;d++)if(q=l[d],q.date==e.date&&q.type!=ia.Thematic.CATEGORIC)g[q.name]={value:q.name},h[h.length]=q.name}else{l=d.getData();k.setData(l);l=d.getIndicators();for(d=0;d<l.length;d++)if(q=l[d],q.type!=ia.Thematic.CATEGORIC)h[h.length]=q.name,g[q.name]={value:q.name}}k.thematic.categoricClassifier.breaks=
h;k.thematic.setData(g);k.thematic.commitChanges();if(i)i.thematic=k.thematic;c!=void 0&&c.call(null,a.id)};this.render=function(b){h.length>0?(g.text(""),k.show(),k.render(),i&&(l.text(""),i.show(),i.render())):(k.hide(),g.text(a.getProperty("notAvailableText")),i&&(i.hide(),l.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};
ia.BarChartFactory=function(a,b,c){ia.BarChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){g.isVisible?g.exportData(b.config.getProperty("saveImageText")):i.isVisible&&i.exportData(b.config.getProperty("saveImageText"))};var g,
h,k,i,l;this.build=function(b){f.content.empty();i=new ia.BarChart("countChart"+e.suffix);l=new ia.CountLayer;l.thematic=e.thematic;d.buildChart(i,l);g=new ia.BarChart(a.id);h=new ia.BarLayer;h.tipFunction=function(b){return ia.tipFunction(b,a.id)};k=new ia.ComparisonLineLayer;k.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h,k);var c=0;g.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&(c++,c==2&&b.call(null,a.id))});i.addEventListener(ia.Event.MAP_READY,function(){b!=
void 0&&(c++,c==2&&b.call(null,a.id))});f.append(g.container);f.append(i.container)};this.update=function(b){e.indicator.getDataType(h.dataField)==ia.Thematic.CATEGORIC?(d.updateChart(i,l),i.drawBarsFromZero=a.getProperty("drawBarsFromZero"),l.sortDirection=a.getProperty("sortDirection"),l.setData(e.indicatorData)):(d.updateChart(g,h,k),g.drawBarsFromZero=a.getProperty("drawBarsFromZero"),h.errorBarColor=a.getProperty("errorBarColor"),h.sortDirection=a.getProperty("sortDirection"),h.setData(e.indicatorData),
k.setData(e.comparisonData));b!=void 0&&b.call(null,a.id)};this.render=function(b){e.indicator.getDataType(h.dataField)==ia.Thematic.CATEGORIC?(g.hide(),f.text(""),i.container.css({visibility:"visible"}),i.show(),i.render()):(i.hide(),i.container.css({visibility:"hidden"}),f.text(""),g.show(),g.render());b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.BarChartFactory);
ia.GridChartFactory=function(a,b,c){ia.GridChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){g.isVisible&&g.exportData(b.config.getProperty("saveImageText"))};var g,h;this.build=function(b){f.content.empty();g=new ia.GridChart(a.id);h=new ia.GridLayer;h.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h);g.addEventListener(ia.Event.MAP_READY,
function(){b!=void 0&&b.call(null,a.id)});f.append(g.container)};this.update=function(b){d.updateChart(g,h);h.setData(e.indicatorData);b!=void 0&&b.call(null,a.id)};this.render=function(b){g.render();b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.GridChartFactory);
ia.BoxAndWhiskerFactory=function(a,b,c){ia.BoxAndWhiskerFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){g.exportData(b.config.getProperty("saveImageText"))};var g,h,k;this.build=function(b){f.content.empty();g=new ia.BoxChart(a.id);
h=new ia.BoxLayer;h.tipFunction=function(b){return ia.tipFunction(b,a.id)};k=new ia.ComparisonLineLayer;k.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h,k);g.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});f.append(g.container)};this.update=function(b){d.updateChart(g,h,k);h.sortDirection=a.getProperty("sortDirection");h.largestObservationField=a.getProperty("largestObservationField");h.upperQuartileField=a.getProperty("upperQuartileField");h.medianField=
a.getProperty("medianField");h.lowerQuartileField=a.getProperty("lowerQuartileField");h.smallestObservationField=a.getProperty("smallestObservationField");h.setData(e.indicatorData);k.setData(e.comparisonData);a.getProperty("showComparison")&&k.selectAll();b!=void 0&&b.call(null,a.id)};this.render=function(b){var c=e.indicator.getDataType(h.dataField);c==ia.Thematic.CATEGORIC||c==!1?(g.hide(),f.text(a.getProperty("notAvailableText"))):(g.show(),f.text(""),g.render());b!=void 0&&b.call(null,a.id)}};
ia.extend(ia.ChartFactory,ia.BoxAndWhiskerFactory);
ia.TimeSeriesFactory=function(a,b,c){ia.TimeSeriesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup,c=c.comparisonInteractionGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(){h.exportData(b.config.getProperty("saveImageText"))};var h,k,i,l=function(){k.dataChanged=!0;d.render()};this.build=
function(b){g.content.empty();h=new ia.TimeChart(a.id);h.wrapXAxisLabels=!0;k=new ia.TimeLayer;i=new ia.ComparisonTimeLayer;i.thematic=f.comparisonThematic;d.buildChart(h,k,i);h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(h.container)};this.update=function(c){var g=f.theme,n=f.indicator,o=n.getDataType(k.dataField),p=g.getIndicatorDates(n.id);if(o!=ia.Thematic.CATEGORIC&&p!=void 0&&p.length>0){d.updateChart(h,k,i);h.orientation=="vertical"?(h.xAxisLabels=
g.getIndicatorDates(n.id),h.yAxisLabels=void 0):(h.xAxisLabels=void 0,h.yAxisLabels=g.getIndicatorDates(n.id));k.drawLinesThroughMissingValues=a.getProperty("drawLinesThroughMissingValues");k.highlightSelectedDate=a.getProperty("highlightSelectedDate");a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,l,this):e.removeListener(this);if(b.config.getComponent("featureLegend"+f.suffix))g=b.config.getComponent("featureLegend"+f.suffix),g=g.getProperty("colorSchemeId"),
k.colorPalette=b.config.getMapPalette().getColorScheme(g);else if(b.config.getComponent("featureLegend"))g=b.config.getComponent("featureLegend"),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g);i.drawLinesThroughMissingValues=a.getProperty("drawLinesThroughMissingValues");k.selectedDate=n.date;k.setData(f.themeData);i.selectedDate=n.date;i.setData(f.comparisonThemeData)}c!=void 0&&c.call(null,a.id)};this.render=function(b){var c=f.theme,d=f.indicator,e=d.getDataType(k.dataField),
c=c.getIndicatorDates(d.id);e!=ia.Thematic.CATEGORIC&&c!=void 0&&c.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.TimeSeriesFactory);
ia.DiscreteTimeSeriesFactory=function(a,b,c){ia.DiscreteTimeSeriesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup,c=c.comparisonInteractionGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(){h.exportData(b.config.getProperty("saveImageText"))};var h,k,i,l=function(){k.dataChanged=!0;
d.render()};this.build=function(b){g.content.empty();h=new ia.TimeBarChart(a.id);k=new ia.TimeBarLayer;i=new ia.ComparisonTimeBarLayer;i.thematic=f.comparisonThematic;d.buildChart(h,k,i);k.interactive=!1;h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(h.container)};this.update=function(c){var g=f.theme,n=f.indicator,o=n.getDataType(k.dataField),p=g.getIndicatorDates(n.id);if(o!=ia.Thematic.CATEGORIC&&p!=void 0&&p.length>0){d.updateChart(h,k,i);h.drawBarsFromZero=
a.getProperty("drawBarsFromZero");h.orientation=="vertical"?(h.xAxisLabels=g.getIndicatorDates(n.id),h.yAxisLabels=void 0):(h.xAxisLabels=void 0,h.yAxisLabels=g.getIndicatorDates(n.id));k.highlightSelectedDate=a.getProperty("highlightSelectedDate");a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,l,this):e.removeListener(this);if(b.config.getComponent("featureLegend"+f.suffix))g=b.config.getComponent("featureLegend"+f.suffix),g=g.getProperty("colorSchemeId"),
k.colorPalette=b.config.getMapPalette().getColorScheme(g);else if(b.config.getComponent("featureLegend"))g=b.config.getComponent("featureLegend"),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g);else if(a.getProperty("colorSchemeId"))k.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));k.selectedDate=n.date;k.setData(f.themeData);i.selectedDate=n.date;i.setData(f.comparisonThemeData)}c!=void 0&&c.call(null,a.id)};this.render=
function(b){var c=f.theme,d=f.indicator,e=d.getDataType(k.dataField),c=c.getIndicatorDates(d.id);e!=ia.Thematic.CATEGORIC&&c!=void 0&&c.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.DiscreteTimeSeriesFactory);
ia.StackedTimeSeriesFactory=function(a,b,c){ia.StackedTimeSeriesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(){g.exportData(b.config.getProperty("saveImageText"))};var g,h,k,i,l;this.build=function(c){f.content.empty();var k=b.config.getComponent("stackedLegend"+
e.suffix);if(k){i=new ia.ProfileLegend(k.id);if(k.getProperty("layout"))i.layout=k.getProperty("layout");l=b.getWidget(k.id);l.append(i.container);b.addComponent(k.id,i)}g=new ia.StackedTimeChart(a.id);g.drawBarsFromZero=!0;g.wrapXAxisLabels=!0;h=new ia.StackedTimeLayer;d.buildChart(g,h);h.interactive=!1;g.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)});f.append(g.container)};this.update=function(c){d.updateChart(g,h);if(a.getProperty("highlightSelectedDate")!=void 0)h.highlightSelectedDate=
a.getProperty("highlightSelectedDate");var f=a.getProperty("colorSchemeId"),f=b.config.getMapPalette().getColorScheme(f),l=e.theme,o=e.indicator;k=[];var p=a.getProperty("ignoreAssociateIds");if(p)for(var q=o.getAssociates(),r=0;r<q.length;r++){for(var t=q[r],s=!0,u=0;u<p.length;u++)if(t.id==p[u]){s=!1;break}if(s&&t.type!=ia.Thematic.CATEGORIC)k[k.length]=t.id}else{q=o.getAssociates();for(r=0;r<q.length;r++)if(t=q[r],t.type!=ia.Thematic.CATEGORIC)k[k.length]=t.id}h.dataFields=k;p=a.getProperty("associateLabels");
q=[];for(r=0;r<k.length;r++)t=new ia.CategoricClass(k[r]),t.color=f.getColorAtIndex(r),t.symbol=ia.Shape.SQUARE,t.size=10,t.value=k[r],p&&p.length>r&&t.setLabel(p[r]),q[q.length]=t;h.legendClasses=q;if(i)i.legendClasses=q;g.orientation=="vertical"?(g.yAxisLabels=void 0,g.xAxisLabels=l.getIndicatorDates(o.id)):(g.yAxisLabels=l.getIndicatorDates(o.id),g.xAxisLabels=void 0);h.selectedDate=o.date;h.setData(e.themeData);c!=void 0&&c.call(null,a.id)};this.render=function(b){e.indicator.date!=void 0&&k.length>
0?(f.text(""),g.show(),g.render(),i&&(l.text(""),i.show(),i.render())):(g.hide(),f.text(a.getProperty("notAvailableText")),i&&(i.hide(),l.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.StackedTimeSeriesFactory);
ia.PyramidChartFactory=function(a,b,c){function d(){var a=g.geography;j.geography=a;for(var b=a.getComparisonFeatures(),c=[],d=0;d<b.length;d++)c.push(b[d].id);a=a.getProfileData(c);o.setData(a.themes[0].indicators);r.setData(a.themes[1].indicators)}var e=this,f=c.interactionGroup,g=c.dataGroup,h=c.comparisonInteractionGroup;g.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d();e.render()});g.addEventListener(ia.DataEvent.DATA_CHANGED,function(){e.update();e.render()});f.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,
function(){var a=f.getSelection();if(a.length>0)for(var a=g.geography.getProfileData([a[0]]),b=0;b<m.length;b++)m[b].setData(a.themes[0].indicators),p[b].setData(a.themes[1].indicators);else for(b=0;b<m.length;b++)m[b].setData({}),p[b].setData({});e.render()});h.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){e.update();e.render()});var k=b.getWidget(a.id);k.exportFunction=function(){j.isVisible&&j.exportData(b.config.getProperty("saveImageText"))};var i,l,j,m,n,o,p,q,r;this.build=
function(c){k.content.empty();if(i=b.config.getComponent("pyramidLegend"+g.suffix)){l=new ia.ProfileLegend(i.id);if(i.getProperty("layout"))l.layout=i.getProperty("layout");b.getWidget(i.id).append(l.container);b.addComponent(i.id,l)}j=new ia.PyramidChart(a.id);j.formatter=b.locale.formatter;k.append(j.container);p=[];m=[];n=new ia.PyramidLayer;n.setVisible(!0);n.interactive=!0;n.highlightColor=b.highlightColor;n.selectionColor=b.selectionColor;j.addLayer(n);m[m.length]=n;q=new ia.PyramidLayer;q.gender=
"female";q.setVisible(!0);q.interactive=!0;q.highlightColor=b.highlightColor;q.selectionColor=b.selectionColor;j.addLayer(q);p[p.length]=q;o=new ia.ComparisonPyramidLayer;o.setVisible(!0);o.interactive=!0;o.thematic=g.comparisonThematic;o.highlightColor=b.highlightColor;o.selectionColor=b.selectionColor;j.addLayer(o);h.addComponent(o);r=new ia.ComparisonPyramidLayer;r.gender="female";r.setVisible(!0);r.interactive=!0;r.thematic=g.comparisonThematic;r.highlightColor=b.highlightColor;r.selectionColor=
b.selectionColor;j.addLayer(r);h.addComponent(r);var e=[],f=a.getProperty("femaleLabel"),v=new ia.CategoricClass(f);v.color=a.getProperty("femaleColor");v.symbol=ia.Shape.SQUARE;v.size=12;v.value=f;e[e.length]=v;v=new ia.CategoricClass(a.getProperty("maleLabel"));f=a.getProperty("maleLabel");v=new ia.CategoricClass(f);v.color=a.getProperty("maleColor");v.symbol=ia.Shape.SQUARE;v.size=12;v.value=f;e[e.length]=v;for(var w=1;w<=3;w++)if(a.getProperty("line_value_"+w)!=void 0){var v=a.getProperty("line_value_"+
w),x=a.getProperty("line_color_"+w),f=a.getProperty("line_label_"+w),A=new ia.ComparisonPyramidLayer;A.dataField=v;A.setVisible(!0);A.interactive=!0;A.displayAll=!0;A.tip=a.getProperty("tip");A.highlightColor=b.highlightColor;j.addLayer(A);A.style.strokeStyle=x;var z=new ia.ComparisonPyramidLayer;z.gender="female";z.dataField=v;z.setVisible(!0);z.interactive=!0;z.tip=a.getProperty("tip");z.displayAll=!0;z.highlightColor=b.highlightColor;j.addLayer(z);z.style.strokeStyle=x;p[p.length]=z;m[m.length]=
A;v=new ia.CategoricClass(f);v.color=x;v.symbol=ia.Shape.HORIZONTAL_LINE;v.size=12;v.value=f;e[e.length]=v}if(b.url.params["select"+g.suffix]){w=b.url.params["select"+g.suffix].toString().split(",");f=g.geography.getProfileData([w[w.length-1]]);for(w=0;w<m.length;w++)m[w].setData(f.themes[0].indicators),p[w].setData(f.themes[1].indicators)}if(l)l.legendClasses=e,l.render();b.addComponent(a.id,j);d();j.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)})};this.update=function(c){j.orientation=
"horizontal";j.drawBarsFromZero=a.getProperty("drawBarsFromZero");j.showYAxisLabels=a.getProperty("showYAxisLabels");n.dataField=a.getProperty("data")||"value";n.tip=a.getProperty("tip");n.style.fillStyle=ia.Color.toRGBA(a.getProperty("maleColor"),0.8);n.style.strokeStyle=a.getProperty("maleColor");q.dataField=a.getProperty("data")||"value";q.tip=a.getProperty("tip");q.style.fillStyle=ia.Color.toRGBA(a.getProperty("femaleColor"),0.8);q.style.strokeStyle=a.getProperty("femaleColor");o.dataField=a.getProperty("data")||
"value";o.displayAll=a.getProperty("showComparison");o.tip=a.getProperty("tip");r.dataField=a.getProperty("data")||"value";r.tip=a.getProperty("tip");r.displayAll=a.getProperty("showComparison");var d=g.indicator,e=d.getProperty(a.getProperty("maxChartValue"));e?(j.useTightLabels=!0,j.fixedMaxValue=e):a.getProperty("useFixedValues")?(j.useTightLabels=!0,j.fixedMaxValue=a.getProperty("fixedMaxValue")):j.useTightLabels=a.getProperty("useTightLabels");if(e=a.getProperty("xAxisTitle"))j.xAxisTitle=b.textSubstitution.formatMessage(e);
if(e=a.getProperty("yAxisTitle"))j.yAxisTitle=b.textSubstitution.formatMessage(e);e=g.geography.getThemes()[0];j.yAxisLabels=e.getIndicatorNames().reverse();j.date=d.date;c!=void 0&&c.call(null,a.id)};this.render=function(b){j.render();b!=void 0&&b.call(null,a.id)}};
ia.TimeControlFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.TimeControl(a.id,e,function(a){if(b.getComponent("timeSeries"))b.getComponent("timeSeries").animationMode=a;if(b.getComponent("discreteTimeSeries"))b.getComponent("discreteTimeSeries").animationMode=a;if(b.getComponent("stackedTimeSeries"))b.getComponent("stackedTimeSeries").animationMode=
a});f.append(g.container);b.addComponent(a.id,g);g.setData(e.indicator);c!=void 0&&c.call(null,a.id)};this.update=function(b){g.delay=a.getProperty("delay");b!=void 0&&b.call(null,a.id)};this.render=function(b){e.indicator.date==void 0?(g.container.hide(),f.text(a.getProperty("notAvailableText"))):(g.container.show(),f.text(""));b!=void 0&&b.call(null,a.id)}};
ia.FeatureCardFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id),h,k;this.build=function(c){g.content.empty();h=new ia.FeatureCard(a.id);g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.noDataValue=b.config.getProperty("noDataValue");h.displayMode=a.getProperty("displayMode");h.dataOrder=a.getProperty("dataOrder");
h.displaySelectedDateOnly=a.getProperty("displaySelectedDateOnly");h.displayFeatureHeader=a.getProperty("displayFeatureHeader");h.displayThemeHeader=a.getProperty("displayThemeHeader");if(a.getProperty("ignoreThemeIds")!=void 0)h.ignoreThemeIds=a.getProperty("ignoreThemeIds");if(a.getProperty("ignoreIndicatorIds")!=void 0)h.ignoreIndicatorIds=a.getProperty("ignoreIndicatorIds");h.geography=f.geography;h.indicator=f.indicator;k!=a.getProperty("snippet")?(k=a.getProperty("snippet"),h.setSnippet(k,function(){c!=
void 0&&c.call(null,a.id)})):c!=void 0&&c.call(null,a.id)};this.render=function(b){h.render();b!=void 0&&b.call(null,a.id)}};
ia.MetadataFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.Metadata(a.id);f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(b){var c=e.indicator,d=a.getProperty("metadataKey");c.getProperty(d)?g.setHtml(c.getProperty(d)):g.setHtml("");b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,
a.id)}};
ia.StatsBoxFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.Metadata(a.id);f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(c){var d=e.indicator;if(d.getDataType(e.thematic.getDataField())!=ia.Thematic.CATEGORIC){var f=a.getProperty("ndecimal");f==-1&&(f=d.precision||2,f==void 0&&(f=2));var d=b.locale.formatter,l=
e.thematic.numericClassifier.getCalculator().getStats();b.textSubstitution.setVariable("sum"+e.suffix,d.format(l.sum,f));b.textSubstitution.setVariable("mean"+e.suffix,d.format(l.mean,f));b.textSubstitution.setVariable("median"+e.suffix,d.format(l.median,f));b.textSubstitution.setVariable("minValue"+e.suffix,d.format(l.minValue,f));b.textSubstitution.setVariable("maxValue"+e.suffix,d.format(l.maxValue,f));b.textSubstitution.setVariable("range"+e.suffix,d.format(l.range,f));b.textSubstitution.setVariable("lowerQuartile"+
e.suffix,d.format(l.lowerQuartile,f));b.textSubstitution.setVariable("upperQuartile"+e.suffix,d.format(l.upperQuartile,f));b.textSubstitution.setVariable("interquartileRange"+e.suffix,d.format(l.interquartileRange,f));b.textSubstitution.setVariable("variance"+e.suffix,d.format(l.variance,f));b.textSubstitution.setVariable("standardDeviation"+e.suffix,d.format(l.standardDeviation,f));b.updateDynamicText(b.textSubstitution)}f=b.textSubstitution.formatMessage(a.getProperty("text"));g.setHtml(f);c!=void 0&&
c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.AdvancedPieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var g=b.getWidget(a.id),h,k;this.build=function(c){g.content.empty();h=new ia.AdvancedPieComponent(a.id,a.getProperty("layout"));h.highlightColor=b.highlightColor;h.selectionColor=b.selectionColor;h.build();g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.tip=a.getProperty("tip");
h.title1=a.getProperty("title1");h.title2=a.getProperty("title2");var e=a.getProperty("colorSchemeId");h.thematic.categoricClassifier.colorPalette=b.config.getMapPalette().getColorScheme(e);var g=f.theme,m=f.indicator,e={};k=[];if(a.getProperty("datasource")=="associate"){h.setData(d.indicatorData);var n=a.getProperty("ignoreAssociateIds");if(n){m=m.getAssociates();for(g=0;g<m.length;g++){for(var o=m[g],p=!0,q=0;q<n.length;q++)if(o.id==n[q]){p=!1;break}if(p&&o.type!=ia.Thematic.CATEGORIC)k[k.length]=
o.id,e[o.id]={value:o.id}}}else{m=m.getAssociates();for(g=0;g<m.length;g++)if(o=m[g],o.type!=ia.Thematic.CATEGORIC)e[o.id]={value:o.id},k[k.length]=o.id}if(g=a.getProperty("associateLabels"))h.thematic.categoricClassifier.labels=g}else if(m.date!=void 0){n=g.getDataForDate(m.date);h.setData(n);n=g.getIndicators();for(g=0;g<n.length;g++)if(o=n[g],o.date==m.date&&o.type!=ia.Thematic.CATEGORIC)e[o.name]={value:o.name},k[k.length]=o.name}else{n=g.getData();h.setData(n);n=g.getIndicators();for(g=0;g<n.length;g++)if(o=
n[g],o.type!=ia.Thematic.CATEGORIC)k[k.length]=o.name,e[o.name]={value:o.name}}h.thematic.categoricClassifier.breaks=k;h.thematic.setData(e);h.thematic.commitChanges();c!=void 0&&c.call(null,a.id)};this.render=function(b){k.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};
ia.PieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});f.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(){h.exportData(b.config.getProperty("saveImageText"))};var h,k;this.build=function(c){g.content.empty();h=new ia.PieChart(a.id);g.append(h.container);b.addComponent(a.id,h);k=new ia.PieLayer;k.thematic=f.thematic;
k.setVisible(!0);k.interactive=!0;k.highlightColor=b.highlightColor;k.selectionColor=b.selectionColor;h.addLayer(k);e.addComponent(k);h.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)})};this.update=function(b){k.tip=a.getProperty("tip");b!=void 0&&b.call(null,a.id)};this.render=function(b){f.thematic.numericClassifier.classificationName==ia.Thematic.CONTINUOUS?(h.hide(),g.text(a.getProperty("notAvailableText"))):(g.text(""),h.show(),h.render());b!=void 0&&b.call(null,
a.id)}};
ia.DataTableFactory=function(a,b,c,d){function e(){i||(i=setTimeout(function(){g.update()},250))}function f(){l||(l=setTimeout(function(){g.render()},250))}for(var g=this,h=0;h<c.length;h++){var k=c[h];k.addEventListener(ia.DataEvent.DATA_CHANGED,function(){e()});k.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()})}var i=null,l=null,j=b.getWidget(a.id);j.exportFunction=function(){m.exportData(b.config.getProperty("saveTableText"))};var m,n;this.build=function(e){j.content.empty();m=new ia.Table(a.id);
m.highlightColor=b.highlightColor;m.selectionColor=b.selectionColor;if(b.url.params.stickToTop!=void 0){var f=b.url.params.stickToTop.toString().split(",");m.stickToTop(f)}j.append(m.container);d.addComponent(m);b.addComponent(a.id,m);a.getProperty("zoomOnSelection")&&m.addEventListener(ia.ItemEvent.ITEM_CLICK,function(){var a=b.getComponent("activeMap"+k.suffix);if(a){var e=d.getSelection();e.length>0?a.zoomToFeatures(e,[c[0].mapData.baseLayer]):a.controller.zoomFull()}});n=new ia.TableTools(c[0],
d);n.filterFunction=function(){d.getSelection().length>0?c[0].setFilteredFeatures(d.getSelection()):c[0].getFilteredFeatures().length>0&&c[0].clearFilter()};n.clearFunction=function(){d.clearSelection();var a=b.getComponent("activeMap"+k.suffix);a&&a.controller.zoomFull()};e!=void 0&&e.call(null,a.id)};this.update=function(d){i=null;m.showLegendColor=a.getProperty("showLegendColor");m.allowUserSorting=a.getProperty("allowUserSorting");if(n)n.clearButtonText=a.getProperty("clearButtonText"),n.filterButtonText=
a.getProperty("filterButtonText"),(n.clearButtonText==void 0||n.clearButtonText=="")&&(n.filterButtonText==void 0||n.filterButtonText=="")?n.container.remove():j.appendToFooter(n.container),n.render();a.customColumns=c[0].indicator.customColumns;for(var e=[],f=0;f<c.length;f++){var g=c[f];e[f]=g.indicator}m.columns=a.getColumnsForIndicators(e,b.textSubstitution);m.setData(c[0].indicatorData);for(f=1;f<c.length;f++)g=c[f],m["data"+(f+1)]=g.indicatorData;d!=void 0&&d.call(null,a.id)};this.render=function(b){l=
null;m.render();b!=void 0&&(a.getProperty("sortColumnName")!=""&&m.sort(a.getProperty("sortColumnName"),a.getProperty("sortDirection")),b.call(null,a.id))}};
ia.ComparisonTableFactory=function(a,b,c,d,e){function f(){i||(i=setTimeout(function(){h.update()},250))}function g(){l||(l=setTimeout(function(){h.render()},250))}for(var h=this,d=0;d<c.length;d++){var k=c[d];k.addEventListener(ia.DataEvent.DATA_CHANGED,function(){f()});k.addEventListener(ia.Event.THEMATIC_CHANGED,function(){g()})}var i=null,l=null,j=b.getWidget(a.id),j=b.getWidget(a.id);j.exportFunction=function(){m.exportData(b.config.getProperty("saveTableText"))};var m;this.build=function(d){j.content.empty();
m=new ia.ComparisonTable(a.id);m.thematic=c[0].comparisonThematic;m.highlightColor=b.highlightColor;m.selectionColor=b.selectionColor;j.append(m.container);e.addComponent(m);b.addComponent(a.id,m);var f=a.getProperty("colorSchemeId");c[0].comparisonThematic.categoricClassifier.colorPalette=b.config.getMapPalette().getColorScheme(f);c[0].comparisonThematic.commitChanges();d!=void 0&&d.call(null,a.id)};this.update=function(d){m.showLegendColor=a.getProperty("showLegendColor");m.allowUserSorting=a.getProperty("allowUserSorting");
i=null;a.customColumns=c[0].indicator.customColumns;for(var e=[],f=0;f<c.length;f++){var g=c[f];e[f]=g.indicator}m.columns=a.getColumnsForIndicators(e,b.textSubstitution);m.setData(c[0].comparisonData);for(f=1;f<c.length;f++)g=c[f],m["data"+(f+1)]=g.comparisonData;d!=void 0&&d.call(null,a.id)};this.render=function(b){l=null;m.render();b!=void 0&&(a.getProperty("sortColumnName")!=""&&m.sort(a.getProperty("sortColumnName"),a.getProperty("sortDirection")),b.call(null,a.id))}};
ia.DataExplorerFactory=function(a,b,c){function d(){var a=f.indicator;k&&a.date!=void 0?h.showItem(a.geography.id+"~"+a.id+"~"+a.date):h.showItem(a.geography.id+"~"+a.id)}var e=this,f=c.dataGroup;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){e.update()});f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d();h.hideOnSelection&&g.hide()});var g=b.getWidget(a.id),h,k,i;this.build=function(c){g.content.empty();h=new ia.DataExplorer(a.id,function(a){var c=a.split("~"),a=c[0],d=c[1],c=c[2];
if(b.config.template==ia.BUBBLE_PLOT_REPORT){var g=b.config.getComponent("scatterPlot");if(g&&g.getProperty("syncDates")==!0)c=e.indicator.date}if(c==void 0)c=f.indicator.date;f.setData(a,d,c)});g.append(h.container);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.closeBranchesOnSelection=a.getProperty("closeBranchesOnSelection");h.hideOnSelection=a.getProperty("hideOnSelection");k=a.getProperty("showDates");i=a.getProperty("reverseDates");i==void 0&&(i=!0);var e=f.geography;
b.config.getComponent("geogExplorer")!=void 0||b.config.template==ia.DOUBLE_GEOG_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT||b.config.template==ia.DOUBLE_PLOT_REPORT||b.config.template==ia.BUBBLE_PLOT_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW?(h.data(e.getDataTree(k,i)),h.build(e.id)):b.data.getGeographies().length>1?(h.data(b.data.getDataTree(k,i)),h.build()):(h.data(e.getDataTree(k,i)),h.build(e.id));d();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&
b.call(null,a.id)}};
ia.GeogExplorerFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update()});e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){g.hideOnSelection&&f.hide()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.DataExplorer(a.id,function(a){e.setData(a,e.indicator.id,e.indicator.date)});f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(c){g.hideOnSelection=a.getProperty("hideOnSelection");
g.data(b.data.getGeographyTree());g.build();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.FilterExplorerFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update()});e.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(){e.getFilteredFeatures().length==0&&g.clearSelection();g.hideOnSelection&&f.hide()});var f=b.getWidget(a.id),g;this.build=function(b){f.content.empty();g=new ia.DataExplorer(a.id,function(a){a=="clearFilter"?e.clearFilter():(a=a.split("~"),e.setFilter(a[0],a[1]))});g.isFilterExplorer=!0;f.append(g.container);
b!=void 0&&b.call(null,a.id)};this.update=function(b){g.closeBranchesOnSelection=a.getProperty("closeBranchesOnSelection");g.hideOnSelection=a.getProperty("hideOnSelection");g.data(e.geography.getFilterTree());g.build();b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.MenuBarFactory=function(a,b){var c=b.getWidget(a.id),d;this.build=function(e){c.content.empty();d=new ia.MenuBar(a.id,a);c.content.empty();c.append(d.container);b.addComponent(a.id,d);e!=void 0&&e.call(null,a.id)};this.update=function(b){d.render(a);b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.ScatterPlotFactory=function(a,b,c,d,e){function f(){j||(j=setTimeout(function(){g.update();g.render()},250))}var g=this,h,k,i,l;c.length==1?(i=c[0],l=c[0]):c.length==2?(i=c[0],l=c[1]):c.length==3?(h=c[0],i=c[1],l=c[2]):c.length==4&&(h=c[0],k=c[1],i=c[2],l=c[3]);h&&h.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});k&&k.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});i.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});l.addEventListener(ia.Event.THEMATIC_CHANGED,
function(){f()});e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){f()});var j=null,m=b.getWidget(a.id);m.exportFunction=function(){n.exportData(b.config.getProperty("saveImageText"))};var n,o,p,q;this.build=function(c){m.content.empty();n=new ia.Plot(a.id);n.formatter=b.locale.formatter;m.append(n.container);b.addComponent(a.id,n);o=new ia.PlotLayer;o.setVisible(!0);o.interactive=!0;o.tipFunction=function(b){return ia.tipFunction(b,a.id)};o.highlightColor=b.highlightColor;o.selectionColor=
b.selectionColor;n.addLayer(o);d.addComponent(o);p=new ia.ComparisonPlotLayer;p.setVisible(!0);p.interactive=!0;p.tipFunction=function(b){return ia.tipFunction(b,a.id)};p.highlightColor=b.highlightColor;p.selectionColor=b.selectionColor;n.addLayer(p);e.addComponent(p);for(var f=1;f<6;f++){var g=a.getProperty("line_xfield_"+f),h=a.getProperty("line_yfield_"+f);if(g!=void 0&&h!=void 0){var i=new ia.LineLayer;i.highlightColor=b.highlightColor;i.selectionColor=b.selectionColor;i.style.strokeStyle=a.getProperty("line_color_"+
f);i.setVisible(!0);i.interactive=!0;(function(){var b=a.getProperty("line_label_"+f);i.tipFunction=function(){return b}})();n.addLayer(i)}}if(a.getProperty("sizeData")!=void 0)q=new ia.Thematic,q.setDataField(a.getProperty("sizeData")),q.classificationName=ia.Thematic.CONTINUOUS,g=q.numericClassifier.sizePalette,g.minSize=a.getProperty("minBubbleSize"),g.maxSize=a.getProperty("maxBubbleSize"),q.categoricClassifier.symbolSize=8;n.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,
a.id)})};this.update=function(c){j=null;if(a.getProperty("sizeData")!=void 0){var d=q.numericClassifier.sizePalette;d.minSize=a.getProperty("minBubbleSize");d.maxSize=a.getProperty("maxBubbleSize")}o.pointSize=a.getProperty("minBubbleSize")||a.getProperty("pointSize");o.xDataField=a.getProperty("xData");o.yDataField=a.getProperty("yData");o.showCorrelationLine=a.getProperty("showCorrelationLine");p.pointSize=a.getProperty("minBubbleSize")||a.getProperty("pointSize");p.xDataField=a.getProperty("xData");
p.yDataField=a.getProperty("yData");p.displayAll=a.getProperty("showComparison");var e;if(k)e=k.indicator;var d=i.indicator,f=l.indicator,g;k&&a.getProperty("sizeData")!=void 0&&(g=k.getFilteredFeatures().length>0?e.getData(k.getFilteredFeatures()):e.getData(),q.setData(g),q.commitChanges());e=d.getDataType(o.xDataField);var w=f.getDataType(o.yDataField);if(e==ia.Thematic.CATEGORIC||w==ia.Thematic.CATEGORIC)n.hide(),m.text(a.getProperty("notAvailableText"));else{n.fixedMinValueX=d.getProperty(a.getProperty("minChartValueX"));
n.fixedMaxValueX=d.getProperty(a.getProperty("maxChartValueX"));n.fixedMinValueY=f.getProperty(a.getProperty("minChartValueY"));n.fixedMaxValueY=f.getProperty(a.getProperty("maxChartValueY"));n.fixedMinValueX!=void 0&&n.fixedMaxValueX!=void 0&&n.fixedMinValueY!=void 0&&n.fixedMaxValueY!=void 0?n.useTightLabels=!0:a.getProperty("useFixedValues")?(n.useTightLabels=!0,n.fixedMinValueX=a.getProperty("fixedMinValueX"),n.fixedMaxValueX=a.getProperty("fixedMaxValueX"),n.fixedMinValueY=a.getProperty("fixedMinValueY"),
n.fixedMaxValueY=a.getProperty("fixedMaxValueY")):n.useTightLabels=a.getProperty("useTightLabels");if(e=a.getProperty("xAxisTitle"))n.xAxisTitle=b.textSubstitution.formatMessage(e);if(e=a.getProperty("yAxisTitle"))n.yAxisTitle=b.textSubstitution.formatMessage(e);n.show();m.text("");o.setXData(i.indicatorData);o.setYData(l.indicatorData);h&&o.setColorData(h.indicatorData);g&&a.getProperty("sizeData")!=void 0&&o.setSizeData(g);p.setXData(i.comparisonData);p.setYData(l.comparisonData);h&&p.setColorData(h.comparisonData);
g=[];e=[];for(w=1;w<6;w++){var x=a.getProperty("line_xfield_"+w),A=a.getProperty("line_yfield_"+w);x!=void 0&&A!=void 0&&(g.push(x),e.push(A))}x=n.getLayers();for(w=0;w<g.length;w++){var A=x[w+2],z=d.getProperty(g[w]),B=f.getProperty(e[w]);if(z!=void 0&&B!=void 0){var z=z.split(","),C=[];if(ia.isNumber(B))for(var y=0;y<z.length;y++)C.push(B);else C=B.split(",");A.setXData(z);A.setYData(C)}}}c!=void 0&&c.call(null,a.id)};this.render=function(c){n.render();var d=i.indicator.precision||2,e=b.locale.formatter,
f=o.correlationInfo;b.textSubstitution.setVariable("correlationCoeff",e.format(f.correlationCoeff,d));b.textSubstitution.setVariable("rSquare",e.format(f.rSquare,d));b.textSubstitution.setVariable("gradient",e.format(f.gradient,d));b.textSubstitution.setVariable("intercept",e.format(f.intercept,d));b.updateDynamicText(b.textSubstitution);c!=void 0&&c.call(null,a.id)}};
ia.AreaProfileFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup,g=c.comparisonInteractionGroup,h=!0;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){h=!0;l.geography=f.geography});f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var k=b.getWidget(a.id),i,l;this.build=function(c){k.content.empty();var d=b.config.getComponent("profileLegend"+f.suffix);if(d){i=new ia.ProfileLegend(d.id);if(d.getProperty("layout"))i.layout=d.getProperty("layout");b.getWidget(d.id).append(i.container);
b.addComponent(d.id,i)}d=a.getProperty("useMouseClick");d==void 0&&(d=!0);l=new ia.Profile(a.id,d,function(a){b.config.template!=ia.ELECTION_REPORT&&(a=a.split("~"),f.setData(f.geography.id,a[0],a[1]))});l.geography=f.geography;if(d=b.getComponent("featureLegend"))l.colorPalette=d.colorPalette;k.append(l.container);e.addComponent(l);g.addComponent(l);b.addComponent(a.id,l);c!=void 0&&c.call(null,a.id)};this.update=function(c){var d=a.getProperties(),e=[],g=[],k;for(k in d){var q="symbol_shape_";if(k.indexOf(q)!=
-1){var q=k.substring(k.lastIndexOf("_")+1,k.length),r={};r.value=a.getProperty("symbol_value_"+q);if(r.value!=void 0)r.shape=a.getProperty("symbol_shape_"+q),r.color=a.getProperty("symbol_color_"+q),r.size=a.getProperty("symbol_size_"+q),r.label=a.getProperty("symbol_label_"+q),g[g.length]=r,q=new ia.CategoricClass(r.label),q.color=r.color,q.symbol=r.shape,q.size=r.size,q.value=r.label,e[e.length]=q}}l.symbols=g;g=[];for(k in d)if(q="target_shape_",k.indexOf(q)!=-1&&(q=k.substring(k.lastIndexOf("_")+
1,k.length),r={},r.data=a.getProperty("target_data_"+q),r.data!=void 0))r.shape=a.getProperty("target_shape_"+q),r.color=a.getProperty("target_color_"+q),r.size=a.getProperty("target_size_"+q),r.label=a.getProperty("target_label_"+q),g[g.length]=r,q=new ia.CategoricClass(r.label),q.color=r.color,q.symbol=r.shape,q.size=r.size,q.value=r.label,e[e.length]=q;l.targets=g;q={};q.data=a.getProperty("barData");q.color=a.getProperty("barColor");q.symbolValue=a.getProperty("symbolValue");q.height=a.getProperty("barHeight");
q.minValue=a.getProperty("minValue");q.midValue=a.getProperty("midValue");q.maxValue=a.getProperty("maxValue");q.breaksData=a.getProperty("breakData");q.breaksFlip=a.getProperty("breakFlipData");l.bar=q;l.displayMode=a.getProperty("displayMode");l.displayDatesInProfile=a.getProperty("displayDatesInProfile");l.useMouseClick=a.getProperty("useMouseClick");g=[];for(k in d)if(q="break_color_",k.indexOf(q)!=-1&&(q=k.substring(k.lastIndexOf("_")+1,k.length),r={},r.label=a.getProperty("break_label_"+q),
r.label!=void 0))r.color=a.getProperty("break_color_"+q),g[g.length]=r,q=new ia.CategoricClass(r.label),q.color=r.color,q.symbol=ia.Shape.SQUARE,q.size=10,q.value=r.label,e[e.length]=q;l.breaks=g;if(i)i.legendClasses=e,i.render();d=f.indicator;l.columns=a.getColumnsForIndicator(d,b.textSubstitution);l.indicator=d;l.render();h&&(d=a.getProperty("expandedThemeIds"),d!=void 0&&l.expandThemes(d),h=!1);c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.MapFactory=function(a,b,c){function d(){if(a==void 0)e();else{for(var c=m.getLayers(),d=0;d<c.length;d++){var h=c[d];g.removeComponent(h)}m.removeLayers();for(d=0;d<j.baseLayers.length;d++)h=j.baseLayers[d],h.dataLabel=b.config.getComponent(a.id).getProperty("tip"),h.interactive=!0,h.tipFunction=function(b){return ia.tipFunction(b,a.id)},h.highlightColor=b.highlightColor,h.selectionColor=b.selectionColor,h.highlightOpacity=b.highlightOpacity,h.selectionOpacity=b.selectionOpacity,g.addComponent(h);
c=j.layers.length;if(j.maintainLayerOrder)for(d=c-1;d>=0;d--)h=j.layers[d],m.addLayer(j.layers[d]);else for(d=0;d<c;d++)h=j.layers[d],m.addLayer(j.layers[d]);m.controller.defaultBBox=j.mapBBox;j.useGoogleMaps?m.render():q?m.controller.zoomToBBox(q):m.controller.zoomFull();q=void 0;i&&(i=!1,f.update(),f.render())}}function e(){m=b.getComponent("map");o=b.getComponent("activeMap");j.noneBaseLayers=[];var a=j.baseLayers[1];a==void 0&&(a=j.baseLayers[0]);if(b.config.template==ia.DOUBLE_BASELAYER_REPORT)a.dataLabel=
b.config.getComponent("map").getProperty("tip"+h.suffix),a.highlightColor=b.highlightColor,a.selectionColor=b.selectionColor,a.highlightOpacity=b.highlightOpacity,a.selectionOpacity=b.selectionOpacity,a.interactive=!0,a.dataLabel=b.config.getComponent("map").getProperty("tip"+h.suffix),a.tipFunction=function(a){return ia.tipFunction(a,"map",h.suffix)},g.addComponent(a);else if(b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)a.showDataTips=!1,a.showLabels=!1;m.addLayer(a)}var f=this,g=c.interactionGroup,
h=c.dataGroup;h.mapData.addEventListener(ia.DataEvent.MAP_DATA_CHANGED,function(){d()});h.addEventListener(ia.Event.THEMATIC_CHANGED,function(){l?i=!0:(f.update(),f.render())});h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){a.filterFeatures.length>0?o.zoomToFeatures(a.filterFeatures,[j.baseLayer]):o.controller.zoomFull()});var k,i=!1,l=!1,j,m,n,o,p,q;b.url.params["bbox"+h.suffix]&&(c=b.url.params["bbox"+h.suffix].split(","),q=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),
parseFloat(c[3])));this.build=function(c){j=h.mapData;if(a==void 0)e(),c!=void 0&&c.call(null,a?a.id:"map");else{l=!0;k=b.getWidget(a.id);k.exportFunction=function(){m.exportData(b.config.getProperty("saveImageText"))};k.content.empty();m=new ia.Map(a.id);b.addComponent(a.id,m);var f=function(){var a=m.getBBox();b.url.params["bbox"+h.suffix]=a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax()};m.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,f);m.addEventListener(ia.BBoxEvent.BBOX_SCALE,f);
var f=a.getProperty("minZoomAllowed"),i=a.getProperty("maxZoomAllowed");if(j.useGoogleMaps)o=n=new ia.GoogleMap(a.id,j.googleMapType,j.googleApiKey,f,i,a.getProperty("googleGreyscaleText"),a.getProperty("googleOffText")),n.addEventListener(ia.Event.MAP_READY,function(){j.mapBBox.getXMin()<-2E7&&j.mapBBox.setXMin(-2E7);j.mapBBox.getXMax()>2E7&&j.mapBBox.setXMax(2E7);n.controller.defaultBBox=j.mapBBox;q?n.controller.zoomToBBox(q):n.controller.zoomFull();n.addMapOverlay(m)}),b.addComponent("gMap"+h.suffix,
n);else{if(f!=-1)m.minZoom=f;if(i!=-1)m.maxZoom=i;m.useNavigation(!0);o=m}m.addEventListener(ia.Event.MAP_READY,function(){d();l=!1;c!=void 0&&c.call(null,a.id)});b.addComponent("activeMap"+h.suffix,o);k.append(o.container);p=$j('<div id="map-copyright" class="ia-map-copyright"></div>');k.append(p);b.evaluation&&b.displayEvaluationMessage(k);f=a.getProperty("includeSearchTool");f==void 0&&(f=!1);if(f&&h.suffix=="")i=document.createElement("script"),i.type="text/javascript",i.src="http://code.jquery.com/ui/1.9.2/jquery-ui.js",
document.body.appendChild(i);f=new ia.MapTools(o,h,g,j.useGoogleMaps,f);f.clearButtonText=a.getProperty("clearButtonText");f.filterButtonText=a.getProperty("filterButtonText");f.filterFunction=function(){g.getSelection().length>0?h.setFilteredFeatures(g.getSelection()):h.getFilteredFeatures().length>0&&h.clearFilter()};f.clearFunction=function(){g.clearSelection()};k.append(f.container);b.addComponent("mapTools"+h.suffix,f);f.render()}};this.update=function(b){if(a){var c=a.getProperty("copyrightText");
c==void 0||c==""?p.hide():(p.show(),p.html(c))}j.baseLayer.setData(h.indicatorData);b!=void 0&&b.call(null,a?a.id:"map")};this.render=function(b){m.render();b!=void 0&&b.call(null,a?a.id:"map")}};
ia.TextBoxFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.TextBox(a.id);f.append(g.container);b.addComponent(a.id,textbox);c!=void 0&&c.call(null,a.id)};this.update=function(c){var d="",f=a.getProperty("propertyKey");f!=void 0?(d=e.indicator.getProperty(f),d=d!=void 0?d:""):a.getProperty("text")&&(d=b.textSubstitution.formatMessage(a.getProperty("text")));
g.setHtml(d);c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.ComponentFactory.prototype.buildInteractionGroups=function(a,b,c,d){function e(c){if(c.length>0){var d=b.geography.getFeature(c[0]);d&&a.textSubstitution.setVariable("selectedFeature"+b.suffix,d.name);a.url.params["select"+b.suffix]=c.join(",")}else a.textSubstitution.setVariable("selectedFeature"+b.suffix,""),a.url.params["select"+b.suffix]="";a.updateDynamicText(a.textSubstitution)}a.addComponent("interactionGroup"+b.suffix,c);a.addComponent("comparisonInteractionGroup"+b.suffix,d);b.addEventListener(ia.DataEvent.GEOG_CHANGED,
function(){c.clearSelection();d.clearSelection()});b.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(){c.clearSelection()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){e(c.getSelection())});d.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){var c=d.getSelection();a.url.params["comparisonSelect"+b.suffix]=c.length>0?c.join(","):""});if(a.url.params["select"+b.suffix]){var f=a.url.params["select"+b.suffix].toString().split(",");e(f)}};
